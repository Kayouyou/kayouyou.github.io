<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Functional networking in Swift | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1663232760640">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="å½“æ¶‰åŠåˆ°åº”ç”¨ç¨‹åºå¼€å‘æ—¶ï¼Œç½‘ç»œæ˜¯ä¸€ä¸ªç‰¹åˆ«æœ‰è¶£çš„è¯é¢˜ã€‚ä¸€æ–¹é¢ï¼Œè¿™æ˜¯å¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½éœ€è¦çš„ä¸œè¥¿â€”â€”å¦ä¸€æ–¹é¢ï¼Œè¿™æ˜¯ä¸€ä»¶éå¸¸æ£˜æ‰‹çš„äº‹æƒ…ï¼Œå°¤å…¶æ˜¯å½“æˆ‘ä»¬å¸Œæœ›ç”Ÿæˆçš„ä»£ç æ—¢æ˜“äºé˜…è¯»ã€ç¼–å†™ï¼Œåˆæ˜“äºæµ‹è¯•çš„æ—¶å€™ã€‚
å› æ­¤ï¼Œç½‘ç»œæ˜¯ç¤¾åŒºä¸­å¤‡å—äº‰è®®çš„é¢†åŸŸä¹‹ä¸€ï¼Œä¹Ÿæ˜¯è®¸å¤šä¸åŒ..." />
    <meta name="keywords" content="networking,functional programming" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1663232760640" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Functional networking in Swift</h2>
            <div class="post-date">2019-01-06</div>
            
            <div class="post-content" v-pre>
              <p>å½“æ¶‰åŠåˆ°åº”ç”¨ç¨‹åºå¼€å‘æ—¶ï¼Œç½‘ç»œæ˜¯ä¸€ä¸ªç‰¹åˆ«æœ‰è¶£çš„è¯é¢˜ã€‚ä¸€æ–¹é¢ï¼Œè¿™æ˜¯å¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½éœ€è¦çš„ä¸œè¥¿â€”â€”å¦ä¸€æ–¹é¢ï¼Œè¿™æ˜¯ä¸€ä»¶éå¸¸æ£˜æ‰‹çš„äº‹æƒ…ï¼Œå°¤å…¶æ˜¯å½“æˆ‘ä»¬å¸Œæœ›ç”Ÿæˆçš„ä»£ç æ—¢æ˜“äºé˜…è¯»ã€ç¼–å†™ï¼Œåˆæ˜“äºæµ‹è¯•çš„æ—¶å€™ã€‚</p>
<p>å› æ­¤ï¼Œç½‘ç»œæ˜¯ç¤¾åŒºä¸­å¤‡å—äº‰è®®çš„é¢†åŸŸä¹‹ä¸€ï¼Œä¹Ÿæ˜¯è®¸å¤šä¸åŒçš„ç¬¬ä¸‰æ–¹æ¡†æ¶è‡´åŠ›äºç®€åŒ–çš„é¢†åŸŸä¹‹ä¸€ï¼Œè¿™å¹¶ä¸å¥‡æ€ªã€‚</p>
<p>æœ¬å‘¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åˆ©ç”¨è‹¹æœå†…ç½®çš„URLSession APIæ¥ç¼–å†™ç½‘ç»œä»£ç  -ä½†æ˜¯ä½¿ç”¨äº†futureå’Œpromiseï¼Œä»¥åŠä¸€äº›å‡½æ•°å¼ç¼–ç¨‹æ¦‚å¿µæ¥å¢å¼ºå®ƒï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªéå¸¸æœ‰è¶£(å¹¶ä¸”é«˜åº¦å¯æµ‹è¯•)çš„ç»“æœã€‚å°±è®©æˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿå§!</p>
<h2 id="futures-promises">Futures &amp; Promises</h2>
<p>å½“è°ˆåˆ°Swiftä¸­çš„å¼‚æ­¥ç¼–ç¨‹æ—¶ï¼ŒFutureså’ŒPromiseä¼¼ä¹æ­£åœ¨æˆä¸ºè¶Šæ¥è¶Šæµè¡Œçš„æŠ½è±¡æ¦‚å¿µï¼Œ è€Œä¸”å‡ºäºå……åˆ†çš„ç†ç”±â€”â€”ä¸å¿…ä¼ é€’å¤šä¸ªé—­åŒ…(æˆ–æ„å»ºä¸€ä¸ªå·¨å¤§çš„é—­åŒ…é‡‘å­—å¡”)ï¼ŒFutureså’ŒPromiseæä¾›äº†ä¸€ç§ä½¿ç”¨ä¸“ç”¨å¯¹è±¡å¯¹å¼‚æ­¥ç»“æœå»ºæ¨¡çš„è½»é‡çº§æ–¹æ³• -å¯ä»¥ä»å‡½æ•°è¿”å›ï¼Œé“¾æ¥ï¼Œè½¬æ¢å’Œè§‚å¯Ÿã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•æ‰©å±•URLSessionæ¥æ”¯æŒFutureså’ŒPromiseâ€”â€”åŒæ—¶å€Ÿç”¨â€œæ„é€ Swiftä¸­çš„urlâ€ä¸­çš„ç«¯ç‚¹ç±»å‹:</p>
<pre><code class="language-swift">extension URLSession {
    func request(_ endpoint: Endpoint) -&gt; Future&lt;Data&gt; {
        // Start by constructing a Promise, that will later be
        // returned as a Future    
        let promise = Promise&lt;Data&gt;()

        // Immediately reject the promise in case the passed
        // endpoint can't be converted into a valid URL
        guard let url = endpoint.url else {
            promise.reject(with: Endpoint.Error.invalidURL)
            return promise
        }

        let task = dataTask(with: url) { data, _, error in
            // Reject or resolve the promise, depending on the result
            if let error = error {
                promise.reject(with: error)
            } else {
                promise.resolve(with: data ?? Data())
            }
        }

        task.resume()

        return promise
    }
}
</code></pre>
<p>future &amp; Promisesçš„ä¸€å¤§ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå…è®¸æˆ‘ä»¬é€šè¿‡å®é™…è°ƒç”¨ç±»å‹ä¸Šçš„æ–¹æ³•æ¥è½»æ¾è½¬æ¢å¼‚æ­¥ç»“æœï¼Œè€Œä¸å¿…ä½¿ç”¨åµŒå¥—çš„é—­åŒ…ã€‚ å› æ­¤ï¼Œä¸ºäº†ä½¿ä¸Šè¿°ç½‘ç»œAPIçš„ç»“æœæ˜“äºè§£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°åœ¨Futureä¸Šæ·»åŠ ä¸€ä¸ªå€¼ç±»å‹ä¸ºDataçš„æ‰©å±•â€”â€”åƒè¿™æ ·:</p>
<pre><code class="language-swift">extension Future where Value == Data {
    func decoded&lt;T: Decodable&gt;() -&gt; Future&lt;T&gt; {
        return decoded(as: T.self, using: JSONDecoder())
    }
}
</code></pre>
<p>ç»“åˆä¸Šè¿°ä¸¤ä¸ªapiï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨Futureså’ŒPromiseçš„åŠ›é‡æ¥æ‰§è¡Œç½‘ç»œè°ƒç”¨ï¼Œ åŒæ—¶ä¾èµ–Swiftçš„ç±»å‹æ¨æ–­å°†ä¸‹è½½çš„æ•°æ®è§£ç ä¸ºæ­£ç¡®çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¤„ç†äº§å“ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åƒè¿™æ ·å®ç°æˆ‘ä»¬çš„äº§å“åŠ è½½ä»£ç :</p>
<pre><code class="language-swift">class ProductLoader {
    private let urlSession: URLSession

    init(urlSession: URLSession = .shared) {
        self.urlSession = urlSession
    }

    func loadProduct(withID id: Product.ID) -&gt; Future&lt;Product&gt; {
        let endpoint = Endpoint.product(withID: id)
        return urlSession.request(endpoint).decoded()
    }
}
</code></pre>
<p>ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ ‡å‡†çš„ä¾èµ–æ³¨å…¥,é€šè¿‡æ³¨å…¥URLSessionæˆ‘ä»¬å¸Œæœ›åœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨çš„ä¸€ä¸ªå®ä¾‹ProductLoader(æˆ‘ä»¬ä¹Ÿä½¿ç”¨.sharedä½œä¸ºä¸€ä¸ªé»˜è®¤çš„å‚æ•°ä½¿æˆ‘ä»¬çš„APIå¾ˆå®¹æ˜“ä½¿ç”¨,åŒæ—¶è¿˜èƒ½ç»™æˆ‘ä»¬æ‰€éœ€è¦çš„çµæ´»æ€§ç­‰æµ‹è¯•)ã€‚</p>
<h2 id="a-simple-signature">A simple signature</h2>
<p>å½“éœ€è¦æ›´å¤æ‚çš„åŠ è½½é€»è¾‘æ—¶ï¼Œä½¿ç”¨ç±»å‹æ¥åŠ è½½æ¨¡å‹(å°±åƒæˆ‘ä»¬åœ¨ä¸Šé¢ä½¿ç”¨ProductLoaderæ‰€åšçš„é‚£æ ·)æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆ-å½“æˆ‘ä»¬æƒ³è¦åšçš„åªæ˜¯æ‰§è¡Œå•ä¸ªç½‘ç»œè°ƒç”¨å¹¶è§£ç ç»“æœæ—¶ï¼Œå®ƒå¯èƒ½ä¼šæ„Ÿè§‰æœ‰ç‚¹æ²‰é‡ã€‚</p>
<p>ä»”ç»†æƒ³æƒ³ï¼Œä¸Šé¢çš„äº§å“åŠ è½½ä»£ç å®é™…ä¸Šå¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªäº§å“IDå¹¶è¿”å›ä¸€ä¸ªfuture:</p>
<pre><code class="language-swift">typealias ProductLoading = (Product.ID) -&gt; Future&lt;Product&gt;
</code></pre>
<p>å¦‚æœæˆ‘ä»¬çš„ç½‘ç»œä»£ç èƒ½åƒè¿™æ ·ï¼Œä¸æ˜¯å¾ˆé…·å—?ä¸éœ€è¦å®ä¾‹åŒ–ä»»ä½•ç±»æˆ–å…¶ä»–ç±»å‹å°±å¯ä»¥è½»æ¾è°ƒç”¨çš„ç®€å•å‡½æ•°? è®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬æ˜¯å¦å¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„æ–¹å¼å·¥ä½œï¼Œä½¿ç”¨ä¸€ç³»åˆ—æ­¥éª¤ï¼ŒåŒ…æ‹¬åœ¨æˆ‘ä»¬çš„ç½‘ç»œä»£ç ä¸­å¼•å…¥ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹æ¦‚å¿µã€‚</p>
<p>å‡½æ•°å¼ç¼–ç¨‹çš„å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯é€šè¿‡å‡½æ•°çš„è§’åº¦æ¥æ¨ç†ç¨‹åºçš„é€»è¾‘â€”â€”é€šè¿‡åŒ¹é…å¯ä»¥é€šè¿‡è¾“å…¥å’Œè¾“å‡ºè¿æ¥åœ¨ä¸€èµ·çš„å‡½æ•°ã€‚ä»¥è¿™ç§æ–¹å¼ç ”ç©¶æˆ‘ä»¬çš„ç½‘ç»œä»£ç ï¼Œè®©æˆ‘ä»¬é¦–å…ˆå›åˆ°æœ€åˆæ·»åŠ åˆ°URLSessionçš„è¯·æ±‚æ–¹æ³•ï¼Œå¹¶çœ‹çœ‹å®ƒçš„ç­¾å:</p>
<pre><code class="language-swift">extension URLSession {
    func request(_ endpoint: Endpoint) -&gt; Future&lt;Data&gt; {
        ...
    }
}
</code></pre>
<p>ä¸ç®¡åœ¨æ–¹æ³•å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Œåœ¨å¤–éƒ¨ä¸–ç•Œ-è¿™æ˜¯è¿™ä¸ªå‡½æ•°çœ‹èµ·æ¥åƒ:</p>
<pre><code class="language-swift">typealias Networking = (Endpoint) -&gt; Future&lt;Data&gt;
</code></pre>
<p>å¦‚æœæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†æˆ‘ä»¬çš„ç½‘ç»œä»£ç å®šä¹‰ä¸ºä¸€ä¸ªä»ç«¯ç‚¹åˆ°Future<Data>çš„å‡½æ•°ï¼Œé‚£å°†ä¼šéå¸¸å¼ºå¤§ã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œä¸éœ€è¦è®©ProductLoaderä¿æŒå¯¹å½“å‰URLSessionçš„å¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è®©å®ƒæ¥å—ä»»ä½•åŒ¹é…ç½‘ç»œç­¾åçš„å‡½æ•°â€”â€”åƒè¿™æ ·:</p>
<pre><code class="language-swift">class ProductLoader {
    private let networking: Networking

    init(networking: @escaping Networking = URLSession.shared.request) {
        self.networking = networking
    }

    func loadProduct(withID id: Product.ID) -&gt; Future&lt;Product&gt; {
        let endpoint = Endpoint.product(withID: id)
        return networking(endpoint).decoded()
    }
}
</code></pre>
<p>æˆ‘ä»¬å†æ¬¡ä½¿ç”¨é»˜è®¤å‚æ•°(è¿™ä¸€æ¬¡é€šè¿‡ä¼ é€’è¯·æ±‚å‡½æ•°æœ¬èº«)ï¼Œä½¿æˆ‘ä»¬çš„APIæ›´æ˜“äºä½¿ç”¨ã€‚</p>
<p>ä¸Šé¢çš„æ”¹å˜å·²ç»æ˜¯ä¸€ä¸ªå·¨å¤§çš„èƒœåˆ©ï¼Œå› ä¸ºæˆ‘ä»¬ä»æœ¬è´¨ä¸Šç§»é™¤äº†ProductLoaderä»¥å‰å¯¹URLSessionçš„ç¡¬ä¾èµ–-è¿™æ—¢ä½¿æµ‹è¯•æ›´å®¹æ˜“ï¼Œä¹Ÿæœ‰åŠ©äºæˆ‘ä»¬çš„ä»£ç ä¸å—æœªæ¥çš„å½±å“(å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨æœªæ¥é‡‡ç”¨å¦ä¸€ä¸ªç½‘ç»œæ¡†æ¶ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯æ”¹å˜é»˜è®¤å‚æ•°)ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬æ‰åˆšåˆšå¼€å§‹ğŸ˜‰ã€‚</p>
<h2 id="combining-functions-and-values">Combining functions and values</h2>
<p>Swiftç¬¬ä¸€ç±»å‡½æ•°åŠŸèƒ½çš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œå®ƒå…è®¸æˆ‘ä»¬åƒä¼ é€’é—­åŒ…ä¸€æ ·ä¼ é€’å‡½æ•°â€”â€”æˆ–è€…ä¼ é€’ä»»ä½•å…¶ä»–å€¼ã€‚å°±åƒæˆ‘ä»¬å‰é¢ä¼ é€’ursession .share .requestä½œä¸ºå‚æ•°ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å…¶ä»–å‡½æ•°åšåŒæ ·çš„äº‹æƒ…ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªæ›´ä¸“ä¸šçš„ç½‘ç»œç‰ˆæœ¬ï¼Œå®ƒåªèƒ½ç”¨äºåŠ è½½å•ä¸ªäº§å“ - ä½†å°†ä½¿æˆ‘ä»¬è¿™æ ·åšï¼Œè€Œä¸éœ€è¦æä¾›ä»»ä½•äº§å“IDåœ¨å‘¼å«åœ°ç‚¹ã€‚è¿™å°±è¦æ±‚æˆ‘ä»¬å°†ç½‘ç»œåŠŸèƒ½ä¸äº§å“IDç›¸ç»“åˆï¼Œå½¢æˆä¸€ä¸ªå…¨æ–°çš„åŠŸèƒ½ã€‚</p>
<p>ä¸ºäº†èƒ½å¤Ÿåœ¨ä¸€èˆ¬æƒ…å†µä¸‹è½»æ¾åœ°åšåˆ°è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªcombineå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå€¼å¹¶å°†å…¶å†…è”åˆ°ç»™å®šçš„å‡½æ•°ä¸­ -äº§ç”Ÿä¸€ä¸ªä¸éœ€è¦ä»»ä½•å‚æ•°å°±å¯ä»¥è°ƒç”¨çš„æ–°å‡½æ•°ï¼Œåƒè¿™æ ·:</p>
<pre><code class="language-swift">// This turns an (A) -&gt; B function into a () -&gt; B function,
// by using a constant value for A.
func combine&lt;A, B&gt;(_ value: A,
                   with closure: @escaping (A) -&gt; B) -&gt; () -&gt; B {
    return { closure(value) }
}
</code></pre>
<p>åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸–ç•Œä¸­ï¼Œä¸Šè¿°æŠ€æœ¯è¢«ç§°ä¸ºéƒ¨åˆ†åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”åœ¨æŸäº›è¯­è¨€(å¦‚c++)ä¸­ä¹Ÿè¢«å®ç°ä¸ºbindã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œå®ƒç°åœ¨è®©æˆ‘ä»¬èƒ½å¤Ÿåšçš„æ˜¯å°†æˆ‘ä»¬çš„äº§å“ç«¯ç‚¹ä¸æˆ‘ä»¬çš„ç½‘ç»œåŠŸèƒ½ç»“åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå¯ä»¥ç›´æ¥è°ƒç”¨çš„ä¸“é—¨ç‰ˆæœ¬:</p>
<pre><code class="language-swift">func loadProduct(withID id: Product.ID) -&gt; Future&lt;Product&gt; {
    let endpoint = Endpoint.product(withID: id)
    let networking = combine(endpoint, with: self.networking)

    // Our new networking function can now be called without
    // having to supply a product ID at the call site.
    return networking().decoded()
}
</code></pre>
<p>å•ç‹¬æ¥çœ‹ï¼Œä¸Šé¢çš„æ›´æ”¹å¯èƒ½çœ‹èµ·æ¥ä¸é‚£ä¹ˆä»¤äººå°è±¡æ·±åˆ»â€”â€”æ¯•ç«Ÿæˆ‘ä»¬å®é™…ä¸Šå·²ç»æ·»åŠ äº†æ›´å¤šä»£ç æ¥åšåŒæ ·çš„äº‹æƒ…ğŸ¤”ã€‚ä½†æ˜¯è®©æˆ‘ä»¬ç»§ç»­æ‹‰è¿™ä¸ªçº¿ï¼Œçœ‹çœ‹æˆ‘ä»¬ä¼šåœ¨å“ªé‡Œç»“æŸã€‚</p>
<h2 id="a-functional-chain">A functional chain</h2>
<p>å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µæ˜¯å‡½æ•°ç»„åˆâ€”â€”å³å¤šä¸ªå‡½æ•°å¯ä»¥ç»„åˆæˆä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚</p>
<p>ç±»ä¼¼äºå¦‚ä½•ä½¿ç”¨åƒå­è§†å›¾æ§åˆ¶å™¨è¿™æ ·çš„æŠ€æœ¯ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä»å¤šä¸ªæ›´å°çš„æ„å»ºå—æ¥ç»„åˆæˆ‘ä»¬çš„UI-ä½¿ç”¨å‡½æ•°ç»„åˆä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†éš”ç¦»åœ¨å°å‡½æ•°ä¸­ï¼Œ åŒæ—¶ä»èƒ½ä½¿å®ƒä»¬åœ¨å‘¼å«åœ°ç‚¹ä½œä¸ºä¸€ä¸ªå•å…ƒä½¿ç”¨ã€‚</p>
<p>ç»„åˆå‡½æ•°çš„ä¸€ç§æ–¹æ³•æ˜¯ç®€å•åœ°å°†ä¸¤ä¸ªå‡½æ•°é“¾æ¥åœ¨ä¸€èµ·ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°(é€šå¸¸ç§°ä¸ºå†…éƒ¨å‡½æ•°)çš„è¾“å‡ºç›´æ¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™ç¬¬äºŒä¸ª(æˆ–å¤–éƒ¨)å‡½æ•°ã€‚ä¸ºäº†å®ç°è¿™ç§ç»„åˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªåŠ©æ‰‹å‡½æ•°â€”â€”ç±»ä¼¼äºcombineâ€”â€”è®©æˆ‘ä»¬è¿™æ ·åš:</p>
<pre><code class="language-swift">// This turns an (A) -&gt; B and a (B) -&gt; C function into a
// (A) -&gt; C function, by chaining them together.
func chain&lt;A, B, C&gt;(_ inner: @escaping (A) -&gt; B,
                    to outer: @escaping (B) -&gt; C) -&gt; (A) -&gt; C {
    return { outer(inner($0)) }
}
</code></pre>
<p>ä½¿ç”¨ä¸Šé¢çš„chainå‡½æ•°ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥è·å¾—é™æ€Endpoint.productæ–¹æ³•ï¼Œå¹¶å°†å…¶ä¸æˆ‘ä»¬çš„ç½‘ç»œåŠŸèƒ½ç›¸ç»“åˆï¼Œä»è€Œäº§ç”Ÿå¦ä¸€ä¸ªä¸“ç”¨ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬åªèƒ½ä½¿ç”¨äº§å“IDè°ƒç”¨ - å› ä¸ºæˆ‘ä»¬çš„é“¾ä¼šæŠŠIDè½¬æ¢æˆä¸€ä¸ªç«¯ç‚¹ï¼Œç„¶ååè¿‡æ¥æŠŠè¿™ä¸ªç«¯ç‚¹ä¼ é€’ç»™æˆ‘ä»¬çš„ç½‘ç»œåŠŸèƒ½:</p>
<pre><code class="language-swift">func loadProduct(withID id: Product.ID) -&gt; Future&lt;Product&gt; {
    let networking = chain(Endpoint.product, to: self.networking)
    return networking(id).decoded()
}
</code></pre>
<p>å†æ¬¡å¼ºè°ƒï¼Œä¹Ÿè®¸å•ç‹¬æ¥è®²å¹¶ä¸æ˜¯éå¸¸æœ‰ç”¨â€”â€”ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å·²ç»å¼€å§‹å–å¾—ä¸€äº›è¿›å±•äº†!ğŸ˜€</p>
<h2 id="currying">Currying</h2>
<p>æˆ‘ä»¬å°†åœ¨ç½‘ç»œä»£ç ä¸­å¼•å…¥çš„æœ€åä¸€ä¸ªå‡½æ•°ç¼–ç¨‹æ¦‚å¿µæ˜¯curry -å½“ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„ç»“æœæ˜¯å¦ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œç„¶åç›´æ¥è°ƒç”¨ã€‚åœ¨Swiftä¸­ï¼Œcurryå®é™…ä¸Šæ¯”å®ƒæœ€åˆçœ‹èµ·æ¥æ›´å¸¸è§â€”â€”äº‹å®ä¸Šï¼Œæ‰€æœ‰å®ä¾‹æ–¹æ³•å®é™…ä¸Šéƒ½æ˜¯é€šè¿‡åœ¨åº•å±‚curryé™æ€æ–¹æ³•æ¥å®ç°çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªLetterç±»ï¼Œå®ƒæœ‰ä¸€ä¸ªopenæ–¹æ³•:</p>
<pre><code class="language-swift">class Letter {
    func open() {
        ...
    }
}
</code></pre>
<p>è°ƒç”¨ä¸Šè¿°æ–¹æ³•çš„â€œæ­£å¸¸â€æ–¹æ³•æ˜¯è¿™æ ·åšçš„:</p>
<pre><code class="language-swift">let letter = Letter()
letter.open()
</code></pre>
<p>ä½†æ˜¯åŒæ ·æ­£ç¡®çš„æ–¹æ³•æ˜¯ä½¿ç”¨curryingâ€”â€”é€šè¿‡è°ƒç”¨openæ–¹æ³•çš„é™æ€ç­‰æ•ˆå‡½æ•° ï¼Œä¼ å…¥æˆ‘ä»¬å¸Œæœ›è·å¾—ä¸€ä¸ªå‡½æ•°çš„å®ä¾‹ï¼Œç„¶ååœ¨å®ƒè¿”å›æ—¶ç›´æ¥è°ƒç”¨å®ƒâ€”â€”åƒè¿™æ ·:</p>
<pre><code class="language-swift">let letter = Letter()
Letter.open(letter)()
</code></pre>
<p>è¿™ä¼¼ä¹ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨ä¸Šé¢çš„æŠ€æœ¯å®é™…ä¸Šä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸äº‹å…ˆçŸ¥é“å®ä¾‹çš„æƒ…å†µä¸‹ç»„åˆå®ä¾‹æ–¹æ³•â€”â€”è¿™éå¸¸é…·ã€‚</p>
<p>è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºå¦ä¸€ä¸ªé“¾çš„é‡è½½ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä¼ é€’ä¸€ä¸ªcurryè¿‡çš„å‡½æ•°ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚ç”±äºè¿™äº›å‡½æ•°è¿”å›å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå…¶ç»“æœï¼Œæˆ‘ä»¬çš„æ–°é‡è½½å¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-swift">// This turns an (A) -&gt; B and a (B) -&gt; () -&gt; C function into a
// (A) -&gt; C function, by chaining them together.
func chain&lt;A, B, C&gt;(
    _ inner: @escaping (A) -&gt; B,
    to outer: @escaping (B) -&gt; () -&gt; C
) -&gt; (A) -&gt; C {
    // Similar to our previous version of chain, we pass the result
    // of the inner function into the outer one â€” but since that
    // now returns another function, we'll also call that one.
    return { outer(inner($0))() }
}
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ä¾‹æ–¹æ³•é“¾æ¥èµ·æ¥ï¼Œè€Œä¸å¿…é¦–å…ˆçŸ¥é“å®ƒä»¬å°†åº”ç”¨äºå“ªä¸ªå®ä¾‹ - æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†æœªæ¥æ‰©å±•ä¸­çš„è§£ç æ–¹æ³•æ·»åŠ åˆ°æˆ‘ä»¬çš„é“¾ä¸­ï¼Œ è¿™æ ·å°±äº§ç”Ÿäº†ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒåŒ…å«äº†ä½¿ç”¨ç»™å®šIDåŠ è½½äº§å“æ‰€éœ€çš„æ‰€æœ‰å†…å®¹:</p>
<pre><code class="language-swift">func loadProduct(withID id: Product.ID) -&gt; Future&lt;Product&gt; {
    let networking = chain(Endpoint.product, to: self.networking)
    return chain(networking, to: Future.decoded)(id)
}
</code></pre>
<p>æ‹¥æœ‰ä¸Šè¿°ä¸¤ç§ç±»å‹çš„é“¾æ¥æ˜¯éå¸¸å¼ºå¤§çš„â€”â€”å®ƒè®©æˆ‘ä»¬ä»¥å…¨æ–°çš„æ–¹å¼æ¥å¤„ç†å‡½æ•°â€”â€”å°¤å…¶æ˜¯å½“æˆ‘ä»¬å¼€å§‹å°†åˆ°ç›®å‰ä¸ºæ­¢æ‰€åšçš„æ‰€æœ‰äº‹æƒ…æ”¾åœ¨ä¸€èµ·æ—¶ã€‚</p>
<h2 id="a-functional-composition">A functional composition</h2>
<p>ä¹ä¸€çœ‹ï¼Œåƒæˆ‘ä»¬ç›®å‰æ‰€åšçš„é‚£æ ·ä½¿ç”¨å‡½æ•°æ¦‚å¿µä¼¼ä¹åªæ˜¯ä¸€ä¸ªçº¯ç²¹çš„ç†è®ºç»ƒä¹ ï¼Œæ²¡æœ‰å¤šå°‘å®ç”¨ä»·å€¼ - å½“è¿™äº›æ¦‚å¿µå•ç‹¬ä½¿ç”¨æ—¶ï¼Œè¿™å¯èƒ½æ˜¯å¯¹çš„ï¼Œä½†ä¸€æ—¦å®ƒä»¬ç»“åˆèµ·æ¥ï¼Œæˆ‘ä»¬å°±èƒ½åšä¸€äº›çœŸæ­£å¼ºå¤§çš„äº‹æƒ…ã€‚</p>
<p>é¦–å…ˆï¼Œæœ€åˆçš„æƒ³æ³•æ˜¯å°†äº§å“çš„ä»£ç åŠ è½½åˆ°å•ä¸ªå‡½æ•°ä¸­ï¼Œç°åœ¨åªéœ€è¦ä½¿ç”¨ä¸¤ä¸ªé“¾é‡è½½ï¼Œå°†éœ€è¦çš„å•ä¸ªå‡½æ•°ç»„åˆæˆä¸€ä¸ªå¯ä»¥ç›´æ¥ä½¿ç”¨çš„å‡½æ•°â€”ä¸éœ€è¦ä»»ä½•ProductLoaderç±»å‹:</p>
<pre><code class="language-swift">extension URLSession {
    var productNetworking: (Product.ID) -&gt; Future&lt;Product&gt; {
        let networking = chain(Endpoint.product, to: request)
        return chain(networking, to: Future.decoded)
    }
}
</code></pre>
<p>è¿™åè¿‡æ¥åˆä½¿æˆ‘ä»¬èƒ½å¤Ÿä»æˆ‘ä»¬ä»£ç åº“çš„å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸­å®Œå…¨æ¶ˆé™¤å¯¹ç½‘ç»œçš„æ„è¯† -å› ä¸ºä¸ºäº†åŠ è½½æ¨¡å‹æˆ–æ‰§è¡Œå¦ä¸€ç§ç½‘ç»œç»‘å®šæ“ä½œï¼Œ æˆ‘ä»¬ç°åœ¨åªéœ€è¦ä¸€ä¸ªåŒ¹é…æ‰€éœ€ç­¾åçš„å‡½æ•°â€”â€”æˆ‘ä»¬ä¸éœ€è¦ä¾èµ–ä»»ä½•å…·ä½“ç±»å‹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ProductViewControllerå¦‚ä½•å°†å…¶åº•å±‚ç½‘ç»œå®Œå…¨æŠ½è±¡å‡ºæ¥-å¹¶æ¥å—ä¸€ä¸ªè¿”å›Future<Product>çš„å‡½æ•°:</p>
<pre><code class="language-swift">class ProductViewController: UIViewController {
    typealias Loading = () -&gt; Future&lt;Product&gt;

    private let loading: Loading

    init(loading: @escaping Loading) {
        self.loading = loading
        super.init(nibName: nil, bundle: nil)
    }

    override func viewWillAppear(_ animated: Bool) {
        super.viewWillAppear(animated)

        // To load the view controller's product, we now
        // simply have to call the injected closure, and
        // observe the returned future.
        loading().observe { [weak self] result in
            switch result {
            case .value(let product):
                self?.render(product)
            case .error(let error):
                self?.handle(error)
            }
        }
    }
}
</code></pre>
<p>å½“éµå¾ªä¸Šè¿°æ–¹æ³•æ—¶ï¼Œæ„é€ è§†å›¾æ§åˆ¶å™¨ä¹Ÿå˜å¾—è¶…çº§ç®€å•-å› ä¸ºæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯ä½¿ç”¨æˆ‘ä»¬çš„combineå‡½æ•°æ¥åˆ›å»ºæ­£ç¡®çš„åŠ è½½å‡½æ•°ï¼Œé€šè¿‡å°†æˆ‘ä»¬çš„è¯·æ±‚æ‰€åŸºäºçš„æ•°æ®ä¸åº•å±‚ç½‘ç»œåŠŸèƒ½ç›¸ç»“åˆ:</p>
<pre><code class="language-swift">func makeProductViewController(forID id: Product.ID) -&gt; UIViewController {
    let networking = combine(id, with: URLSession.shared.productNetworking)
    return ProductViewController(loading: networking)
}
</code></pre>
<p>æœ€åâ€”â€”ä¹Ÿè®¸æ˜¯æœ€å¥½çš„ä¸€ç‚¹â€”â€”ä½¿ç”¨åŠŸèƒ½æ€§æ–¹æ³•è¿›è¡Œè”ç½‘çš„æµ‹è¯•ä»£ç å˜å¾—å¾®ä¸è¶³é“ã€‚å› ä¸ºæˆ‘ä»¬çš„è§†å›¾æ§åˆ¶å™¨(å’Œå…¶ä»–ä¾èµ–äºç½‘ç»œè°ƒç”¨çš„ä»£ç )ä¸å†ä¾èµ–äºæˆ‘ä»¬å®é™…çš„ç½‘ç»œä»£ç ï¼Œåœ¨ç¼–å†™æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯ä¼ å…¥å‡½æ•°ï¼Œè¿”å›æˆ‘ä»¬æµ‹è¯•æ‰€åŸºäºçš„å€¼:</p>
<pre><code class="language-swift">let viewController = ProductViewController {
    let product = Product(id: 7, name: &quot;iPad Pro&quot;)
    return Promise(value: product)
}
</code></pre>
<p>æˆ‘ä»¬ä¸ä»…å‡å°‘äº†éœ€è¦ç»´æŠ¤çš„ç±»å‹çš„æ•°é‡ï¼Œè¿˜å¯ç”¨äº†ä¸éœ€è¦ä»»ä½•åè®®æˆ–é¢å¤–åŸºç¡€è®¾æ–½çš„å¯æµ‹è¯•æ€§-ç”±äºæˆ‘ä»¬æ‰€åšçš„ä¸€åˆ‡éƒ½æ˜¯ç»„åˆå‡½æ•°-æˆ‘ä»¬çš„ä»£ç åº”è¯¥ä¿æŒé«˜åº¦å¯é‡ç”¨æ€§ã€‚å¾ˆé…·!ğŸ˜</p>
<h2 id="conclusion">Conclusion</h2>
<p>å‡½æ•°å¼ç¼–ç¨‹ä»ç„¶æ˜¯æˆ‘å’ŒSwiftç¤¾åŒºçš„è®¸å¤šå…¶ä»–äººéå¸¸æ„Ÿå…´è¶£çš„ä¸€ä¸ªé¢†åŸŸã€‚è™½ç„¶æœ¬æ–‡çš„è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è¿›ä¸€æ­¥ä½¿ç”¨-ä¾‹å¦‚ï¼Œåœ¨å‡½æ•°ç»„åˆå’Œè½¬å‘åº”ç”¨ä¸­ä½¿ç”¨å¸¸è§çš„æ“ä½œç¬¦ -ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹æ¦‚å¿µä½œä¸ºçµæ„Ÿï¼Œç„¶åå®ç°æˆ‘ä»¬è‡ªå·±çš„â€œé£æ ¼â€ï¼Œå°±å¯ä»¥åœ¨è‹¹æœsdkçš„é¢å‘å¯¹è±¡ä¸–ç•Œå’Œâ€œçº¯â€å‡½æ•°å¼ç¼–ç¨‹ä¸–ç•Œä¹‹é—´æä¾›ä¸€ä¸ªä¼Ÿå¤§çš„ä¸­é—´åœ°å¸¦ã€‚</p>
<p>æˆ‘ç¡®ä¿¡æˆ‘ä»¬å°†åœ¨ä»¥åçš„æ–‡ç« ä¸­ç»§ç»­æ¢è®¨å‡½æ•°å¼ç¼–ç¨‹ã€‚ ä¸å¤§å¤šæ•°äº‹æƒ…ä¸€æ ·ï¼Œé‡è¦çš„æ˜¯ä¸ºä»»ä½•ç»™å®šçš„é¡¹ç›®æ‰¾åˆ°å„ç§æ¦‚å¿µä¹‹é—´çš„æ­£ç¡®å¹³è¡¡â€”â€”å¹¶ä»”ç»†è€ƒè™‘å°†å“ªäº›æ¦‚å¿µå¼•å…¥ä»£ç åº“ã€‚ä½†æ˜¯å¯¹äºç½‘ç»œæ¥è¯´ï¼Œè®¸å¤šåŠŸèƒ½æ¦‚å¿µè¢«è¯æ˜æ˜¯éå¸¸é€‚åˆçš„ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºæˆ‘ä»¬ç»å¸¸å¤„ç†çº¯ç²¹çš„æ•°æ®è½¬æ¢ã€‚</p>
<p><a href="https://www.swiftbysundell.com/articles/functional-networking-in-swift/">åŸæ–‡é“¾æ¥</a></p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/EV0rk5a8R1/" class="tag">
                    networking
                  </a>
                
                  <a href="https://kayouyou.github.io/tag/Jn075RYwWt/" class="tag">
                    functional programming
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/slot-based-ui-development-in-swift/">
                  <h3 class="post-title">
                    Slot-based UI development in Swift
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
