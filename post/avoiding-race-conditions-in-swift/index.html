<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Avoiding race conditions in Swift | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1663221929783">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ç«äº‰æ¡ä»¶æ˜¯å½“æ“ä½œåºåˆ—çš„é¢„æœŸå®Œæˆé¡ºåºå˜å¾—ä¸å¯é¢„æµ‹æ—¶å‘ç”Ÿçš„æƒ…å†µï¼Œå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºé€»è¾‘æœ€ç»ˆå¤„äºæœªå®šä¹‰çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨å†…å®¹å®Œå…¨åŠ è½½ä¹‹å‰æ›´æ–°UIï¼Œæˆ–è€…åœ¨ç”¨æˆ·å®Œå…¨ç™»å½•ä¹‹å‰ï¼Œæ„å¤–åœ°æ˜¾ç¤ºä¸€ä¸ªåªé’ˆå¯¹å·²ç™»å½•ç”¨æˆ·çš„å±å¹•ã€‚
ç«æ€æ¡ä»¶ä¸€å¼€å§‹å¯èƒ½çœ‹èµ·æ¥æ˜¯éšæœºçš„..." />
    <meta name="keywords" content="concurrency,GCD,code structure" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1663221929783" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Avoiding race conditions in Swift</h2>
            <div class="post-date">2018-11-04</div>
            
            <div class="post-content" v-pre>
              <p>ç«äº‰æ¡ä»¶æ˜¯å½“æ“ä½œåºåˆ—çš„é¢„æœŸå®Œæˆé¡ºåºå˜å¾—ä¸å¯é¢„æµ‹æ—¶å‘ç”Ÿçš„æƒ…å†µï¼Œå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºé€»è¾‘æœ€ç»ˆå¤„äºæœªå®šä¹‰çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨å†…å®¹å®Œå…¨åŠ è½½ä¹‹å‰æ›´æ–°UIï¼Œæˆ–è€…åœ¨ç”¨æˆ·å®Œå…¨ç™»å½•ä¹‹å‰ï¼Œæ„å¤–åœ°æ˜¾ç¤ºä¸€ä¸ªåªé’ˆå¯¹å·²ç™»å½•ç”¨æˆ·çš„å±å¹•ã€‚</p>
<p>ç«æ€æ¡ä»¶ä¸€å¼€å§‹å¯èƒ½çœ‹èµ·æ¥æ˜¯éšæœºçš„ï¼Œè€Œä¸”è°ƒè¯•èµ·æ¥éå¸¸æ£˜æ‰‹â€”â€”å› ä¸ºé€šå¸¸å¾ˆéš¾(ç”šè‡³ä¸å¯èƒ½)ä¸ºå®ƒä»¬æå‡ºå¯é çš„å¤åˆ¶æ­¥éª¤ã€‚æœ¬å‘¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹å¯èƒ½å¯¼è‡´ç«æ€æ¡ä»¶çš„å¸¸è§åœºæ™¯ï¼Œä»¥åŠé¿å…ç«æ€æ¡ä»¶çš„å¯èƒ½æ–¹æ³•â€”â€”ä»¥åŠæˆ‘ä»¬å¦‚ä½•ä½¿æˆ‘ä»¬çš„ä»£ç åœ¨è¿‡ç¨‹ä¸­æ›´åŠ å¥å£®å’Œå¯é¢„æµ‹ã€‚</p>
<h2 id="an-unpredictable-race">An unpredictable race</h2>
<p>è®©æˆ‘ä»¬ä»çœ‹ä¸€ä¸ªç¤ºä¾‹å¼€å§‹ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªAccessTokenServiceï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åœ°æ£€ç´¢è®¿é—®ä»¤ç‰Œï¼Œä»¥æ‰§è¡ŒæŸç§å½¢å¼çš„ç»è¿‡èº«ä»½éªŒè¯çš„ç½‘ç»œè¯·æ±‚ã€‚ æˆ‘ä»¬çš„æœåŠ¡æ˜¯ç”¨ä¸€ä¸ªAccessTokenLoaderåˆå§‹åŒ–çš„ï¼Œå®ƒæ‰§è¡Œå®é™…çš„ç½‘ç»œæ“ä½œï¼Œè€ŒæœåŠ¡æœ¬èº«ä½œä¸ºé¡¶çº§APIå¤„ç†ç¼“å­˜å’Œä»¤ç‰ŒéªŒè¯â€”â€”çœ‹èµ·æ¥åƒè¿™æ ·:</p>
<pre><code class="language-swift">class AccessTokenService {
    typealias Handler = (Result&lt;AccessToken&gt;) -&gt; Void

    private let loader: AccessTokenLoader
    private var token: AccessToken?
    
    init(loader: AccessTokenLoader) {
        self.loader = loader
    }
    func retrieveToken(then handler: @escaping Handler) {
        // If we have a cached token that is still valid, simply
        // return that directly as the result.
        if let token = token, token.isValid {
            return handler(.value(token))
        }
        loader.load { [weak self] result in
            // Cache the loaded token, then pass the result
            // along to the given handler.
            self?.token = result.value
            handler(result)
        }
    }
}
</code></pre>
<p>ä¸Šé¢çš„ç±»å¯èƒ½çœ‹èµ·æ¥éå¸¸ç®€å•ï¼Œå¦‚æœå•ç‹¬ä½¿ç”¨çš„è¯â€”â€”ç¡®å®å¦‚æ­¤ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä»”ç»†è§‚å¯Ÿæˆ‘ä»¬çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœretrieveTokenæ–¹æ³•è¢«è°ƒç”¨ä¸¤æ¬¡ -ç¬¬äºŒæ¬¡è°ƒç”¨å‘ç”Ÿåœ¨åŠ è½½å™¨å®ŒæˆåŠ è½½ä¹‹å‰-æˆ‘ä»¬æœ€ç»ˆä¼šåŠ è½½ä¸¤ä¸ªè®¿é—®ä»¤ç‰Œã€‚å¯¹äºä¸€äº›èº«ä»½éªŒè¯æœåŠ¡å™¨æ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå› ä¸ºåœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´é€šå¸¸åªæœ‰ä¸€ä¸ªè®¿é—®ä»¤ç‰Œæœ‰æ•ˆ--å½“ç¬¬äºŒä¸ªè¯·æ±‚ä½¿ç¬¬ä¸€ä¸ªè¯·æ±‚çš„ç»“æœæ— æ•ˆæ—¶ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½ä¼šä»¥ä¸€ä¸ªç«äº‰æ¡ä»¶ç»“æŸã€‚</p>
<h2 id="enqueueing-pending-handlers">Enqueueing pending handlers</h2>
<p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ‰èƒ½é˜²æ­¢è¿™ç§ç«æ€æ¡ä»¶çš„å‘ç”Ÿå‘¢?æˆ‘ä»¬å¯ä»¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ç¡®ä¿æ²¡æœ‰é‡å¤çš„è¯·æ±‚å¹¶è¡Œæ‰§è¡Œï¼Œè€Œæ˜¯åœ¨åŠ è½½å™¨å¿™äºåŠ è½½æ—¶å°†ä¼ é€’ç»™retrieveTokençš„ä»»ä½•å¤„ç†ç¨‹åºæ”¾å…¥é˜Ÿåˆ—ä¸­</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆå°†pendingHandlersæ•°ç»„æ·»åŠ åˆ°æˆ‘ä»¬çš„è®¿é—®ä»¤ç‰ŒæœåŠ¡â€”æ¯æ¬¡è°ƒç”¨retrieveTokensæ—¶ï¼Œæˆ‘ä»¬å°†æŠŠä¼ é€’çš„handleré™„åŠ åˆ°è¯¥æ•°ç»„ã€‚ ç„¶åï¼Œé€šè¿‡æ£€æŸ¥æ•°ç»„æ˜¯å¦åªåŒ…å«å•ä¸ªå…ƒç´ ï¼Œç¡®ä¿åœ¨ä»»ä½•ç»™å®šæ—¶é—´åªæ‰§è¡Œå•ä¸ªè¯·æ±‚ä¸€æ—¦åŠ è½½å™¨å®Œæˆï¼Œæˆ‘ä»¬å°†è°ƒç”¨ä¸€ä¸ªæ–°çš„ç§æœ‰æ–¹æ³•handleï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨å½“å‰çš„å¤„ç†ç¨‹åº:</p>
<pre><code class="language-swift">class AccessTokenService {
    typealias Handler = (Result&lt;AccessToken&gt;) -&gt; Void

    private let loader: AccessTokenLoader
    private var token: AccessToken?
    // We'll keep track of all enqueued, pending handlers using
    // a simple array.
    private var pendingHandlers = [Handler]()

    func retrieveToken(then handler: @escaping Handler) {
        if let token = token, token.isValid {
            return handler(.value(token))
        }

        pendingHandlers.append(handler)

        // We'll only start loading if the current handler is
        // alone in the array after being inserted.
        guard pendingHandlers.count == 1 else {
            return
        }

        loader.load { [weak self] result in
            self?.handle(result)
        }
    }
}
</code></pre>
<p>æˆ‘ä»¬ä¹‹æ‰€ä»¥å¼•å…¥äº†ä¸€ä¸ªæ–°çš„handleæ–¹æ³•ï¼Œè€Œä¸æ˜¯ç®€å•åœ°å°†ç»“æœå¤„ç†é€»è¾‘å†…è”åˆ°load completionå¤„ç†å™¨ä¸­(å°±åƒæˆ‘ä»¬ä¹‹å‰åšçš„é‚£æ ·)ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨éœ€è¦æ›´å¤æ‚çš„é€»è¾‘å’Œå¯¹selfçš„å¤šä¸ªå¼•ç”¨ã€‚ æˆ‘ä»¬æ— éœ€ä½¿ç”¨ç»å…¸çš„guard let danceå°†å¯¹selfçš„å¼±å¼•ç”¨è½¬æ¢ä¸ºå¼ºå¼•ç”¨ï¼Œåªéœ€è°ƒç”¨handleï¼Œè¿™å°†è®©æˆ‘ä»¬åƒå¾€å¸¸ä¸€æ ·è®¿é—®æ‰€æœ‰çš„å±æ€§ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„handleå®ç°ä¸­ï¼Œæˆ‘ä»¬å°†å†æ¬¡ç¼“å­˜å·²åŠ è½½çš„ä»¤ç‰Œï¼Œå¹¶é€šçŸ¥æ¯ä¸ªæŒ‚èµ·çš„å¤„ç†ç¨‹åºä¸€ä¸ªç»“æœå·²åŠ è½½-åƒè¿™æ ·:</p>
<pre><code class="language-swift">private extension AccessTokenService {
    func handle(_ result: Result&lt;AccessToken&gt;) {
        token = result.value
        let handlers = pendingHandlers
        pendingHandlers = []
        handlers.forEach { $0(result) }
    }
}
</code></pre>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥ä¿è¯ï¼Œå³ä½¿æŒ‰é¡ºåºå¤šæ¬¡è°ƒç”¨retrieveTokenï¼Œæœ€ç»ˆä¹Ÿåªä¼šåŠ è½½ä¸€ä¸ªä»¤ç‰Œâ€”â€”å¹¶ä¸”æ‰€æœ‰å¤„ç†ç¨‹åºéƒ½å°†æŒ‰ç…§æ­£ç¡®çš„é¡ºåºå¾—åˆ°é€šçŸ¥ã€‚ğŸ‘</p>
<p>åœ¨å¤„ç†å•ä¸ªçŠ¶æ€æºçš„ä»£ç ä¸­ï¼ŒåŠ å…¥å¼‚æ­¥å®Œæˆå¤„ç†ç¨‹åº(å°±åƒæˆ‘ä»¬ä¸Šé¢æ‰€åšçš„é‚£æ ·)å¯ä»¥è®©æˆ‘ä»¬èµ°å¾ˆé•¿ä¸€æ®µè·¯æ¥é¿å…ç«äº‰æ¡ä»¶â€”â€”ä½†æˆ‘ä»¬ä»ç„¶æœ‰ä¸€ä¸ªéœ€è¦è§£å†³çš„ä¸»è¦é—®é¢˜â€”â€”çº¿ç¨‹å®‰å…¨ã€‚</p>
<h2 id="thread-safety">Thread safety</h2>
<p>å¾ˆå°‘æœ‰äº‹æƒ…ä¼šæ¯”å¤šçº¿ç¨‹æ›´å®¹æ˜“å¯¼è‡´ç«æ€æ¡ä»¶ï¼Œå°¤å…¶æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ„å»ºåº”ç”¨ç¨‹åºæ—¶ç¼–å†™çš„å¤§éƒ¨åˆ†ä»£ç å®é™…ä¸Šå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å› ä¸ºUIKitåªè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œå®ƒå¯¹æˆ‘ä»¬çš„é€»è¾‘æ¥è¯´æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ“ä½œæ¥è¿‘è§†å›¾å±‚ï¼Œå‡è®¾å®ƒåªä¼šä»ä¸»çº¿ç¨‹è°ƒç”¨ä½†ä¸€æ—¦æˆ‘ä»¬æ·±å…¥åˆ°æˆ‘ä»¬çš„æ ¸å¿ƒé€»è¾‘ï¼Œè¿™ä¸ªå‡è®¾å¯èƒ½å°±ä¸å†æˆç«‹äº†ã€‚</p>
<p>åªè¦ä»£ç åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›¸ä¿¡ä»å¯¹è±¡å±æ€§ä¸­è¯»å–å’Œå†™å…¥çš„æ•°æ®æ˜¯æ­£ç¡®çš„ã€‚ç„¶è€Œï¼Œä¸€æ—¦æˆ‘ä»¬å¼•å…¥äº†å¤šçº¿ç¨‹å¹¶å‘ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯èƒ½ä¼šåœ¨å®Œå…¨ç›¸åŒçš„æ—¶é—´ç»“æŸå¯¹ç›¸åŒå±æ€§çš„è¯»å†™-å¯¼è‡´å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®ç«‹å³è¿‡æ—¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåªè¦åœ¨å•ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨ä¹‹å‰çš„AccessTokenServiceï¼Œæˆ‘ä»¬é€šè¿‡è¾“å…¥ç­‰å¾…å®Œæˆå¤„ç†ç¨‹åºæ¥å¤„ç†ç«äº‰æ¡ä»¶çš„æœºåˆ¶å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†æ˜¯ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹æœ€ç»ˆä½¿ç”¨ç›¸åŒçš„è®¿é—®ä»¤ç‰ŒæœåŠ¡ï¼Œä¸€æ—¦æˆ‘ä»¬çš„pendingHandlersæ•°ç»„å¹¶å‘åœ°ä»å¤šä¸ªçº¿ç¨‹æ›´æ”¹ï¼Œæˆ‘ä»¬å¯èƒ½å¾ˆå¿«å°±ä¼šä»¥æœªå®šä¹‰çš„çŠ¶æ€ç»“æŸã€‚å†ä¸€æ¬¡ï¼Œæˆ‘ä»¬æ‰‹ä¸Šæœ‰ä¸€ä¸ªç«äº‰æ¡ä»¶ã€‚</p>
<p>è™½ç„¶æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥å¤„ç†åŸºäºå¤šçº¿ç¨‹çš„ç«æ€æ¡ä»¶ï¼Œä½†åœ¨è‹¹æœå¹³å°ä¸Šï¼Œä¸€ç§ç›¸å½“ç›´æ¥çš„æ–¹æ³•æ˜¯ä½¿ç”¨Grand Central Dispatchâ€”â€”è¿™è®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´ç®€å•çš„åŸºäºé˜Ÿåˆ—çš„æŠ½è±¡æ¥å¤„ç†çº¿ç¨‹ã€‚</p>
<p>è®©æˆ‘ä»¬å›åˆ°AccessTokenServiceï¼Œé€šè¿‡ä½¿ç”¨ä¸“ç”¨çš„DispatchQueueæ¥åŒæ­¥å…¶å†…éƒ¨çŠ¶æ€ï¼Œä½¿å…¶æˆä¸ºçº¿ç¨‹å®‰å…¨çš„æœåŠ¡ã€‚æˆ‘ä»¬å°†é¦–å…ˆåœ¨æœåŠ¡çš„åˆå§‹åŒ–å™¨ä¸­æ¥å—æ³¨å…¥çš„é˜Ÿåˆ—(ä»¥ä¾¿äºæµ‹è¯•)ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ï¼Œç„¶åâ€”â€”ä¸€æ—¦retrieveTokenæ–¹æ³•è¢«è°ƒç”¨-æˆ‘ä»¬å°†å‘é€ä¸€ä¸ªå¼‚æ­¥é—­åŒ…åˆ°æˆ‘ä»¬çš„é˜Ÿåˆ—ä¸Šï¼Œæˆ‘ä»¬å°†åœ¨é˜Ÿåˆ—ä¸­å®é™…æ‰§è¡Œä»¤ç‰Œæ£€ç´¢ï¼Œä½¿æˆ‘ä»¬çš„ç±»ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·:</p>
<pre><code class="language-swift">class AccessTokenService {
    typealias Handler = (Result&lt;AccessToken&gt;) -&gt; Void

    private let loader: AccessTokenLoader
    private let queue: DispatchQueue
    private var token: AccessToken?
    private var pendingHandlers = [Handler]()

    init(loader: AccessTokenLoader,
         queue: DispatchQueue = .init(label: &quot;AccessToken&quot;)) {
        self.loader = loader
        self.queue = queue
    }

    func retrieveToken(then handler: @escaping Handler) {
        queue.async { [weak self] in
            self?.performRetrieval(with: handler)
        }
    }
}
</code></pre>
<p>å°±åƒä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€åœ¨å¼‚æ­¥é—­åŒ…ä¸­è°ƒç”¨ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œè€Œä¸å¿…æ·»åŠ å¤§é‡çš„è‡ªå¼•ç”¨ã€‚åœ¨æˆ‘ä»¬çš„æ–°performRetrievalæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†è¿è¡Œä¸ä¹‹å‰å®Œå…¨ç›¸åŒçš„é€»è¾‘â€”â€”æ·»åŠ çš„å†…å®¹æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨ä¹Ÿå°†è°ƒç”¨å°è£…åœ¨å¼‚æ­¥é˜Ÿåˆ—åˆ†æ´¾ä¸­handle,-ç¡®ä¿å®Œæ•´çš„çº¿ç¨‹å®‰å…¨:</p>
<pre><code class="language-swift">private extension AccessTokenService {
    func performRetrieval(with handler: @escaping Handler) {
        if let token = token, token.isValid {
            return handler(.value(token))
        }

        pendingHandlers.append(handler)

        guard pendingHandlers.count == 1 else {
            return
        }

        loader.load { [weak self] result in
            // Whenever we are mutating our class' internal
            // state, we always dispatch onto our queue. That
            // way, we can be sure that no concurrent mutations
            // will occur.
            self?.queue.async {
                self?.handle(result)
            }
        }
    }
}
</code></pre>
<p>æœ‰äº†ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä»ä»»ä½•çº¿ç¨‹ä½¿ç”¨AccessTokenServiceï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥ç¡®ä¿æˆ‘ä»¬çš„é€»è¾‘å°†ä¿æŒå¯é¢„æµ‹ï¼Œå¹¶ä¸”æ‰€æœ‰å¤„ç†ç¨‹åºéƒ½å°†æŒ‰ç…§æ­£ç¡®çš„é¡ºåºğŸ‰è¢«è°ƒç”¨ã€‚</p>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾ˆå®¹æ˜“åœ°æµ‹è¯•çº¿ç¨‹å’Œé˜Ÿåˆ—é€»è¾‘æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºæˆ‘ä»¬è¦æ³¨å…¥DispatchQueueï¼Œä»¥ä¾¿åœ¨æœåŠ¡çš„åˆå§‹åŒ–å™¨ä¸­ä½¿ç”¨ã€‚å…³äºå¦‚ä½•ç¼–å†™è¿™ç±»æµ‹è¯•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œå¼‚æ­¥Swiftä»£ç å•å…ƒæµ‹è¯•â€ã€‚</p>
<h2 id="conclusion">Conclusion</h2>
<p>è™½ç„¶å¯èƒ½æ²¡æœ‰åŠæ³•å®Œå…¨é¿å…ç«äº‰æ¡ä»¶ï¼Œä½†ä½¿ç”¨è¯¸å¦‚æ’é˜Ÿå’Œä¸­å¤®è°ƒåº¦ç­‰æŠ€æœ¯å¯ä»¥è®©æˆ‘ä»¬ç¼–å†™æ›´å¯é¢„æµ‹ã€æ›´ä¸æ˜“å‘ç”ŸåŸºäºç«äº‰æ¡ä»¶çš„é”™è¯¯çš„ä»£ç ã€‚æ¯å½“æˆ‘ä»¬ç¼–å†™æŸç§å½¢å¼çš„å¼‚æ­¥ä»£ç æ—¶ï¼Œç¡®å®éœ€è¦ä»”ç»†è€ƒè™‘ä»£ç åœ¨å¹¶å‘è°ƒç”¨æ—¶çš„è¡Œä¸ºï¼Œå¹¶è®¾ç½®æœºåˆ¶ä»¥ç¡®ä¿æ‰€æœ‰æ“ä½œä»¥å¯é¢„æµ‹çš„é¡ºåºæ‰§è¡Œ(å’Œå®Œæˆ)ã€‚</p>
<p>è¿™æ˜¯å¦æ„å‘³ç€æˆ‘ä»¬åº”è¯¥ä»¥å®Œå…¨çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ç¼–å†™æ‰€æœ‰ä»£ç ? æˆ‘ä¸ªäººä¸è¿™ä¹ˆè®¤ä¸ºã€‚ è™½ç„¶çº¿ç¨‹å®‰å…¨åœ¨æ ¸å¿ƒæœåŠ¡ä¸­éå¸¸æ–¹ä¾¿ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä½¿ç”¨çš„AccessTokenServiceï¼Œæˆ‘ä»¬çš„å¤§éƒ¨åˆ†ä»£ç å¯èƒ½æ°¸è¿œä¸ä¼šåœ¨ä¸»çº¿ç¨‹ä¹‹å¤–ä½¿ç”¨â€”â€”æ‰€ä»¥åœ¨ä»»ä½•åœ°æ–¹éƒ½æ·»åŠ å®Œå…¨çš„çº¿ç¨‹å®‰å…¨æ€§å¸¸å¸¸ä¼šæˆä¸ºè¿‡åº¦å·¥ç¨‹çš„ç»ƒä¹ ã€‚</p>
<p>åƒå¾€å¸¸ä¸€æ ·ï¼Œä»€ä¹ˆæŠ€æœ¯æ˜¯åˆé€‚çš„åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæˆ‘ä»¬æ­£åœ¨æ„å»ºä»€ä¹ˆ - å½“æˆ‘ä»¬è®¾è®¡apiå’Œå®ƒä»¬çš„å®ç°æ—¶ï¼Œåªè¦æŠŠçº¿ç¨‹å®‰å…¨æ”¾åœ¨å¿ƒä¸Šï¼Œå°±å¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç å˜å¾—æ›´åŠ å¥å£®ã€‚</p>
<p><a href="https://www.swiftbysundell.com/articles/avoiding-race-conditions-in-swift/">åŸæ–‡é“¾æ¥</a></p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/ArhVOQ_GL/" class="tag">
                    concurrency
                  </a>
                
                  <a href="https://kayouyou.github.io/tag/C46TKgaZSw/" class="tag">
                    GCD
                  </a>
                
                  <a href="https://kayouyou.github.io/tag/Z107CQRlK/" class="tag">
                    code structure
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/the-power-of-key-paths-in-swift/">
                  <h3 class="post-title">
                    The power of key paths in Swift
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
