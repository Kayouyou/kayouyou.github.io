<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>PointFree Episode 12: Tagged | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1663221960632">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="



Introduction




Decodable




Raw representable




Tagged




Whatâ€™s the point?






1. Introduction
æˆ‘ä»¬ç»å¸¸å¤„ç†è¿‡äºä¸€èˆ¬åŒ–çš„..." />
    <meta name="keywords" content="PointFree" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1663221960632" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">PointFree Episode 12: Tagged</h2>
            <div class="post-date">2021-11-07</div>
            
            <div class="post-content" v-pre>
              <!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#Introduction">Introduction</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="#Decodable">Decodable</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#Rawrepresentable">Raw representable</a></li>
</ol>
</li>
<li>
<ol start="4">
<li><a href="#Tagged">Tagged</a></li>
</ol>
</li>
<li>
<ol start="5">
<li><a href="#Whatsthepoint">Whatâ€™s the point?</a></li>
</ol>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<!-- # PointFree Episode 12: Tagged -->
<h2 id="1-a-nameintroductionaintroduction">1. <a name='Introduction'></a>Introduction</h2>
<p>æˆ‘ä»¬ç»å¸¸å¤„ç†è¿‡äºä¸€èˆ¬åŒ–çš„ç±»å‹ï¼Œæˆ–è€…åŒ…å«çš„å€¼å¤ªå¤šï¼Œè¶…è¿‡äº†åŸŸä¸­æ‰€éœ€è¦çš„å€¼ã€‚åœ¨ä¸Šä¸€é›†å…³äºä»£æ•°æ•°æ®ç±»å‹çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»£æ•°æ¥å¸®åŠ©ç®€åŒ–æŸäº›ç±»å‹ï¼Œä½¿å…¶æˆä¸ºæ ¸å¿ƒå†…å®¹ã€‚ ç„¶è€Œï¼Œæœ‰æ—¶è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚æœ‰æ—¶ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³åœ¨ç±»å‹çº§åˆ«ä¸ŠåŒºåˆ†ä¸¤ä¸ªçœ‹èµ·æ¥ç­‰ä»·çš„å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†å®ƒçš„ä½¿ç”¨æ–¹å¼åº”è¯¥å—åˆ°é™åˆ¶ã€‚ åŒæ ·ï¼Œæˆ‘ä»¬ä»£ç ä¸­çš„<strong>id</strong>å¯èƒ½éƒ½æ˜¯æ•´æ•°ï¼Œä½†æ˜¯å°†ç”¨æˆ·<strong>id</strong>ä¸è®¢é˜…<strong>id</strong>è¿›è¡Œæ¯”è¾ƒæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚å®ƒä»¬æ˜¯å®Œå…¨ä¸åŒçš„å®ä½“ã€‚</p>
<p>æˆ‘ä»¬æƒ³è¦å±•ç¤ºçš„æ˜¯ï¼ŒSwiftï¼Œå°¤å…¶æ˜¯Swift 4.1ï¼Œç»™äº†æˆ‘ä»¬ä¸€ä¸ªä¸å¯æ€è®®çš„å·¥å…·ï¼Œå°†ç±»å‹æå‡åˆ°ä¸€ä¸ªæ›´é«˜çš„æ°´å¹³ï¼Œè¿™æ ·å®ƒä»¬å°±èƒ½æ›´å®¹æ˜“åœ°ç›¸äº’åŒºåˆ†ã€‚è¿™æœ‰åŠ©äºæ”¹è¿›æˆ‘ä»¬åœ¨å‡½æ•°å’Œæ–¹æ³•ä¸­æ„å»ºçš„å¥‘çº¦ï¼Œæ€»ä½“ä¸Šä½¿ä»£ç æ›´å®‰å…¨ã€‚</p>
<h2 id="2-a-namedecodableadecodable">2. <a name='Decodable'></a>Decodable</h2>
<p>è®©æˆ‘ä»¬çœ‹ä¸€çœ‹æˆ‘ä»¬å¯èƒ½ä»APIæˆ–å…¶ä»–æ•°æ®å­˜å‚¨è¿”å›çš„ä¸€äº›ç¤ºä¾‹æ•°æ®ã€‚æˆ‘ä»¬ç”¨JSONè¡¨ç¤ºä¸€äº›ç”¨æˆ·å’Œè®¢é˜…ã€‚</p>
<pre><code class="language-swift">let usersJson = &quot;&quot;&quot;
[
  {
    &quot;id&quot;: 1,
    &quot;name&quot;: &quot;Brandon&quot;,
    &quot;email&quot;: &quot;brandon@pointfree.co&quot;,
    &quot;subscriptionId&quot;: 1
  },
  {
    &quot;id&quot;: 2,
    &quot;name&quot;: &quot;Stephen&quot;,
    &quot;email&quot;: &quot;stephen@pointfree.co&quot;,
    &quot;subscriptionId&quot;: null
  },
  {
    &quot;id&quot;: 3,
    &quot;name&quot;: &quot;Blob&quot;,
    &quot;email&quot;: &quot;blob@pointfree.co&quot;,
    &quot;subscriptionId&quot;: 1
  }
]
&quot;&quot;&quot;

let subscriptionsJson = &quot;&quot;&quot;
[
  {
    &quot;id&quot;: 1,
    &quot;ownerId&quot;: 1
  }
]
&quot;&quot;&quot;
</code></pre>
<p>æˆ‘ä»¬æœ‰ä¸€å¯¹å¯¹åº”çš„ç»“æ„ä½“å®ƒä»¬çš„å±æ€§åå’Œç±»å‹éƒ½åŒ¹é…ã€‚</p>
<pre><code class="language-swift">struct Subscription {
  let id: Int
  let ownerId: Int
}

struct User {
  let id: Int
  let name: String
  let email: String
  let subscriptionId: Int?
}
</code></pre>
<p>Swiftæœ‰ä¸€å¯¹åŠŸèƒ½å¼ºå¤§çš„åè®®ï¼Œ<strong>Encodable and Decodable</strong>ï¼Œå®ƒä»¬å°†è‡ªåŠ¨ä¸ºç”±åˆ†åˆ«ç¬¦åˆæ¯ä¸ªåè®®çš„ç±»å‹ç»„æˆçš„ç»“æ„ä½“åˆæˆç¼–ç å’Œè§£ç é€»è¾‘ã€‚</p>
<p>æˆ‘ä»¬å¦‚ä½•ä½¿è¿™äº›å¯è§£ç ç±»å‹? æˆ‘ä»¬å¯ä»¥éµå¾ªä»¥ä¸‹<strong>Subscription</strong>ç±»å‹:</p>
<pre><code class="language-swift">struct Subscription: Decodable {
  let id: Int
  let ownerId: Int
}
</code></pre>
<p>ä¸€åˆ‡éƒ½è¿˜åœ¨ç»§ç»­ã€‚Swiftç°åœ¨å·²ç»ä¸ºè¿™ä¸ªç±»å‹åˆæˆäº†ä¸€ä¸ªåˆå§‹åŒ–å¼:</p>
<pre><code class="language-swift">Subscription.init(from:)
// (Decoder) throws -&gt; Subscription
</code></pre>
<p>æˆ‘ä»¬å¯¹UseråšåŒæ ·çš„å¤„ç†ã€‚</p>
<pre><code class="language-swift">struct User: Decodable {
  let id: Int
  let name: String
  let email: String
  let subscriptionId: Int?
}
</code></pre>
<p>æœ‰äº†è¿™äº›æ¡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<strong>JSONDecoder</strong>æ¥è§£ç <strong>JSON</strong>ä¸­çš„å€¼ã€‚</p>
<pre><code class="language-swift">let decoder = JSONDecoder()
let users = try! decoder.decode([User].self, from: Data(usersJson.utf8))
let subscriptions = try! decoder.decode([Subscription].self, from: Data(subscriptionsJson.utf8))
</code></pre>
<p>å¥½äº†! æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™ä»»ä½•é€»è¾‘æ¥è§£ç æ•°æ®ã€‚ ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬åšåˆ°äº†! æˆ‘ä»¬çš„å¥‘çº¦æ˜¯ç”¨æ•°æ®ç±»å‹æœ¬èº«ç¼–å†™çš„ï¼Œè¿™éå¸¸å¼ºå¤§ã€‚</p>
<p>ä¸è¿‡ï¼Œæˆ‘ä»¬çš„æ•°æ®ç±»å‹æœ‰ç‚¹æ¾æ•£ã€‚æˆ‘ä»¬ä½¿ç”¨<strong>Intå’ŒString</strong>ï¼Œå› ä¸ºå®ƒä»¬æ˜¯å¯è§£ç çš„ï¼Œä½†æœ€å¥½åœ¨ç±»å‹å±‚é¢åŠ å¼ºå®ƒä»¬ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šå¯¹idæˆ–ç”µå­é‚®ä»¶åœ°å€åšå¥‡æ€ªçš„äº‹æƒ…ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯ä»¥å‘æŸä¸ªåœ°å€å‘é€ç”µå­é‚®ä»¶çš„åŠŸèƒ½ã€‚</p>
<pre><code class="language-swift">func sendEmail(email: String) {
  //
}
</code></pre>
<p>å—¯ï¼Œæˆ‘ä»¬å¯ä»¥ä»æˆ‘ä»¬çš„å•†åº—ä¸­è·å–ä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶ç»™ä»–ä»¬å‘é€ç”µå­é‚®ä»¶ã€‚</p>
<pre><code class="language-swift">let user = users[0]
sendEmail(email: user.email)
</code></pre>
<p>è¿™å¯ä»¥ç¼–è¯‘å¹¶è¿è¡Œï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢æˆ‘ä»¬è¿™æ ·å†™:</p>
<pre><code class="language-swift">sendEmail(email: user.name)
</code></pre>
<p>æˆ‘ä»¬ç•™ä¸‹äº†ä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ã€‚æˆ‘ä»¬å°†ç”µå­é‚®ä»¶åœ°å€è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ï¼Œä½†ä¸æ˜¯æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯æœ‰æ•ˆçš„ç”µå­é‚®ä»¶åœ°å€ã€‚</p>
<p>æˆ‘ä»¬æƒ³è¦çš„æ˜¯æ¯”<strong>String</strong>æ›´å—çº¦æŸçš„ç±»å‹ã€‚è®©æˆ‘ä»¬å°†å­—ç¬¦ä¸²åŒ…è£…åœ¨<strong>Email</strong>ç»“æ„ä¸­ï¼Œå¹¶å°†<strong>sendmail</strong>æ›´æ”¹ä¸ºåªæ¥å—<strong>Email</strong>å€¼ä½œä¸ºè¾“å…¥ã€‚</p>
<pre><code class="language-swift">struct Email {
  let email: String
}
</code></pre>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨è¿™ç§ç±»å‹æ¥è¡¨ç¤ºç”¨æˆ·çš„ç”µå­é‚®ä»¶ã€‚</p>
<pre><code class="language-swift">struct User: Decodable {
  let id: Int
  let name: String
  let email: Email
  let subscriptionId: Int?
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥åœ¨<strong>sendmail</strong>å‡½æ•°ä¸­ä½¿ç”¨è¿™ä¸ªç±»å‹ã€‚</p>
<pre><code class="language-swift">func sendEmail(email: Email) {
  //
}
</code></pre>
<p>å½“æˆ‘ä»¬è¯•å›¾ä¼ é€’å­—ç¬¦ä¸²æ—¶ï¼Œ<strong>sendmail</strong>ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚</p>
<pre><code class="language-swift">sendEmail(email: user.name)
</code></pre>
<ul>
<li>æ— æ³•å°†ç±»å‹' <strong>String</strong> 'çš„å€¼è½¬æ¢ä¸ºæœŸæœ›çš„å‚æ•°ç±»å‹' <strong>Email</strong> '<br>
Swiftç°åœ¨ä¸ºæˆ‘ä»¬æä¾›äº†æ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ã€‚</li>
</ul>
<p>ä¸è¿‡ï¼Œæˆ‘ä»¬æœ‰å¦ä¸€ä¸ªç¼–è¯‘å™¨é”™è¯¯ã€‚</p>
<ul>
<li>â€œ<strong>User</strong>â€ç±»å‹ä¸ç¬¦åˆâ€œ<strong>Decodable</strong>â€åè®®</li>
</ul>
<p>ç¼–è¯‘å™¨ä¸èƒ½å†è‡ªåŠ¨è®©<strong>User</strong>éµå¾ª<strong>Decodable</strong>ï¼Œå› ä¸ºç”µå­é‚®ä»¶æ˜¯<strong>UnDecodable</strong>ã€‚</p>
<p>è¿™å¾ˆå®¹æ˜“è§£å†³ã€‚</p>
<pre><code class="language-swift">struct Email: Decodable {
  let email: String
}
</code></pre>
<p>å½“æˆ‘ä»¬è§£ç ç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<blockquote>
<p>Fatal error: â€˜try!â€™ expression unexpectedly raised an error: Swift.DecodingError.typeMismatch(Swift.Dictionary&lt;Swift.String, Any&gt;, Swift.DecodingError.Context(codingPath: [_JSONKey(stringValue: â€œIndex 0â€, intValue: 0), CodingKeys(stringValue: â€œemailâ€, intValue: nil)], debugDescription: â€œExpected to decode Dictionary&lt;String, Any&gt; but found a string/data instead.â€, underlyingError: nil))</p>
</blockquote>
<p>å½“Swiftä¸ºç»“æ„ä½“ç”Ÿæˆè§£ç åˆå§‹åŒ–å™¨æ—¶ï¼Œå®ƒå‡å®šæ•°æ®è¢«åŒ…è£…åœ¨ä¸€ä¸ªä»¥å±æ€§åä½œä¸ºé”®çš„å®¹å™¨ä¸­ã€‚è¿™æ„å‘³ç€JSONè§£ç å™¨éœ€è¦ä¸€ä¸ªå¸¦æœ‰ç”µå­é‚®ä»¶å¯†é’¥çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåŸå§‹å­—ç¬¦ä¸²ã€‚æ˜¯è¿™æ ·çš„:</p>
<pre><code class="language-swift">// &quot;email&quot;: {&quot;email&quot;: String}
</code></pre>
<p>æˆ‘ä»¬æƒ³è¦æŠŠå®ƒå±•å¼€ï¼Œä»¥ä¾¿å®ƒä¸æˆ‘ä»¬æ­£åœ¨å¤„ç†çš„JSONç›¸åŒ¹é…ã€‚æˆ‘ä»¬å¯ä»¥ç¼–å†™è‡ªå·±çš„è‡ªå®šä¹‰åˆå§‹åŒ–å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è§£ç å™¨æœ‰å‡ ç§äº§ç”Ÿè§£ç å®¹å™¨çš„æ–¹æ³•ã€‚ <strong>KeyedDecodingContainers</strong>è§£ç è¢«é”®æ§çš„å€¼ï¼Œå°±åƒæˆ‘ä»¬çš„ç»“æ„æ˜¯ç”±å±æ€§åé”®æ§çš„ï¼Œæ‰€ä»¥è¿™æ˜¯å®ƒé»˜è®¤ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„ã€‚ UnkeyedDecodingContainersç”¨äºæ•°ç»„ã€‚æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æ˜¯<strong>SingleValueDecodingContainer</strong>ï¼Œå®ƒå’Œå®ƒçš„åå­—ä¸€æ ·ï¼Œè´Ÿè´£è§£ç å•ä¸ªå€¼ã€‚</p>
<pre><code class="language-swift">struct Email: Decodable {
  let email: String

  init(from decoder: Decoder) throws {
    let container = try decoder.singleValueContainer()
    self.email = try container.decode(String.self)
  }
}
</code></pre>
<p>å¤ªæ£’äº†! æ‰€æœ‰çš„ä¸œè¥¿éƒ½ä¼šç¼–è¯‘ã€è¿è¡Œï¼Œå¹¶ä¸”ä»ç„¶é™åˆ¶æˆ‘ä»¬ä»¥åŸå§‹å­—ç¬¦ä¸²å‘é€ç”µå­é‚®ä»¶ã€‚ä½†æ˜¯ï¼Œå¿…é¡»æä¾›è‡ªå®šä¹‰åˆå§‹åŒ–å™¨æœ‰ç‚¹éº»çƒ¦ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿé¿å…ä½¿ç”¨æ ·æ¿æ–‡ä»¶ã€‚</p>
<h2 id="3-a-namerawrepresentablearaw-representable">3. <a name='Rawrepresentable'></a>Raw representable</h2>
<p>è®©æˆ‘ä»¬çœ‹çœ‹Swifté™„å¸¦çš„å¦ä¸€ä¸ªæœ‰ç”¨çš„åè®®:<strong>RawRepresentable</strong>ã€‚</p>
<p><strong>RawRepresentable</strong> æ˜¯æè¿°å¦ä¸€ä¸ªå€¼çš„åŒ…è£…çš„å°åè®®ã€‚ä½ å¯èƒ½åœ¨ä¸çŸ¥ä¸è§‰ä¸­å°±éµä»äº†å®ƒã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­:</p>
<pre><code class="language-swift">enum Status: Int {
  case ok = 200
  case notFound = 404
}
</code></pre>
<p>åˆ›å»ºè¿™äº›ç±»å‹çš„æšä¸¾æ˜¯å¾ˆå¸¸è§çš„ï¼Œä»¥ä½¿ä»£ç æ›´åŠ ç±»å‹å®‰å…¨ã€‚ å®ƒä»¬å°†æ›´ä¸€èˆ¬çš„ç±»å‹å°è£…åœ¨ä¸€ä¸ªæ›´å…·ä½“çš„å®¹å™¨ä¸­ï¼Œæœ‰ç‚¹åƒæˆ‘ä»¬çš„<strong>Email</strong>ç»“æ„ä½“! è¿™äº›æšä¸¾è‡ªåŠ¨éµå¾ª<strong>RawRepresentable</strong>ï¼Œæä¾›äº†ä¸åŸå§‹å€¼ä¹‹é—´çš„æ¥å£ã€‚</p>
<pre><code class="language-swift">Status.ok.rawValue // 200
Status(rawValue: 200) // Status.ok
Status(rawValue: 600) // nil
</code></pre>
<p>è¿™å¯èƒ½æ˜¯<strong>RawRepresentable</strong>æœ€å¸¸è§çš„ç”¨æ³•ï¼Œä½†æ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢æˆ‘ä»¬æ‰‹åŠ¨éµå¾ªã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†<strong>Email</strong>ç¬¦åˆ<strong>RawRepresentable</strong>ã€‚æˆ‘ä»¬å¯ä»¥è®©Swiftå†™åè®®å­˜æ ¹ã€‚</p>
<pre><code class="language-swift">struct Email: Decodable, RawRepresentable {
  init?(rawValue: String) {
    self.email = rawValue
  }

  var rawValue: String {
    return self.email
  }

  typealias RawValue = String

  let email: String

  init(from decoder: Decoder) throws {
    let container = try decoder.singleValueContainer()
    self.email = try container.decode(String.self)
  }
}
</code></pre>
<p>ç°åœ¨è¿™é‡Œæœ‰å¾ˆå¤šä¸œè¥¿ï¼Œä½†æˆ‘ä»¬è‡³å°‘å¯ä»¥åˆ é™¤æˆ‘ä»¬çš„æ‰‹åŠ¨<strong>Decodable</strong>åˆå§‹åŒ–å™¨:<strong>RawRepresentable</strong>ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå…è´¹å®Œæˆç›¸åŒå·¥ä½œçš„å·¥å…·ã€‚</p>
<pre><code class="language-swift">struct Email: Decodable, RawRepresentable {
  init?(rawValue: String) {
    self.email = rawValue
  }

  var rawValue: String {
    return self.email
  }

  typealias RawValue = String

  let email: String
}
</code></pre>
<p>è¿™ä»ç„¶æ˜¯å¾ˆå¤šï¼Œä½†å¦‚æœæˆ‘ä»¬é‡å‘½åç”µå­é‚®ä»¶ä¸º<strong>rawValue</strong>ï¼Œæˆ‘ä»¬å¯ä»¥å¤§å¤§ç¼©çŸ­å†…å®¹ã€‚</p>
<pre><code class="language-swift">struct Email: Decodable, RawRepresentable {
  let rawValue: String
}
</code></pre>
<p>ä¸€åˆ‡è¿è¡Œæ­£å¸¸! æˆ‘ä»¬å¯ä»¥ä¾èµ–Swiftä¸ºæˆ‘ä»¬åˆæˆçš„é»˜è®¤çš„æˆå‘˜åˆå§‹åŒ–å¼ã€‚ è¿™å¹¶ä¸æ˜¯å¾ˆå¤šä»£ç ï¼Œä½†æ˜¯å®ƒäº§ç”Ÿäº†å¾ˆå¤šæœ‰ç”¨çš„ä¸œè¥¿ã€‚ä»…ä»…é€šè¿‡å°†ç»“æ„ä½“æ ‡è®°ä¸º<strong>Decodable</strong>, <strong>RawRepresentable</strong>ï¼Œå¹¶å°†å…¶å±æ€§å‘½åä¸º<strong>rawValue</strong>, Swiftå°±å…è®¸æˆ‘ä»¬ä¸ºåº”ç”¨ç¨‹åºçš„è¾¹ç•Œåˆ›å»ºä¸€ä¸ªç±»å‹å®‰å…¨çš„åŒ…è£…å™¨ã€‚</p>
<p>äº‹æƒ…å¾ˆçŸ­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå˜æˆä¸€è¡Œä»£ç ã€‚</p>
<pre><code class="language-swift">struct Email: Decodable, RawRepresentable { let rawValue: String }
</code></pre>
<p>åªéœ€è¦è¿™ä¸€è¡Œä»£ç å°±å¯ä»¥ä½¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ›´åŠ ç±»å‹å®‰å…¨ã€‚æˆ‘ä»¬çš„JSONå®Œå…¨æ²¡æœ‰æ”¹å˜ï¼Œä½†<strong>email</strong>å±æ€§ç°åœ¨å®Œå…¨å—é™ï¼Œæˆ‘ä»¬ä¸ä¼šæ„å¤–åœ°ç¼–å†™ä»£ç ï¼Œè¯•å›¾å‘ç”¨æˆ·çš„åç§°å­—ç¬¦ä¸²å‘é€ç”µå­é‚®ä»¶ã€‚</p>
<p>å®ƒæ˜¯å¦‚æ­¤çš„çŸ­ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåœ¨æˆ‘ä»¬çš„ä»£ç åº“ä¸­springè¿™äº›ç±»å‹ï¼Œä»¥è·å¾—æ›´å¤šçš„ä¿æŠ¤ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å¦ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ã€‚å‡è®¾æˆ‘ä»¬æƒ³è·å–ç”¨æˆ·çš„è®¢é˜…ã€‚</p>
<pre><code class="language-swift">let subscription = subscriptions
  .first(where: { $0.id == user.subscriptionId })
</code></pre>
<p>è¿™æ˜¯å¯è¡Œçš„ï¼Œä½†å¹¶ä¸èƒ½é˜»æ­¢æˆ‘ä»¬ä¸å°å¿ƒæ¯”è¾ƒç”¨æˆ·çš„idã€‚</p>
<pre><code class="language-swift">let subscription = subscriptions
  .first(where: { $0.id == user.id })
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯æ­£åœ¨ç­‰å¾…å‘ç”Ÿï¼Œå®ƒå¯èƒ½ä¼šè¿”å›é”™è¯¯çš„æ•°æ®ç»™ç”¨æˆ·ã€‚è¿™æ˜¯ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç±»å‹çº§åˆ«æ•è·å®ƒã€‚</p>
<p>å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºå¦ä¸€ä¸ª<strong>RawRepresentable</strong>ç»“æ„ä½“æ¥è¡¨ç¤ºè®¢é˜…çš„idã€‚</p>
<pre><code class="language-swift">struct Subscription: Decodable {
  struct Id: Decodable, RawRepresentable { let rawValue: Int }

  let id: Id
  let ownerId: Int
}
</code></pre>
<p>æˆ‘ä»¬è¿˜å¸Œæœ›ç¡®ä¿<strong>User</strong>ä½¿ç”¨è¿™ä¸ªç±»å‹è¡¨ç¤ºå®ƒçš„<strong>subscriptionId</strong>ã€‚</p>
<pre><code class="language-swift">struct User: Decodable {
  let id: Int
  let name: String
  let email: Email
  let subscriptionId: Subscription.Id?
}
</code></pre>
<p>æˆ‘ä»¬ç°åœ¨æœ‰å‡ ä¸ªç¼–è¯‘å™¨é”™è¯¯ï¼Œè¿™æ˜¯é¢„æ–™ä¹‹ä¸­çš„ã€‚ç¬¬ä¸€ä¸ªé”™è¯¯çš„æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¸º<em>Subscription.Id</em>å®šä¹‰ç›¸ç­‰ï¼Œç¬¬äºŒä¸ªé”™è¯¯çš„æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³æ¯”è¾ƒè®¢é˜…Idå’Œç”¨æˆ·Idã€‚</p>
<p>è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹ç¬¬ä¸€ä¸ªé”™è¯¯ã€‚</p>
<blockquote>
<p>Binary operator â€˜==â€™ cannot be applied to operands of type â€˜Subscription.Idâ€™ and â€˜Subscription.Id?â€™</p>
</blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªå¾®å¦™çš„é—®é¢˜ï¼Œå› ä¸ºä»¥ä¸‹å·¥ä½œ:</p>
<pre><code class="language-swift">let subscription = subscriptions
  .first { $0.id == user.subscriptionId! }
</code></pre>
<p>è¿™æ˜¯å› ä¸ºSwiftåœ¨==ä¸Šæä¾›äº†ä¸€ä¸ªæ³›å‹é‡è½½ï¼Œåœ¨å…³è”çš„<strong>RawValue</strong>ç±»å‹ç›¸ç­‰çš„æƒ…å†µä¸‹å¤„ç†<strong>RawRepresentable</strong>å€¼ï¼Œä½†åœ¨ä»»æ„ä¸€è¾¹éƒ½æ˜¯å¯é€‰çš„æƒ…å†µä¸‹ä¸é‡è½½ã€‚<strong>RawRepresentable</strong>ä¸èƒ½æœ‰æ¡ä»¶åœ°éµå¾ª<strong>Equatable</strong>ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåè®®ï¼Œåè®®æ‰©å±•ä¸èƒ½æœ‰ç»§æ‰¿å­å¥ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®©<strong>Subscription.Id</strong>éµä»<strong>Equatable</strong>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<pre><code class="language-swift">struct Subscription: Decodable {
  struct Id: Decodable, RawRepresentable, Equatable { let rawValue: Int }

  let id: Id
  let ownerId: Int
}
</code></pre>
<p>è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å¼ºåˆ¶è§£åŒ…ã€‚</p>
<pre><code class="language-swift">let subscription = subscriptions
  .first { $0.id == user.subscriptionId! }
</code></pre>
<p>ç”šè‡³ä¸éœ€è¦å†™æ›´å¤šçš„ä»£ç ! Swiftèƒ½å¤Ÿä¸ºæˆ‘ä»¬æ¨å¯¼ä¸€è‡´æ€§ï¼Œå› ä¸ºIntå·²ç»ç¬¦åˆ<strong>Equatable</strong>ã€‚</p>
<p>è¿™ä¹ˆå¤šå…è´¹çš„èƒ½åŠ›! æˆ‘ä»¬æ­£åœ¨åˆ›å»ºå°è£…äº†æ›´å¤šåŸºæœ¬ç±»å‹çš„æ–°ç±»å‹ï¼Œå¹¶åœ¨apiä¸­åˆ›å»ºäº†éå¸¸å¼ºçš„å¥‘çº¦ã€‚ å®ƒå˜å¾—æœ‰ç‚¹å˜ˆæ‚äº†ï¼Œå°½ç®¡Swiftä¸ºæˆ‘ä»¬å†™äº†å¾ˆå¤šä»£ç ï¼Œä½†æˆ‘ä»¬è‚¯å®šéœ€è¦ä¸€éåˆä¸€éåœ°å‘Šè¯‰å®ƒåº”è¯¥å†™å“ªäº›ä»£ç ã€‚<strong>Thereâ€™s gotta be a better way</strong>.</p>
<h2 id="4-a-nametaggedatagged">4. <a name='Tagged'></a>Tagged</h2>
<p>è®©æˆ‘ä»¬ç¼–å†™è‡ªå·±çš„é€šç”¨ç»“æ„æ¥åŒ…è£…åŸå§‹å€¼ã€‚</p>
<pre><code class="language-swift">struct Tagged&lt;Tag, RawValue&gt; {
  let rawValue: RawValue
}
</code></pre>
<p>æˆ‘ä»¬ç§°å®ƒä¸º<strong>Tagged</strong>ï¼Œä»¥è¯´æ˜ä¸€ä¸ªé¢å¤–çš„<strong>Tag</strong>æ³›å‹å‚æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªå¥‡æ€ªçš„å‚æ•°ï¼Œä¼¼ä¹æ²¡æœ‰åœ¨ç±»å‹çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚è¿™æœ‰æ—¶è¢«ç§°ä¸ºâ€œå¹»å½±ç±»å‹(phantom type)â€ã€‚</p>
<p>æˆ‘ä»¬èƒ½åšäº›ä»€ä¹ˆå‘¢? è®©æˆ‘ä»¬ç”¨<strong>Tagged</strong>æ›¿æ¢æˆ‘ä»¬çš„<strong>Subscription.Id</strong>ç»“æ„ä½“ã€‚</p>
<pre><code class="language-swift">struct Subscription: Decodable {
  typealias Id = Tagged&lt;Subscription, Int&gt;

  let id: Id
  let ownerId: Int
}
</code></pre>
<p>æˆ‘ä»¬å·²ç»ç”¨<strong>Subscription</strong>ç±»å‹æœ¬èº«æ ‡è®°äº†è¿™ä¸ª<strong>Id</strong>ç±»å‹ã€‚</p>
<p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æ‰“ç ´äº†ä¸€äº›ä¸œè¥¿ã€‚<strong>User</strong>ä¸å†æ˜¯å¯è§£ç çš„ï¼Œå› ä¸º<strong>Tagged</strong>ä¸å¯è§£ç ã€‚å¹¸è¿çš„æ˜¯ï¼ŒSwiftæä¾›äº†ä¸€ä¸ªå·¥å…·æ¥è§£å†³è¿™ä¸ªé—®é¢˜:æ¡ä»¶ä¸€è‡´æ€§ï¼ˆconditional conformanceï¼‰ã€‚</p>
<p>è®©æˆ‘ä»¬æœ‰æ¡ä»¶åœ°è®©<strong>Tagged</strong> éµå¾ª <strong>Decodable</strong>ã€‚</p>
<pre><code class="language-swift">extension Tagged: Decodable where RawValue: Decodable {
  init(from decoder: Decoder) throws {
    let container = try decoder.singleValueContainer()
    self.init(rawValue: try container.decode(RawValue.self))
  }
}
</code></pre>
<blockquote>
<p>Correction<br>
This implementation of init(from decoder:) incorrectly makes the assumption that a tagged value is always a â€œsingle valueâ€, preventing tagged keyed and unkeyed container types (like structs, arrays, and dictionaries) from being decodable.<br>
The fix is a simpler implementation that delegates to the raw value directly and was submitted as a pull request here.</p>
</blockquote>
<p>å¾ˆå¥½ï¼Œæˆ‘ä»¬çš„è®¢é˜…åˆå¯ä»¥è§£ç äº†ï¼Œä½†æˆ‘ä»¬è¿˜æœ‰ä¸ªé—®é¢˜ã€‚</p>
<blockquote>
<p>Binary operator â€˜==â€™ cannot be applied to two â€˜Subscription.Idâ€™ (aka â€˜Tagged&lt;Subscription, Int&gt;â€™) operands</p>
</blockquote>
<p>è¿™æ˜¯å› ä¸º<strong>Tagged</strong>ä¸ç¬¦åˆ<strong>Equatable</strong>ã€‚æˆ‘ä»¬ä¸å†å¤„ç†<strong>RawRepresentable</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å†æœ‰==é‡è½½ã€‚å› ä¸ºæˆ‘ä»¬å¤„ç†çš„æ˜¯å…·ä½“ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æ¡ä»¶ä¸€è‡´æ€§ä½¿<strong>Tagged</strong> <strong>equatable</strong>ã€‚</p>
<pre><code class="language-swift">extension Tagged: Equatable where RawValue: Equatable {
  static func == (lhs: Tagged, rhs: Tagged) -&gt; Bool {
    return lhs.rawValue == rhs.rawValue
  }
}
</code></pre>
<p>å“‡ã€‚æ‰€æœ‰çš„å·¥ä½œäº†!</p>
<pre><code class="language-swift">let subscription = subscriptions
  .first { $0.id == user.subscriptionId }
</code></pre>
<p>æˆ‘ä»¬è¿”å›é¢„å®šçš„è®¢é˜…! é‚£æˆ‘ä»¬çš„é—®é¢˜é€»è¾‘å‘¢?</p>
<pre><code class="language-swift">let subscription = subscriptions
  .first { $0.id == user.id }
</code></pre>
<blockquote>
<p>Binary operator â€˜==â€™ cannot be applied to operands of type â€˜Subscription.Idâ€™ (aka â€˜Tagged&lt;Subscription, Int&gt;â€™) and â€˜User.Idâ€™ (aka â€˜Tagged&lt;User, Int&gt;â€™)</p>
</blockquote>
<p>å“‡ï¼Œ<strong>Tagged</strong>è§£å†³äº†å’Œ<strong>RawRepresentable</strong>ä¸€æ ·çš„æ‰€æœ‰é—®é¢˜ï¼Œä½†ç”¨çš„ä»£ç æ›´å°‘ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ‰§è¡Œä»»åŠ¡ä¼¼ä¹æ›´å¥½ã€‚</p>
<p>è®©æˆ‘ä»¬ç”¨ç”¨æˆ·idè¯•ä¸€ä¸‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨Userç»“æ„ä¸­å®šä¹‰ä¸€ä¸ªå¸¦æ ‡ç­¾çš„id.</p>
<pre><code class="language-swift">struct User: Decodable {
  typealias Id = Tagged&lt;User, Int&gt;

  let id: Id
  let name: String
  let email: Email
  let subscriptionId: Subscription.Id?
}
</code></pre>
<p>å¹¶ç›¸åº”åœ°æ›´æ–°è®¢é˜…ç»“æ„ä½“ã€‚</p>
<pre><code class="language-swift">struct Subscription: Decodable {
  typealias Id = Tagged&lt;Subscription, Int&gt;

  let id: Id
  let ownerId: User.Id
}
</code></pre>
<p>And everything still compiles!</p>
<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬å°è¯•æ¯”è¾ƒè®¢é˜…idå’Œç”¨æˆ·idæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªéå¸¸å…·ä½“çš„ã€å¯è¯»çš„é”™è¯¯æ¶ˆæ¯:</p>
<blockquote>
<p>ğŸ›‘ Binary operator â€˜==â€™ cannot be applied to operands of type â€˜Subscription.Idâ€™ (aka â€˜Tagged&lt;Subscription, Int&gt;â€™) and â€˜User.Idâ€™ (aka â€˜Tagged&lt;User, Int&gt;â€™)</p>
</blockquote>
<p>é‚£ä¹ˆæˆ‘ä»¬çš„ç”µå­é‚®ä»¶ç±»å‹å‘¢?</p>
<pre><code class="language-swift">typealias Email = Tagged&lt;_, String&gt;
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ä»€ä¹ˆæ ‡è®°ç”µå­é‚®ä»¶? æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„å…³è”ç±»å‹ï¼Œå°±åƒæˆ‘ä»¬çš„<strong>Subscription.Idå’ŒUser.Id</strong>ä¸€æ ·ã€‚æˆ‘ä»¬å¯ä»¥åˆ›é€ ä¸€ä¸ªä¸€æ¬¡æ€§çš„ã€‚</p>
<pre><code class="language-swift">protocol EmailTag {}
typealias Email = Tagged&lt;EmailTag, String&gt;
</code></pre>
<p>è¿™ä¸ªå¾ˆå¥½ï¼Œä½†æ˜¯æœ‰ç‚¹å¥‡æ€ªã€‚ä½¿ç”¨ç©ºåè®®æ„Ÿè§‰å¾ˆå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆå®ƒæ˜¯ä¸€ä¸ªåè®®? æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªæ— äººå±…ä½çš„<strong>enum</strong>ã€‚</p>
<pre><code class="language-swift">enum EmailTag {}
typealias Email = Tagged&lt;EmailTag, String&gt;
</code></pre>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨ç»“æ„æˆ–ç±»ï¼Œè¿™æœ‰ç‚¹å¥‡æ€ªï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥è¢«å®ä¾‹åŒ–ã€‚è®©æˆ‘ä»¬é€‰æ‹©æšä¸¾ï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚æˆ‘è®¤ä¸ºæˆ‘ä»¬å‘ç°ï¼Œä»¥è¿™ç§æ–¹å¼ä½¿ç”¨<strong>Tagged</strong>å¸¦æœ‰ä¸€äº›åŒ…è¢±ï¼Œå› ä¸ºæœ‰æ—¶æˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç±»å‹æ¥ä½œä¸ºæ ‡ç­¾ä½¿ç”¨ã€‚</p>
<p>å…¶ä»–è¯­è¨€æœ‰â€œæ–°ç±»å‹â€çš„æ¦‚å¿µã€‚å®ƒèƒ½å¤Ÿç”¨å¾ˆå°‘çš„ä»£ç åˆ›å»ºè¿™äº›æ›´ç±»å‹å®‰å…¨çš„å®¹å™¨ã€‚</p>
<pre><code class="language-swift">newtype Email = String
</code></pre>
<p>Swiftæ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œä½†è¿™å¾ˆå¥½ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦åˆ›å»ºå…¨æ–°çš„ç±»å‹æ¥ä½¿ç”¨<strong>Tagged</strong>ã€‚</p>
<p>æˆ‘ä»¬åº”è¯¥æŒ‡å‡ºï¼Œ<strong>typealias</strong>ä¸æä¾›è¿™ç§åŠŸèƒ½ã€‚</p>
<pre><code class="language-swift">typealias Email = String
</code></pre>
<p><strong>typealias</strong>å…³é”®å­—ä¸ºç±»å‹åˆ›å»ºäº†ä¸€ä¸ªå®Œå…¨å¯äº’æ¢çš„åŒä¹‰è¯ï¼Œå› æ­¤<strong>Email</strong> typealiasåˆ°Stringä»ç„¶å…è®¸ä»»ä½•å­—ç¬¦ä¸²è¢«è§†ä¸ºç”µå­é‚®ä»¶ï¼Œè€Œä¸æä¾›ä»»ä½•é¢å¤–çš„ç±»å‹å®‰å…¨ã€‚</p>
<p>ç°åœ¨ï¼Œä»£æ›¿å®ƒçš„æ˜¯<strong>RawRepresentable</strong>æˆ–<strong>Tagged</strong>ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œ<strong>RawRepresentable</strong>åœ¨æ²¡æœ‰æ¡ä»¶ä¸€è‡´æ€§çš„æƒ…å†µä¸‹æœ‰ä¸€ç‚¹åŠ£åŠ¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä¸ºæ­¤ä»˜å‡ºä»£ä»·ï¼Œå¶å°”ä½¿ç”¨æ ·æ¿æ–‡ä»¶åˆ›å»ºæ ‡ç­¾ã€‚ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•å°†æ‰€æœ‰è¿™äº›é€»è¾‘æ•´åˆåˆ°ä¸€ä¸ªå•ä¸€çš„<strong>Tagged</strong>ç±»å‹ä¸­ã€‚ æˆ‘ä»¬ä¸éœ€è¦åœ¨æ‰€æœ‰åœ°æ–¹åˆ›å»ºæ–°çš„<strong>RawRepresentable</strong>ç»“æ„ï¼Œä¹Ÿä¸éœ€è¦åˆ—å‡ºæ¯ä¸ªæˆ‘ä»¬å¸Œæœ›å®ƒç¬¦åˆçš„<strong>Decodable, Equatable</strong>åè®®ã€‚<strong>Tagged</strong>ä¼šè‡ªåŠ¨ç»§æ‰¿å®ƒåŒ…è£…çš„ç±»å‹çš„æ‰€æœ‰ç‰¹æ€§ã€‚</p>
<p>æˆ‘ä»¬çš„<strong>Tagged</strong>ç±»å‹å·¥ä½œå¾—éå¸¸å¥½! è®©æˆ‘ä»¬çœ‹çœ‹å®ä¾‹åŒ–ä¸€ä¸ªç”¨æˆ·çš„äººæœºå·¥ç¨‹å­¦æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œå®ƒåŒ…å«äº†å¾ˆå¤šè¿™äº›æ–°ç±»å‹ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ä»£ç çš„ä¼˜ç‚¹æ˜¯æˆ‘ä»¬çš„ç”¨æˆ·æ˜¯é€šè¿‡JSONè§£ç å®ä¾‹åŒ–çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨ä»»ä½•åœ°æ–¹æ‰‹åŠ¨è°ƒç”¨åˆå§‹åŒ–å™¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç¡®å®æƒ³æ‰‹åŠ¨å®ä¾‹åŒ–ä¸€ä¸ªç”¨æˆ·å‘¢?</p>
<pre><code class="language-swift">User.init(
  id: User.Id.init(rawValue: 1),
  name: &quot;Blob&quot;,
  email: Email.init(rawValue: &quot;blob@pointfree.co&quot;),
  subscriptionId: Subscription.Id.init(rawValue: 2)
)
</code></pre>
<p>å“å‘€ï¼Œè¿™çœŸæ˜¯ä¸€å›¢ç³Ÿã€‚æˆ‘ä»¬å¯ä»¥ç¨å¾®æ¸…ç†ä¸€ä¸‹ï¼Œä½¿ç”¨ç‚¹å‰ç¼€ç¬¦å·ã€‚</p>
<pre><code class="language-swift">User(
  id: .init(rawValue: 1),
  name: &quot;Blob&quot;,
  email: .init(rawValue: &quot;blob@pointfree.co&quot;),
  subscriptionId: .init(rawValue: 2)
)
</code></pre>
<p>æ‰‹åŠ¨åŒ…è£…æ‰€æœ‰è¿™äº›ç±»å‹ä»ç„¶æœ‰ç›¸å½“å¤šçš„å·¥ä½œã€‚</p>
<p>Swiftæœ‰ä¸€ä¸ªå®Œæ•´çš„<strong>ExpressibleBy-Literal</strong>åè®®é›†åˆï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨éœ€è¦å¦ä¸€ç§ç±»å‹çš„åœ°æ–¹ä¼ é€’æ–‡å­—å€¼ã€‚ä¹Ÿè®¸æˆ‘ä»¬ä¹Ÿå¯ä»¥æœ‰æ¡ä»¶åœ°éµå¾ªè¿™äº›åè®®ã€‚</p>
<pre><code class="language-swift">extension Tagged: ExpressibleByIntegerLiteral where RawValue: ExpressibleByIntegerLiteral {
  typealias IntegerLiteralType = RawValue.IntegerLiteralType

  init(integerLiteral value: IntegerLiteralType) {
    self.init(rawValue: RawValue(integerLiteral: value))
  }
}
</code></pre>
<p>æˆ‘ä»¬å°†<strong>IntegerLiteralType</strong>ç±»å‹åˆ«åå§”æ‰˜ç»™<strong>RawValueçš„IntegerLiteralType</strong>ï¼Œå¹¶ä¸”åŒæ ·åœ°å°†æ¥å—æ•´å‹å­—é¢å€¼çš„åˆå§‹åŒ–å¼å§”æ‰˜ç»™å®ƒã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ¸…ç†å¾ˆå¤šå™ªéŸ³ã€‚</p>
<pre><code class="language-swift">User(
  id: 1,
  name: &quot;Blob&quot;,
  email: .init(rawValue: &quot;blob@pointfree.co&quot;),
  subscriptionId: 2
)
</code></pre>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥é€šè¿‡éµå¾ª<strong>ExpressibleByStringLiteral</strong>æ¥æ¶ˆé™¤å›´ç»•ç”µå­é‚®ä»¶çš„å¹²æ‰°ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å±•ç¤ºäº†å¦‚ä½•æ¢å¤å®ä¾‹åŒ–è¿™äº›ç±»å‹å®‰å…¨å®¹å™¨çš„äººä½“å·¥ç¨‹å­¦ï¼Œè€Œä¸å¿…æ‰‹åŠ¨å°†å®ƒä»¬åˆ°å¤„åŒ…è£…ã€‚</p>
<h2 id="5-a-namewhatsthepointawhats-the-point">5. <a name='Whatsthepoint'></a>Whatâ€™s the point?</h2>
<p>æˆ‘ä»¬é€šå¸¸ä¸ä¼šç»å¸¸åšè¿™ç§äº‹! æˆ‘ä»¬é€šå¸¸æ»¡è¶³äºåœ¨æ¨¡å‹ä¸­ä½¿ç”¨stringã€intå’Œå…¶ä»–åŸºæœ¬ç±»å‹ã€‚ ä»–ä»¬å¾ˆå®¹æ˜“ç›¸å¤„ï¼Œä¹Ÿå¾ˆç†Ÿæ‚‰ã€‚ä½†ç°åœ¨æˆ‘ä»¬åœ¨æ‰€æœ‰åœ°æ–¹åˆ›å»ºå¤§é‡çš„æ–°ç±»å‹ï¼Œå¹¶å°†æ‰€æœ‰çš„å€¼åŒ…è£…åœ¨å¦ä¸€ä¸ªå±‚ä¸­ã€‚è¿™å€¼å¾—å—?</p>
<p>è¿™å®Œå…¨å€¼å¾—! äººä»¬ä¸è¿™ä¹ˆåšçš„å”¯ä¸€åŸå› æ˜¯ï¼Œåœ¨Swift 4.1é¢ä¸–ä¹‹å‰ï¼Œè¿™æ ¹æœ¬ä¸å¯èƒ½!  å³ä½¿æ˜¯æˆ‘ä»¬å¼€å§‹ä½¿ç”¨çš„<strong>RawRepresentable</strong>ç‰ˆæœ¬ä¹Ÿå¾—ç›ŠäºSwift 4.1çš„ç‰¹æ€§:è‡ªåŠ¨æ´¾ç”ŸEquatableã€‚å¦‚ä»Šï¼ŒSwiftä¸ºæˆ‘ä»¬æä¾›äº†è®¸å¤šä¼Ÿå¤§çš„å·¥å…·ï¼Œè®©åŸæœ¬ä¸åˆ‡å®é™…çš„äº‹æƒ…æˆä¸ºå¯èƒ½ã€‚</p>
<p>çœ‹çœ‹æˆ‘ä»¬ç¼–å†™çš„ä»£ç ã€‚</p>
<pre><code class="language-swift">struct Tagged&lt;Tag, RawValue&gt; {
  let rawValue: RawValue
}
extension Tagged: Decodable where RawValue: Decodable {
  init(from decoder: Decoder) throws {
    let container = try decoder.singleValueContainer()
    self.init(rawValue: try container.decode(RawValue.self))
  }
}
extension Tagged: Equatable where RawValue: Equatable {
  static func == (lhs: Tagged, rhs: Tagged) -&gt; Bool {
    return lhs.rawValue == rhs.rawValue
  }
}
extension Tagged: ExpressibleByIntegerLiteral where RawValue: ExpressibleByIntegerLiteral {
  typealias IntegerLiteralType = RawValue.IntegerLiteralType
  init(integerLiteral value: IntegerLiteralType) {
    self.init(rawValue: RawValue(integerLiteral: value))
  }
}
</code></pre>
<p>è¿™ä»…ä»…æ˜¯20è¡Œä»£ç ! ä½†æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æ¯æ¬¡æƒ³è¦ä¸€ç§å…·æœ‰è¿™äº›å“è´¨çš„æ–°å‘å‹æ—¶éƒ½è¦é‡å¤è¿™æ ·åšï¼Œé‚£å°±ä¸ç°å®äº†ã€‚æ‰€æ¶‰åŠçš„åŠªåŠ›æ„å‘³ç€åœ¨ä»»ä½•åœ°æ–¹éƒ½æ›´å®¹æ˜“åšæŒæˆ‘ä»¬çš„åŸå§‹ä»·å€¼è§‚ã€‚</p>
<p>ä½†ç°åœ¨ï¼Œåœ¨Swift 4.1ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€è¡Œä¸­å®Œæˆæ‰€æœ‰è¿™äº›åŠŸèƒ½ï¼Œä»¥åŠæ›´å¤šé™„åŠ çš„ä¸€è‡´æ€§!</p>
<pre><code class="language-swift">typealias Id = Tagged&lt;User, Int&gt;
</code></pre>
<p>è™½ç„¶è¿™æ ·åˆ›å»ºæ–°ç±»å‹åœ¨Swiftä¸­å¹¶ä¸å¸¸è§ï¼Œä½†åœ¨Haskellå’ŒPureScriptç­‰è¯­è¨€ä¸­å´å¾ˆå¸¸è§ï¼Œåœ¨è¿™äº›è¯­è¨€ä¸­åˆ›å»ºæ–°ç±»å‹ä¹Ÿæ˜¯å•è¡Œçš„æƒ…å†µã€‚</p>
<p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç çœŸçš„å¾ˆé…·!æˆ‘ä»¬åœ¨é”®è·¯å¾„(1,2,3)ä¸­è§è¿‡ï¼Œè¿™é‡Œä¹Ÿä¸€æ ·ã€‚</p>
<p>è¿™æ•è·çš„æ¼æ´ä¸æ˜¯å¾®ä¸è¶³é“çš„! æˆ‘ä»¬åœ¨Point-Freeä»£ç åº“ä¸­ä½¿ç”¨äº†<strong>Tagged</strong>ï¼Œå®ƒæ•è·äº†å¯èƒ½ä¼šå‘æˆ‘ä»¬çš„è®¿é—®è€…æ¨å‡ºçš„bug ! æˆ‘ä»¬åœ¨ä»»ä½•åœ°æ–¹éƒ½ä½¿ç”¨å®ƒ! æˆ‘ä»¬ä½¿ç”¨å®ƒåœ¨æˆ‘ä»¬çš„æ¨¡å‹ä¸Šçš„idï¼Œä»ç¬¬ä¸‰æ–¹æœåŠ¡çš„idï¼Œç”µå­é‚®ä»¶åœ°å€ï¼Œå’Œæ›´å¤š!ç¼–è¯‘å™¨ä½¿æˆ‘ä»¬å¤„äºæ£€æŸ¥çŠ¶æ€ï¼Œå¹¶å¸®åŠ©æˆ‘ä»¬é¿å…ä¸€äº›å…¶ä»–æ–¹é¢ä»¤äººè®¨åŒçš„é”™è¯¯ã€‚</p>
<p>è¿™æ˜¯äººä»¬ä»Šå¤©å¯ä»¥ä½¿ç”¨çš„ä»£ç ! æ‚¨å¯ä»¥ç”¨å¾ˆå°‘çš„ä»£ç ä½¿æ‚¨çš„ä»£ç æ›´å®‰å…¨ã€æ›´æœ‰è¡¨ç°åŠ›å’Œæ›´æ˜“äºæ–‡æ¡£åŒ–!</p>
<p>â€œå¹½çµç±»å‹â€çš„æ¦‚å¿µæ˜¯<strong>Tagged</strong>çš„æ¦‚å¿µä¹‹ä¸€ï¼Œæˆ‘ä»¬åªæ˜¯é¡ºä¾¿ç®€å•æåˆ°è¿‡ã€‚æˆ‘ä»¬å°†åœ¨æœªæ¥æ›´å¤šåœ°æ¢ç´¢å®ƒä»¬!</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/i-r9uoo_2N/" class="tag">
                    PointFree
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/pointfree-episode-11-composition-without-operators/">
                  <h3 class="post-title">
                    PointFree Episode 11: Composition without Operators
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
