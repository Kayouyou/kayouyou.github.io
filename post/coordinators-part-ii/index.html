<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Coordinators Part II | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1663222449571">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="

Coordinators Part II

How to configure AppDelegate with main app coordinator?
Letâ€™s introduce Instructor
Deep Links, P..." />
    <meta name="keywords" content="coordinator" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1663222449571" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Coordinators Part II</h2>
            <div class="post-date">2021-06-08</div>
            
            <div class="post-content" v-pre>
              <!-- TOC -->
<ul>
<li><a href="#coordinators-part-ii">Coordinators Part II</a>
<ul>
<li><a href="#how-to-configure-appdelegate-with-main-app-coordinator">How to configure AppDelegate with main app coordinator?</a></li>
<li><a href="#lets-introduce-instructor">Letâ€™s introduce Instructor</a></li>
<li><a href="#deep-links-push-notifications-force-touch">Deep Links, Push Notifications, Force Touch</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="coordinators-part-ii">Coordinators Part II</h1>
<p>åœ¨æœ¬æ•™ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å¤§ä½“ä¸Šè®¨è®ºäº†coordinatorçš„æ–¹æ³•ï¼Œå¹¶å±•ç¤ºäº†ä¸€äº›ä¸æˆ‘çš„å®ç°ç›¸å…³çš„å¸¸è§ç¤ºä¾‹ã€‚ä¸ºäº†ä¸æœ¬æ–‡ä¿æŒä¸€è‡´ï¼Œè¯·é˜…è¯»ä¸Šä¸€éƒ¨åˆ†ã€‚</p>
<p>åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘æƒ³ä»‹ç»ä¸€äº›ä½¿ç”¨åè°ƒå™¨çš„è¾¹ç¼˜æƒ…å†µã€‚</p>
<p>æˆ‘æƒ³æœ€æœ‰è¶£çš„éƒ¨åˆ†æ˜¯ï¼š</p>
<ul>
<li>AppDelegateé…ç½®</li>
<li>ç®¡ç†å¯åŠ¨é€‰é¡¹</li>
<li>æ·±åº¦é“¾æ¥å’Œåè°ƒå‘˜å¤„ç†æ¨é€é€šçŸ¥</li>
</ul>
<p>æˆ‘å°†å±•ç¤ºä¸€æ­¥ä¸€æ­¥çš„è§£å†³æ–¹æ¡ˆå¹¶ç»™å‡ºè§£é‡Šã€‚</p>
<h2 id="how-to-configure-appdelegate-with-main-app-coordinator">How to configure AppDelegate with main app coordinator?</h2>
<p>AppDelegateå˜å¾—éå¸¸ç®€å•ï¼Œå› ä¸ºæ‰€æœ‰å¯¼èˆªé€»è¾‘éƒ½ç§»åŠ¨åˆ°AppCoordinatorã€‚</p>
<p>æ‰€ä»¥ï¼Œæ‚¨éœ€è¦åšçš„æ˜¯åˆ›å»ºä¸€ä¸ªåè°ƒå™¨ï¼Œæ³¨å…¥rootControllerå¹¶è°ƒç”¨startï¼ˆï¼‰ã€‚</p>
<pre><code class="language-swift">@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {
  
  var window: UIWindow?
  var rootController: UINavigationController {
    return self.window!.rootViewController as! UINavigationController
  }
  private lazy var applicationCoordinator: Coordinator = self.makeCoordinator()
  
  func application(_ application: UIApplication,
                   didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {
    applicationCoordinator.start()
    return true
  }
  
  private func makeCoordinator() -&gt; Coordinator {
      return ApplicationCoordinator(
        router: RouterImp(rootController: rootController),
        coordinatorFactory: CoordinatorFactoryImp()
      )
  }
}
</code></pre>
<p>æˆ‘ä»¬ä»ç„¶éœ€è¦åœ¨AppDelegateä¸­å®ç°è¯¸å¦‚didReceiveRemoteNotificationæˆ–continueUserActivityä¹‹ç±»çš„å§”æ‰˜æ–¹æ³•ï¼Œä½†æ˜¯åœ¨æ–¹æ³•ä½“ä¸­ï¼Œæˆ‘ä»¬åªéœ€å†æ¬¡è°ƒç”¨åè°ƒå™¨startï¼ˆï¼‰ï¼ˆæˆ‘ä»¬å°†é€šè¿‡æ­¤æ–¹æ³•å‘é€ä¸€äº›æ•°æ®ï¼Œæˆ‘å°†åœ¨æœ¬æ•™ç¨‹çš„åé¢éƒ¨åˆ†å±•ç¤ºï¼‰ã€‚ä½œä¸ºä¸€ä¸ªå¥½å¤„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å•å…ƒæµ‹è¯•è¦†ç›–åè°ƒå™¨çš„é€»è¾‘å¹¶ä¿æŒAppDelegateçš„æ¸…æ™°ã€‚</p>
<h2 id="lets-introduce-instructor">Letâ€™s introduce Instructor</h2>
<p>å®é™…ç”Ÿäº§åº”ç”¨ç¨‹åºçš„å¤§å¤šæ•°éƒ¨åˆ†éƒ½æœ‰ä¸åŒçš„å¯åŠ¨åœºæ™¯ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://tva1.sinaimg.cn/large/008i3skNgy1grane899jgj312w0m4760.jpg" alt="avatar" loading="lazy"></figure>
<p>æˆ‘ä»¬å¸Œæœ›é€šè¿‡æ¼”ç¤ºæ•™ç¨‹ã€æ˜¾ç¤ºèº«ä»½éªŒè¯æµã€é€šçŸ¥ç”¨æˆ·æ–°åŠŸèƒ½ï¼Œæˆ–è€…ç®€å•åœ°æ˜¾ç¤ºä¸»å±å¹•æ¥å‘ç”¨æˆ·ä»‹ç»æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬åº”è¯¥å°å¿ƒå¤„ç†è¿™ç§è¡Œä¸ºã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰3ç§ä¸åŒçš„æƒ…å†µ:</p>
<ul>
<li>ç”¨æˆ·åº”è¯¥çœ‹åˆ°æ–°æ‰‹æ•™ç¨‹(æˆ‘ä»¬æ˜¾ç¤ºæ–°æ‰‹ç•Œé¢)</li>
<li>ç”¨æˆ·åº”è¯¥å·²ç»ç™»å½•(æˆ‘ä»¬æ˜¾ç¤ºç™»å½•å±å¹•)</li>
<li>ç”¨æˆ·å·²ç»å®Œæˆäº†å‰é¢çš„ä¸¤ä¸ªæ­¥éª¤ï¼Œåªçœ‹åˆ°ä¸»å±å¹•</li>
</ul>
<p>ä¸ºäº†æ–¹ä¾¿åœ°å¤„ç†æ‰€æœ‰è¿™äº›åœºæ™¯ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªenumä½œä¸ºåè°ƒå™¨çš„åŠ©æ‰‹ã€‚æ­¤æšä¸¾åº”æ£€æŸ¥æ‰€æœ‰æ ‡å¿—å¹¶è¿”å›åè°ƒå™¨åº”éµå¾ªçš„æ­£ç¡®æ–¹æ¡ˆã€‚æˆ‘å°†è¿™ä¸ªå®ä½“å‘½åä¸ºInstructorï¼Œå› ä¸ºå®ƒæŒ‡å¯¼åè°ƒå‘˜ä¸‹ä¸€æ­¥è¦åšä»€ä¹ˆã€‚</p>
<pre><code class="language-swift">fileprivate enum LaunchInstructor {
  case main, auth, onboarding
  
  static func configure(tutorialWasShown: Bool, isAutorized: Bool) -&gt; LaunchInstructor {
    switch (tutorialWasShown, isAutorized) {
      case (true, false), (false, false): return .auth
      case (false, true): return .onboarding
      case (true, true): return .main
    }
  }
}
</code></pre>
<p>åˆ›å»ºä¹‹åï¼ŒAppCoordinatorå¯ä»¥éµå¾ªstartå‡½æ•°å¹¶æ ¹æ®çŠ¶æ€è¿è¡Œä¸åŒçš„æµï¼š</p>
<pre><code class="language-swift">override func start() {
  switch instructor {
    case .onboarding: runOnboardingFlow()
    case .auth: runAuthFlow()
    case .main: runMainFlow()
  }
}
</code></pre>
<p>æ­¤æ–¹æ³•é€‚ç”¨äºä»»ä½•åè°ƒç¨‹åºã€‚åœ¨æšä¸¾ä¸­æå–æµé€»è¾‘æ—¶ï¼Œä»£ç å˜å¾—æ¸…æ™°ä¸”æ˜“äºé˜…è¯»ã€‚ç°åœ¨å‡è®¾æˆ‘ä»¬æƒ³è¦æ˜¾ç¤ºItemCreationæ¨¡å—ï¼Œä½†æ˜¯åœ¨æ˜¾ç¤ºå’Œä¸€ä¸ªæœåŠ¡å™¨è¯·æ±‚ä¹‹åï¼Œæˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ªéè®¤è¯é”™è¯¯ã€‚æˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™ä¸ªé”™è¯¯?åè°ƒå™¨åªæ˜¯æ£€æŸ¥æŒ‡ä»¤å¹¶è¿è¡ŒéªŒè¯æµã€‚å®Œæˆåï¼Œåè°ƒå™¨å†æ¬¡è¯·æ±‚æŒ‡å¯¼è€…ï¼Œç„¶åè¿è¡ŒItemCreationæµã€‚</p>
<pre><code class="language-swift">private func runAuthFlow() {
  let coordinator = coordinatorFactory.makeAuthCoordinatorBox(router: router)
  coordinator.finishFlow = { [weak self, weak coordinator] in
    isAutorized = true
    self?.start() //here we'll check instruction
    self?.removeDependency(coordinator)
  }
  addDependency(coordinator)
  coordinator.start()
}
</code></pre>
<h2 id="deep-links-push-notifications-force-touch">Deep Links, Push Notifications, Force Touch</h2>
<p>æˆ‘ç›¸ä¿¡åè°ƒè€…çš„ä¼˜åŠ¿åœ¨äºæ·±åº¦é“¾æ¥ï¼Œæ¨é€é€šçŸ¥å’ŒForce Touchã€‚æˆ‘ä¸æƒ³æ¶‰åŠæƒåˆ©å’Œè¯ä¹¦è¿™äº›ä¸œè¥¿ã€‚å‡è®¾æ‰€æœ‰è¿™äº›éƒ½å·¥ä½œæ­£å¸¸ï¼Œæˆ‘ä»¬åªéœ€è¦å¤„ç†é€»è¾‘ã€‚å¦‚ä»Šï¼Œå½“æˆ‘ä»¬æ‰“å¼€åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šé€‰æ‹©:æŒ‰å‹è§¦æ‘¸ï¼Œæ¨é€é€šçŸ¥ï¼Œæ·±åº¦é“¾æ¥ï¼Œæˆ–æŒ‰ä¸‹åº”ç”¨çš„å›¾æ ‡(ä¹Ÿè®¸å°†æ¥ä¼šæœ‰æ–°çš„å›¾æ ‡ï¼Œè‹¹æœ?ğŸ¤“)ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://tva1.sinaimg.cn/large/008i3skNgy1granjjr3m0j312w0jxmzb.jpg" alt="avatar" loading="lazy"></figure>
<p>å¦‚ä½•å¤„ç†?å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»‹ç»äº†BaseCoordinatorï¼Œå®ƒåŒ…å«å­åè°ƒå™¨æ•°ç»„ã€‚æ‰€æœ‰çš„åè°ƒå™¨éƒ½ç»§æ‰¿å®ƒã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¾ªç¯æ‰€æœ‰å­èŠ‚ç‚¹å¹¶æ‰§è¡Œæ“ä½œã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åªéœ€æ·»åŠ ä¸€ä¸ªæ–¹æ³•æ¥å¤„ç†DeepLinké€»è¾‘æœ¬èº«ï¼Œæˆ–è€…å¾ªç¯å­ç¨‹åºæ¥æ‰¾åˆ°èƒ½å¤Ÿå¤„ç†å®ƒçš„æ–¹æ³•ã€‚å®ƒä¼šåƒä¸€æ£µæ ‘ã€‚æˆ‘ä»¬å¯ä»¥åˆ¶å®šå…·ä½“çš„åè®®æ¥å®ç°è¿™ä¸ªç›®æ ‡ã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://tva1.sinaimg.cn/large/008i3skNgy1grankfxicyj312w0oyad5.jpg" alt="avatar" loading="lazy"></figure>
<p>è®©æˆ‘ä»¬æ›´æ–°åè°ƒå‘˜åè®®:</p>
<pre><code class="language-swift">protocol Coordinator: class {
  func start()
  func start(with option: DeepLinkOption?)
}
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ä¸¤ä¸ªä¸»ä½“ä¸ºç©ºçš„æ–¹æ³•æ·»åŠ åˆ°<strong>BaseCoordinator</strong>ï¼Œä»¥ä¿æŒå®ƒæ˜¯å¯é€‰çš„ã€‚æ ¹æ®æˆ‘ä»¬çš„ç›®æ ‡ï¼Œå­©å­å¯ä»¥ç»§æ‰¿è¿™äº›æ–¹æ³•ä¸­çš„ä¸€ä¸ªï¼Œæˆ–è€…ä¸¤è€…éƒ½ç»§æ‰¿ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸å¸¦é€‰é¡¹çš„startæ¥è¿è¡Œé»˜è®¤è¡Œä¸ºï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç»§ç»­ä½¿ç”¨æ·±åº¦é“¾æ¥åœºæ™¯ï¼Œæˆ‘ä»¬åº”è¯¥æ·»åŠ å…³äºpresent caseçš„ä¿¡æ¯ã€‚å¦‚ä½•å®ç°?æ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ·»åŠ ä¸€äº›åŒ…å«æ‰€æœ‰æ·±å±‚é“¾æ¥å¿«æ·æ–¹å¼çš„å®ä½“ï¼Œå¹¶åˆ›å»ºæˆ‘ä»¬å¯ä»¥ç”¨**start()**æ–¹æ³•å‘é€çš„å¯¹è±¡ã€‚</p>
<p>ä½ é”™è¿‡enumså—ï¼Ÿè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ–°çš„ï¼å®ƒå°†æ˜¯DeepLinkOptionï¼š</p>
<pre><code class="language-swift">struct DeepLinkURLConstants {
  static let Onboarding = &quot;onboarding&quot;
  static let Items = &quot;items&quot;
  static let Item = &quot;item&quot;
  static let Settings = &quot;settings&quot;
}

enum DeepLinkOption {
  case onboarding
  case items
  case settings
  case item(String?)
  
  static func build(with id: String, params: [String : AnyObject]?) -&gt; DeepLinkOption? {
    let itemID = params?[&quot;item_id&quot;] as? String
    switch id {
      case DeepLinkURLConstants.Onboarding: return .onboarding
      case DeepLinkURLConstants.Items: return .items
      case DeepLinkURLConstants.Item: return .item(itemID)
      case DeepLinkURLConstants.Settings: return .settings
      default: return nil
    }
  }
}
</code></pre>
<p>ä½œä¸ºä¸€ä¸ªå¥½å¤„ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„DeepLinkæ–¹æ³•åœ¨åè°ƒå™¨å°†åƒåˆ‡æ¢enumã€‚æ˜¯çš„ï¼Œå’Œå‰é¢çš„ä¾‹å­ä¸€æ ·ï¼Œä½ æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ ä¸€äº›é¢å¤–çš„æ„å»ºæ–¹æ³•:</p>
<pre><code class="language-swift">static func build(with userActivity: NSUserActivity) -&gt; DeepLinkOption?
static func build(with url: URL) -&gt; DeepLinkOption?
static func build(with dict: [String : AnyObject]?) -&gt; DeepLinkOption?
</code></pre>
<p>åœ¨è¿™ä¸ªè¿­ä»£ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬è¿”å›åˆ°AppDelegateå¹¶æ›´æ–°å®ƒä¸€ç‚¹ï¼Œå®ƒå°†ä¼šåƒè¿™æ ·:</p>
<pre><code class="language-swift">func application(_ application: UIApplication,
                 didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -&gt; Bool {
  let notification = launchOptions?[.remoteNotification] as? [String: AnyObject]
  let deepLink = DeepLinkOption.build(with: notification)
  applicationCoordinator.start(with: deepLink)
  return true
}

func application(_ application: UIApplication,
                 didReceiveRemoteNotification userInfo: [AnyHashable : Any]) {
  let dict = userInfo as? [String: AnyObject]
  let deepLink = DeepLinkOption.build(with: dict)
  applicationCoordinator.start(with: deepLink)
}

func application(_ application: UIApplication, continue userActivity: NSUserActivity,
                 restorationHandler: @escaping ([Any]?) -&gt; Void) -&gt; Bool {
  let deepLink = DeepLinkOption.build(with: userActivity)
  applicationCoordinator.start(with: deepLink)
  return true
}
</code></pre>
<p>å¥½å§ï¼Œçœ‹èµ·æ¥ä¸é”™ï¼ŸğŸ¤” ç„¶åæ‚¨å°†æ”¶åˆ°ä¸€ä¸ªæ¨é€é€šçŸ¥æˆ–ä¸€ä¸ªæ·±åº¦é“¾æ¥ï¼Œæ‚¨åªéœ€æ„å»ºæ‚¨çš„æ·±åº¦é“¾æ¥å¹¶ä½¿ç”¨AppCoordinatorç»§ç»­æ­¤æ“ä½œã€‚</p>
<pre><code class="language-swift">override func start(with option: DeepLinkOption?) {
    //start with deepLink
    if let option = option {
        switch option {
        case .onboarding: runOnboardingFlow()
        case .signUp: runAuthFlow()
        default: childCoordinators.forEach { coordinator in
            coordinator.start(with: option)
            }
        }
    //default start
    } else {
        switch instructor {
        case .onboarding: runOnboardingFlow()
        case .auth: runAuthFlow()
        case .main: runMainFlow()
        }
    }
}
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>åœ¨æˆ‘ä»¬è¯•å›¾åœ¨ä»£ç ä¸­å®ç°çš„æ¯ä¸€ä¸ªæ–°è§£å†³æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬éƒ½é¢ä¸´ç€è®¸å¤šè¾¹ç¼˜æƒ…å†µå’Œä¸€äº›ä¸é‚£ä¹ˆæ¼‚äº®çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒä¸åº”è¯¥åƒç‚’ä½œé©±åŠ¨çš„å¼€å‘ï¼Œæˆ‘ä»¬åªéœ€è¦é€‚å½“åœ°é€æ­¥å®Œå–„æ‰€æœ‰æ£˜æ‰‹çš„éƒ¨åˆ†ã€‚</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/fkXsOWHsE/" class="tag">
                    coordinator
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/coordinators-part-i/">
                  <h3 class="post-title">
                    Coordinators Part I
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
