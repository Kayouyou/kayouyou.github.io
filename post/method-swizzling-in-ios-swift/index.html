<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Method swizzling in iOS swift | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1645872277603">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="

Method swizzling in iOS swift

What is method swizzling?
How to do method swizzling in swift 4?
Letâ€™s swizzle!!
Drawba..." />
    <meta name="keywords" content="method swizzling" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1645872277603" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Method swizzling in iOS swift</h2>
            <div class="post-date">2021-05-28</div>
            
            <div class="post-content" v-pre>
              <!-- TOC -->
<ul>
<li><a href="#method-swizzling-in-ios-swift">Method swizzling in iOS swift</a>
<ul>
<li><a href="#what-is-method-swizzling">What is method swizzling?</a></li>
<li><a href="#how-to-do-method-swizzling-in-swift-4">How to do method swizzling in swift 4?</a></li>
<li><a href="#lets-swizzle">Letâ€™s swizzle!!</a></li>
<li><a href="#drawbacks-of-method-swizzling">Drawbacks of method swizzling</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="method-swizzling-in-ios-swift">Method swizzling in iOS swift</h2>
<h3 id="what-is-method-swizzling">What is method swizzling?</h3>
<p>Method swizzling æ˜¯åœ¨è¿è¡Œæ—¶æ›´æ”¹ç°æœ‰é€‰æ‹©å™¨çš„å®ç°çš„è¿‡ç¨‹ã€‚ç®€å•åœ°è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ”¹æ–¹æ³•çš„åŠŸèƒ½ã€‚</p>
<blockquote>
<p>Note: è¿™æ˜¯ä¸€ä¸ªObjective-Cè¿è¡Œæ—¶ç‰¹æ€§ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚:å¦‚æœä½ æƒ³è·Ÿè¸ªæ·»åŠ åˆ°UserDefaultsä¸­çš„é”®å’Œå€¼ï¼Œå¹¶åœ¨æ‰€æœ‰é”®ä¹‹å‰æ·»åŠ ä¸€ä¸ªå‰ç¼€å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥ç”¨ä½ è‡ªå·±çš„æ–¹æ³•åˆ‡æ¢setValue:forKeyæ–¹æ³•çš„å®ç°ã€‚å› æ­¤ï¼Œæ‰€æœ‰å¯¹setValue:forKeyæ–¹æ³•çš„è°ƒç”¨éƒ½å°†è¢«è·¯ç”±åˆ°æ–°çš„é€‰æ‹©å™¨æ–¹æ³•ã€‚æ‚¨å¯ä»¥åˆ›å»ºæ·»åŠ äº†å‰ç¼€çš„æ–°é”®å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨æ–°é”®è°ƒç”¨setValue:forKeyæ–¹æ³•çš„åŸå§‹å®ç°ã€‚ä½ ä¼šå›°æƒ‘å®ƒæ˜¯å¦ä¼šä»¥æ— é™å¾ªç¯ç»“æŸã€‚ä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚(æ³¨æ„:ä½ å¯ä»¥é€šè¿‡åœ¨Objcæˆ–swiftæ‰©å±•ä¸­ä½¿ç”¨categoryæ¥åšåŒæ ·çš„äº‹æƒ…ã€‚åªéœ€åˆ›å»ºä¸€ä¸ªæ–°æ–¹æ³•ï¼Œå¹¶ä»è¿™ä¸ªæ–°æ–¹æ³•è°ƒç”¨è¶…çº§setValue:forKeyæ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¯¼å…¥çš„ç¬¬ä¸‰æ–¹åº“å’Œæ¡†æ¶ç›´æ¥ä½¿ç”¨setValue:forKeyæ–¹æ³•æ€ä¹ˆåŠ? è¿™äº›åº“ä¸çŸ¥é“æ–°çš„è‡ªå®šä¹‰æ–¹æ³•ï¼Œä¹Ÿä¸çŸ¥é“æˆ‘ä»¬éœ€è¦å‘é”®æ·»åŠ å‰ç¼€ã€‚è¿™å°±æ˜¯<strong>method swizzling</strong>å‘æŒ¥ä½œç”¨çš„æ—¶å€™äº†). æˆ‘æŠŠè¿™ä¸ªä¾‹å­ä»ä»¥ä¸‹æ–‡ç« ğŸ‘‡ğŸ»ğŸ‘‡ğŸ»ğŸ‘‡ğŸ»ğŸ‘‡ğŸ»ğŸ‘‡ğŸ»ğŸ‘‡ğŸ»ã€‚</p>
<p>åœ¨ç»§ç»­ä¹‹å‰è¯·é˜…è¯»Michael Mavrisçš„<a href="https://medium.com/rocknnull/ios-to-swizzle-or-not-to-swizzle-f8b0ed4a1ce6">æ–‡ç« </a>ã€‚çœ‹çœ‹stackoverflowä¸Šå…³äºå¦‚ä½•åœ¨swift 3å’Œ4ä¸­åš<a href="https://stackoverflow.com/questions/39562887/how-to-implement-method-swizzling-swift-3-0">method swizzling</a>çš„å¸–å­ã€‚</p>
<h3 id="how-to-do-method-swizzling-in-swift-4">How to do method swizzling in swift 4?</h3>
<p>Well, its easy:</p>
<ul>
<li>Create a new method with your custom implementation for a method that you want to swizzle.</li>
<li>Get the class representation.</li>
<li>Get the old method selector reference.</li>
<li>Get the new method selector reference.</li>
<li>Ask the objective-C runtime to switch the selectors.</li>
<li>Take a deep breath and relax.!! ğŸ˜‚.</li>
</ul>
<h3 id="lets-swizzle">Letâ€™s swizzle!!</h3>
<p>è®©æˆ‘ä»¬ä¸ºUIColorç±»çš„descriptionæ–¹æ³•åˆ›å»ºä¸€ä¸ªäº¤æ¢æ–¹æ³•ã€‚</p>
<p>å¦‚æœä½ å°è¯•æ‰“å°ä¸€ä¸ªUIColorå¯¹è±¡ï¼Œå®ƒä¼šåƒè¿™æ ·æ‰“å°RGBAå€¼:</p>
<pre><code class="language-swift">print(UIColor.red) // prints UIExtendedSRGBColorSpace 1 0 0 1
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥æ‰“å°é¢œè‰²ï¼Œå› ä¸ºUIColoræœ‰ä¸€ä¸ªæè¿°æ–¹æ³•ï¼Œå®ƒå°†è¿”å›é¢œè‰²çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚è®©æˆ‘ä»¬è¯•è¯•è¿™ç§æ–¹æ³•ã€‚</p>
<pre><code class="language-swift">import Foundation
import UIKit
public extension UIColor {
    @objc func colorDescription() -&gt; String {
        return &quot;Printing rainbow colours.&quot;
    }
    private static let swizzleDesriptionImplementation: Void = {
        let instance: UIColor = UIColor.red
        let aClass: AnyClass! = object_getClass(instance)
        let originalMethod = class_getInstanceMethod(aClass, #selector(description))
        let swizzledMethod = class_getInstanceMethod(aClass, #selector(colorDescription))
        if let originalMethod = originalMethod, let swizzledMethod = swizzledMethod {
        // switch implementation..
        method_exchangeImplementations(originalMethod, swizzledMethod)
        }
    }()
    public static func swizzleDesription() {
        _ = self.swizzleDesriptionImplementation
    }
}
</code></pre>
<p>æˆ‘è®¤ä¸ºä¸Šé¢çš„ä»£ç å¾ˆå®¹æ˜“è§£é‡Šã€‚åœ¨æˆ‘çš„è§†å›¾æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘æ·»åŠ äº†ä»¥ä¸‹ä»£ç ã€‚</p>
<pre><code class="language-swift">override func viewDidLoad() {
    super.viewDidLoad()
    print(UIColor.red)
    print(UIColor.green)
    UIColor.swizzleDesription()
    print(â€œ\nswizzled\nâ€)
    print(UIColor.red)
    print(UIColor.red)
    UIColor.swizzleDesription()
    print(â€œ\nTrying to swizzle again\nâ€)
    print(UIColor.red)
    print(UIColor.red)
}
</code></pre>
<p><strong>Output</strong></p>
<pre><code class="language-swift">UIExtendedSRGBColorSpace 1 0 0 1
UIExtendedSRGBColorSpace 0 1 0 1
swizzled
Printing rainbow colours.
Printing rainbow colours.
Trying to swizzle again
Printing rainbow colours.
Printing rainbow colours.
</code></pre>
<p><strong>Swiftçš„é™æ€æˆå‘˜æ˜¯éšå¼æƒ°æ€§(lazy)çš„</strong>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆswizzledescriptionimplementationæ²¡æœ‰è¢«å†æ¬¡è°ƒç”¨ï¼Œä¹Ÿæ²¡æœ‰å†æ¬¡å‘ç”Ÿswizzledescriptionimplementationçš„åŸå› ã€‚ å°†ä¿®æ”¹æ–¹æ³•çš„æ‰€æœ‰æ“ä½œå°é—­åœ¨è®¡ç®—çš„å…¨å±€å¸¸é‡çš„æƒ°æ€§åˆå§‹åŒ–å—ä¸­ï¼Œå¯ä»¥ç¡®ä¿è¯¥è¿‡ç¨‹åªæ‰§è¡Œä¸€æ¬¡(å› ä¸ºè¿™äº›å˜é‡æˆ–å¸¸é‡çš„åˆå§‹åŒ–åœ¨åå°ä½¿ç”¨dispatch_once)ã€‚</p>
<h3 id="drawbacks-of-method-swizzling">Drawbacks of method swizzling</h3>
<ul>
<li>
<p>å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ä»»ä½•æ ‡å‡†ç±»æ–¹æ³•è¿›è¡Œäº¤æ¢ï¼Œé‚£ä¹ˆæœ€å¥½ç¡®ä¿äº¤æ¢æˆåŠŸï¼Œå¹¶è°ƒç”¨æ–°çš„äº¤æ¢æ–¹æ³•ã€‚ å¦‚æœä½ ä½¿ç”¨çš„æ¡†æ¶(ä¾‹å¦‚Firebase)ä½¿ç”¨äº†äº¤æ¢ï¼Œè¯·ç¡®ä¿ä½ æ²¡æœ‰æ··åˆä»–ä»¬å·²ç»äº¤æ¢çš„ä¸€äº›æ–¹æ³•ã€‚å¦‚æœäº¤æ¢å‘ç”Ÿå¤šæ¬¡ï¼Œè¦ä¹ˆæ‚¨çš„ä»£ç ä¸èƒ½å·¥ä½œï¼Œè¦ä¹ˆfirebase(æˆ–ä»»ä½•å…¶ä»–æ¡†æ¶æ··åˆç›¸åŒçš„æ–¹æ³•)ä¸èƒ½å·¥ä½œã€‚</p>
</li>
<li>
<p>å½“æ›´æ–°çš„iOSç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œäº¤æ¢æœ‰å¯èƒ½å¤±è´¥ã€‚ä½ å¯èƒ½æ¯æ¬¡éƒ½è¦åå¤æ ¸å¯¹ã€‚</p>
</li>
<li>
<p>å¦‚æœä½ å‘è¡Œçš„æ¡†æ¶(ä¾‹å¦‚ä¸€äº›åˆ†ææ¡†æ¶)è¢«æ•°ç™¾æ¬¾åº”ç”¨æ‰€ä½¿ç”¨ï¼Œé‚£ä¹ˆæœ€å¥½ä¸è¦åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨äº¤æ¢åŠŸèƒ½ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨äº¤æ¢ï¼Œè¯·ç¡®ä¿åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜çŸ¥é“æ¡†æ¶æ‰€åšçš„äº¤æ¢ã€‚ç¡®ä¿å°†å…¶æ·»åŠ åˆ°æ–‡æ¡£ä¸­ã€‚</p>
</li>
<li>
<p>åœ¨å­ç±»ä¸­è¿›è¡Œæ··åˆå°†æ˜¯ä¸€ä¸ªå¤´ç—›çš„äº‹ã€‚å¯èƒ½ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„äº‹æƒ…ã€‚</p>
</li>
</ul>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/hR9JIjWsI/" class="tag">
                    method swizzling
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/method-swizzling/">
                  <h3 class="post-title">
                    iOSé»‘é­”æ³•ï¼šMethod Swizzling
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
