<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Modelling state in Swift | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1652020609222">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="åœ¨æ„å»ºåº”ç”¨ç¨‹åºå’Œè®¾è®¡ç³»ç»Ÿæ—¶ï¼Œæœ€å›°éš¾çš„äº‹æƒ…ä¹‹ä¸€æ˜¯å†³å®šå¦‚ä½•å»ºæ¨¡å’Œå¤„ç†çŠ¶æ€ã€‚ ä»£ç ç®¡ç†çŠ¶æ€ä¹Ÿæ˜¯bugçš„ä¸€ä¸ªå¸¸è§æ¥æºï¼Œå½“æˆ‘ä»¬çš„åº”ç”¨çš„æŸäº›éƒ¨åˆ†å¯èƒ½ä¼šå‡ºç°æˆ‘ä»¬æ²¡æœ‰é¢„æ–™åˆ°çš„çŠ¶æ€ã€‚
æœ¬å‘¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›æŠ€æœ¯ï¼Œè¿™äº›æŠ€æœ¯å¯ä»¥ä½¿ç¼–å†™å¤„ç†å’Œå“åº”çŠ¶æ€å˜åŒ–çš„ä»£ç å˜å¾—..." />
    <meta name="keywords" content="state management,architecture" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1652020609222" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Modelling state in Swift</h2>
            <div class="post-date">2017-07-02</div>
            
            <div class="post-content" v-pre>
              <p>åœ¨æ„å»ºåº”ç”¨ç¨‹åºå’Œè®¾è®¡ç³»ç»Ÿæ—¶ï¼Œæœ€å›°éš¾çš„äº‹æƒ…ä¹‹ä¸€æ˜¯å†³å®šå¦‚ä½•å»ºæ¨¡å’Œå¤„ç†çŠ¶æ€ã€‚ ä»£ç ç®¡ç†çŠ¶æ€ä¹Ÿæ˜¯bugçš„ä¸€ä¸ªå¸¸è§æ¥æºï¼Œå½“æˆ‘ä»¬çš„åº”ç”¨çš„æŸäº›éƒ¨åˆ†å¯èƒ½ä¼šå‡ºç°æˆ‘ä»¬æ²¡æœ‰é¢„æ–™åˆ°çš„çŠ¶æ€ã€‚</p>
<p>æœ¬å‘¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›æŠ€æœ¯ï¼Œè¿™äº›æŠ€æœ¯å¯ä»¥ä½¿ç¼–å†™å¤„ç†å’Œå“åº”çŠ¶æ€å˜åŒ–çš„ä»£ç å˜å¾—æ›´å®¹æ˜“â€”â€”ä½¿å®ƒæ›´å¥å£®ï¼Œæ›´ä¸å®¹æ˜“å‡ºé”™ã€‚ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ä¼šè¯¦ç»†ä»‹ç»ç‰¹å®šçš„æ¡†æ¶æˆ–æ›´å¤§çš„ã€åº”ç”¨ç¨‹åºèŒƒå›´å†…çš„æ¶æ„å˜åŒ–(æ¯”å¦‚RxSwiftã€ReSwiftæˆ–ä½¿ç”¨ä¸€ä¸ªå—ELMå¯å‘çš„æ¶æ„)(æˆ‘å°†æŠŠè¿™ä¸ªé—®é¢˜ç•™åˆ°ä¸‹ä¸€å‘¨è®¨è®º)-ç›¸åï¼Œæˆ‘æƒ³ä¸“æ³¨äºå°çš„æŠ€å·§ï¼ŒæŠ€å·§å’Œæ¨¡å¼ï¼Œæˆ‘å·²ç»å‘ç°çœŸæ­£æœ‰ç”¨çš„ã€‚</p>
<h2 id="a-single-source-of-truth">A single source of truth</h2>
<p>åœ¨ä¸ºå„ç§çŠ¶æ€å»ºæ¨¡æ—¶ï¼Œæœ€å¥½è®°ä½ä¸€ä¸ªæ ¸å¿ƒåŸåˆ™ï¼Œé‚£å°±æ˜¯å°½é‡åšæŒâ€œå•ä¸€çš„çœŸç›¸æ¥æºâ€ã€‚ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ï¼Œæ‚¨æ°¸è¿œä¸éœ€è¦æ£€æŸ¥å¤šä¸ªæ¡ä»¶æ¥ç¡®å®šæ‚¨æ‰€å¤„çš„çŠ¶æ€ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æ­£åœ¨åˆ¶ä½œä¸€æ¬¾æ¸¸æˆï¼Œå…¶ä¸­çš„æ•Œäººæ‹¥æœ‰ä¸€å®šçš„å‘½å€¼ï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ªæ——å¸œæ¥å†³å®šä»–ä»¬æ˜¯å¦åœ¨æ¸¸æˆä¸­ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨æ•Œäººç±»ä¸Šä½¿ç”¨ä¸¤ä¸ªå±æ€§è¿›è¡Œå»ºæ¨¡ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-swift">class Enemy {
    var health = 10
    var isInPlay = false
}
</code></pre>
<p>è™½ç„¶ä¸Šé¢çš„è¯´æ³•æ˜¯ç›´æ¥ç›´å»çš„ï¼Œä½†å®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°æŠŠæˆ‘ä»¬ç½®äºä¸€ç§æœ‰å¤šç§çœŸç›¸æ¥æºçš„å¢ƒåœ°ã€‚è®©æˆ‘ä»¬å‡è®¾åªè¦æ•Œäººçš„ç”Ÿå‘½å€¼è¾¾åˆ°0ï¼Œå®ƒå°±åº”è¯¥é€€å‡ºæ¸¸æˆã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬ä»£ç çš„æŸä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›é€»è¾‘æ¥å¤„ç†å®ƒ:</p>
<pre><code class="language-swift">func enemyDidTakeDamage() {
    if enemy.health &lt;= 0 {
        enemy.isInPlay = false
    }
}
</code></pre>
<p>å½“æˆ‘ä»¬å¼•å…¥æ–°çš„ä»£ç è·¯å¾„è€Œå¿˜è®°æ‰§è¡Œä¸Šè¿°æ£€æŸ¥æ—¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç»™äºˆç©å®¶ä¸€ç§ç‰¹æ®Šçš„æ”»å‡»ï¼Œå°†æ‰€æœ‰æ•Œäººçš„ç”Ÿå‘½å€¼ç«‹å³è®¾ç½®ä¸º0:</p>
<pre><code class="language-swift">func performSpecialAttack() {
    for enemy in allEnemies {
        enemy.health = 0
    }
}
</code></pre>
<p>å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬æ›´æ–°äº†æ‰€æœ‰æ•Œäººçš„ç”Ÿå‘½å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¿˜è®°æ›´æ–°isInPlayäº†ã€‚è¿™å¾ˆå¯èƒ½ä¼šå¯¼è‡´bugå’Œæˆ‘ä»¬æœ€ç»ˆå¤„äºæœªå®šä¹‰çŠ¶æ€çš„æƒ…å†µã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šé€šè¿‡æ·»åŠ å¤šä¸ªæ£€æŸ¥æ¥è§£å†³é—®é¢˜ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-swift">if enemy.isInPlay &amp;&amp; enemy.health &gt; 0 {
    // Enemy is *really* in play
} else {
    // Enemy is *really* defeated
}
</code></pre>
<p>è™½ç„¶ä¸Šé¢çš„æ–¹æ³•å¯ä»¥ä½œä¸ºä¸€ä¸ªä¸´æ—¶çš„â€œåˆ›å£è´´â€è§£å†³æ–¹æ¡ˆï¼Œä½†å½“æˆ‘ä»¬æ·»åŠ æ›´å¤šçš„æ¡ä»¶å’Œæ›´å¤æ‚çš„çŠ¶æ€æ—¶ï¼Œå®ƒå°†å¾ˆå¿«å¯¼è‡´ä»£ç éš¾ä»¥é˜…è¯»ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“è¢«ç ´åã€‚å¦‚æœä½ ä»”ç»†æƒ³æƒ³ï¼Œåšä¸Šé¢çš„äº‹æƒ…æœ‰ç‚¹åƒä¸ä¿¡ä»»æˆ‘ä»¬è‡ªå·±çš„apiï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»ç¼–å†™å¦‚æ­¤é˜²å¾¡æ€§çš„ä»£ç ğŸ˜•</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•ï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬æœ‰ä¸€ä¸ªå•ä¸€çš„çœŸç›¸æ¥æºï¼Œæ˜¯è‡ªåŠ¨æ›´æ–°æ•Œäººç±»çš„isInPlayå±æ€§ï¼Œä½¿ç”¨å¥åº·å±æ€§çš„didSet:</p>
<pre><code class="language-swift">class Enemy {
    var health = 10 {
        didSet { putOutOfPlayIfNeeded() }
    }

    // Important to only allow mutations of this property from within this class
    private(set) var isInPlay = true

    private func putOutOfPlayIfNeeded() {
        guard health &lt;= 0 else {
            return
        }

        isInPlay = false
        remove()
    }
}
</code></pre>
<p>è¿™æ ·æˆ‘ä»¬ç°åœ¨åªéœ€è¦æ‹…å¿ƒæ›´æ–°æ•Œäººçš„å‘½å€¼ï¼Œå¹¶ä¸”æˆ‘ä»¬ç¡®ä¿¡isInPlayå±æ€§å°†å§‹ç»ˆä¿æŒåŒæ­¥ğŸ‘</p>
<h2 id="making-states-exclusive">Making states exclusive</h2>
<p>ä¸Šé¢çš„æ•Œäººä¾‹å­éå¸¸ç®€å•ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¦å¤„ç†æ›´å¤æ‚çš„çŠ¶æ€ï¼Œæ¯ä¸ªçŠ¶æ€éƒ½æœ‰ç›¸å…³çš„å€¼ï¼Œæˆ‘ä»¬éœ€è¦ç›¸åº”åœ°æ¸²æŸ“å’Œåšå‡ºååº”ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨ï¼Œå®ƒå°†å…è®¸æˆ‘ä»¬ä»ç‰¹å®šçš„URLä¸‹è½½å’Œè§‚çœ‹è§†é¢‘ã€‚ä¸ºè§†é¢‘å»ºæ¨¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç»“æ„ä½“ï¼Œåƒè¿™æ ·:</p>
<pre><code class="language-swift">struct Video {
    let url: URL
    var downloadTask: Task?
    var file: File?
    var isPlaying = false
    var progress: Double = 0
}
</code></pre>
<p>ä¸Šé¢çš„æ–¹æ³•çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šæœ‰å¾ˆå¤šå¯é€‰çš„é€‰é¡¹ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸èƒ½é€šè¿‡é˜…è¯»æˆ‘ä»¬çš„æ¨¡å‹ä»£ç æ¥çœŸæ­£åœ°çŸ¥é“è§†é¢‘å¯ä»¥å¤„äºä»€ä¹ˆçŠ¶æ€ã€‚æˆ‘ä»¬é€šå¸¸è¿˜ä¸å¾—ä¸ç¼–å†™å¤æ‚çš„å¤„ç†ç¨‹åºï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€äº›ä¸åº”è¯¥è¢«è¾“å…¥çš„ä»£ç è·¯å¾„:</p>
<pre><code class="language-swift">if let downloadTask = video.downloadTask {
    // Handle download
} else if let file = video.file {
    // Perform playback
} else {
    // Uhm... what to do here? ğŸ¤”
}
</code></pre>
<p>æˆ‘è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ä½¿ç”¨æšä¸¾æ¥å®šä¹‰éå¸¸æ¸…æ™°çš„æ’ä»–çŠ¶æ€ï¼Œåƒè¿™æ ·:</p>
<pre><code class="language-swift">struct Video {
    enum State {
        case willDownload(from: URL)
        case downloading(task: Task)
        case playing(file: File, progress: Double)
        case paused(file: File, progress: Double)
    }

    var state: State
}
</code></pre>
<p>æ­£å¦‚æ‚¨åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å»æ‰äº†æ‰€æœ‰çš„å¯é€‰é€‰é¡¹ï¼Œæ‰€æœ‰ä¸çŠ¶æ€ç›¸å…³çš„å€¼ç°åœ¨éƒ½åˆå¹¶åˆ°å®ƒä»¬å°†è¦ç”¨äºçš„çŠ¶æ€ä¸­ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥å¦ä¸€ä¸ªçº§åˆ«çš„çŠ¶æ€æ¥è¿›ä¸€æ­¥æ¶ˆé™¤ä¸€äº›é‡å¤:</p>
<pre><code class="language-swift">extension Video {
    struct PlaybackState {
        let file: File
        var progress: Double
    }
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ’­æ”¾å’Œæš‚åœçš„æƒ…å†µä¸‹ä½¿ç”¨:</p>
<pre><code class="language-swift">case playing(PlaybackState)
case paused(PlaybackState)
</code></pre>
<h2 id="rendering-reactively">Rendering reactively</h2>
<p>ç„¶è€Œï¼Œå¦‚æœä½ å¼€å§‹åƒä¸Šé¢é‚£æ ·å»ºæ¨¡ä½ çš„çŠ¶æ€ï¼Œä½†ç»§ç»­å†™å‘½ä»¤å¼çŠ¶æ€å¤„ç†ä»£ç (ä½¿ç”¨å¤šä¸ªif/elseè¯­å¥ï¼Œåƒä¸Šé¢é‚£æ ·)ï¼Œäº‹æƒ…å°†å˜å¾—ç›¸å½“ä¸‘é™‹ã€‚ å› ä¸ºæˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯éƒ½â€œéšè—â€åœ¨ä¸åŒçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åšå¤§é‡çš„switchæˆ–if case letè¯­å¥æ¥â€œå–å‡ºå®ƒâ€ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦å°†çŠ¶æ€æšä¸¾ä¸å“åº”æ€§çŠ¶æ€å¤„ç†ä»£ç ç»“åˆèµ·æ¥ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ç¼–å†™ä»£ç æ¥æ›´æ–°è§†é¢‘æ’­æ”¾å™¨è§†å›¾æ§åˆ¶å™¨ä¸­çš„åŠ¨ä½œæŒ‰é’®:</p>
<pre><code class="language-swift">class VideoPlayerViewController: UIViewController {
    var video: Video {
        // Every time the video changes, we re-render
        didSet { render() }
    }

    fileprivate lazy var actionButton = UIButton()

    private func render() {
        renderActionButton()
    }

    private func renderActionButton() {
        let actionButtonImage = resolveActionButtonImage()
        actionButton.setImage(actionButtonImage, for: .normal)
    }

    private func resolveActionButtonImage() -&gt; UIImage {
        // The image for the action button is declaratively resolved
        // directly from the video state
        switch video.state {
            // We can easily discard associated values that we don't need
            // by simply omitting them
            case .willDownload:
                return .wait
            case .downloading:
                return .cancel
            case .playing:
                return .pause
            case .paused:  
                return .play
        } 
    }
}
</code></pre>
<p>ç°åœ¨ï¼Œæ¯å½“æˆ‘ä»¬çš„è§†é¢‘çŠ¶æ€æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬çš„UIå°±ä¼šè‡ªåŠ¨æ›´æ–°ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå•ä¸€çš„çœŸç†æ¥æºï¼Œæ²¡æœ‰æœªå®šä¹‰çš„çŠ¶æ€ğŸ‰ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•æ¸²æŸ“æ–¹æ³•ï¼Œå½“æˆ‘ä»¬çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰çš„UIæ›´æ–°:</p>
<pre><code class="language-swift">func render() {
    renderActionButton()
    renderVideoSurface()
    renderNavigationBarButtonItems()
    ...
}
</code></pre>
<h2 id="handling-state-changes">Handling state changes</h2>
<p>æ¸²æŸ“æ˜¯ä¸€å›äº‹ï¼Œä½†é€šå¸¸æˆ‘ä»¬è¿˜éœ€è¦åœ¨çŠ¶æ€æ”¹å˜æ—¶è§¦å‘æŸç§å½¢å¼çš„é€»è¾‘ã€‚æˆ‘ä»¬å¯èƒ½æƒ³è¦è½¬æ¢åˆ°å¦ä¸€ä¸ªçŠ¶æ€ï¼Œæˆ–è€…å¼€å§‹ä¸€ä¸ªæ“ä½œã€‚ å¥½çš„æ–¹é¢æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸æ¸²æŸ“å®Œå…¨ç›¸åŒçš„æ¨¡å¼æ¥æ‰§è¡Œè¿™æ ·çš„é€»è¾‘ã€‚</p>
<p>è®©æˆ‘ä»¬å†™ä¸€ä¸ªhandleStateChangeæ–¹æ³•ï¼Œå®ƒä¹Ÿä¼šä»è§†é¢‘å±æ€§çš„didSetä¸­è¢«è°ƒç”¨ï¼Œå®ƒä¼šæ ¹æ®æˆ‘ä»¬å½“å‰æ‰€å¤„çš„çŠ¶æ€è¿è¡Œå„ç§é€»è¾‘:</p>
<pre><code class="language-swift">private extension VideoPlayerViewController {
    func handleStateChange() {
        switch video.state {
        case .willDownload(let url):
            // Start a download task and enter the 'downloading' state
            let task = Task.download(url: url)
            task.start()
            video.state = .downloading(task: task)
        case .downloading(let task):
            // If the download task finished, start playback
            switch task.state {
            case .inProgress:
                break
            case .finished(let file):
                let playbackState = Video.PlaybackState(file: file, progress: 0)
                video.state = .playing(playbackState)
            }
        case .playing:
            player.play()
        case .paused:
            player.pause()
        }
    }
}
</code></pre>
<h2 id="extracting-information">Extracting information</h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨switchè¯­å¥æ¥æ‰§è¡Œæ‰€æœ‰çš„æ¸²æŸ“å’ŒçŠ¶æ€å¤„ç†ã€‚ æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±â€”â€”å®ƒâ€œè¿«ä½¿â€æˆ‘ä»¬è€ƒè™‘æ‰€æœ‰çš„çŠ¶æ€å’Œæ‰€æœ‰çš„æƒ…å†µï¼Œå¹¶ä¸ºæ¯ä¸€ç§æƒ…å†µå†™é€‚å½“çš„é€»è¾‘ã€‚å¦‚æœå¼•å…¥äº†æˆ‘ä»¬æ²¡æœ‰å¤„ç†çš„æ–°çŠ¶æ€ï¼Œå®ƒè¿˜å…è®¸æˆ‘ä»¬åˆ©ç”¨ç¼–è¯‘å™¨æ¥ç»™å‡ºé”™è¯¯ã€‚</p>
<p>ç„¶è€Œï¼Œæœ‰æ—¶æ‚¨éœ€è¦åšä¸€äº›åªå½±å“ç‰¹å®šçŠ¶æ€çš„éå¸¸å…·ä½“çš„äº‹æƒ…ã€‚ å‡è®¾æˆ‘ä»¬æƒ³è¦ç¡®ä¿æˆ‘ä»¬å–æ¶ˆä»»ä½•æ­£åœ¨è¿›è¡Œçš„ä¸‹è½½ä»»åŠ¡ï¼Œå¦‚æœæˆ‘ä»¬çš„è§†å›¾æ§åˆ¶å™¨ç¦»å¼€å±å¹•:</p>
<pre><code class="language-swift">extension VideoPlayerViewController {
    override func viewDidDisappear(_ animated: Bool) {
        super.viewDidDisappear(animated)

        // Ideally, we'd like an API like this, that let's us cancel any ongoing
        // download task without having to write a huge switch statement
        video.downloadTask?.cancel()
    }
}
</code></pre>
<p>èƒ½å¤Ÿè®¿é—®å¦‚ä¸Šæ‰€è¿°çš„æŸäº›å±æ€§æ˜¯éå¸¸å¥½çš„ï¼Œå¹¶ä¸”å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‘†è„±å¤§é‡çš„æ ·æ¿æ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©æ€»æ˜¯ä½¿ç”¨switchè¯­å¥è¿›è¡ŒçŠ¶æ€å¤„ç†ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ç¼–å†™è¿™äº›æ ·æ¿æ–‡ä»¶ã€‚</p>
<p>æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬å®ç°å®ƒå§!è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åªéœ€åœ¨è§†é¢‘ä¸Šåˆ›å»ºä¸€ä¸ªæ‰©å±•ï¼Œä½¿ç”¨Swiftçš„guard caseè®©æ¨¡å¼åŒ¹é…è¯­æ³•æå–ä»»ä½•æ­£åœ¨è¿›è¡Œçš„ä¸‹è½½ä»»åŠ¡:</p>
<pre><code class="language-swift">extension Video {
    var downloadTask: Task? {
        guard case let .downloading(task) = state else {
            return nil  
        }

        return task
    }
}
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>è™½ç„¶åœ¨çŠ¶æ€å¤„ç†æ–¹é¢æ²¡æœ‰ä»€ä¹ˆçµä¸¹å¦™è¯ï¼Œä½†ä»¥ä¸€ç§æ¶ˆé™¤æ¨¡ç³Šæ€§å’Œå¼ºåˆ¶æ‰§è¡Œæ˜ç¡®å®šä¹‰çš„çŠ¶æ€çš„æ–¹å¼å¯¹çŠ¶æ€å»ºæ¨¡ï¼Œé€šå¸¸ä¼šå¯¼è‡´æ›´å¥å£®çš„ä»£ç ã€‚</p>
<p>æ‹¥æœ‰å•ä¸€çš„çœŸç›¸æ¥æºï¼Œå¹¶ä»¥ä¸€ç§è¢«åŠ¨çš„æ–¹å¼å¤„ç†çŠ¶æ€å˜åŒ–ï¼Œé€šå¸¸ä¹Ÿä¼šè®©ä½ å†™å‡ºæ›´å®¹æ˜“é˜…è¯»å’Œæ¨ç†çš„ä»£ç ï¼Œ è€Œä¸”ä¹Ÿæ›´å®¹æ˜“æ‰©å±•å’Œé‡æ„(åªè¦æ·»åŠ æˆ–åˆ é™¤ä¸€ä¸ªcaseï¼Œç¼–è¯‘å™¨å°±ä¼šå‘Šè¯‰æ‚¨éœ€è¦æ›´æ–°å“ªäº›ä»£ç )ã€‚</p>
<p>æˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­æåˆ°çš„è§£å†³æ–¹æ¡ˆå’ŒæŠ€å·§è‚¯å®šæ˜¯æœ‰æƒè¡¡çš„ï¼Œå®ƒä»¬ç¡®å®éœ€è¦ä½ ç¼–å†™æ›´å¤šçš„æ ·æ¿ä»£ç ï¼Œæœ‰æ—¶ï¼Œå®ç°çŠ¶æ€æšä¸¾çš„Equatableå¯èƒ½ä¼šæœ‰ç‚¹æ£˜æ‰‹(æˆ‘ä»¬å°†åœ¨ä»¥åçš„æ–‡ç« ä¸­é€šè¿‡ä»£ç ç”Ÿæˆå’Œè„šæœ¬æŸ¥çœ‹å¦‚ä½•ä½¿å…¶å˜å¾—æ›´å®¹æ˜“)ã€‚</p>
<p><a href="https://www.swiftbysundell.com/articles/modelling-state-in-swift/">åŸæ–‡é“¾æ¥</a></p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/EWN51MbzW/" class="tag">
                    state management
                  </a>
                
                  <a href="https://kayouyou.github.io/tag/8qZG0_WaL/" class="tag">
                    architecture
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/using-spritekit-to-create-animations-in-swift/">
                  <h3 class="post-title">
                    Using SpriteKit to create animations in Swift
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
