<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>PointFree Episode 74:Modular State Management: View Actions | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1652020609222">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="



Transforming a storeâ€™s action




Combining view functions




Focusing on favorite primes actions




Extracting ou..." />
    <meta name="keywords" content="PointFree" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1652020609222" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">PointFree Episode 74:Modular State Management: View Actions</h2>
            <div class="post-date">2021-11-20</div>
            
            <div class="post-content" v-pre>
              <!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#Transformingastoresaction">Transforming a storeâ€™s action</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="#Combiningviewfunctions">Combining view functions</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#Focusingonfavoriteprimesactions">Focusing on favorite primes actions</a></li>
</ol>
</li>
<li>
<ol start="4">
<li><a href="#Extractingourfirstmodularview">Extracting our first modular view</a></li>
</ol>
</li>
<li>
<ol start="5">
<li><a href="#Focusingonprimemodalactions">Focusing on prime modal actions</a></li>
</ol>
</li>
<li>
<ol start="6">
<li><a href="#Focusingoncounteractions">Focusing on counter actions</a></li>
</ol>
</li>
<li>
<ol start="7">
<li><a href="#Nexttime:whatsthepoint">Next time: whatâ€™s the point?</a></li>
</ol>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<!-- # PointFree Episode 74:Modular State Management: View Actions -->
<h2 id="1-a-nametransformingastoresactionatransforming-a-stores-action">1. <a name='Transformingastoresaction'></a>Transforming a storeâ€™s action</h2>
<p>æˆ‘ä»¬ç°åœ¨å·²ç»æ”¹è¿›äº†åœ¨ä½¿ç”¨å¯è§‚å¯Ÿçš„<strong>Store</strong>å¯¹è±¡çš„è§†å›¾ä¸­è®¿é—®<strong>state</strong>çš„æ¨¡å—åŒ–å’Œäººæœºå·¥ç¨‹å­¦ï¼Œ ä½†æˆ‘ä»¬ä¸èƒ½å°†ä»»ä½•è§†å›¾æå–åˆ°ç‹¬ç«‹çš„æ¨¡å—ä¸­ï¼Œå› ä¸ºæ¯ä¸ªè§†å›¾çš„<strong>store</strong>ä»ç„¶ä¾èµ–äº<strong>AppAction</strong>ã€‚å› æ­¤ï¼Œå¬èµ·æ¥æˆ‘ä»¬éœ€è¦å¦ä¸€ä¸ªæ“ä½œæ¥å°†å‘é€å…¨å±€<strong>actionsçš„store</strong>è½¬æ¢ä¸ºå‘é€æœ¬åœ°<strong>actionsçš„store</strong>ã€‚æˆ‘ä»¬å‘ç°æˆ‘ä»¬å¯ä»¥<strong>è½¬æ¢storeçš„value</strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥<strong>è½¬æ¢storeçš„actions</strong>å—?</p>
<p>é¦–å…ˆï¼Œè¿™æ„å‘³ç€ä»€ä¹ˆ? ç›®å‰ï¼Œæˆ‘ä»¬åœ¨å¤–éƒ¨å¤„ç†<strong>actions and the store</strong>çš„å”¯ä¸€æ—¶é—´æ˜¯é€šè¿‡è°ƒç”¨<strong>send</strong>æ–¹æ³•å‘<strong>store</strong>å‘é€<strong>action</strong>çš„æ—¶å€™ã€‚å¦‚æœæˆ‘ä»¬èƒ½å‘é€å±€éƒ¨<strong>actions</strong>åˆ°é‚£ä¸ªæ–¹æ³•è€Œä¸æ˜¯å…¨å±€<strong>actions</strong>ï¼Œç„¶ååœ¨<strong>store</strong>çš„æŸä¸ªåœ°æ–¹ï¼Œä¹Ÿè®¸å®ƒå¯ä»¥è‡ªåŠ¨åœ°å°†å±€éƒ¨<strong>actions</strong>åŒ…è£…æˆå…¨å±€<strong>actions</strong>ã€‚</p>
<p>è®©æˆ‘ä»¬ä»ä¸ºè¿™ä¸ªè½¬æ¢å‡†å¤‡å¦ä¸€ä¸ªå‡½æ•°ç­¾åå¼€å§‹ã€‚æˆ‘ä»¬å°†ä»å¦ä¸€ä¸ªæœªå‘½åçš„æ–¹æ³•å¼€å§‹ï¼Œä»¥ä¾¿ä¸“æ³¨äºä½¿è½¬æ¢å·¥ä½œã€‚</p>
<pre><code class="language-swift">final class Store&lt;Value, Action&gt;: ObservableObject {
  â€¦
  func ___()
}
</code></pre>
<p>å†è¯´ä¸€æ¬¡ï¼Œæˆ‘ä»¬æƒ³é€€å›ä¸€å®¶å…¨æ–°çš„å•†åº—ã€‚</p>
<pre><code class="language-swift">final class Store&lt;Value, Action&gt;: ObservableObject {
  â€¦
  func ___() -&gt; Store
}
</code></pre>
<p>æˆ‘ä»¬å¸Œæœ›è¿™ä¸ª<strong>store</strong>èƒ½å¤Ÿå¤„ç†æ¯”å½“å‰<strong>store</strong>æ›´æœ¬åœ°åŒ–çš„æ“ä½œã€‚</p>
<pre><code class="language-swift">final class Store&lt;Value, Action&gt;: ObservableObject {
  â€¦
  func ___&lt;LocalAction&gt;() -&gt; Store&lt;Value, LocalAction&gt;
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å†æ¬¡æ‰“å¼€å‡½æ•°ä½“å¹¶ç«‹å³è¿”å›<strong>Store&lt;Value, LocalAction&gt;</strong>ã€‚</p>
<pre><code class="language-swift">final class Store&lt;Value, Action&gt;: ObservableObject {
  â€¦
  func ___&lt;LocalAction&gt;() -&gt; Store&lt;Value, LocalAction&gt; {
    return Store&lt;Value, LocalAction&gt;(
      initialValue: &lt;#Value#&gt;,
      reducer: &lt;#(inout Value, LocalAction) -&gt; Void#&gt;
    )
  }
}
</code></pre>
<p>ä¸ºäº†ç»™<strong>store</strong>æä¾›ä¸€ä¸ªåˆå§‹å€¼ï¼Œæˆ‘ä»¬åªéœ€ä¼ é€’å½“å‰çš„<strong>self.value</strong>å³å¯ã€‚ç±»å‹ä¸å˜ã€‚</p>
<pre><code class="language-swift">initialValue: self.value,
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦å¼„æ¸…æ¥šå¦‚ä½•å®ç°å¦ä¸€ä¸ªå¥‡æ€ªçš„ã€ç±»ä¼¼äº<strong>reducer</strong>çš„å‡½æ•°ã€‚è®©æˆ‘ä»¬æ‰“å¼€é—­åŒ…ã€‚</p>
<pre><code class="language-swift">initialValue: self.value,
  reducer: { value, localAction in

}
</code></pre>
<p>åœ¨è¿™é‡Œï¼Œå½“æˆ‘ä»¬è½¬æ¢ä¸€ä¸ª<strong>store</strong>çš„å€¼æ—¶ï¼Œæˆ‘ä»¬æ‰€åšçš„ä¸»è¦å·¥ä½œæ˜¯è°ƒç”¨æ ¹<strong>store</strong>çš„<strong>self.send</strong>æ–¹æ³•å¹¶ä½¿ç”¨å…¶æ›´æ–°çš„<strong>self.value</strong>ä»¥ç›¸åº”åœ°æ›´æ–°<strong>sub-store</strong>çš„å€¼ã€‚ä¸ºäº†è°ƒç”¨<strong>self.send</strong>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª<strong>Action</strong>ï¼Œä½†æˆ‘ä»¬åªæœ‰ä¸€ä¸ª<strong>LocalAction</strong>ã€‚ å¦‚æœæˆ‘ä»¬èƒ½æŠŠ<strong>LocalActions</strong>è½¬æ¢æˆ<strong>Actions</strong>ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿå®ç°è¿™ä¸ªã€‚å¬èµ·æ¥åƒæ˜¯å¦ä¸€ä¸ªå‡½æ•°!</p>
<p>è®©æˆ‘ä»¬å¼•å…¥å¦ä¸€ä¸ª<strong>f</strong>ä»<strong>LocalActionåˆ°Action</strong>ã€‚</p>
<pre><code class="language-swift">func ___&lt;LocalAction&gt;(
  _ f: (LocalAction) -&gt; Action
) -&gt; Store&lt;Value, LocalAction&gt; {
</code></pre>
<p>åœ¨å°†<strong>localAction</strong>ä¼ é€’ç»™<strong>store</strong>ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª<strong>f</strong>å°†<strong>localAction</strong>è½¬æ¢ä¸ºæ›´å…¨å±€çš„<strong>action</strong>ã€‚</p>
<pre><code class="language-swift">reducer: { value, localAction in
    self.send(f(localAction))
}
</code></pre>
<p>ä½†æ˜¯æˆ‘ä»¬éœ€è¦æ ‡è®°<strong>f</strong>ä¸ºé€ƒé€¸ï¼Œå› ä¸ºå®ƒè¢«<strong>store</strong>æ•è·äº†ã€‚</p>
<pre><code class="language-swift">func ___&lt;LocalAction&gt;(
  f: @escaping (LocalAction) -&gt; Action
) -&gt; Store&lt;Value, LocalAction&gt; {
</code></pre>
<p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦ç”¨<strong>self.value</strong>é‡æ–°åˆ†é…è¾“å…¥è¾“å‡ºçš„å¯å˜å€¼ã€‚</p>
<pre><code class="language-swift">reducer: { value, localAction in
    self.send(f(localAction))
    value = self.value
}
</code></pre>
<p>å¥½å§ï¼Œå¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼Œä½†è¿™åˆæ˜¯ä¸€ä¸ªå¥‡æ€ªçš„<strong>reducer</strong>ã€‚å®ƒå–å†³äº<strong>store</strong>çš„å†…éƒ¨è¡Œä¸ºæ¥æ”¹å˜å®ƒçš„å€¼ï¼Œç„¶åå®ƒä¼šé‡æ–°èµ‹å€¼ç»™å¯å˜çš„å€¼å³ä½¿å®ƒæ ¹æœ¬æ²¡ç”¨é‚£ä¸ªå€¼ã€‚</p>
<p>ä½†æ’‡å¼€å¥‡æ€ªä¸è°ˆï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªæˆ‘ä»¬ç†Ÿæ‚‰çš„å½¢çŠ¶å—?</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ç­¾å:</p>
<pre><code class="language-swift">// ((LocalAction) -&gt; Action) -&gt; ((Store&lt;_, Action&gt;) -&gt; Store&lt;_, LocalAction&gt;)
</code></pre>
<p>å°†é€šç”¨åç§°å½’çº³ä¸ºAå’ŒB:</p>
<pre><code class="language-swift">// ((B) -&gt; A) -&gt; ((Store&lt;A, _&gt;) -&gt; Store&lt;B, _&gt;)
</code></pre>
<p>å¹¶ä»<strong>Store</strong>ä¸­å½’çº³å‡ºä¸Šä¸‹æ–‡æ¥å¾—åˆ°ä¸€ä¸ªéå¸¸æ¸…æ™°çš„ç”»é¢ã€‚</p>
<pre><code class="language-swift">// ((B) -&gt; A) -&gt; (F&lt;A&gt;) -&gt; F&lt;B&gt;)
</code></pre>
<p>è¿™æ˜¯æˆ‘ä»¬åœ¨Point-Freeä¸Šé‡åˆ°è¿‡å¤šæ¬¡çš„å‡½æ•°ç­¾åï¼Œæˆ‘ä»¬å°†æ“ä½œå‘½åä¸º<strong>pullback</strong>ã€‚</p>
<pre><code class="language-swift">// pullback: ((A) -&gt; B) -&gt; (F&lt;B&gt;) -&gt; F&lt;A&gt;)
</code></pre>
<p>è¿™æ˜¯æˆ‘ä»¬åœ¨æ·±å…¥ç ”ç©¶â€œé€†å˜æ€§â€æ—¶é¦–æ¬¡æ¢ç´¢çš„å‡½æ•°å½¢çŠ¶ï¼Œæˆ‘ä»¬æ¢ç´¢äº†ä¸€ç§é€†è½¬å‡½æ•°ç®­å¤´çš„ç»„åˆå½¢å¼ï¼Œå°±åƒæˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„é‚£æ ·ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯èƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ“ä½œ<strong>pullback</strong>:</p>
<pre><code class="language-swift">public func pullback&lt;LocalAction&gt;(
  f: @escaping (LocalAction) -&gt; Action
) -&gt; Store&lt;Value, LocalAction&gt; {
</code></pre>
<p>ç„¶è€Œï¼Œç”±äºç±»ä¼¼äºæˆ‘ä»¬åœ¨<strong>Store</strong>ä¸Šæè¿°çš„<strong>map</strong>æ“ä½œçš„åŸå› ï¼Œæˆ‘ä»¬ä¸å–œæ¬¢è°ƒç”¨è¿™ä¸ª<strong>pullback</strong>æ–¹æ³•ã€‚å®ƒå…·æœ‰æ‰€æœ‰ç›¸åŒçš„é—®é¢˜ï¼Œå› ä¸ºå®ƒä½œç”¨äºå¼•ç”¨ç±»å‹ï¼Œå¹¶ä¾èµ–äºå¯¹è±¡çš„è¡Œä¸ºï¼Œè€Œä¸ä»…ä»…æ˜¯çº¯ç²¹çš„æ•°å­¦å±æ€§ã€‚</p>
<p>ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å‘½åä¸ºâ€œ<strong>view</strong>â€ï¼Œå› ä¸ºå®ƒè¿”å›ä¸€ä¸ªåªèƒ½å‘é€æœ¬åœ°æ“ä½œé›†çš„<strong>store</strong>è§†å›¾ã€‚</p>
<pre><code class="language-swift">final class Store&lt;Value, Action&gt;: ObservableObject {
  â€¦
  public func view&lt;LocalAction&gt;(
    f: @escaping (LocalAction) -&gt; Action
  ) -&gt; Store&lt;Value, LocalAction&gt; {
    return Store&lt;Value, LocalAction&gt;(
      initialValue: self.value,
      reducer: { value, localAction in
        self.send(f(action))
        value = self.value
    }
    )
  }
}
</code></pre>
<h2 id="2-a-namecombiningviewfunctionsacombining-view-functions">2. <a name='Combiningviewfunctions'></a>Combining view functions</h2>
<p>è¿™ä¸ªå‡½æ•°å¯ä»¥å°†å…¨å±€æ“ä½œä¸­çš„storeè½¬æ¢ä¸ºæ›´å¤šæœ¬åœ°æ“ä½œä¸­çš„storeï¼Œä½†ç°åœ¨è¿˜ä¸æ˜¯è¿™æ ·ã€‚å®ƒä»ç„¶éœ€è¦å¤„ç†å¯¹æ›´å¤šå…¨å±€<strong>store</strong>çš„æœ¬åœ°<strong>store</strong>çš„è®¢é˜…ï¼Œä¹Ÿè®¸æˆ‘ä»¬åº”è¯¥å°†è¿™ä¸¤ä¸ª<strong>view</strong>å‡½æ•°åˆå¹¶åˆ°ä¸€ä¸ªä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰å·¥ä½œçš„å‡½æ•°ä¸­ã€‚</p>
<p>å¦‚æœå°†è¿™äº›å‡½æ•°ç´§å¯†åœ°ç²˜è´´åœ¨ä¸€èµ·ï¼Œå°±å¯ä»¥å°†æ‰€æœ‰<strong>action</strong>è½¬æ¢åµŒå…¥åˆ°åŒæ ·å¤„ç†<strong>state</strong>è½¬æ¢çš„æ–¹æ³•ä¸­ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥<strong>LocalAction</strong>æ³›å‹ï¼Œå¹¶å°†è¿™ä¸¤ä¸ªè½¬æ¢å‡½æ•°éƒ½ä½œä¸ºè¾“å…¥ã€‚</p>
<pre><code class="language-swift">public func view&lt;LocalValue, LocalAction&gt;(
  _ f: @escaping (Value) -&gt; LocalValue,
  _ g: @escaping (LocalAction) -&gt; Action
</code></pre>
<p>ç°åœ¨å¾ˆæ¸…æ¥šäº†ï¼ŒåŒæ—¶ï¼Œå˜æ¢å‡½æ•°çš„æ–¹å‘æ˜¯å®Œå…¨ç›¸åçš„ã€‚</p>
<p>è®©æˆ‘ä»¬æ›´æ–°å‚æ•°åä»¥ä½¿å†…å®¹æ›´å…·å¯è¯»æ€§ã€‚</p>
<pre><code class="language-swift">func view&lt;LocalValue, LocalAction&gt;(
  value toLocalValue: @escaping (Value) -&gt; LocalValue,
  action toGlobalAction: @escaping (LocalAction) -&gt; Action
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦æ›´æ–°æ‰€æœ‰å¯¹è§†å›¾è½¬æ¢å‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶å¤„ç†ä»å±€éƒ¨<strong>actions</strong>åˆ°å…¨å±€<strong>actions</strong>çš„è½¬æ¢ã€‚</p>
<pre><code class="language-swift">public func view&lt;LocalValue, LocalAction&gt;(
  value toLocalValue: @escaping (Value) -&gt; LocalValue,
  action toGlobalAction: @escaping (LocalAction) -&gt; Action
) -&gt; Store&lt;LocalValue, LocalAction&gt; {
  let localStore = Store&lt;LocalValue, LocalAction&gt;(
    initialValue: toLocalValue(self.value)
    reducer: { localValue, localAction in
      self.send(toGlobalAction(localAction))
      localValue = toLocalValue(self.value)
  }
  )
  localStore.cancellable = self.$value.sink { [weak localStore] newValue in
    localStore?.value = toLocalValue(newValue)
  }
  return localStore
}
</code></pre>
<h2 id="3-a-namefocusingonfavoriteprimesactionsafocusing-on-favorite-primes-actions">3. <a name='Focusingonfavoriteprimesactions'></a>Focusing on favorite primes actions</h2>
<p>æˆ‘ä»¬çš„åº”ç”¨æ— æ³•æ­£å¸¸ç¼–è¯‘ï¼Œå› ä¸ºæ— è®ºâ€œ<strong>ContentView.swift</strong>â€ä½¿ç”¨<strong>Store</strong>çš„è§†å›¾å‡½æ•°ï¼Œå®ƒåªä¼ é€’ä¸€ä¸ªè½¬æ¢å‡½æ•°çš„å€¼ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸ºæ¯ä¸ªåŠ¨ä½œä¼ é€’ä¸€ä¸ª<strong>transform</strong>å‡½æ•°æ¥å†æ¬¡è¿›è¡Œç¼–è¯‘ã€‚å› ä¸ºæˆ‘ä»¬æ‰€æœ‰çš„è§†å›¾éƒ½æœŸæœ›ä½¿ç”¨<strong>AppAction</strong>çš„<strong>store</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡è¯†å‡½æ•°ï¼Œæ‹¼å†™ä¸º{$0}ã€‚</p>
<p>åœ¨åˆå§‹åŒ–è®¡æ•°å™¨å±å¹•çš„åœ°æ–¹ï¼Œå¯ä»¥åšä»¥ä¸‹æ›´æ”¹:</p>
<pre><code class="language-swift">NavigationLink(
  &quot;Counter demo&quot;,
  destination: CounterView(
    store: self.store.view(
      value: { ($0.count, $0.favoritePrimes) },
      action: { $0 }
    )
  )
)
</code></pre>
<p>åœ¨åˆå§‹åŒ–æ”¶è—ç´ æ•°å±å¹•çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥åšä»¥ä¸‹æ›´æ”¹ã€‚</p>
<pre><code class="language-swift">NavigationLink(
  &quot;Favorite primes&quot;,
  destination: FavoritePrimesView(
    store: self.store.view(
      value: { $0.favoritePrimes },
      action: { $0 }
    )
  )
)
</code></pre>
<p>æœ€åï¼Œåœ¨ä¸»æ¨¡æ€è§†å›¾è¢«æ„é€ çš„åœ°æ–¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ›´æ–°å®ƒå¯¹è§†å›¾çš„è°ƒç”¨:</p>
<pre><code class="language-swift">IsPrimeModalView(
  Store: self.store
    .view(
      value: { ($0.count, $0.favoritePrimes) },
      action: { $0 }
  )
)
</code></pre>
<p>å¥½äº†ï¼Œåˆå¯ä»¥æ­£å¸¸ç¼–è¯‘äº†ï¼Œä½†æ˜¯æˆ‘ä»¬çš„è§†å›¾ä»ç„¶ä¸å…¨å±€<strong>AppActions</strong>ä¸€èµ·å·¥ä½œã€‚è®©æˆ‘ä»¬æ›´æ–°è§†å›¾ä»¥ä½¿ç”¨æ›´å¤šçš„æœ¬åœ°<strong>actions</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä»<strong>FavoritePrimesView</strong>å¼€å§‹:</p>
<pre><code class="language-swift">struct FavoritePrimesView: View {
  @ObservedObject var store: Store&lt;[Int], AppAction&gt;
</code></pre>
<p>å¹¶å°†å…¶æ›´æ–°ä¸ºä¸<strong>FavoritePrimesAction</strong>ä¸€èµ·å·¥ä½œ:</p>
<pre><code class="language-swift">struct FavoritePrimesView: View {
  @ObservedObject var store: Store&lt;[Int], FavoritePrimesAction&gt;
</code></pre>
<p>å®ƒæ‰“ç ´äº†æˆ‘ä»¬çš„å˜å¼‚:</p>
<pre><code class="language-swift">.onDelete { indexSet in
  self.store.send(.favoritePrimes(.deleteFavoritePrimes(indexSet)))
  self.store.send(.counter(.incrTapped))
}
</code></pre>
<blockquote>
<p>ğŸ›‘ Type â€˜FavoritePrimesActionâ€™ has no member â€˜favoritePrimesâ€™ ğŸ›‘ Type â€˜FavoritePrimesActionâ€™ has no member â€˜counterâ€™</p>
</blockquote>
<p>å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œè§£å†³æ–¹æ³•å¾ˆç®€å•:æˆ‘ä»¬å¯ä»¥è§£é™¤<strong>action</strong>çš„åµŒå¥—:</p>
<pre><code class="language-swift">self.store.send(.deleteFavoritePrimes(indexSet))
</code></pre>
<p>ç¬¬äºŒä¸ªé”™è¯¯æ˜¯å¾ˆå¥½çš„é”™è¯¯! <strong>favorite</strong>è´¨æ•°è§†å›¾å‘é€äº†ä¸€ä¸ªä¸åº”è¯¥å‘é€çš„<strong>counter</strong>æ“ä½œï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤è¿™è¡Œä»£ç ï¼Œå¹¶æ¬£èµè¿™ä¸ªè§†å›¾å˜å¾—å¤šä¹ˆé›†ä¸­ã€‚</p>
<p>æˆ‘ä»¬è¿˜æœ‰ä¸€ä»¶äº‹è¦è§£å†³ã€‚åˆå§‹åŒ–<strong>FavoritePrimesView</strong>:</p>
<pre><code class="language-swift">NavigationLink(
  &quot;Favorite primes&quot;,
  destination: FavoritePrimesView(
    store: self.store.view(
      value: { $0.favoritePrimes },
      action: { $0 }
    )
  )
)
</code></pre>
<blockquote>
<p>ğŸ›‘ â€˜Store&lt;[Int], AppAction&gt;â€™ is not convertible to â€˜Store&lt;[Int], FavoritePrimesAction&gt;â€™</p>
</blockquote>
<p>æˆ‘ä»¬éœ€è¦å°†åº”ç”¨ç¨‹åºæ“ä½œçš„<strong>store</strong>ï¼Œç”Ÿæˆä¸€ä¸ªåº”ç”¨ç¨‹åºæ“ä½œçš„<strong>store</strong>è§†å›¾ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†<strong>FavoritePrimesAction</strong>ä¼ é€’ç»™<strong>action</strong>é—­åŒ…ï¼Œå¹¶å°†å…¶åµŒå…¥åˆ°<strong>AppAction</strong>çš„<strong>favoritePrimes case</strong>ä¸­æ¥å®ç°:</p>
<pre><code class="language-swift">NavigationLink(
  &quot;Favorite primes&quot;,
  destination: FavoritePrimesView(
    store: self.store.view(
      value: { $0.favoritePrimes },
      action: { AppAction.favoritePrimes($0) }
    )
  )
)
</code></pre>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨ç±»å‹æ¨æ–­æ¥ç®€åŒ–äº‹æƒ…:</p>
<pre><code class="language-swift">NavigationLink(
  &quot;Favorite primes&quot;,
  destination: FavoritePrimesView(
    store: self.store.view(
      value: { $0.favoritePrimes },
      action: { .favoritePrimes($0) }
    )
  )
)
</code></pre>
<p>ç°åœ¨ç”šè‡³æœ‰äº†ä¸€ä¸ªå¾ˆå¥½çš„å¯¹ç§°ã€‚</p>
<h2 id="4-a-nameextractingourfirstmodularviewaextracting-our-first-modular-view">4. <a name='Extractingourfirstmodularview'></a>Extracting our first modular view</h2>
<p>åœ¨æˆ‘ä»¬æ›´æ–°æ‰€æœ‰å…¶ä»–è§†å›¾ä¹‹å‰ï¼Œè®©æˆ‘ä»¬åœä¸‹æ¥æ¬£èµä¸€ä¸‹æˆ‘ä»¬æ‰€åšçš„:<strong>FavoritePrimesView</strong>ç°åœ¨å·²ç»å°½å¯èƒ½åœ°é›†ä¸­äº†ã€‚<br>
å®ƒä¸çŸ¥é“<strong>AppState</strong>:å®ƒåªèƒ½è®¿é—®å®ƒæ¸²æŸ“çš„æœ€å–œæ¬¢çš„ç´ æ•°çš„[Int]ã€‚è€Œä¸”å®ƒæ²¡æœ‰åŠæ³•å‘é€<strong>AppActions</strong>:å®ƒåªèƒ½å‘é€<strong>FavoritePrimesActions</strong>ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä¸€ç›´åœ¨åŠªåŠ›è¿½æ±‚çš„æ¨¡å—åŒ–ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æœ€ç»ˆå¯ä»¥å°†è¿™ä¸ªè§†å›¾æå–åˆ°å®ƒè‡ªå·±çš„æ¨¡å—ä¸­ã€‚</p>
<p>è™½ç„¶å®ƒå¯ä»¥ä½äºè‡ªå·±çš„æ¨¡å—ä¸­ï¼Œä½†ç°åœ¨è®©æˆ‘ä»¬å°†å®ƒç§»åˆ°â€œ<strong>FavoritePrimes</strong>â€æ¨¡å—ã€‚æˆ‘ä»¬å¯ä»¥å‰ªåˆ‡ç²˜è´´:</p>
<pre><code class="language-swift">struct FavoritePrimesView: View {
  @ObservedObject var store: Store&lt;[Int], FavoritePrimesAction&gt;

  var body: some View {
    â€¦
  }
}
</code></pre>
<blockquote>
<p>ğŸ›‘ Use of undeclared type â€˜Viewâ€™</p>
</blockquote>
<p>ä½†æ˜¯å®ƒä¾èµ–äºä¸€å †å…¶ä»–æ¨¡å—ï¼ŒåŒ…æ‹¬<strong>Combineã€SwiftUI</strong>ï¼Œç”šè‡³æˆ‘ä»¬çš„â€œ<strong>ComposableArchitecture</strong>â€æ¡†æ¶ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¯¼å…¥å®ƒä»¬ã€‚</p>
<pre><code class="language-swift">import ComposableArchitecture
import SwiftUI
</code></pre>
<p>æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ç¼–è¯‘çš„ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯ç‹¬ç«‹çš„ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è®©æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯<strong>public</strong>ï¼Œä¹Ÿå°±æ˜¯:ç»“æ„ä½“æœ¬èº«å’Œå®ƒçš„<strong>body</strong>ã€‚</p>
<pre><code class="language-swift">public struct FavoritePrimesView: View {
  @ObservedObject var store: Store&lt;[Int], FavoritePrimesAction&gt;

  public var body: some View {
    â€¦
  }
}
</code></pre>
<p>å¦‚æœæˆ‘ä»¬å°è¯•æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚</p>
<blockquote>
<p>ğŸ›‘ â€˜FavoritePrimesViewâ€™ initializer is inaccessible due to â€˜internalâ€™ protection level</p>
</blockquote>
<p>åœ¨å°†è§†å›¾ç§»åŠ¨åˆ°æ¨¡å—æ—¶ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªç±»ä¼¼äºå°†<strong>prime modal state</strong>ç§»åŠ¨åˆ°æ¨¡å—æ—¶çš„é—®é¢˜:Swiftè‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„æˆå‘˜åˆå§‹åŒ–å¼æ˜¯<strong>internal</strong>ï¼Œä½†æˆ‘ä»¬éœ€è¦ä¸€ä¸ª<strong>public</strong>åˆå§‹åŒ–å¼æ¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ç”Ÿæˆå€¼ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»å¤´å¼€å§‹å®šä¹‰å®ƒ:</p>
<pre><code class="language-swift">public struct FavoritePrimesView: View {
  @ObservedObject var store: Store&lt;[Int], FavoritePrimesAction&gt;

  public init(store: Store&lt;[Int], FavoritePrimesAction&gt;)
    self.store = store
  }

  public var body: some View {
    â€¦
  }
}
</code></pre>
<p>æœ‰äº†å®ƒï¼Œä¸€åˆ‡éƒ½æ„å»ºèµ·æ¥äº†ï¼Œæˆ‘ä»¬çœŸçš„ï¼Œç”¨ç¼–è¯‘å™¨æ£€æŸ¥çš„æ–¹å¼ï¼ŒæŠŠè¿™ä¸ªè§†å›¾ä»åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†åˆ†ç¦»å‡ºæ¥äº†ã€‚è¿™æ ·åšä¼´éšç€ä¸€äº›æ˜¾å¼åˆå§‹åŒ–å¼å½¢å¼çš„æ ·æ¿æ–‡ä»¶ï¼Œä½†å°±åƒæˆ‘ä»¬åœ¨æœ¬ç³»åˆ—æ—©æœŸé‡‡ç”¨çš„æ ·æ¿æ–‡ä»¶ä¸€æ ·ï¼Œå®ƒå®Œå…¨æ˜¯æœºæ¢°ç¼–å†™çš„ï¼Œæœªæ¥çš„Xcodeç‰ˆæœ¬å°†èƒ½å¤Ÿä¸ºæˆ‘ä»¬ç¼–å†™å®ƒã€‚ è¿™æ˜¯å®Œå…¨å€¼å¾—çš„ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬çš„<strong>view</strong>æœ‰ä¸€ä¸ªéå¸¸æœ‰é™çš„èƒ½åŠ›ï¼Œä»¥è·å¾—æ›´å¤šçš„å…¨å±€<strong>actionså’Œstate</strong>ã€‚</p>
<h2 id="5-a-namefocusingonprimemodalactionsafocusing-on-prime-modal-actions">5. <a name='Focusingonprimemodalactions'></a>Focusing on prime modal actions</h2>
<p>æˆ‘ä»¬è¿˜æœ‰ä¸€äº›è§†å›¾å¯ä»¥ä»<strong>AppAction</strong>ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œæ¯”å¦‚<strong>IsPrimeModalView</strong>:</p>
<pre><code class="language-swift">struct IsPrimeModalView: View {
  @ObservedObject var store: Store&lt;PrimeModalState, AppAction&gt;
</code></pre>
<p>å®ƒåªéœ€è¦å‘é€<strong>PrimeModalActions</strong>ã€‚</p>
<pre><code class="language-swift">struct IsPrimeModalView: View {
  @ObservedObject var store: Store&lt;PrimeModalState, PrimeModalAction&gt;
</code></pre>
<p>å®ƒé€šè¿‡æ¶ˆé™¤æ›´å¤šçš„åµŒå¥—æ¥ç®€åŒ–æ“ä½œçš„è°ƒç”¨:</p>
<pre><code class="language-swift">Button(&quot;Remove from favorite primes&quot;) {
   self.store.send(.removeFavoritePrimeTapped)
}
â€¦
Button(&quot;Save to favorite primes&quot;) {
  self.store.send(.saveFavoritePrimeTapped)
}
</code></pre>
<p>åœ¨è§†å›¾åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›ä¸€ä¸ªé™åˆ¶å…¶æ“ä½œçš„<strong>store</strong>ã€‚</p>
<pre><code class="language-swift">IsPrimeModalView(
  store: self.store.view(
    value: { ($0.count, $0.favoritePrimes) }
    action: { .primeModal($0) }
  )
)
</code></pre>
<p>æ›´å¤šçš„æœ¬åœ°æ“ä½œéœ€è¦åµŒå…¥åˆ°<strong>AppAction</strong>ä¸­ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰å¦ä¸€ä¸ªå®Œå…¨å­¤ç«‹çš„<strong>view</strong>ã€‚</p>
<p>è®©æˆ‘ä»¬å°†è§†å›¾åŠå…¶<strong>isPrime</strong>åŠ©æ‰‹å‡½æ•°å‰ªåˆ‡å¹¶ç²˜è´´åˆ°â€œ<strong>PrimeModal</strong>â€æ¨¡å—ä¸­ã€‚</p>
<pre><code class="language-swift">struct IsPrimeModalView: View {
  @ObservedObject var store: Store&lt;PrimeModalState, PrimeModalAction&gt;

  var body: some View {
    â€¦
  }
}

func isPrime(_ p: Int) -&gt; Bool {
  â€¦
}
</code></pre>
<p>åŒæ ·ï¼Œæˆ‘ä»¬è¦æ·»åŠ ä¸€äº›å¯¼å…¥ã€‚</p>
<pre><code class="language-swift">import ComposableArchitecture
import SwiftUI
</code></pre>
<p>æˆ‘ä»¬å¿…é¡»å…¬å¼€è§†å›¾çš„ç•Œé¢ã€‚</p>
<pre><code class="language-swift">public struct IsPrimeModalView: View {
  @ObservedObject var store: Store&lt;PrimeModalState, PrimeModalAction&gt;

  public var body: some View {
    â€¦
  }
}
</code></pre>
<p>æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªå…¬å…±åˆå§‹åŒ–å¼ã€‚</p>
<pre><code class="language-swift">public init(store: Store&lt;PrimeModalState, PrimeModalAction&gt;) {
  self.store = store
}
</code></pre>
<p>è¿‡ç¨‹å’Œä¸Šæ¬¡å®Œå…¨ä¸€æ ·ã€‚å½“æˆ‘ä»¬æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‰€æœ‰çš„ç¼–è¯‘éƒ½å¾ˆå¥½ï¼Œæ•´ä¸ªè¿‡ç¨‹åªèŠ±äº†å‡ åˆ†é’Ÿã€‚</p>
<h2 id="6-a-namefocusingoncounteractionsafocusing-on-counter-actions">6. <a name='Focusingoncounteractions'></a>Focusing on counter actions</h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä»åº”ç”¨ç¨‹åºä¸­æå–äº†ä¸¤ä¸ªè§†å›¾åˆ°å®ƒä»¬è‡ªå·±çš„æ¨¡å—ä¸­ï¼Œå¹¶æå¤§åœ°é™åˆ¶äº†å®ƒä»¬çš„è¡¨é¢ç§¯ã€‚å®ƒä»¬ä¸å†èƒ½å¤Ÿè®¿é—®æ‰€æœ‰çš„åº”ç”¨<strong>state</strong>å’Œåº”ç”¨<strong>actions</strong>ã€‚</p>
<p>æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªè§†å›¾ï¼Œä½†å®ƒæ¯”å…¶ä»–è§†å›¾æ›´å¤æ‚ä¸€äº›ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°è¯•å¤„ç†å®ƒï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<p>å¦‚æœæˆ‘ä»¬çœ‹æˆ‘ä»¬çš„<strong>counter</strong>è§†å›¾ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤§çš„ã€‚</p>
<pre><code class="language-swift">struct CounterView: View {
  @ObservedObject var store: Store&lt;CounterViewState, AppAction&gt;
</code></pre>
<p>å®ƒä»ç„¶é€‚ç”¨äºæ‰€æœ‰çš„appåŠ¨ä½œã€‚</p>
<p>å®ƒéœ€è¦è®¿é—®å®ƒæ‰€æ˜¾ç¤ºçš„è®¡æ•°å™¨çš„<strong>CounterActions</strong>ï¼Œå¹¶ä¸”å®ƒéœ€è¦è®¿é—®<strong>PrimeModalActions</strong>ä»¥ä¾¿å°†å®ƒä»¬ä¼ é€’ç»™<strong>IsPrimeModalView</strong>ã€‚å®ƒä¸éœ€è¦è®¿é—®<strong>FavoritePrimesActions</strong>ï¼Œä¹Ÿä¸åº”è¯¥æœ‰å°†å®ƒä»¬å‘é€åˆ°<strong>store</strong>çš„èƒ½åŠ›ã€‚ä½†æˆ‘ä»¬å¦‚ä½•é™åˆ¶è§†å›¾å‘é€è¿™äº›åŠ¨ä½œï¼ŒåŒæ—¶ä¿ç•™å‘é€<strong>counter</strong>åŠ¨ä½œæˆ–ä¸»è¦æ¨¡æ€åŠ¨ä½œçš„èƒ½åŠ›?</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§ç±»ä¼¼äºé™åˆ¶ä¸»æ¨¡æ€æ‰€èƒ½è®¿é—®çš„<strong>state</strong>çš„æ–¹å¼æ¥å®ç°:é€šè¿‡åˆ›å»ºä¸€ä¸ªä¸­é—´ç±»å‹ã€‚ä½†è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬æƒ³è¦å®šä¹‰çš„ä¸æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œè€Œæ˜¯ä¸€ä¸ªenumï¼Œå®ƒå¤„ç†çš„æ¯ä¸ªæ“ä½œéƒ½æœ‰ä¸€ä¸ªcaseã€‚</p>
<pre><code class="language-swift">enum CounterViewAction {
  case counter(CounterAction)
  case primeModal(PrimeModalAction)
}
</code></pre>
<p>æœ‰äº†è¿™ä¸ªå®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥æ¢å‡º<strong>store</strong>çš„åŠ¨ä½œç±»å‹:</p>
<pre><code class="language-swift">struct IsPrimeModalView: View {
  @ObservedObject var store: Store&lt;CounterViewState, CounterViewAction&gt;
</code></pre>
<p>æ²¡æœ‰ä»€ä¹ˆéœ€è¦æ”¹å˜çš„ã€‚å› ä¸º<strong>case</strong>åç§°åŒ¹é…ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿè¿›è¡Œè¿™ä¸ªé‡æ„ï¼Œå¹¶ä¿æŒè§†å›¾ä¸»ä½“å®Œå…¨å®Œæ•´ã€‚</p>
<p>äº‹æƒ…è¿˜æ²¡æœ‰å®Œå…¨å»ºç«‹ï¼Œå°½ç®¡ï¼Œå› ä¸º<strong>CounterView</strong>è¢«åˆå§‹åŒ–ä¸é”™è¯¯çš„<strong>store</strong>ç±»å‹ã€‚</p>
<pre><code class="language-swift">NavigationLink(
  &quot;Counter demo&quot;,
  destination: CounterView(
    store: self.store.view(
      value: { ($0.count, $0.favoritePrimes) },
      action: { $0 }
    )
  )
)
</code></pre>
<blockquote>
<p>ğŸ›‘ Cannot convert value of type â€˜CounterViewActionâ€™ to closure result type AppAction</p>
</blockquote>
<p><strong>action</strong>å—ç°åœ¨ä¼ é€’äº†ä¸€ä¸ª<strong>CounterViewAction</strong>ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›ä¸€ä¸ª<strong>AppAction</strong>ã€‚æ²¡æœ‰<strong>AppAction case</strong>ä¼šåµŒå…¥<strong>CounterViewAction</strong>ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ‡æ¢å®¹å™¨åŠ¨ä½œï¼Œæ‰“å¼€æ¯ä¸ª<strong>case</strong>ï¼Œå¹¶åœ¨é€‚å½“çš„<strong>AppAction</strong>ä¸­é‡æ–°åŒ…è£…å®ƒä»¬ã€‚</p>
<pre><code class="language-swift">NavigationLink(
  &quot;Counter demo&quot;,
  destination: CounterView(
    store: self.store.view(
      value: { ($0.count, $0.favoritePrimes) },
      action: {
        switch $0 {
        case let .counter(action):
          return AppAction.counter(action)
        case let .primeModal(action):
          return AppAction.primeModal(action)
        }
      }
    )
  )
)
</code></pre>
<p>è¿™å·²ç»è¶³å¤Ÿæ»¡è¶³ç¼–è¯‘å™¨çš„è¦æ±‚äº†ï¼Œä½†æ˜¯å†…è”ç¼–å†™æœ‰å¾ˆå¤šå†…å®¹ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬è‡´åŠ›äºç®€åŒ–è§†å›¾æ—¶ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™æ˜¯éå¸¸ç®€å•çš„é€»è¾‘ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥ç®€åŒ–å®ƒã€‚</p>
<p>å¥½çš„ï¼Œ<strong>counter</strong>è§†å›¾å·²ç»å®Œå…¨å‡†å¤‡å¥½è¢«ç§»åŠ¨åˆ°â€œ<strong>counter</strong>â€æ¨¡å—ã€‚æˆ‘ä»¬å¯ä»¥å‰ªåˆ‡å’Œç²˜è´´æˆ‘ä»¬éœ€è¦çš„éƒ¨åˆ†ï¼ŒåŒ…æ‹¬è§†å›¾ã€PrimeAlertåŒ…è£…ç»“æ„ã€ä¸­é—´çš„CounterViewActionå’Œå‡ ä¸ªåŠ©æ‰‹ã€‚</p>
<pre><code class="language-swift">struct PrimeAlert: Identifiable {
  â€¦
}

enum CounterViewAction {
  â€¦
}

struct CounterView: View {
  @ObservedObject var store: Store&lt;CounterViewState, CounterViewAction&gt;
  â€¦

  var body: some View {
    â€¦
  }
}

func nthPrime(_ n: Int, callback: @escaping (Int?) -&gt; Void) -&gt; Void {
  â€¦
}

func ordinal(_ n: Int) -&gt; String {
  â€¦
}
</code></pre>
<p>è®©æˆ‘ä»¬æ·»åŠ è¿™äº›å¯¼å…¥ã€‚</p>
<pre><code class="language-swift">import ComposableArchitecture
import SwiftUI
</code></pre>
<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªç¼–è¯‘å™¨é”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬ä¾èµ–äº<strong>PrimeModalAction</strong>ï¼Œå®ƒå­˜åœ¨äºè‡ªå·±çš„æ¨¡å—ä¸­ã€‚</p>
<pre><code class="language-swift">enum CounterViewAction {
  case counter(CounterAction)
  case primeModal(PrimeModalAction)
</code></pre>
<blockquote>
<p>ğŸ›‘ Use of undeclared type â€˜PrimeModalActionâ€™</p>
</blockquote>
<p>å› æ­¤ï¼Œåœ¨å¯¼å…¥æ¡†æ¶ä¹‹å‰ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ›´æ–°æ¡†æ¶ä»¥ä¾èµ–äºè¿™ä¸ªæ¨¡å—ã€‚</p>
<pre><code class="language-swift">import PrimeModal
</code></pre>
<p>But we still have one error:</p>
<blockquote>
<p>ğŸ›‘ Use of unresolved identifier â€˜wolframAlphaâ€™</p>
</blockquote>
<p>å› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦å°†â€œ<strong>WolframAlpha.swift</strong>â€ç§»åŠ¨åˆ°æ¨¡å—ä¸­ï¼Œå› ä¸º<strong>nthPrime</strong>åŠ©æ‰‹ä½¿ç”¨å®ƒã€‚</p>
<p>å¥½äº†ï¼Œæ¡†æ¶ä¼¼ä¹å¯ä»¥ç¼–è¯‘äº†ï¼Œè®©æˆ‘ä»¬æ¥å®¡è®¡å…¬å…±æ¥å£ã€‚ä¸­é—´çš„è®¡æ•°å™¨å®¹å™¨æ“ä½œéœ€è¦æ˜¯<strong>public</strong>ï¼Œè¿™æ ·æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸“æ³¨äºè¿™äº›æ“ä½œçš„<strong>store</strong>ã€‚</p>
<pre><code class="language-swift">public typealias CounterViewState = (count: Int, favoritePrimes: [Int])

public enum CounterViewAction {
  â€¦
}
</code></pre>
<p>æœ€åï¼Œè§†å›¾è¿˜æ˜¯éœ€è¦æ˜¯å…¬å…±çš„ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªæ˜¾å¼çš„å…¬å…±åˆå§‹åŒ–å¼ã€‚</p>
<pre><code class="language-swift">public struct CounterView: View {
  @ObservedObject var store: Store&lt;CounterViewState, CounterViewAction&gt;
  â€¦

  var body: some View {
    â€¦
  }
}
</code></pre>
<p>å†…éƒ¨çš„åŠ©æ‰‹éƒ½ä¸éœ€è¦å…¬å¼€ã€‚å®ƒä»¬ç”šè‡³å¯ä»¥å˜æˆç§æœ‰çš„!</p>
<p>ä¸€åˆ‡éƒ½å¯ä»¥æ­£å¸¸æ„å»ºï¼Œä½†æ˜¯<strong>counter</strong>è§†å›¾å·²ç»è¢«å®Œå…¨æå–åˆ°å®ƒè‡ªå·±çš„æ¨¡å—ä¸­ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥è¿è¡Œåº”ç”¨ç¨‹åºæ¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼Œå°±åƒä»¥å‰ä¸€æ ·ï¼Œå³ä½¿æ¯ä¸ªå±å¹•éƒ½å­˜åœ¨äºå®ƒè‡ªå·±çš„æ¨¡å—ä¸­ã€‚</p>
<h2 id="7-a-namenexttimewhatsthepointanext-time-whats-the-point">7. <a name='Nexttime:whatsthepoint'></a>Next time: whatâ€™s the point?</h2>
<p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†æ¨¡å—çŠ¶æ€ç®¡ç†ç³»åˆ—æ–‡ç« å¼€å§‹æ—¶è¦åšçš„äº‹æƒ…ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†â€œæ¨¡å—åŒ–â€çš„å«ä¹‰:æˆ‘ä»¬ç¡®å®šæ¨¡å—åŒ–æ˜¯å°†ä»£ç ç§»åŠ¨åˆ°å­—é¢ä¸Šçš„Swiftæ¨¡å—çš„èƒ½åŠ›ï¼Œè¿™æ ·å®ƒå°±å®Œå…¨ä¸åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†éš”ç¦»ã€‚ç„¶åï¼Œæˆ‘ä»¬å±•ç¤ºäº†æˆ‘ä»¬çš„<strong>reducers</strong>å·²ç»æ˜¯å¤šä¹ˆæ¨¡å—åŒ–ï¼Œé€šè¿‡å°†æ¯ä¸ª<strong>reducer</strong>åˆ†è§£æˆä¸€ä¸ªè‡ªå·±çš„æ¡†æ¶ã€‚æœ€åï¼Œä¸ºäº†æ¨¡å—åŒ–è§†å›¾ï¼Œæˆ‘ä»¬åœ¨<strong>Store</strong>ç±»å‹ä¸Šå‘ç°äº†ä¸¤ç§ç»„åˆå½¢å¼:ä¸€ç§å…è®¸æˆ‘ä»¬å°†ç°æœ‰storeé›†ä¸­åœ¨<strong>state</strong>çš„æŸä¸ªå­é›†ä¸Šï¼Œå¦ä¸€ç§å…è®¸æˆ‘ä»¬å°†ç°æœ‰<strong>store</strong>é›†ä¸­åœ¨<strong>actions</strong>çš„æŸä¸ªå­é›†ä¸Šã€‚è¿™äº›æ“ä½œå…è®¸æˆ‘ä»¬å°†æ‰€æœ‰çš„è§†å›¾ä»æ›´å…¨å±€çš„ã€åº”ç”¨çº§çš„å…³æ³¨ç‚¹ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶å°†å®ƒä»¬ç§»åŠ¨åˆ°å„è‡ªç‹¬ç«‹çš„æ¨¡å—ä¸­ã€‚</p>
<p>ä½†æ¯å½“æˆ‘ä»¬åœ¨point - freeä¸Šç»“æŸè¿™äº›æ¢ç´¢æ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯ä¼šåœä¸‹æ¥åæ€ï¼Œç„¶åé—®:â€œæœ‰ä»€ä¹ˆæ„ä¹‰?â€</p>
<p>ä¸ºäº†æ»¡è¶³æˆ‘ä»¬å¯¹æ¨¡å—åŒ–çš„è¦æ±‚ï¼Œæˆ‘ä»¬å¿…é¡»:</p>
<ul>
<li>åœ¨Xcodeä¸­ä¸ºæ¯ä¸ªç»„ä»¶åˆ›å»ºä¸€ä¸ªæ–°æ¡†æ¶ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä»¶éº»çƒ¦çš„äº‹æƒ…ï¼Œå¹¶å¯èƒ½å¯¼è‡´å¤æ‚çš„é¡¹ç›®æ„å»ºè®¾ç½®ã€‚</li>
<li>è¯†åˆ«å¹¶ç§»åŠ¨åº”è¯¥ç§»åŠ¨åˆ°æ¨¡å—çš„ä»£ç ï¼Œå¹¶å®¡è®¡æ¨¡å—éœ€è¦å…¬å¼€çš„å…¬å…±æ¥å£</li>
<li>å›´ç»•å…¬å…±åˆå§‹åŒ–å™¨æ·»åŠ æ ·æ¿ï¼Œæœ‰æ—¶ç”šè‡³ä¸º<strong>state</strong>å¼•å…¥ä¸­é—´<strong>struct</strong>ï¼Œä¸º<strong>actions</strong>å¼•å…¥ä¸­é—´<strong>enum</strong>ã€‚</li>
</ul>
<p>æˆ‘ä»¬çœŸçš„éœ€è¦è¿™ç§çº§åˆ«çš„æ¨¡å—åŒ–å—?  ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½æŠŠä¸œè¥¿ç§»åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œç„¶åå¼•å…¥ç§æœ‰å’Œæ–‡ä»¶ç§æœ‰è®¿é—®å‘¢? å¦‚æœå¯ä»¥ï¼Œä¸ºä»€ä¹ˆä¸é¿å…é¢å¤–çš„æ ·æ¿æ–‡ä»¶å‘¢? è¿™æ˜¯ç›¸å½“å¤šçš„é¢å¤–å·¥ä½œã€‚è¿™çœŸçš„å€¼å¾—å»åšå—?</p>
<p>æˆ‘ä»¬å·²ç»åœ¨æ•´ä¸ªç³»åˆ—ä¸­è¯´è¿‡äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜è¦å†è¯´ä¸€é:æˆ‘ä»¬ç»å¯¹ç›¸ä¿¡è¿™æ˜¯å€¼å¾—åšçš„ã€‚</p>
<p>æ¯ä¸ªæ¨¡å—ç°åœ¨éƒ½é«˜åº¦å…³æ³¨ä¸€å°éƒ¨åˆ†åº”ç”¨çŠ¶æ€ã€é€»è¾‘å’Œè§†å›¾ï¼Œç”±ç¼–è¯‘å™¨å¼ºåˆ¶æ‰§è¡Œã€‚æ‚¨çš„é˜Ÿå‹å’Œæœªæ¥çš„è‡ªå·±ç°åœ¨å¯ä»¥é˜…è¯»è¿™äº›æ¨¡å—ï¼Œå¹¶ä»¥ä¸€ç§å¯èƒ½éœ€è¦æ›´å¤šæ—¶é—´å’Œç²¾åŠ›çš„æ–¹å¼ä¸€ç›®äº†ç„¶åœ°ç†è§£å®ƒä»¬ã€‚</p>
<p>çš„ç¡®ï¼Œæ‚¨å¯ä»¥å°†ä»£ç ç»„ç»‡åˆ°æ›´ç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å¼•å…¥<strong>private and fileprivate</strong>è®¿é—®å¯ä»¥é™åˆ¶æ³„æ¼çš„ä»£ç æ•°é‡ã€‚ä½†æ˜¯ï¼Œå®ƒå¹¶æ²¡æœ‰é˜»æ­¢è¿™äº›æ–‡ä»¶è®¿é—®æ¨¡å—ä¸­çš„æ‰€æœ‰å…¶ä»–å†…å®¹ã€‚åœ¨ä¸€ä¸ªå¤§å‹åº”ç”¨ç›®æ ‡ä¸­ï¼Œè¿™å¯èƒ½æ˜¯å¾ˆå¤šã€‚</p>
<p>æˆæœ¬æ˜¯ä¸€äº›åˆ›å»ºæ¨¡å—ã€ç§»åŠ¨ä»£ç å’Œç¼–å†™æœ‰é™æ•°é‡çš„æ ·æ¿æ–‡ä»¶çš„å‰æœŸå·¥ä½œã€‚ä½†å¥½å¤„åœ¨äºéƒ½åœ¨ä»¥åæ‰€èŠ‚çœä¸‹æ¥ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å±•ç¤ºè¿™äº›å±å¹•å¦‚ä½•ç‹¬ç«‹è¿è¡Œæ¥æµ‹è¯•è¿™ç§æ¨¡å—åŒ–ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<strong>playground</strong>ä¸ŠåŠ è½½ä»»ä½•è¿™äº›å±å¹•ï¼Œå¹¶åœ¨é‚£é‡Œè¿›è¡Œè¯•éªŒï¼Œå°±åƒå®ƒä»¬æ˜¯è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸€æ ·ä½¿ç”¨å®ƒä»¬â€¦â€¦ä¸‹ä¸€æ¬¡!</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/i-r9uoo_2N/" class="tag">
                    PointFree
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/pointfree-episode-73modular-state-management-view-state/">
                  <h3 class="post-title">
                    PointFree Episode 73:Modular State Management: View State
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
