<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>A deep summary of Key Paths | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1665922595647">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="é”®è·¯å¾„
Swift 4 ä¸­æ·»åŠ äº†é”®è·¯å¾„ (key paths) çš„æ¦‚å¿µã€‚é”®è·¯å¾„æ˜¯ä¸€ä¸ªæŒ‡å‘å±æ€§çš„æœªè°ƒç”¨çš„å¼•ç”¨ï¼Œå®ƒå’Œå¯¹æŸä¸ªæ–¹æ³•çš„æœªä½¿ç”¨çš„å¼•ç”¨å¾ˆç±»ä¼¼ã€‚é”®è·¯å¾„ä¹Ÿä¸º Swift çš„ç±»å‹ç³»ç»Ÿè¡¥å…¨äº†ç¼ºå¤±çš„å¾ˆå¤§ä¸€å—æ‹¼å›¾ã€‚åœ¨ä¹‹å‰ï¼Œä½ æ— æ³•åƒå¼•ç”¨æ–¹æ³• (æ¯”å¦‚ S..." />
    <meta name="keywords" content="a deep summary,summary,key paths" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1665922595647" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
       <a href="https://beian.miit.gov.cn/">è±«ICPå¤‡2021012281å·-1</a> | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">A deep summary of Key Paths</h2>
            <div class="post-date">2021-04-23</div>
            
              <div class="feature-container" style="background-image: url('https://images.unsplash.com/photo-1520970014086-2208d157c9e2?ixid=MnwxMjA3fDB8MHxzZWFyY2h8MXx8c3VtbWFyeXxlbnwwfHwwfHw%3D&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=900&amp;q=60')">
              </div>
            
            <div class="post-content" v-pre>
              <h2 id="é”®è·¯å¾„">é”®è·¯å¾„</h2>
<p>Swift 4 ä¸­æ·»åŠ äº†é”®è·¯å¾„ (key paths) çš„æ¦‚å¿µã€‚<em>é”®è·¯å¾„æ˜¯ä¸€ä¸ªæŒ‡å‘å±æ€§çš„æœªè°ƒç”¨çš„å¼•ç”¨ï¼Œå®ƒå’Œå¯¹æŸä¸ªæ–¹æ³•çš„æœªä½¿ç”¨çš„å¼•ç”¨å¾ˆç±»ä¼¼</em>ã€‚é”®è·¯å¾„ä¹Ÿä¸º Swift çš„ç±»å‹ç³»ç»Ÿè¡¥å…¨äº†ç¼ºå¤±çš„å¾ˆå¤§ä¸€å—æ‹¼å›¾ã€‚åœ¨ä¹‹å‰ï¼Œä½ æ— æ³•åƒå¼•ç”¨æ–¹æ³• (æ¯”å¦‚ String.uppercased) é‚£æ ·å¼•ç”¨ä¸€ä¸ªç±»å‹çš„å±æ€§ (æ¯”å¦‚ String.count)ã€‚å’Œ Objective-C åŠ Foundation ä¸­çš„é”®è·¯å¾„ç›¸æ¯”ï¼Œé™¤äº†æ‹¥æœ‰å…±åŒçš„åå­—ä»¥å¤–ï¼ŒSwift ä¸­çš„é”®è·¯å¾„æœ‰å¾ˆå¤§ä¸åŒã€‚</p>
<p>é”®è·¯å¾„è¡¨è¾¾å¼ä»¥ä¸€ä¸ªåæ–œæ å¼€å¤´ï¼Œæ¯”å¦‚ \String.countã€‚åæ–œæ æ˜¯ä¸ºäº†å°†é”®è·¯å¾„å’ŒåŒåçš„ç±»å‹å±æ€§åŒºåˆ†å¼€æ¥ (å‡å¦‚ String ä¹Ÿæœ‰ä¸€ä¸ª static count å±æ€§çš„è¯ï¼ŒString.count è¿”å›çš„å°±ä¼šæ˜¯è¿™ä¸ªå±æ€§å€¼äº†)ã€‚<em>ç±»å‹æ¨æ–­å¯¹é”®è·¯å¾„ä¹Ÿæ˜¯æœ‰æ•ˆçš„ï¼Œåœ¨ä¸Šä¸‹æ–‡ä¸­å¦‚æœç¼–è¯‘å™¨å¯ä»¥æ¨æ–­å‡ºç±»å‹çš„è¯ï¼Œä½ å¯ä»¥å°†ç±»å‹åçœç•¥ï¼Œåªç•™ä¸‹ .count</em>ã€‚</p>
<blockquote>
<p>è™½ç„¶é”®è·¯å¾„å’Œå‡½æ•°ç±»å‹å¼•ç”¨æœ‰ç´§å¯†çš„å…³ç³»ï¼Œä½†å¾ˆä¸å¹¸çš„æ˜¯ Swift ä¸­å®ƒä»¬çš„è¯­æ³•æ˜¯ä¸åŒçš„ã€‚ä¸è¿‡ï¼ŒSwift å›¢é˜Ÿè¡¨è¾¾è¿‡åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œä¸ºå‡½æ•°ç±»å‹å¼•ç”¨ä¹Ÿå¼•å…¥è¿™ç§åæ–œæ è¯­æ³•çš„å…´è¶£ã€‚</p>
</blockquote>
<p>æ­£å¦‚å…¶åï¼Œé”®è·¯å¾„æè¿°äº†ä¸€ä¸ªå€¼ä»æ ¹å¼€å§‹çš„å±‚çº§è·¯å¾„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ä¸‹é¢çš„ Person å’Œ Address ç±»å‹ä¸­ï¼Œ\Person.address.street è¡¨è¾¾äº†ä¸€ä¸ªäººçš„è¡—é“ä½å€çš„é”®è·¯å¾„ï¼š</p>
<pre><code class="language-swift">struct Address {
    var street: String
    var city: String
    var zipCode: Int
}
struct Person {
    let name: String
    var address: Address
}
let streetKeyPath = \Person.address.street
// Swift.WritableKeyPath&lt;Person, Swift.String&gt;
let nameKeyPath = \Person.name // Swift.KeyPath&lt;Person, Swift.String&gt;
</code></pre>
<p>é”®è·¯å¾„å¯ä»¥ç”±ä»»æ„çš„å­˜å‚¨å’Œè®¡ç®—å±æ€§ç»„åˆè€Œæˆï¼Œå…¶ä¸­è¿˜å¯ä»¥åŒ…æ‹¬å¯é€‰é“¾æ“ä½œç¬¦ã€‚ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºæ‰€æœ‰ç±»å‹ç”Ÿæˆ [keyPath:] çš„ä¸‹æ ‡æ–¹æ³•ã€‚ä½ é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥â€œè°ƒç”¨â€æŸä¸ªé”®è·¯å¾„ã€‚å¯¹é”®è·¯å¾„çš„è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨æŸä¸ªå®ä¾‹ä¸Šè®¿é—®ç”±é”®è·¯å¾„æ‰€æè¿°çš„å±æ€§ã€‚æ‰€ä»¥ï¼Œ&quot;Hello&quot;[keyPath: .count] ç­‰æ•ˆäº &quot;Hello&quot;.countã€‚æˆ–è€…åœ¨æˆ‘ä»¬ç°åœ¨çš„ä¾‹å­ä¸­ï¼š</p>
<pre><code class="language-swift">let simpsonResidence = Address(street: &quot;1094 Evergreen Terrace&quot;,
city: &quot;Springfield&quot;, zipCode: 97475)
var lisa = Person(name: &quot;Lisa Simpson&quot;, address: simpsonResidence)
lisa[keyPath: nameKeyPath] // Lisa Simpson
</code></pre>
<p>å¦‚æœä½ æ£€æŸ¥ä¸Šé¢ä¸¤ä¸ªé”®è·¯å¾„å˜é‡çš„ç±»å‹ï¼Œä½ ä¼šæ³¨æ„åˆ° nameKeyPath çš„ç±»å‹æ˜¯ <em>KeyPath&lt;Person, String&gt;ã€‚è¿™ä¸ªé”®è·¯å¾„æ˜¯å¼ºç±»å‹çš„ï¼Œå®ƒè¡¨ç¤ºè¯¥é”®è·¯å¾„å¯ä»¥ä½œç”¨äº Personï¼Œå¹¶è¿”å›ä¸€ä¸ª String</em>ã€‚è€Œ <em>streetKeyPath æ˜¯ä¸€ä¸ª WritableKeyPathï¼Œè¿™æ˜¯å› ä¸ºæ„æˆè¿™ä¸ªé”®è·¯å¾„çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå¯å†™é”®è·¯å¾„æœ¬èº«å…è®¸å…¶ä¸­çš„å€¼å‘ç”Ÿå˜åŒ–:</em></p>
<pre><code class="language-swift">lisa[keyPath: streetKeyPath] = &quot;742 Evergreen Terraceâ€
</code></pre>
<p>å¯¹ nameKeyPath åšåŒæ ·çš„æ“ä½œä¼šé€ æˆé”™è¯¯ï¼Œå› ä¸ºå®ƒèƒŒåçš„å±æ€§ä¸æ˜¯å¯å˜çš„ã€‚</p>
<p><em><strong>é”®è·¯å¾„ä¸ä»…å¯ä»¥æè¿°å±æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å®ƒä»¬æ¥æè¿°ä¸‹æ ‡æ“ä½œ</strong></em>ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™æ ·çš„è¯­æ³•æå–æ•°ç»„é‡Œç¬¬äºŒä¸ª person å¯¹è±¡çš„ name å±æ€§ï¼š=</p>
<pre><code class="language-swift">var bart = Person(name: &quot;Bart Simpson&quot;, address: simpsonResidence)
let people = [lisa, bart]
people[keyPath: \.[1].name] // Bart Simpson
</code></pre>
<p>åŒæ ·çš„è¯­æ³•ä¹Ÿå¯ç”¨äºåœ¨é”®è·¯å¾„ä¸­åŒ…å«å­—å…¸ä¸‹æ ‡ã€‚</p>
<h3 id="å¯ä»¥é€šè¿‡å‡½æ•°å»ºæ¨¡çš„é”®è·¯å¾„">å¯ä»¥é€šè¿‡å‡½æ•°å»ºæ¨¡çš„é”®è·¯å¾„</h3>
<p><strong>ä¸€ä¸ªå°†åŸºç¡€ç±»å‹ Root æ˜ å°„ä¸ºç±»å‹ä¸º Value çš„å±æ€§çš„é”®è·¯å¾„ï¼Œå’Œä¸€ä¸ªå…·æœ‰ (Root) -&gt; Value ç±»å‹çš„å‡½æ•°ååˆ†ç±»ä¼¼ã€‚è€Œå¯¹äºå¯å†™çš„é”®è·¯å¾„æ¥è¯´ï¼Œåˆ™å¯¹åº”ç€ä¸€å¯¹è·å–å’Œè®¾ç½®å€¼çš„å‡½æ•°</strong>ã€‚ç›¸å¯¹äºè¿™æ ·çš„å‡½æ•°ï¼Œé”®è·¯å¾„é™¤äº†åœ¨è¯­æ³•ä¸Šæ›´ç®€æ´å¤–ï¼Œ<em><strong>æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºå®ƒä»¬æ˜¯å€¼ã€‚ä½ å¯ä»¥æµ‹è¯•é”®è·¯å¾„æ˜¯å¦ç›¸ç­‰ï¼Œä¹Ÿå¯ä»¥å°†å®ƒä»¬ç”¨ä½œå­—å…¸çš„é”® (å› ä¸ºå®ƒä»¬éµå®ˆ Hashable)ã€‚å¦å¤–ï¼Œä¸åƒå‡½æ•°ï¼Œé”®è·¯å¾„æ˜¯ä¸åŒ…å«çŠ¶æ€çš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¸ä¼šæ•è·å¯å˜çš„çŠ¶æ€ã€‚å¦‚æœä½¿ç”¨æ™®é€šçš„å‡½æ•°çš„è¯ï¼Œè¿™äº›éƒ½æ˜¯æ— æ³•åšåˆ°çš„</strong></em>ã€‚</p>
<p><em><strong>é”®è·¯å¾„è¿˜å¯ä»¥é€šè¿‡å°†ä¸€ä¸ªé”®è·¯å¾„é™„åŠ åˆ°å¦ä¸€ä¸ªé”®è·¯å¾„çš„æ–¹å¼æ¥ç”Ÿæˆ</strong></em>ã€‚è¿™ä¹ˆåšæ—¶ï¼Œç±»å‹å¿…é¡»è¦åŒ¹é…ï¼›å¦‚æœä½ æœ‰ä¸€ä¸ªä» A åˆ° B çš„é”®è·¯å¾„ï¼Œé‚£ä¹ˆä½ è¦é™„åŠ çš„é”®è·¯å¾„çš„æ ¹ç±»å‹å¿…é¡»ä¸º Bï¼Œå¾—åˆ°çš„å°†ä¼šæ˜¯ä¸€ä¸ªä» A åˆ° C çš„é”®è·¯å¾„ï¼Œå…¶ä¸­ C æ˜¯æ‰€é™„åŠ çš„é”®è·¯å¾„çš„å€¼çš„ç±»å‹ï¼š</p>
<pre><code class="language-swift">// KeyPath&lt;Person, String&gt; + KeyPath&lt;String, Int&gt; = KeyPath&lt;Person, Int&gt;
let nameCountKeyPath = nameKeyPath.appending(path: \.count)
// Swift.KeyPath&lt;Person, Swift.Int&gt;
</code></pre>
<p>è®©æˆ‘ä»¬ç”¨é”®è·¯å¾„ä»£æ›¿å‡½æ•°æ¥é‡å†™æœ¬ç« å‰é¢æåˆ°çš„æ’åºæè¿°ç¬¦ã€‚æˆ‘ä»¬ä¹‹å‰é€šè¿‡ä¸€ä¸ª (Root) -&gt; Value å‡½æ•°æ¥å®šä¹‰äº† sortDescriptorï¼š</p>
<pre><code class="language-swift">typealias SortDescriptor&lt;Root&gt; = (Root, Root) -&gt; Bool
func sortDescriptor&lt;Root, Value&gt;(key: @escaping (Root) -&gt; Value)
-&gt; SortDescriptor&lt;Root&gt; where Value: Comparable {
    return { key($0) &lt; key($1) }
}
// ä½¿ç”¨
let streetSD: SortDescriptor&lt;Person&gt; = sortDescriptor { $0.address.street }
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é”®è·¯å¾„æ¥æ·»åŠ ä¸€ç§æ’åºæè¿°ç¬¦çš„æ„å»ºæ–¹å¼ã€‚é€šè¿‡é”®è·¯å¾„çš„ä¸‹æ ‡æ¥è®¿é—®å€¼ï¼š</p>
<pre><code class="language-swift">func sortDescriptor&lt;Root, Value&gt;(key: KeyPath&lt;Root, Value&gt;) -&gt; SortDescriptor&lt;Root&gt; where Value: Comparable {
    return { $0[keyPath: key] &lt; $1[keyPath: key] }
}
// ä½¿ç”¨
let streetSDKeyPath: SortDescriptor&lt;Person&gt; =
sortDescriptor(key: \.address.street)
</code></pre>
<p>ä¸è¿‡è™½ç„¶æ‹¥æœ‰ä¸€ä¸ªæ¥å—é”®è·¯å¾„çš„ sortDescriptor å¾ˆæœ‰ç”¨ï¼Œä¸è¿‡å®ƒå¹¶æ²¡æœ‰ç»™æˆ‘ä»¬å’Œå‡½æ•°ä¸€æ ·çš„çµæ´»åº¦ã€‚é”®è·¯å¾„ä¾èµ– Value æ»¡è¶³ Comparable è¿™ä¸€å‰æã€‚åªä½¿ç”¨é”®è·¯å¾„çš„è¯ï¼Œæˆ‘ä»¬æ— æ³•å¾ˆè½»æ˜“åœ°ä½¿ç”¨å¦ä¸€ç§æ’åºæ–­è¨€ (æ¯”å¦‚ï¼Œä½¿ç”¨å¿½ç•¥å¤§å°å†™çš„æŒ‰åŒºåŸŸè®¾ç½®çš„æ¯”è¾ƒ)ã€‚</p>
<h3 id="å¯å†™é”®è·¯å¾„-swift-é€šè¿‡é”®è·¯å¾„å®ç°åŒå‘ç»‘å®š">å¯å†™é”®è·¯å¾„ - swift é€šè¿‡é”®è·¯å¾„å®ç°åŒå‘ç»‘å®š</h3>
<p>å¯å†™é”®è·¯å¾„æ¯”è¾ƒç‰¹æ®Šï¼š<em>ä½ å¯ä»¥ç”¨å®ƒæ¥è¯»å–æˆ–è€…å†™å…¥ä¸€ä¸ªå€¼</em>ã€‚å› æ­¤ï¼Œå®ƒå’Œä¸€å¯¹å‡½æ•°ç­‰æ•ˆï¼šä¸€ä¸ªè´Ÿè´£è·å–å±æ€§å€¼ ((Root) -&gt;Value)ï¼Œå¦ä¸€ä¸ªè´Ÿè´£è®¾ç½®å±æ€§å€¼ ((inout Root, Value) -&gt; Void)ã€‚ç›¸æ¯”äºåªè¯»é”®è·¯å¾„ï¼Œå¯å†™é”®è·¯å¾„è¦å¤æ‚çš„å¤šã€‚é¦–å…ˆï¼Œå®ƒå°†å¾ˆå¤šä»£ç åŒ…æ‹¬åœ¨äº†ç®€æ´çš„è¯­æ³•ä¸­ã€‚å°† streetKeyPath ä¸ç­‰æ•ˆçš„ getter å’Œ setter å¯¹è¿›è¡Œæ¯”è¾ƒï¼š</p>
<pre><code class="language-swift">let streetKeyPath = \Person.address.street
let getStreet: (Person) -&gt; String = { person in
    return person.address.street
}
let setStreet: (inout Person, String) -&gt; () = { person, newValue in
    person.address.street = newValue
}
// ä½¿ç”¨ Setter
lisa[keyPath: streetKeyPath] = &quot;1234 Evergreen Terrace&quot;
setStreet(&amp;lisa, &quot;1234 Evergreen Terrace&quot;)
</code></pre>
<p>å¯å†™é”®è·¯å¾„å¯¹äºæ•°æ®ç»‘å®šç‰¹åˆ«æœ‰ç”¨ï¼Œä½ æƒ³å°†ä¸¤ä¸ªå±æ€§äº’ç›¸ç»‘å®šï¼šå±æ€§ 1 å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå±æ€§ 2 çš„å€¼ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œåä¹‹äº¦ç„¶ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥å°†ä¸€ä¸ª model.name å±æ€§ç»‘å®šåˆ° textField.text ä¸Šã€‚API çš„ç”¨æˆ·éœ€è¦æŒ‡å®šå¦‚ä½•è¯»å†™ model.name å’Œ textField.textï¼Œè€Œé”®è·¯å¾„æ‰€è§£å†³çš„æ­£æ˜¯è¿™ä¸ªé—®é¢˜</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦å¯¹å±æ€§çš„å˜åŒ–è¿›è¡Œè§‚å¯Ÿã€‚åœ¨ Cocoa ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨é”®å€¼è§‚å¯Ÿæœºåˆ¶æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä¸è¿‡è¿™æ ·çš„æ–¹å¼åªèƒ½ä½œç”¨äºç±»ä¸Šé¢ï¼Œå¹¶å±€é™åœ¨ Apple å¹³å°ä¸Šã€‚Foundation æä¾›äº†ä¸€ç§æ–°çš„ç±»å‹å®‰å…¨çš„ KVO çš„ APIï¼Œå®ƒä»¬å¯ä»¥å°† Objective-C ä¸–ç•Œä¸­åŸºäºå­—ç¬¦ä¸²çš„é”®è·¯å¾„éšè—èµ·æ¥ã€‚NSObject ä¸Šçš„ observe(_:options:changeHandler:) æ–¹æ³•å°†ä¼šå¯¹ä¸€ä¸ª (Swift çš„å¼ºç±»å‹) é”®è·¯å¾„è¿›è¡Œè§‚å¯Ÿï¼Œå¹¶åœ¨å±æ€§å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è°ƒç”¨ handlerã€‚<em>ä¸è¦å¿˜è®°ä½ è¿˜éœ€è¦å°†è¦è§‚å¯Ÿçš„å±æ€§æ ‡è®°ä¸º @objc dynamicï¼Œå¦åˆ™ KVO å°†ä¸ä¼šå·¥ä½œ</em>ã€‚</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨ä¸¤ä¸ª NSObject ä¹‹é—´å®ç°åŒå‘ç»‘å®šï¼Œä¸è¿‡è®©æˆ‘ä»¬ä»å•å‘ç»‘å®šå¼€å§‹ï¼šæ¯å½“ self ä¸Šçš„è¢«è§‚å¯Ÿå€¼å˜æ›´ï¼Œæˆ‘ä»¬å°±åŒæ—¶å˜æ›´å¦ä¸€ä¸ªå¯¹è±¡ã€‚é”®è·¯å¾„å¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç æ›´åŠ æ³›ç”¨ï¼Œè€Œä¸å¿…æ‹˜æ³¥äºæŸä¸ªç‰¹å®šçš„å±æ€§ï¼šè°ƒç”¨è€…åªéœ€è¦æŒ‡å®šä¸¤ä¸ªå¯¹è±¡ä»¥åŠä¸¤ä¸ªé”®è·¯å¾„ï¼Œè¿™ä¸ªæ–¹æ³•å°±å¯ä»¥å¤„ç†å…¶ä»–çš„äº‹æƒ…ï¼š</p>
<pre><code class="language-swift">extension NSObjectProtocol where Self: NSObject {
    func observe&lt;A, Other&gt;(_ keyPath: KeyPath&lt;Self, A&gt;,
    writeTo other: Other, _ otherKeyPath: ReferenceWritableKeyPath&lt;Other, A&gt;)
    -&gt; NSKeyValueObservation
    where A: Equatable, Other: NSObjectProtocol
    {
        return observe(keyPath, options: .new) { _, change in
            guard let newValue = change.newValue,
                other[keyPath: otherKeyPath] != newValue else {
                return // prevent endless feedback loop
            }
            other[keyPath: otherKeyPath] = newValue 
        }
    }
}
</code></pre>
<p>è¿™æ®µä»£ç ä¸­æœ‰ä¸å°‘å€¼å¾—ä¸€è¯´çš„ä¸œè¥¿ã€‚<br>
é¦–å…ˆï¼Œæˆ‘ä»¬å¯¹æ‰€æœ‰ NSObject çš„å­ç±»å®šä¹‰äº†è¿™ä¸ªæ–¹æ³•ï¼Œé€šè¿‡æ‰©å±• NSObjectProtocol è€Œä¸æ˜¯ NSObjectï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Selfã€‚<br>
ReferenceWritableKeyPath å’Œ WritableKeyPath å¾ˆç›¸ä¼¼ï¼Œä¸è¿‡å®ƒå¯ä»¥è®©æˆ‘ä»¬å¯¹ (other è¿™æ ·çš„) ä½¿ç”¨ let å£°æ˜çš„å¼•ç”¨å˜é‡è¿›è¡Œå†™æ“ä½œ (æˆ‘ä»¬ä¼šåœ¨éšåè®¨è®ºç»†èŠ‚)ã€‚<br>
ä¸ºäº†é¿å…ä¸å¿…è¦çš„å†™æ“ä½œï¼Œæˆ‘ä»¬åªåœ¨å€¼å‘ç”Ÿæ”¹å˜æ—¶æ‰å¯¹ other è¿›è¡Œå†™å…¥ã€‚<br>
è¿”å›å€¼ NSKeyValueObservation æ˜¯ä¸€ä¸ª tokenï¼Œè°ƒç”¨è€…ä½¿ç”¨è¿™ä¸ª token æ¥æ§åˆ¶è§‚å¯Ÿçš„ç”Ÿå‘½å‘¨æœŸï¼šå±æ€§è§‚å¯Ÿä¼šåœ¨è¿™ä¸ª token å¯¹è±¡è¢«é”€æ¯æˆ–è€…è°ƒç”¨è€…è°ƒç”¨äº†å®ƒçš„ invalidate æ–¹æ³•æ—¶åœæ­¢ã€‚</p>
<p>æœ‰äº† observe(<em>:writeTo:</em>ğŸ˜ƒï¼ŒåŒå‘ç»‘å®šä¹Ÿå°±å¾ˆç›´æ¥äº†ï¼šæˆ‘ä»¬å¯¹ä¸¤ä¸ªå¯¹è±¡éƒ½è°ƒç”¨ observeï¼Œå®ƒä»¬å°†è¿”å›ä¸¤ä¸ªè§‚å¯Ÿ tokenï¼š</p>
<pre><code class="language-swift">extension NSObjectProtocol where Self: NSObject {
    func bind&lt;A, Other&gt;(_ keyPath: ReferenceWritableKeyPath&lt;Self,A&gt;,
    to other: Other,
    _ otherKeyPath: ReferenceWritableKeyPath&lt;Other,A&gt;)
    -&gt; (NSKeyValueObservation, NSKeyValueObservation)
    where A: Equatable, Other: NSObject
    {
        let one = observe(keyPath, writeTo: other, otherKeyPath)
        let two = other.observe(otherKeyPath, writeTo: self, keyPath)
        return (one,two)
    }
}
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯æ„å»ºä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼ŒPerson å’Œ TextFieldï¼Œç„¶åå°† name å’Œ text å±æ€§äº’ç›¸ç»‘å®šï¼š</p>
<pre><code class="language-swift">final class Person: NSObject {
    @objc dynamic var name: String = &quot;&quot;
}
class TextField: NSObject {
    @objc dynamic var text: String = &quot;&quot;
}
let person = Person()
let textField = TextField()
let observation = person.bind(\.name, to: textField, \.text)
person.name = &quot;John&quot;
textField.text // John
textField.text = &quot;Sarah&quot;
person.name // Sarah
</code></pre>
<blockquote>
<p>å¦‚æœä½ å¾ˆç†Ÿç»†å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¯å†™é”®è·¯å¾„å¯èƒ½ä¼šè®©ä½ æƒ³èµ·å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„é€é•œ (lenses)ã€‚å®ƒä»¬ç´§å¯†ç›¸å…³ï¼šé€šè¿‡ä¸€ä¸ª WritableKeypath&lt;Root, Value&gt;ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª Lens&lt;Root, Value&gt;ã€‚é€é•œçš„æ¦‚å¿µåœ¨åƒæ˜¯ Haskell æˆ– PureScript è¿™æ ·çš„çº¯å‡½æ•°å¼è¯­è¨€ä¸­éå¸¸æœ‰ç”¨ï¼Œä¸è¿‡å› ä¸º Swift å†…å»ºæ”¯æŒå¯å˜æ€§ï¼Œæ‰€ä»¥åœ¨ Swift é‡Œå®ƒæ²¡æœ‰é‚£ä¹ˆæœ‰ç”¨ã€‚</p>
</blockquote>
<h3 id="é”®è·¯å¾„å±‚çº§">é”®è·¯å¾„å±‚çº§</h3>
<p>é”®è·¯å¾„æœ‰äº”ç§ä¸åŒçš„ç±»å‹ï¼Œæ¯ç§ç±»å‹éƒ½åœ¨å‰ä¸€ç§ä¸Šæ·»åŠ äº†æ›´åŠ ç²¾ç¡®çš„æè¿°åŠåŠŸèƒ½ï¼š</p>
<ul>
<li>
<p>AnyKeyPath å’Œ (Any) -&gt; Any? ç±»å‹çš„å‡½æ•°ç›¸ä¼¼ã€‚</p>
</li>
<li>
<p>PartialKeyPath<Source> å’Œ (Source) -&gt; Any? å‡½æ•°ç›¸ä¼¼ã€‚</p>
</li>
<li>
<p>KeyPath&lt;Source, Target&gt; å’Œ (Source) -&gt; Target å‡½æ•°ç›¸ä¼¼ã€‚</p>
</li>
<li>
<p>WritableKeyPath&lt;Source, Target&gt; å’Œ (Source) -&gt; Target ä¸ (inout Source, Target) -&gt; () è¿™ä¸€å¯¹å‡½æ•°ç›¸ä¼¼ã€‚</p>
</li>
<li>
<p>ReferenceWritableKeyPath&lt;Source, Target&gt; å’Œ (Source) -&gt; Target ä¸ (Source, Target) -&gt; () è¿™ä¸€å¯¹å‡½æ•°ç›¸ä¼¼ã€‚ç¬¬äºŒä¸ªå‡½æ•°å¯ä»¥ç”¨ Target æ¥æ›´æ–° Source çš„å€¼ï¼Œä¸”è¦æ±‚ Source æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ã€‚<em><strong>å¯¹ WritableKeyPath å’Œ ReferenceWritableKeyPath è¿›è¡ŒåŒºåˆ†æ˜¯å¿…è¦çš„ï¼Œå‰ä¸€ä¸ªç±»å‹çš„ setter è¦æ±‚å®ƒçš„å‚æ•°æ˜¯ inout çš„ã€‚</strong></em></p>
</li>
</ul>
<p>è¿™å‡ ç§é”®è·¯å¾„çš„å±‚çº§ç»“æ„ç°åœ¨æ˜¯é€šè¿‡ç±»çš„ç»§æ‰¿æ¥å®ç°çš„ã€‚ç†æƒ³çŠ¶æ€ä¸‹ï¼Œè¿™äº›ç‰¹æ€§åº”è¯¥ç”±åè®®æ¥å®Œæˆï¼Œä½†æ˜¯ Swift çš„æ³›å‹ç³»ç»Ÿè¿˜ç¼ºå°‘ä¸€äº›ä½¿ä¹‹å¯è¡Œçš„ç‰¹æ€§ã€‚è¿™ç§ç±»çš„å±‚çº§æœ‰æ„åœ°ä¿æŒäº†å¯¹å¤–ä¸å¯è§ï¼Œè¿™æ ·ä»¥ä¾¿äºæœªæ¥åœ¨æ›´æ–°æ—¶ï¼Œç°æœ‰çš„ä»£ç ä¹Ÿä¸ä¼šè¢«ç ´åã€‚</p>
<p>æˆ‘ä»¬å‰é¢ä¹Ÿæåˆ°ï¼Œ<em>é”®è·¯å¾„ä¸åŒäºå‡½æ•°ï¼Œå®ƒä»¬æ˜¯æ»¡è¶³ Hashable çš„ï¼Œè€Œä¸”åœ¨å°†æ¥å®ƒä»¬å¾ˆæœ‰å¯èƒ½è¿˜ä¼šæ»¡è¶³ Codable</em>ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¼ºè°ƒ AnyKeyPath å’Œ (Any) -&gt; Any åªæ˜¯ç›¸ä¼¼çš„åŸå› ã€‚<em>è™½ç„¶æˆ‘ä»¬èƒ½å¤Ÿå°†ä¸€ä¸ªé”®è·¯å¾„è½¬æ¢ä¸ºå¯¹åº”çš„å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬æ— æ³•åšç›¸åçš„æ“ä½œ</em>ã€‚</p>
<h3 id="å¯¹æ¯”-objective-c-çš„é”®è·¯å¾„">å¯¹æ¯” Objective-C çš„é”®è·¯å¾„</h3>
<p>åœ¨ Foundation å’Œ Objective-C ä¸­ï¼Œé”®è·¯å¾„æ˜¯é€šè¿‡å­—ç¬¦ä¸²æ¥å»ºæ¨¡çš„ (æˆ‘ä»¬ä¼šå°†å®ƒä»¬ç§°ä¸º Foundation é”®è·¯å¾„ï¼Œä»¥åŒºåˆ« Swift çš„é”®è·¯å¾„)ã€‚<em>ç”±äº Foundation é”®è·¯å¾„æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒä»¬ä¸å«æœ‰ä»»ä½•çš„ç±»å‹ä¿¡æ¯ã€‚ä»è¿™ä¸ªè§’åº¦çœ‹ï¼Œå®ƒä»¬å’Œ AnyKeyPath ç±»ä¼¼ã€‚å¦‚æœä¸€ä¸ª Foundation é”®è·¯å¾„æ‹¼å†™é”™è¯¯ã€æ²¡æœ‰æ­£ç¡®ç”Ÿæˆã€æˆ–è€…å®ƒçš„ç±»å‹ä¸åŒ¹é…çš„è¯ï¼Œç¨‹åºå¯èƒ½ä¼šå´©æºƒ</em>ã€‚(Swift ä¸­çš„ #keyPath æŒ‡ä»¤å¯¹æ‹¼å†™é”™è¯¯çš„é—®é¢˜è¿›è¡Œäº†ä¸€äº›æ”¹å–„ï¼Œç¼–è¯‘å™¨å¯ä»¥æ£€æŸ¥ç‰¹å®šåå­—æ‰€å¯¹åº”çš„å±æ€§æ˜¯å¦å­˜åœ¨ã€‚) <em>Swift çš„ KeyPathã€WritableKeypath å’Œ ReferenceWritableKeyPath ä»æ„é€ å¼€å§‹å°±æ˜¯æ­£ç¡®çš„ï¼šå®ƒä»¬ä¸å¯èƒ½è¢«æ‹¼é”™ï¼Œä¹Ÿä¸ä¼šæœ‰ç±»å‹é”™è¯¯</em>ã€‚</p>
<p>å¾ˆå¤š Cocoa API åœ¨åŸæœ¬ç”¨å‡½æ•°ä¼šæ›´å¥½çš„åœ°æ–¹ä½¿ç”¨äº† (Foundation) é”®è·¯å¾„ã€‚è¿™å…¶ä¸­æœ‰ä¸€éƒ¨åˆ†æ˜¯å†å²åŸå› ï¼šåŒ¿åå‡½æ•° (æˆ–è€…åœ¨ Objective-C ä¸­æ‰€è°“çš„ block) å…¶å®æ˜¯ç›¸å¯¹æœ€è¿‘æ‰æ·»åŠ çš„ç‰¹æ€§ï¼Œè€Œé”®è·¯å¾„çš„å­˜åœ¨åˆ™è¦é•¿ä¹…å¾—å¤šã€‚åœ¨ block è¢«å¼•å…¥ Objective-C ä¹‹å‰ï¼Œæƒ³è¦åœ¨ä¸ç”¨é”®è·¯å¾„ &quot;address.street&quot; çš„æ¡ä»¶ä¸‹ï¼Œè¡¨è¾¾ç±»ä¼¼ { $0.address.street } è¿™æ ·çš„å‡½æ•°æ˜¯å¾ˆå›°éš¾çš„ã€‚</p>
<p>å‚è€ƒä¹¦ç±<br>
<a href="https://objccn.io/products/advanced-swift/">Swiftè¿›é˜¶</a></p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/BKc_eiC_7/" class="tag">
                    a deep summary
                  </a>
                
                  <a href="https://kayouyou.github.io/tag/mQbhOOb5q/" class="tag">
                    summary
                  </a>
                
                  <a href="https://kayouyou.github.io/tag/SaaEscPbvk/" class="tag">
                    key paths
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/a-tip-of-property-wrapper-wei-codable-jie-ma-she-ding-mo-ren-zhi/">
                  <h3 class="post-title">
                    A tip of Property Wrapper - use type constraints transform value to set default value for Codable 
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
