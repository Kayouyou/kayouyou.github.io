<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Creating custom collections in Swift | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico?v=1656758429524">
<link rel="stylesheet" href="http://localhost:4000/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="åœ¨Swiftä¸­åˆ›å»ºå¯¹è±¡æˆ–å€¼çš„é›†åˆæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨æ ‡å‡†åº“æä¾›çš„æ•°æ®ç»“æ„â€”â€”ä¾‹å¦‚Arrayã€Dictionaryå’ŒSetã€‚ è™½ç„¶è¿™ä¸‰ç§æ–¹æ³•æ¶µç›–äº†å¤§å¤šæ•°ç”¨ä¾‹ï¼Œä½†æœ‰æ—¶åˆ›å»ºè‡ªå®šä¹‰åŒ…è£…å™¨é›†åˆå¯ä»¥ä½¿æ‚¨çš„ä»£ç æ›´å®¹æ˜“é¢„æµ‹ï¼Œæ›´ä¸æ˜“å‡ºé”™ã€‚
æœ¬å‘¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä½œä¸º..." />
    <meta name="keywords" content="collections" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="http://localhost:4000">
        <img src="http://localhost:4000/images/avatar.png?v=1656758429524" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="http://localhost:4000/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Creating custom collections in Swift</h2>
            <div class="post-date">2017-09-17</div>
            
            <div class="post-content" v-pre>
              <p>åœ¨Swiftä¸­åˆ›å»ºå¯¹è±¡æˆ–å€¼çš„é›†åˆæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨æ ‡å‡†åº“æä¾›çš„æ•°æ®ç»“æ„â€”â€”ä¾‹å¦‚Arrayã€Dictionaryå’ŒSetã€‚ è™½ç„¶è¿™ä¸‰ç§æ–¹æ³•æ¶µç›–äº†å¤§å¤šæ•°ç”¨ä¾‹ï¼Œä½†æœ‰æ—¶åˆ›å»ºè‡ªå®šä¹‰åŒ…è£…å™¨é›†åˆå¯ä»¥ä½¿æ‚¨çš„ä»£ç æ›´å®¹æ˜“é¢„æµ‹ï¼Œæ›´ä¸æ˜“å‡ºé”™ã€‚</p>
<p>æœ¬å‘¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä½œä¸ºåº”ç”¨å¼€å‘è€…çš„æˆ‘ä»¬å¦‚ä½•åœ¨Swiftä¸­å®šä¹‰è¿™æ ·çš„å®šåˆ¶é›†åˆï¼Œä»¥åŠå¦‚ä½•ç»“åˆæšä¸¾çš„å¼ºå¤§åŠŸèƒ½æ¥ä¸ºè‡ªå·±åˆ›å»ºä¸€äº›æ¼‚äº®çš„apiã€‚</p>
<h2 id="removing-optionals">Removing optionals</h2>
<p>å°±åƒæˆ‘ä»¬åœ¨â€œå¤„ç†Swiftä¸­çš„éå¯é€‰é€‰é¡¹â€ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œå½“ä½ æ­£åœ¨å¯»æ‰¾çš„å€¼å®é™…ä¸Šæ˜¯å¿…éœ€çš„æ—¶ï¼Œå‡å°‘ä½¿ç”¨å¯é€‰é€‰é¡¹çš„éœ€è¦ç¡®å®å¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å…é”™è¯¯ï¼Œå¹¶ä½¿æˆ‘ä»¬çš„ä»£ç æ›´å®¹æ˜“å¤„ç†ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œé›†åˆçš„é—®é¢˜æ˜¯ï¼Œä½ é€šå¸¸ä¸èƒ½ä¿è¯å®ƒä»¬æ˜¯å¦åŒ…å«æŸä¸ªå€¼ï¼Œ å› æ­¤ï¼Œæ‚¨å¾€å¾€ä¼šå¾—åˆ°å¤§é‡çš„å¯é€‰é¡¹å’Œé€»è¾‘ï¼Œéœ€è¦ä»¥ä¸€ç§æˆ–å¦ä¸€ç§æ–¹å¼å±•å¼€å®ƒä»¬ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ä¸ºä¸€ä¸ªæ‚è´§åº—æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªUIè®©ç”¨æˆ·æŒ‰ç±»åˆ«æ˜¾ç¤ºæ‰€æœ‰äº§å“ã€‚è¦ä¸ºè¿™æ ·çš„UIåˆ›å»ºæ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­—å…¸ï¼Œå®ƒä½¿ç”¨Categoryä½œä¸ºé”®ç±»å‹ï¼Œ[Product]ä½œä¸ºå€¼ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-swift">let products: [Category : [Product]] = [
    .dairy: [
        Product(name: &quot;Milk&quot;, category: .dairy),
        Product(name: &quot;Butter&quot;, category: .dairy)
    ],
    .vegetables: [
        Product(name: &quot;Cucumber&quot;, category: .vegetables),
        Product(name: &quot;Lettuce&quot;, category: .vegetables)
    ]
]
</code></pre>
<p>è™½ç„¶ä¸Šé¢çš„å·¥ä½œï¼Œå®ƒå°†è¦æ±‚æˆ‘ä»¬å†™è¿™æ ·çš„ä»£ç ï¼Œä»¥-ä¾‹å¦‚-åªæ˜¾ç¤ºæ‰€æœ‰çš„ä¹³åˆ¶å“:</p>
<pre><code class="language-swift">if let dairyProducts = products[.dairy] {
    guard !dairyProducts.isEmpty else {
        renderEmptyView()
        return
    }

    render(dairyProducts)
} else {
    renderEmptyView()
}
</code></pre>
<p>å¾ˆå¥½ï¼Œä½†è¿˜å¯ä»¥æ›´å¥½ã€‚ç„¶è€Œï¼Œæ’å…¥æ–°äº§å“å˜å¾—æ›´åŠ éº»çƒ¦:</p>
<pre><code class="language-swift">class ShoppingCart {
    private(set) var products = [Category : [Product]]()

    func add(_ product: Product) {
        if var productsInCategory = products[product.category] {
            productsInCategory.append(product)
            products[product.category] = productsInCategory
        } else {
            products[product.category] = [product]
        }
    }
}
</code></pre>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼Œé€šè¿‡åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰é›†åˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ä¸Šè¿°ä¸¤ä¸ªç¤ºä¾‹å˜å¾—æ›´å¥½ã€æ›´ç®€æ´ã€‚æ›´å¥½çš„æ¶ˆæ¯æ˜¯â€”â€”å¤šäºäº†Swifté¢å‘åè®®çš„è®¾è®¡â€”â€”åˆ›å»ºè¿™æ ·çš„é›†åˆå®é™…ä¸Šç›¸å½“å®¹æ˜“!</p>
<h2 id="to-be-a-collection">To be a collection</h2>
<p>Swiftæ ‡å‡†åº“ä¸­çš„æ‰€æœ‰é›†åˆéƒ½éµå¾ªCollectionåè®®ï¼Œè€Œé›†åˆåè®®åˆç»§æ‰¿äº†Sequenceåè®®ã€‚é€šè¿‡ä½¿è‡ªå®šä¹‰é›†åˆç¬¦åˆè¿™ä¸¤ä¸ªåè®®ï¼Œå®ƒå¯ä»¥å®Œå…¨å…è´¹åœ°åˆ©ç”¨æ‰€æœ‰æ ‡å‡†é›†åˆæ“ä½œâ€”â€”æ¯”å¦‚è¿­ä»£å’Œè¿‡æ»¤ã€‚</p>
<p>è®©æˆ‘ä»¬ä»å®šä¹‰å®šåˆ¶ProductCollectionçš„åŸºç¡€å¼€å§‹ï¼Œè¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»¥ä¸€ç§æ›´å¥½çš„æ–¹å¼å¤„ç†äº§å“å’Œç±»åˆ«ã€‚</p>
<pre><code class="language-swift">struct ProductCollection {
    typealias DictionaryType = [Category : [Product]]

    // Underlying, private storage, that is the same type of dictionary
    // that we previously was using at the call site
    private var products = DictionaryType()

    // Enable our collection to be initialized with a dictionary
    init(products: DictionaryType) {
        self.products = products
    }
}
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡å®ç°åè®®éœ€æ±‚ä½¿å…¶ç¬¦åˆé›†åˆã€‚æˆ‘ä»¬è¦åšçš„å¤§éƒ¨åˆ†å·¥ä½œå°±æ˜¯ç®€å•åœ°å°†è°ƒç”¨è½¬å‘åˆ°åº•å±‚productså­—å…¸ï¼Œå¹¶è®©å®ƒæ¥åšâ€œç¹é‡çš„å·¥ä½œâ€:</p>
<pre><code class="language-swift">extension ProductCollection: Collection {
    // Required nested types, that tell Swift what our collection contains
    typealias Index = DictionaryType.Index
    typealias Element = DictionaryType.Element

    // The upper and lower bounds of the collection, used in iterations
    var startIndex: Index { return products.startIndex }
    var endIndex: Index { return products.endIndex }

    // Required subscript, based on a dictionary index
    subscript(index: Index) -&gt; Iterator.Element {
        get { return products[index] }
    }

    // Method that returns the next index when iterating
    func index(after i: Index) -&gt; Index {
        return products.index(after: i)
    }
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨çš„æ˜¯Swift 4ï¼Œå®ƒä½¿å¾—å®šä¹‰è‡ªå®šä¹‰é›†åˆå˜å¾—éå¸¸ç®€å•ï¼Œè¿™è¦å½’åŠŸäºé€šç”¨çº¦æŸçš„æ”¹è¿›(æˆ‘ä»¬å°†åœ¨ä»¥åçš„å¸–å­ä¸­æ›´ä»”ç»†åœ°ç ”ç©¶è¿™äº›æ”¹è¿›ä»¥åŠå¦‚ä½•ä½¿ç”¨ç±»å‹çº¦æŸ)ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå®šåˆ¶é›†åˆï¼Œå®ƒå¯ä»¥ä½œä¸ºå†…ç½®é›†åˆä¹‹ä¸€ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥éå†å®ƒ:</p>
<pre><code class="language-swift">for (category, productsInCategory) in products {
    ...
}
</code></pre>
<p>æˆ–è€…ä½¿ç”¨ç±»ä¼¼mapçš„æ“ä½œ</p>
<pre><code class="language-swift">let categories = productCollection.map { $0.key }
</code></pre>
<h2 id="custom-collection-apis">Custom collection APIs</h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»ä¸ºæˆ‘ä»¬çš„é›†åˆå¥ å®šäº†åŸºç¡€ï¼Œè®©æˆ‘ä»¬å¼€å§‹æ·»åŠ ä¸€äº›apiï¼Œè¿™äº›apiå°†ä½¿æˆ‘ä»¬çš„äº§å“å¤„ç†ä»£ç å˜å¾—æ›´å¥½ã€‚æˆ‘ä»¬å°†ä»è‡ªå®šä¹‰ä¸‹æ ‡é‡è½½å¼€å§‹ï¼Œå®ƒå…è®¸æˆ‘ä»¬è·å–æˆ–è®¾ç½®ä¸€ä¸ªäº§å“æ•°ç»„ï¼Œè€Œä¸å¿…å¤„ç†å¯é€‰é¡¹:</p>
<pre><code class="language-swift">extension ProductCollection {
    subscript(category: Category) -&gt; [Product] {
        get { return products[category] ?? [] }
        set { products[category] = newValue }
    }
}
</code></pre>
<p>è®©æˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ªæ–¹ä¾¿çš„APIï¼Œæ–¹ä¾¿åœ°å°†æ–°äº§å“æ’å…¥åˆ°æˆ‘ä»¬çš„é›†åˆä¸­:</p>
<pre><code class="language-swift">extension ProductCollection {
    mutating func insert(_ product: Product) {
        var productsInCategory = self[product.category]
        productsInCategory.append(product)
        self[product.category] = productsInCategory
    }
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å›åˆ°æœ€åˆçš„äº§å“å¤„ç†ä»£ç ï¼Œå¹¶å°†å…¶æ›´æ–°å¾—æ›´å¥½ã€‚é˜…è¯»:</p>
<pre><code class="language-swift">let dairyProducts = products[.dairy]

if dairyProducts.isEmpty {
    renderEmptyView()
} else {
    render(dairyProducts)
}


&lt;!-- And writing: --&gt;

class ShoppingCart {
    private(set) var products = ProductCollection()

    func add(product: Product) {
        products.insert(product)
    }
}
</code></pre>
<h2 id="becoming-expressible-by-a-literal">Becoming expressible by a literal</h2>
<p>å¥½äº†ï¼Œå¥–é‡‘ç¯èŠ‚åˆ°äº†! å› ä¸ºæˆ‘ä»¬çš„è‡ªå®šä¹‰é›†åˆåŸºæœ¬ä¸Šåªæ˜¯ä¸€ä¸ªå­—å…¸çš„åŒ…è£…å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ å¯¹ä½¿ç”¨å­—å…¸å­—é¢é‡åˆå§‹åŒ–ä¸€ä¸ªå­—å…¸çš„æ”¯æŒã€‚è¿™æ ·åšå¯ä»¥è®©æˆ‘ä»¬å†™å‡ºè¿™æ ·çš„ä»£ç :</p>
<pre><code class="language-swift">let products: ProductCollection = [
    .dairy: [
        Product(name: &quot;Milk&quot;, category: .dairy),
        Product(name: &quot;Butter&quot;, category: .dairy)
    ],
    .vegetables: [
        Product(name: &quot;Cucumber&quot;, category: .vegetables),
        Product(name: &quot;Lettuce&quot;, category: .vegetables)
    ]
]
</code></pre>
<p>å¾ˆé…·!è¿™ä¸ä»…æœ‰åŠ©äºå‡å°‘ç”Ÿäº§ä»£ç ä¸­çš„å†—é•¿ï¼Œè€Œä¸”è¿˜å¯ä»¥ç®€åŒ–æµ‹è¯•ä¸­äº§å“é›†åˆæ¨¡æ‹Ÿçš„è®¾ç½®ã€‚</p>
<p>ä¸ºäº†å®ç°ä¸Šè¿°æƒ…å†µï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯éµå¾ªExpressibleByDictionaryLiteralï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬å®ç°ä¸€ä¸ªä»¥å­—é¢é‡ä¸ºå‚æ•°çš„åˆå§‹åŒ–å¼ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-swift">extension ProductCollection: ExpressibleByDictionaryLiteral {
    typealias Key = Category
    typealias Value = [Product]

    init(dictionaryLiteral elements: (Category, [Product])...) {
        for (category, productsInCategory) in elements {
            products[category] = productsInCategory
        }
    }
}
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>ä½¿ç”¨è‡ªå®šä¹‰é›†åˆæ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥ä»¥ä¸€ç§æ›´å¯é¢„æµ‹å’Œæ˜“äºä½¿ç”¨çš„æ–¹å¼å¤„ç†ä¸€ç»„å€¼ã€‚å½“æ‚¨å¤„ç†å¤šä¸ªå€¼æ—¶ï¼Œå®ƒå¯èƒ½ä¸åº”è¯¥æ€»æ˜¯æ‚¨çš„é¦–é€‰è§£å†³æ–¹æ¡ˆï¼Œä½†åœ¨æ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œå®ƒç¡®å®å¯ä»¥å¸®åŠ©æ‚¨ç¼–å†™æ›´æ¸…æ™°çš„ä»£ç ã€‚</p>
<p>åœ¨è°ƒè¯•æ—¶ï¼Œç†è§£åƒé›†åˆè¿™æ ·çš„ä¸œè¥¿æ˜¯å¦‚ä½•å·¥ä½œçš„ä¹Ÿéå¸¸æœ‰å¸®åŠ©ï¼Œæˆ–è€…è®©æ‚¨äº†è§£å¦‚ä½•ä¼˜åŒ–å¤„ç†é›†åˆçš„ä»£ç ã€‚<br>
è¿˜æœ‰ä»€ä¹ˆæ¯”å»ºç«‹è‡ªå·±çš„Collectionsæ›´å¥½çš„æ–¹å¼æ¥å­¦ä¹ æ›´å¤šå…³äºCollectionsçš„çŸ¥è¯†å‘¢?ğŸ˜„</p>
<p><a href="https://www.swiftbysundell.com/articles/creating-custom-collections-in-swift/">åŸæ–‡é“¾æ¥</a></p>

            </div>
            
              <div class="tag-container">
                
                  <a href="http://localhost:4000/tag/J3hVc8gY-/" class="tag">
                    collections
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="http://localhost:4000/post/using-the-factory-pattern-to-avoid-shared-state-in-swift/">
                  <h3 class="post-title">
                    Using the factory pattern to avoid shared state in Swift
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
