<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>PointFree Episode 84:Testable State Management: Ergonomics | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1663222449571">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="

PointFree Episode 84:Testable State Management: Ergonomics

Simplifying testing stateÃ¥
The shape of a test
Improving t..." />
    <meta name="keywords" content="PointFree" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1663222449571" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">PointFree Episode 84:Testable State Management: Ergonomics</h2>
            <div class="post-date">2021-11-28</div>
            
            <div class="post-content" v-pre>
              <!-- TOC -->
<ul>
<li><a href="#pointfree-episode-84testable-state-management-ergonomics">PointFree Episode 84:Testable State Management: Ergonomics</a>
<ul>
<li><a href="#simplifying-testing-state%C3%A5">Simplifying testing stateÃ¥</a></li>
<li><a href="#the-shape-of-a-test">The shape of a test</a></li>
<li><a href="#improving-test-feedback">Improving test feedback</a></li>
<li><a href="#trailing-closure-ergonomics">Trailing closure ergonomics</a></li>
<li><a href="#actions-sent-and-actions-received">Actions sent and actions received</a></li>
<li><a href="#assertion-edge-cases">Assertion edge cases</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<!-- # PointFree Episode 84:Testable State Management: Ergonomics -->
<p>æˆ‘ä»¬ä¸ä»…å¸Œæœ›æˆ‘ä»¬çš„æ¶æ„æ˜¯å¯æµ‹è¯•çš„ï¼Œè€Œä¸”æˆ‘ä»¬è¿˜å¸Œæœ›å®ƒéå¸¸å®¹æ˜“åœ°ç¼–å†™æµ‹è¯•ï¼Œç”šè‡³å¯èƒ½æ˜¯ç¼–å†™æµ‹è¯•çš„ä¹è¶£! ç°åœ¨åœ¨ç¼–å†™æµ‹è¯•æ—¶æ¶‰åŠåˆ°ä¸€äº›ç¤¼èŠ‚ï¼Œå› æ­¤æˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•å°†è¿™äº›ç»†èŠ‚éšè—åœ¨ä¸€ä¸ªè‰¯å¥½çš„ç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„APIåé¢ã€‚</p>
<h2 id="simplifying-testing-stateÃ¥">Simplifying testing stateÃ¥</h2>
<p>è®©æˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªé—®é¢˜å¼€å§‹:æ–­è¨€æ‰€æœ‰<strong>reducer</strong>çš„çŠ¶æ€éå¸¸å†—é•¿ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬æœ€ç®€å•çš„<strong>counter</strong>è§†å›¾æµ‹è¯•:</p>
<pre><code class="language-swift">func testIncrButtonTapped() {
  var state = CounterViewState(
    alertNthPrime: nil,
    count: 2,
    favoritePrimes: [3, 5],
    isNthPrimeButtonDisabled: false
  )

  let effects = counterViewReducer(&amp;state, .counter(.incrTapped))

  XCTAssertEqual(
    state,
    CounterViewState(
      alertNthPrime: nil,
      count: 3,
      favoritePrimes: [3, 5],
      isNthPrimeButtonDisabled: false
    )
  )
  XCTAssertTrue(effects.isEmpty)
}
</code></pre>
<p>æˆ‘ä»¬é€šè¿‡é‡æ–°åˆ›å»ºå®ƒçš„æ•´ä½“æ¥æ–­è¨€æ›´æ–°çŠ¶æ€ï¼Œä½†æˆ‘ä»¬å®é™…ä¸Šåªå…³å¿ƒä¸€è¡Œ:</p>
<pre><code class="language-swift">count: 3,
</code></pre>
<p><strong>count</strong>æ˜¯å”¯ä¸€ä¸åŒäºåˆå§‹çŠ¶æ€çš„å­—æ®µï¼Œä½†å¾ˆéš¾çœ‹å‡ºæ˜¯å“ªä¸ªå­—æ®µï¼Œå°¤å…¶æ˜¯åœ¨æ²¡æœ‰æ‰‹åŠ¨æ£€æŸ¥å’Œæ¯”è¾ƒæ¯ä¸ªåˆå§‹åŒ–å™¨è°ƒç”¨çš„æƒ…å†µä¸‹çš„æ›´æ”¹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–­è¨€çš„<strong>message</strong>æ¥æ›´å¥½åœ°æ•è·æˆ‘ä»¬çš„æ„å›¾ã€‚</p>
<pre><code class="language-swift">XCTAssertEqual(
  state,
  CounterViewState(
    alertNthPrime: nil,
    count: 3,
    favoritePrimes: [3, 5],
    isNthPrimeButtonDisabled: false
  ),
  &quot;Expected count to increment to 3&quot;
)
</code></pre>
<p>ä½†è¿™ä½¿å¾—æµ‹è¯•æ›´åŠ å†—é•¿ï¼ŒåŒ…å«çš„ä¿¡æ¯å¯èƒ½å¾ˆå¿«å°±ä¼šä»æ–­è¨€å®é™…è¯•å›¾æ•è·çš„ä¿¡æ¯ä¸­è¿‡æ—¶ã€‚</p>
<pre><code class="language-swift">//&quot;Expected count to increment to 3&quot;
</code></pre>
<p>æ­¤å¤–ï¼Œ<strong>CounterViewState</strong>åªåŒ…å«å››ä¸ªå­—æ®µã€‚æ‚¨å¯ä»¥æƒ³è±¡åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä»£ç ä¸­æœ‰æ›´å¤§çš„ç±»å‹ï¼Œå› æ­¤è¿™ç§æ–¹å¼çš„æµ‹è¯•å°†å¾ˆå¿«å˜å¾—ä¸å¯æŒç»­ã€‚ç®€åŒ–æˆ‘ä»¬æ–­è¨€çš„æ–¹å¼å¯èƒ½ä¼šæ›´å¥½ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æµ‹è¯•æ›´ç›´æ¥åœ°æè¿°æˆ‘ä»¬çš„<strong>expectations</strong>ã€‚</p>
<p>åœ¨å°†åŸæ¥çš„çŠ¶æ€æä¾›ç»™<strong>reducer</strong>ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªçŠ¶æ€çš„å¯å˜å‰¯æœ¬ã€‚</p>
<pre><code class="language-swift">func testIncrButtonTapped() {
  var state = CounterViewState(
    alertNthPrime: nil,
    count: 2,
    favoritePrimes: [3, 5],
    isNthPrimeButtonDisabled: false
  )
  var expected = state
  let effects = counterViewReducer(&amp;state, .counter(.incrTapped))
</code></pre>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åº”ç”¨çªå˜æ¥æ”¹å˜æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œcount:</p>
<pre><code class="language-swift">//    XCTAssertEqual(
//      state,
//      CounterViewState(
//        alertNthPrime: nil,
//        count: 3,
//        favoritePrimes: [3, 5],
//        isNthPrimeButtonDisabled: false
//      )
//    )
  expected.count = 3
  XCTAssertEqual(state, expected)
  XCTAssertTrue(effects.isEmpty)
}
</code></pre>
<p>ä¹è¡Œå˜æˆä¸€è¡Œï¼Œæˆ‘ä»¬çš„æœŸæœ›åœ¨çªå˜ä¸­æ¸…æ™°åœ°è¡¨ç°å‡ºæ¥ã€‚è¿™æ¯”ä¹‹å‰çš„ä¸€å›¢çŠ¶æ€è¦å¥½å¾—å¤šã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬æµ‹è¯•çš„å¾ˆå¤§ä¸€éƒ¨åˆ†ä»ç„¶è‡´åŠ›äºåˆå§‹åŒ–çŠ¶æ€:æˆ‘ä»¬åœ¨æ¯ä¸ªæµ‹è¯•çš„å¼€å§‹è°ƒç”¨æ•´ä¸ªåˆå§‹åŒ–å™¨ï¼Œè¿™ä½¿å¾—äº‹æƒ…å˜å¾—æ›´è„†å¼±:å¦‚æœ<strong>CounterViewState</strong>ç»“æ„ä½“æ”¹å˜äº†ï¼Œä»»ä½•æ„é€ å®ƒçš„æµ‹è¯•å°†æ— æ³•ç¼–è¯‘å¹¶éœ€è¦æ›´æ–°ï¼Œä¸ç®¡è¿™äº›æ”¹å˜æ˜¯å¦å½±å“ä»»ä½•ç‰¹å®šçš„æµ‹è¯•ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åšçš„ä¸€ä»¶äº‹æ˜¯ç”¨ä¸€äº›åˆç†çš„é»˜è®¤å€¼æ›´æ–°<strong>CounterViewState</strong>çš„åˆå§‹åŒ–å™¨ã€‚</p>
<pre><code class="language-swift">public struct CounterViewState: Equatable {
  public var alertNthPrime: PrimeAlert?
  public var count: Int
  public var favoritePrimes: [Int]
  public var isNthPrimeButtonDisabled: Bool

  public init(
    alertNthPrime: PrimeAlert? = nil,
    count: Int = 0,
    favoritePrimes: [Int] = [],
    isNthPrimeButtonDisabled: Bool = false
  ) {
</code></pre>
<p>Swiftç¼–è¯‘å™¨ç°åœ¨åªå…è®¸æˆ‘ä»¬æ’å…¥ç‰¹å®šæµ‹è¯•æ‰€å…³å¿ƒçš„å€¼ã€‚</p>
<p>åœ¨<strong>testIncrButtonTapped</strong>çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å®é™…ä¸Šåªå…³å¿ƒ<strong>count</strong>ï¼Œå› ä¸ºå®ƒæ˜¯å”¯ä¸€è¢«<strong>mutated</strong>çš„å­—æ®µã€‚</p>
<pre><code class="language-swift">func testIncrButtonTapped() {
  var state = CounterViewState(count: 2)
  var expected = state
  let effects = counterViewReducer(&amp;state, .counter(.incrTapped))

  expected.count = 3
  XCTAssertEqual(state, expected)
  XCTAssertTrue(effects.isEmpty)
}
</code></pre>
<p>è¿™ä¸ªæµ‹è¯•éå¸¸ç®€æ´ã€‚</p>
<p>è®©æˆ‘ä»¬ç»§ç»­å¹¶æ›´æ–°<strong>counter</strong>é€’å‡çš„æµ‹è¯•ã€‚</p>
<pre><code class="language-swift">func testDecrButtonTapped() {
  var state = CounterViewState(count: 2)
  var expected = state
  let effects = counterViewReducer(&amp;state, .counter(.decrTapped))

  expected.count = 1
  XCTAssertEqual(state, expected)
  XCTAssertTrue(effects.isEmpty)
}
</code></pre>
<p>å¾ˆç®€å•! 21è¡Œå˜æˆäº†9è¡Œï¼Œä¸“æ³¨äºä»–ä»¬æ‰€å…³å¿ƒçš„ç»†èŠ‚ã€‚</p>
<p>å¥½äº†ï¼Œæˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªæµ‹è¯•æ›´æœ‰å®è´¨æ„ä¹‰ã€‚äº‹å®ä¸Šï¼Œè¿™æ˜¯è¿„ä»Šä¸ºæ­¢æˆ‘ä»¬æ‰€ç¼–å†™çš„æœ€å¤æ‚çš„æµ‹è¯•ä¹‹ä¸€ã€‚å®ƒè¿è¡Œç‚¹å‡»ç¬¬nä¸ªè´¨æ•°æŒ‰é’®çš„æ•´ä¸ªæµç¨‹ï¼Œè¯„ä¼°è·å¾—ç¬¬nä¸ªè´¨æ•°å“åº”çš„<strong>effect</strong>ï¼Œæœ€å<strong>dismiss</strong>ç»“æœè­¦æŠ¥ã€‚</p>
<pre><code class="language-swift">func testNthPrimeButtonHappyFlow() {
    Current.nthPrime = { _ in .sync { 17 } }

    var state = CounterViewState(
      alertNthPrime: nil,
      count: 2,
      favoritePrimes: [3, 5],
      isNthPrimeButtonDisabled: false
    )

    var effects = counterViewReducer(&amp;state, .counter(.nthPrimeButtonTapped))

    XCTAssertEqual(
      state,
      CounterViewState(
        alertNthPrime: nil,
        count: 2,
        favoritePrimes: [3, 5],
        isNthPrimeButtonDisabled: true
      )
    )
    XCTAssertEqual(effects.count, 1)

    var nextAction: CounterViewAction!
    let receivedCompletion = self.expectation(description: &quot;receivedCompletion&quot;)
    let cancellable = effects[0].sink(
      receiveCompletion: { _ in
        receivedCompletion.fulfill()
    },
      receiveValue: { action in
        XCTAssertEqual(action, .counter(.nthPrimeResponse(17)))
        nextAction = action
    }
    )
    self.wait(for: [receivedCompletion], timeout: 0.01)

    effects = counterViewReducer(&amp;state, nextAction)

    XCTAssertEqual(
      state,
      CounterViewState(
        alertNthPrime: PrimeAlert(prime: 17),
        count: 2,
        favoritePrimes: [3, 5],
        isNthPrimeButtonDisabled: false
      )
    )
    XCTAssertTrue(effects.isEmpty)

    effects = counterViewReducer(&amp;state, .counter(.alertDismissButtonTapped))

    XCTAssertEqual(
      state,
      CounterViewState(
        alertNthPrime: nil,
        count: 2,
        favoritePrimes: [3, 5],
        isNthPrimeButtonDisabled: false
      )
    )
    XCTAssertTrue(effects.isEmpty)
  }
</code></pre>
<p>å®ƒæœ‰å¤šè¾¾62è¡Œä»£ç ã€‚ä¸è¿‡ï¼Œå¦‚æœæˆ‘ä»¬åªå…³æ³¨æˆ‘ä»¬æ‰€å…³å¿ƒçš„<strong>state</strong>ï¼Œæˆ‘ä»¬å°±åº”è¯¥èƒ½å¤Ÿå¤§å¹…å‰Šå‡å¼€æ”¯ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–<strong>state</strong>çš„å®ä¾‹åŒ–ï¼Œå°†æ³¨æ„åŠ›é›†ä¸­åœ¨æµ‹è¯•æ‰€å…³å¿ƒçš„å†…å®¹ä¸Š:ä¸»è¦<strong>prime alert state</strong>ä»¥åŠä¸»è¦æŒ‰é’®æ˜¯å¦è¢«ç¦ç”¨ã€‚</p>
<pre><code class="language-swift">var state = CounterViewState(alertNthPrime: nil, isNthPrimeButtonDisabled: false)
</code></pre>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªå¯å˜å‰¯æœ¬æ¥è·Ÿè¸ªæˆ‘ä»¬æœŸæœ›çš„éšæ—¶é—´çš„å˜åŒ–çš„<strong>state</strong>ã€‚</p>
<pre><code class="language-swift">var expected = state
</code></pre>
<p>å½“ç‚¹å‡»ç¬¬nä¸ªä¸»æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›è¯¥æŒ‰é’®ç¦ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ”¹å˜é¢„æœŸçš„<strong>state</strong>å¹¶é’ˆå¯¹å®ƒè¿›è¡Œæ–­è¨€ã€‚</p>
<pre><code class="language-swift">var effects = counterViewReducer(&amp;state, .counter(.nthPrimeButtonTapped))

expected.isNthPrimeButtonDisabled = true
XCTAssertEqual(state, expected)
XCTAssertEqual(effects.count, 1)
</code></pre>
<p>å½“æˆ‘ä»¬å¾—åˆ°å“åº”æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›è®¾ç½®<strong>prime alert state</strong>å¹¶é‡æ–°å¯ç”¨æŒ‰é’®ã€‚</p>
<pre><code class="language-swift">effects = counterViewReducer(&amp;state, nextAction)

expected.alertNthPrime = PrimeAlert(prime: 17)
expected.isNthPrimeButtonDisabled = false
XCTAssertEqual(state, expected)
XCTAssertTrue(effects.isEmpty)
</code></pre>
<p>æœ€åï¼Œå½“å…³é—­è­¦æŠ¥æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›<strong>prime alert state</strong>ä¸ºnilã€‚</p>
<pre><code class="language-swift">effects = counterViewReducer(&amp;state, .counter(.alertDismissButtonTapped))

expected.alertNthPrime = nil
XCTAssertEqual(state, expected)
XCTAssertTrue(effects.isEmpty)
</code></pre>
<p>å¥½äº†ï¼Œæˆ‘ä»¬å¼€å§‹æœ‰è¿›å±•äº†ã€‚è¿™ä¸ªæµ‹è¯•å‡ ä¹å¯ä»¥åœ¨ä¸€ä¸ªå±å¹•ä¸Šå®Œæˆ!</p>
<h2 id="the-shape-of-a-test">The shape of a test</h2>
<p>è™½ç„¶<strong>state</strong>é‡Œçš„è®¸å¤šæ ·æ¿å·²ç»å¤§å¹…ç¼©æ°´ï¼Œä½†åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ä»æœ‰è®¸å¤šå¯æ€•çš„ä»ªå¼:</p>
<ul>
<li>
<p>ä¹Ÿè®¸æœ€çªå‡ºçš„æ˜¯æˆ‘ä»¬å¦‚ä½•å¤„ç†<strong>effect</strong>ã€‚<strong>effect</strong>é™„åŠ äº†è®¸å¤šæ ·æ¿:æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ä¿å­˜å®ƒä»¬ï¼Œä½¿ç”¨sinkæ–¹æ³•æ‰‹åŠ¨æ‰§è¡Œå®ƒä»¬ï¼Œå¹¶æ‰§è¡Œä¸€ä¸ª<strong>XCTestExpectation</strong>åŠ¨ä½œï¼Œå…¶ä¸­åŒ…æ‹¬åˆ›å»ºä¸€ä¸ª<strong>expectation</strong>ã€ç­‰å¾…å®ƒå¹¶åœ¨å®Œæˆå—ä¸­å®Œæˆå®ƒã€‚æˆ‘ä»¬å¯èƒ½ä¼šå¿˜è®°å¾ˆå¤šæˆ–è€…æ‰€æœ‰è¿™äº›æ­¥éª¤ã€‚</p>
</li>
<li>
<p>åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„æµ‹è¯•ç®¡ç†çš„å¹¶æä¾›ç»™<strong>reducer</strong>çš„æœ¬åœ°çš„ã€å¯å˜çš„çŠ¶æ€ä¸å¤ªæ˜æ˜¾ã€‚å°†çªå˜å¼•å…¥ä¸€ä¸ªèŒƒå›´ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªå±€éƒ¨èŒƒå›´ï¼Œä¹Ÿä¼šä½¿å…¶æ›´éš¾è§£é‡Šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»¥<strong>expected</strong>å¤åˆ¶çš„å½¢å¼å¼•å…¥äº†ä¸¤å€çš„å¯å˜çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ä¸¤å€çš„æœºä¼šä»¥é”™è¯¯çš„æ–¹å¼æ„å¤–çªå˜è¿™äº›å€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚</p>
</li>
</ul>
<p>è¿™ä¸ªæµ‹è¯•æœ‰ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„å½¢çŠ¶ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šäº‹æƒ…æˆ‘ä»¬å¿…é¡»å¼„å¯¹æ‰èƒ½åšå‡ºè¿™äº›æ–­è¨€ã€‚å¦‚æœæˆ‘ä»¬é€€åä¸€æ­¥ï¼Œçœ‹çœ‹è¿™ä¸ªå½¢çŠ¶ï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æ‰€ç¼–å†™çš„æ¯ä¸ªæµ‹è¯•éƒ½éµå¾ªç›¸åŒçš„è„šæœ¬:æˆ‘ä»¬æ„å»ºåˆå§‹çŠ¶æ€ï¼Œå¯åŠ¨<strong>reducer</strong>ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç”¨æˆ·æ“ä½œè„šæœ¬ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ç»´æŠ¤æˆ‘ä»¬æ‰€æœ‰çš„<strong>expectations</strong>ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª<strong>assert helper</strong>ï¼Œå°±åƒè‹¹æœçš„<strong>XCTAssert</strong>åŠŸèƒ½ï¼Œé™¤äº†å®ƒå¯ä»¥æ„ŸçŸ¥æˆ‘ä»¬çš„æ¶æ„ã€‚æˆ‘ä»¬å¯ä»¥æä¾›ç”¨æˆ·æ‰§è¡Œçš„ä¸€ç³»åˆ—æ“ä½œçš„æè¿°ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­çš„æ¯ä¸€æ­¥æˆ‘ä»¬éƒ½èƒ½å¤Ÿæ–­è¨€çŠ¶æ€æ˜¯å¦‚ä½•æ”¹å˜çš„ã€‚</p>
<p>è¿™æ ·çš„<strong>assert helper</strong>çœ‹èµ·æ¥åƒä»€ä¹ˆ? å—¯ï¼Œ<strong>XCTAssert</strong>åªæ˜¯ä¸€ä¸ªç®€å•çš„è‡ªç”±å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„åŠ©æ‰‹å¯ä»¥æ˜¯ç›¸åŒçš„:</p>
<pre><code class="language-swift">func assert(
) {
}
</code></pre>
<p>ä¸ºäº†è®©è¿™ä¸ªåŠ©æ‰‹å®Œæˆå®ƒçš„å·¥ä½œï¼Œå®ƒå¿…é¡»çŸ¥é“æˆ‘ä»¬å¼€å§‹çš„åˆå§‹å€¼å’Œæˆ‘ä»¬æƒ³è¦æµ‹è¯•çš„<strong>reducer</strong>ã€‚è®©æˆ‘ä»¬æ¥æä¾›:</p>
<pre><code class="language-swift">func assert&lt;Value, Action&gt;(
  initialValue: Value,
  reducer: Reducer&lt;Value, Action&gt;
) {
}
</code></pre>
<p>ç„¶åï¼Œæœ‰äº†è¿™äº›é…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬æƒ³ç»™<strong>assert helper</strong>æä¾›ä¸€ä¸ªç”¨æˆ·åœ¨ä¸UIäº¤äº’æ—¶æ‰§è¡Œçš„æ“ä½œåˆ—è¡¨:</p>
<pre><code class="language-swift">func assert&lt;Value, Action&gt;(
  initialValue: Value,
  reducer: Reducer&lt;Value, Action&gt;,
  steps: [Action]
) {
}
</code></pre>
<p>ç„¶è€Œï¼Œåœ¨æ¯ä¸ªæ­¥éª¤æ‰§è¡Œä¹‹åï¼Œæˆ‘ä»¬å¸Œæœ›è¿›ä¸€æ­¥æ–­è¨€æ¨¡å‹æ˜¯å¦‚ä½•ä»å‰ä¸€æ­¥æ›´æ”¹çš„ã€‚æ‰€ä»¥ä»…ä»…æä¾›ä¸€ä¸ªæ“ä½œæ•°ç»„æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜æƒ³æä¾›çªå˜å‡½æ•°æ¥æè¿°æˆ‘ä»¬æœŸæœ›å€¼å¦‚ä½•æ”¹å˜:</p>
<pre><code class="language-swift">func assert&lt;Value, Action&gt;(
  initialValue: Value,
  reducer: Reducer&lt;Value, Action&gt;,
  steps: [(action: Action, update: (inout Value) -&gt; Void)]
) {
}
</code></pre>
<p>å¦‚æœæˆ‘ä»¬å¯ä»¥å®ç°è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†æœ€ç®€å•çš„æµ‹è¯•æ›´æ–°ä¸ºå¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-swift">func testIncrButtonTapped() {
  assert(
    initialValue: CounterViewState(count: 2),
    reducer: counterViewReducer
    steps: [
      (.counter(.incrTapped), { state in state.count = 3 })
    ]
  )
}
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„è¿›æ­¥ã€‚æˆ‘ä»¬ä¸å†é‡å¤å°†å¯å˜å˜é‡å’ŒåŠ¨ä½œè¾“å…¥<strong>reducer</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç®€åŒ–ä¸€ä¸‹ï¼Œç”¨$0ä»£æ›¿<strong>state</strong>ï¼Œç°åœ¨æ”¹å˜çš„<strong>state</strong>å°±å¾ˆæ¸…æ¥šäº†:</p>
<pre><code class="language-swift">(.counter(.incrTapped), { $0.count = 3 })
</code></pre>
<p>å› ä¸ºç»´æŠ¤è¿™ä¸ªæ­¥éª¤åˆ—è¡¨éå¸¸å®¹æ˜“ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åšä¸€äº›æ›´ç®€å•çš„æ–­è¨€ã€‚</p>
<pre><code class="language-swift">steps: [
  (.counter(.incrTapped), { $0.count = 3 }),
  (.counter(.incrTapped), { $0.count = 4 }),
  (.counter(.decrTapped), { $0.count = 3 })
]
</code></pre>
<p>å› ä¸ºç¼–å†™è¿™ä¸ªæµ‹è¯•è„šæœ¬éå¸¸å®¹æ˜“ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æœ‰èƒ½åŠ›å¼€å§‹æµ‹è¯•æ›´å¤æ‚ã€æ›´ç»†å¾®ã€æ›´å¾®å¦™çš„ç”¨æˆ·æµã€‚</p>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥é€šè¿‡ä½¿ç”¨**variadics(å¯å˜å‚æ•°)**è€Œä¸æ˜¯æ•°ç»„æ¥å‡å°‘ä¸€å±‚åµŒå¥—:</p>
<pre><code class="language-swift">func assert&lt;Value, Action&gt;(
  initialValue: Value,
  reducer: Reducer&lt;Value, Action&gt;,
  steps: (action: Action, update: (inout Value) -&gt; Void)...
) {
}

assert(
  initialValue: CounterViewState(count: 2),
  reducer: counterViewReducer
  steps:
  (.counter(.incrTapped), { $0.count = 3 }),
  (.counter(.incrTapped), { $0.count = 4 }),
  (.counter(.decrTapped), { $0.count = 3 })
)
</code></pre>
<p>è¿™å°†ç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•ï¼Œä½†å½“ç„¶æˆ‘ä»¬è¿˜æ²¡æœ‰æµ‹è¯•ä»»ä½•ä¸œè¥¿ï¼Œå› ä¸º<strong>assert helper</strong>æ˜¯ç©ºçš„ã€‚è®©æˆ‘ä»¬å¼€å§‹å®ç°å®ƒçš„ä¸»ä½“ã€‚</p>
<p>æˆ‘ä»¬å¸Œæœ›å®ƒéå†ç»™å®šçš„æ­¥éª¤å¹¶è¿è¡Œæ¯ä¸ªæ“ä½œï¼Œä»¥ä¾¿åœ¨è¿‡ç¨‹ä¸­åšå‡ºæ–­è¨€ã€‚</p>
<pre><code class="language-swift">steps.forEach { step in

}
</code></pre>
<p>åœ¨æ¯ä¸ªæ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›è¿è¡Œ<strong>reducer</strong>ä¸å½“å‰æ­¥éª¤çš„<strong>action</strong>ã€‚</p>
<pre><code class="language-swift">steps.forEach { step in
  reducer
}
</code></pre>
<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯å˜çš„å€¼æ¥ä¼ é€’ç»™<strong>reducer</strong>ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°†å®ƒå¤åˆ¶åˆ°å¾ªç¯å¤–ï¼Œå¹¶å°†å®ƒä¸å½“å‰æ­¥éª¤çš„<strong>action</strong>ä¸€èµ·æä¾›ç»™<strong>reducer</strong>ã€‚</p>
<pre><code class="language-swift">var state = initialValue
steps.forEach { step in
  reducer(&amp;state, step.action)
}
</code></pre>
<blockquote>
<p>âš ï¸ Result of call to function returning â€˜[Effect]â€™ is unused</p>
</blockquote>
<p>è®©æˆ‘ä»¬ä¿æŒç®€å•ï¼Œæš‚æ—¶å¿½ç•¥è¿™äº›å½±å“ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºæˆ‘ä»¬å‹¾å‹’å‡ºçš„ç¬¬ä¸€ä¸ªæ–­è¨€æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ–­è¨€ï¼Œçªå˜æŒ‰ç…§æˆ‘ä»¬çš„é¢„æœŸå‘ç”Ÿï¼Œè¿™æ˜¯æˆ‘ä»¬çš„æµ‹è¯•ç›®å‰æ­£åœ¨ä»¥éå¸¸æ‰‹åŠ¨çš„æ–¹å¼è¿›è¡Œçš„å·¥ä½œï¼Œæˆ‘ä»¬å¤åˆ¶å½“å‰å€¼ï¼Œçªå˜å®ƒï¼Œå¹¶æ–­è¨€å®ƒä»¬æ˜¯ç›¸ç­‰çš„ã€‚ä½†è¿™ä¸€æ¬¡çªå˜åœ¨æ­¥éª¤çš„æ›´æ–°å‡½æ•°ä¸­è¢«æ•è·ã€‚</p>
<pre><code class="language-swift">var state = initialValue
steps.forEach { step in
  var expected = state
  _ reducer(&amp;state, step.action)
  step.update(&amp;expected)
  XCTAssertEqual(state, expected)
}
</code></pre>
<blockquote>
<p>ğŸ›‘ Global function â€˜XCTAssertEqual(::_:file:line:)â€™ requires that â€˜Valueâ€™ conform to â€˜Equatableâ€™</p>
</blockquote>
<p>ä½†æ˜¯æˆ‘ä»¬éœ€è¦å°†<strong>Value</strong>é™åˆ¶ä¸º<strong>Equatable</strong>ï¼Œä»¥ä¾¿å°†å®ƒä»¬æä¾›ç»™æ–­è¨€ã€‚</p>
<pre><code class="language-swift">func assert&lt;Value: Equatable, Action&gt;(
</code></pre>
<p>ä¸€åˆ‡éƒ½æ„å»ºå¥½äº†ï¼Œå½“æˆ‘ä»¬è¿è¡Œæµ‹è¯•æ—¶â€¦</p>
<blockquote>
<p>âœ… Executed 1 test, with 0 failures (0 unexpected)</p>
</blockquote>
<p>Nice, it passes!</p>
<h2 id="improving-test-feedback">Improving test feedback</h2>
<p>ä¸ºäº†ç¡®ä¿æˆ‘ä»¬å®é™…ä¸Šå¾—åˆ°äº†æˆ‘ä»¬æœŸæœ›çš„æ–­è¨€ï¼Œè®©æˆ‘ä»¬æ‰“ç ´å®ƒçš„æœŸæœ›<strong>count</strong>ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å‘é€<strong>decrement</strong>æ“ä½œçš„åœ°æ–¹å¢åŠ é¢„æœŸçš„<strong>count</strong>ã€‚</p>
<pre><code class="language-swift">assert(
  initialValue: CounterViewState(count: 2),
  reducer: counterViewReducer
  steps:
  (.counter(.incrTapped), { $0.count = 3 }),
  (.counter(.incrTapped), { $0.count = 4 }),
  (.counter(.decrTapped), { $0.count = 5 })
)
</code></pre>
<p>å½“æˆ‘ä»¬è¿è¡Œæµ‹è¯•æ—¶ï¼Œå®ƒä¼šåƒé¢„æœŸçš„é‚£æ ·å¤±è´¥ã€‚</p>
<blockquote>
<p>âŒ Executed 1 test, with 1 failure (0 unexpected)</p>
</blockquote>
<p>ä½†ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªå¤±è´¥å‡ºç°åœ¨<strong>assert helper</strong>çš„å†…éƒ¨æ·±å¤„ã€‚</p>
<pre><code class="language-swift">XCTAssertEqual(value, expected) // âŒ
</code></pre>
<p>æˆ‘ä»¬è¿˜å¿…é¡»é‡‡å–ä¸€äº›é¢å¤–çš„æ­¥éª¤æ¥è®©é”™è¯¯æ¶ˆæ¯åœ¨<strong>Xcode</strong>ä¸­æ›´å¥½åœ°å‘æŒ¥ä½œç”¨ã€‚<strong>XCTest</strong>åˆ©ç”¨ä¸€äº›Swiftç‰¹æ€§å†…è”æ˜¾ç¤ºå…¶é”™è¯¯ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒæ ·çš„ç‰¹æ€§å¢å¼º<strong>assert</strong>åŠ©æ‰‹ã€‚</p>
<p><strong>XCTAssertEqual</strong>æœ‰ä¸€äº›éšè—çš„é»˜è®¤å‚æ•°ï¼Œå®ƒä»¬è´Ÿè´£è¿™ç§è¡Œä¸ºã€‚</p>
<pre><code class="language-swift">func XCTAssertEqual(_ expression1: @autoclosure () throws -&gt; T, _ expression2: @autoclosure () throws -&gt; T, _ message: @autoclosure () -&gt; String = â€œâ€, file: StaticString = #file, line: UInt = #line) where T : Equatable
</code></pre>
<p><strong>#fileå’Œ#line</strong>éƒ½æ˜¯ç‰¹æ®Šçš„å­—é¢å€¼ï¼Œå®ƒä»¬æŒ‡å‘æ˜¾ç¤ºå®ƒä»¬çš„æ–‡ä»¶å’Œè¡Œã€‚å½“å®ƒä»¬è¢«ç”¨ä½œé»˜è®¤å‚æ•°æ—¶ï¼Œå®ƒä»¬æŒ‡çš„æ˜¯è°ƒç”¨å‡½æ•°çš„æ–‡ä»¶å’Œè¡Œã€‚</p>
<p>ä¸ºäº†çªå‡ºæ˜¾ç¤ºè°ƒç”¨<strong>assert helper</strong>çš„å¤±è´¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›å­—é¢å€¼å¼•å…¥åˆ°å…¶ç­¾åä¸­ã€‚</p>
<pre><code class="language-swift">func assert&lt;Value: Equatable, Action&gt;(
  initialValue: Value,
  reducer: Reducer&lt;Value, Action&gt;,
  steps: (action: Action, update: (inout Value) -&gt; Void)...,
  file: StaticString = #file,
  line: UInt = #line
) {
</code></pre>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬ä¼ é€’ç»™<strong>XCTest</strong>æ–­è¨€ã€‚</p>
<pre><code class="language-swift">XCTAssertEqual(value, expected, file: file, line: line)
</code></pre>
<p>å½“æˆ‘ä»¬è¿è¡Œæµ‹è¯•æ—¶ï¼Œå¤±è´¥ç°åœ¨æ˜¾ç¤ºåœ¨æˆ‘ä»¬è°ƒç”¨<strong>assert</strong>çš„åœ°æ–¹ã€‚</p>
<pre><code class="language-swift">assert( // âŒ
</code></pre>
<p>è¿™è‚¯å®šæ›´å¥½ï¼Œä½†ä»ç„¶ä¸ç†æƒ³ã€‚æˆ‘ä»¬å¼•å…¥çš„å®é™…å¤±è´¥æ˜¯åœ¨æœ€åä¸€æ­¥ã€‚æ›´ç³Ÿçš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ‰“ç ´äº†å¦ä¸€ä¸ªæœŸæœ›ï¼Œè¯´ç¬¬ä¸€ä¸ª:</p>
<pre><code class="language-swift">(.counter(.incrTapped), { $0.count = 2 }),
(.counter(.incrTapped), { $0.count = 4 }),
(.counter(.decrTapped), { $0.count = 5 })
</code></pre>
<p>æˆ‘ä»¬å¾—åˆ°äº†ä¸¤ä¸ªå¤±è´¥ï¼Œè¿™æ˜¯æ„æ–™ä¹‹ä¸­çš„ï¼Œä½†å®ƒä»¬éƒ½åœ¨åŒä¸€è¡Œä¸Šï¼Œè°ƒç”¨äº†<strong>assert</strong>ï¼Œä½†ä¸ä¸‹é¢çš„å®é™…é—®é¢˜ç›¸å·®ç”šè¿œã€‚<br>
å¦‚æœè¿™äº›ç±»å‹çš„å¤±è´¥ä»¥å†…è”æ–¹å¼çªå‡ºæ˜¾ç¤ºï¼Œé‚£å°±æ›´å¥½äº†ã€‚</p>
<p>ä¼ é€’ä½ç½®çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨é¢å¤–çš„<strong>file and line</strong>å­—æ®µå‡çº§<strong>steps</strong>ã€‚</p>
<pre><code class="language-swift">steps: (action: Action, update: (inout Value) -&gt; Void, file: StaticString, line: UInt)...,
</code></pre>
<p>åœ¨è¿™é‡Œä½¿ç”¨é»˜è®¤å‚æ•°ä¹Ÿå¾ˆå¥½ï¼Œä½†è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æœºæ¢°åœ°åœ¨è°ƒç”¨ç«™ç‚¹ä¼ é€’#<strong>fileå’Œ#line</strong>ã€‚</p>
<pre><code class="language-swift">assert(
  initialValue: CounterViewState(count: 2),
  reducer: counterViewReducer,
  steps:
  (.counter(.incrTapped), { $0.count = 3 }, #file, #line),
  (.counter(.incrTapped), { $0.count = 4 }, #file, #line),
  (.counter(.decrTapped), { $0.count = 5 }, #file, #line)
)
</code></pre>
<p>ä¸ºäº†åˆ©ç”¨è¿™äº›å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬ä¼ é€’ç»™XCTestæ–­è¨€ã€‚</p>
<pre><code class="language-swift">XCTAssertEqual(value, expected, file: step.file, line: step.line)
</code></pre>
<p>å½“æˆ‘ä»¬è¿›è¡Œæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ›´å¥½çš„åé¦ˆã€‚å¤±è´¥å‡ºç°åœ¨å¤±è´¥æ­¥éª¤:</p>
<pre><code class="language-swift">(.counter(.incrTapped), { $0.count = 2 }, #file, #line), // âŒ
(.counter(.incrTapped), { $0.count = 4 }, #file, #line),
(.counter(.incrTapped), { $0.count = 5 }, #file, #line)  // âŒ
</code></pre>
<p>ä½†æ˜¯ï¼Œè¿™ç§æ‰‹å·¥å·¥ä½œéå¸¸ç¬¨æ‹™ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å¸¦æœ‰é»˜è®¤å®å‚çš„å‡½æ•°æ¥è‡ªåŠ¨å®Œæˆè¿™é¡¹å·¥ä½œï¼Œå®ç°è¿™ä¸€ç›®çš„çš„ä¸€ç§æ–¹æ³•æ˜¯å°†è¿™ä¸ªå…ƒç»„å‡çº§ä¸ºå¸¦æœ‰åˆå§‹åŒ–å™¨å‡½æ•°çš„ç»“æ„ä½“ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†ç»“æ„ä½“ç§°ä¸º<strong>Step</strong>ã€‚</p>
<p>å®ƒéœ€è¦åœ¨<strong>Valueå’ŒAction</strong>ä¹‹ä¸Šæ˜¯é€šç”¨çš„ï¼Œå®ƒå°†å­˜å‚¨ä¸€ä¸ªæ“ä½œã€ä¸€ä¸ªçªå˜ã€ä¸€ä¸ªæ–‡ä»¶åå’Œä¸€ä¸ªè¡Œå·ã€‚</p>
<pre><code class="language-swift">struct Step&lt;Value, Action&gt; {
  let action: Action
  let update: (inout Value) -&gt; Void
  let file: StaticString
  let line: UInt
}
</code></pre>
<p>ä¸ºäº†è·å¾—è¿™äº›#<strong>fileå’Œ#line</strong>é»˜è®¤å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰åˆå§‹åŒ–å™¨ã€‚</p>
<pre><code class="language-swift">init(
  _ action: Action,
  _ update: @escaping (inout Value) -&gt; Void,
  file: StaticString = #file,
  line: UInt = #line
) {
  self.action = action
  self.update = update
  self.file = file
  self.line = line
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬åªéœ€è¦æ›´æ–°<strong>assert</strong>æ¥ä½¿ç”¨<strong>Step</strong>è€Œä¸æ˜¯<strong>tuple</strong>ã€‚</p>
<pre><code class="language-swift">func assert&lt;Value: Equatable, Action&gt;(
  initialValue: Value,
  reducer: Reducer&lt;Value, Action&gt;,
  steps: Step&lt;Value, Action&gt;...,
  file: StaticString = #file,
  line: UInt = #line
) {
</code></pre>
<p>è¦ç¼–è¯‘å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ–­è¨€çš„æ¯ä¸€æ­¥å‰é¢åŠ ä¸Šä¸€ä¸ªå¤§å†™çš„<strong>Step</strong>ï¼Œå¹¶åˆ é™¤å°¾éšçš„#<strong>fileå’Œ#lines</strong>ã€‚</p>
<pre><code class="language-swift">steps:
Step(.counter(.incrTapped), { $0.count = 2 }),
Step(.counter(.incrTapped), { $0.count = 4 }),
Step(.counter(.decrTapped), { $0.count = 5 })
</code></pre>
<p>å¥½äº†ã€‚ä¸€åˆ‡éƒ½æ„å»ºå¥½äº†ï¼Œå½“æˆ‘ä»¬è¿è¡Œæµ‹è¯•æ—¶ï¼Œå¤±è´¥ä»ç„¶åœ¨é€‚å½“çš„è¡Œä¸Šé«˜äº®æ˜¾ç¤ºã€‚</p>
<pre><code class="language-swift">Step(.counter(.incrTapped), { $0.count = 2 }), // âŒ
Step(.counter(.incrTapped), { $0.count = 4 }),
Step(.counter(.decrTapped), { $0.count = 5 })  // âŒ
</code></pre>
<p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†å¯¹å¤±è´¥çš„è‡ªåŠ¨åé¦ˆï¼Œè®©æˆ‘ä»¬å†æ¬¡è®©äº‹æƒ…é€šè¿‡ã€‚</p>
<pre><code class="language-swift">Step(.counter(.incrTapped), { $0.count = 3 }),
Step(.counter(.incrTapped), { $0.count = 4 }),
Step(.counter(.decrTapped), { $0.count = 3 })
</code></pre>
<blockquote>
<p>âœ… Executed 1 test, with 0 failures (0 unexpected)</p>
</blockquote>
<p>ä¸€åˆ‡éƒ½è¿˜åœ¨è¿è½¬ã€‚</p>
<h2 id="trailing-closure-ergonomics">Trailing closure ergonomics</h2>
<p>å› ä¸ºæˆ‘ä»¬å·²ç»ä½¿ç”¨æ­£ç¡®çš„ç»“æ„ä½“å’Œåˆå§‹åŒ–å™¨å‡çº§äº†å…ƒç»„<strong>step</strong>ï¼Œæ‰€ä»¥æœ€å¥½åˆ©ç”¨å°¾éšé—­åŒ…è¯­æ³•ã€‚</p>
<pre><code class="language-swift">Step(.counter(.incrTapped)) { $0.count = 3 }, // ğŸ›‘
Step(.counter(.incrTapped)) { $0.count = 4 },
Step(.counter(.decrTapped)) { $0.count = 5 }
</code></pre>
<blockquote>
<p>ğŸ›‘ Generic parameter â€˜Valueâ€™ could not be inferred</p>
</blockquote>
<p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™è¡Œä¸é€šã€‚è¿™ä¸ªé”™è¯¯æ¶ˆæ¯å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ï¼Œä½†å®ƒä¸èƒ½ç¼–è¯‘çš„åŸå› æ˜¯ï¼Œå°¾éšé—­åŒ…è¯­æ³•åªå¯¹å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æœ‰æ•ˆï¼Œå³ä½¿åé¢çš„å‚æ•°æœ‰é»˜è®¤å€¼ï¼Œå› æ­¤å¯ä»¥çœç•¥ã€‚</p>
<pre><code class="language-swift">_ action: Action,
_ update: @escaping (inout Value) -&gt; Void,
file: StaticString = #file,
line: UInt = #line
</code></pre>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°†<strong>update</strong>ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ„å»ºå°±å¾ˆå¥½äº†ã€‚</p>
<pre><code class="language-swift">_ action: Action,
file: StaticString = #file,
line: UInt = #line,
_ update: @escaping (inout Value) -&gt; Void
</code></pre>
<h2 id="actions-sent-and-actions-received">Actions sent and actions received</h2>
<p>æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ç§å¾ˆå¥½çš„ã€è½»é‡çº§çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼Œç”¨äºæè¿°åœ¨æ˜¾å¼å‘é€ç»™<strong>reducer</strong>çš„æ“ä½œè¿‡ç¨‹ä¸­å¯¹å…¶çŠ¶æ€çš„ç²’çŠ¶å˜åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰é‡æ–°æ•è·æµ‹è¯•<strong>effect</strong>çš„å·¥ä½œã€‚æœ‰ä¸¤ç§ä¸»è¦çš„æ–¹å¼å°†åŠ¨ä½œåé¦ˆç»™storeçš„<strong>reducer</strong>:</p>
<ul>
<li>
<p>å®ƒä»¬é€šè¿‡ç”¨æˆ·<strong>action</strong>æˆ–</p>
</li>
<li>
<p>å®ƒä»¬é€šè¿‡<strong>effect</strong>çš„ç»“æœåé¦ˆåˆ°ç³»ç»Ÿä¸­ã€‚</p>
</li>
</ul>
<p>è¿™å¬èµ·æ¥åƒæ˜¯æˆ‘ä»¬åº”è¯¥åœ¨æˆ‘ä»¬çš„é¢†åŸŸç‰¹å®šè¯­è¨€ä¸­åˆ†ç¦»è¿™äº›æƒ³æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æœ‰ä¸€ä¸ªè„šæœ¬ï¼Œå£°æ˜ç”¨æˆ·åšäº†ä»€ä¹ˆåŠ¨ä½œï¼Œä»¥åŠæˆ‘ä»¬å¸Œæœ›å°†ä»€ä¹ˆåŠ¨ä½œåé¦ˆç»™ç³»ç»Ÿã€‚</p>
<p>è®©æˆ‘ä»¬å°è¯•ç”¨<strong>assert helper</strong>æ¥æè¿°ç¬¬nä¸ªè´¨æ•°æµã€‚å®ƒçœ‹èµ·æ¥åƒè¿™æ ·:</p>
<pre><code class="language-swift">Current.nthPrime = { _ in .sync { 17 } }

assert(
  initialValue: CounterViewState(
    alertNthPrime: nil,
    isNthPrimeButtonDisabled: false
  ),
  reducer: counterViewReducer,
  steps:
  Step(.counter(.nthPrimeButtonTapped)) {
    $0.isNthPrimeButtonDisabled = true
  },
  Step(.counter(.nthPrimeResponse(17))) {
    $0.alertNthPrime = PrimeAlert(prime: 17)
    $0.isNthPrimeButtonDisabled = false
  },
  Step(.counter(.alertDismissButtonTapped)) {
    $0.alertNthPrime = nil
  }
)
</code></pre>
<p>è¿™çœ‹èµ·æ¥å¾ˆå¥½ï¼Œä¹Ÿå¾ˆç®€æ´! å¦‚æœæˆ‘ä»¬è¿è¡Œå®ƒï¼Œå®ƒç”šè‡³ä¼šé€šè¿‡! ä½†ä¸å¹¸çš„æ˜¯ï¼Œå®ƒå°†æˆ‘ä»¬å¸¦å›åˆ°ä¸€ä¸ªä¸–ç•Œï¼Œåœ¨é‚£é‡Œï¼Œæˆ‘ä»¬æè¿°çš„æ˜¯æˆ‘ä»¬æœŸæœ›äº§ç”Ÿ<strong>effect</strong>çš„è¡Œä¸ºï¼Œæ–­è¨€å¹¶ä¸èƒ½ç¡®ä¿æˆ‘ä»¬å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™äº›æ­¥éª¤å°†è®°å½•å“ªäº›æ“ä½œåº”è¯¥å‘é€åˆ°<strong>store</strong>ï¼Œå“ªäº›æ“ä½œåº”è¯¥ç”±<strong>effect</strong>æ¥æ”¶ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨<strong>Step</strong>ä¸­å¼•å…¥ä¸€ä¸ªæ–°çš„å­—æ®µæ¥åŒºåˆ†è¿™ç§åŒºåˆ«ï¼Œè¯¥å­—æ®µæè¿°äº†<strong>Step</strong>çš„ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>enum</strong>æ¥æè¿°æ¯ç§æƒ…å†µ:ä¸€ç§æƒ…å†µæ˜¯æˆ‘ä»¬æƒ³é€šè¿‡<strong>reducer</strong>å‘é€ä¸€ä¸ªåŠ¨ä½œï¼Œå¦ä¸€ç§æƒ…å†µæ˜¯æˆ‘ä»¬å¸Œæœ›ä»<strong>effect</strong>æ¥æ”¶ä¸€ä¸ªåŠ¨ä½œã€‚</p>
<pre><code class="language-swift">enum StepType {
  case send
  case receive
}
</code></pre>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥ç›¸åº”åœ°æ›´æ–°<strong>Step</strong>ã€‚</p>
<pre><code class="language-swift">let type: StepType

init(
  _ type: StepType,
  _ action: Action,
  file: StaticString = #file,
  line: UInt = #line,
  _ update: @escaping (inout Value) -&gt; Void
) {
  self.type = type
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›æ–°ä¿¡æ¯æ¥æ›´æ–°æˆ‘ä»¬çš„æµ‹è¯•ã€‚é¦–å…ˆï¼Œ<strong>testIncrButtonTapped</strong>é€šè¿‡æ˜¾å¼<strong>sends</strong>å¾—åˆ°æ›´æ–°:</p>
<pre><code class="language-swift">assert(
  initialValue: CounterViewState(count: 2),
  reducer: counterViewReducer,
  steps:
  Step(.send, .counter(.incrTapped)) { $0.count = 3 },
  Step(.send, .counter(.incrTapped)) { $0.count = 4 },
  Step(.send, .counter(.decrTapped)) { $0.count = 3 }
)
</code></pre>
<p>æ¥ä¸‹æ¥,<strong>testNthPrimeHappyFlow</strong>:</p>
<pre><code class="language-swift">assert(
  initialValue: CounterViewState(
    alertNthPrime: nil,
    isNthPrimeButtonDisabled: false
  ),
  reducer: counterViewReducer,
  steps:
  Step(.send, .counter(.nthPrimeButtonTapped)) {
    $0.isNthPrimeButtonDisabled = true
  },
  Step(.receive, .counter(.nthPrimeResponse(17))) {
    $0.alertNthPrime = PrimeAlert(prime: 17)
    $0.isNthPrimeButtonDisabled = false
  },
  Step(.send, .counter(.alertDismissButtonTapped)) {
    $0.alertNthPrime = nil
  }
)
</code></pre>
<p>è¿™å¼€å§‹å˜å¾—éå¸¸å¥½è¯»ï¼Œä½†æ˜¯å½“ç„¶ï¼Œ<strong>assert helper</strong>æ²¡æœ‰ä½¿ç”¨ä»»ä½•è¿™äº›ä¿¡æ¯ã€‚</p>
<p>å¦‚ä½•ä½¿ç”¨æ­¥éª¤ç±»å‹çš„æ€»ä½“æ€æƒ³æ˜¯ï¼Œå½“ä¸€ä¸ªæ­¥éª¤è¯´è¦å‘é€ä¸€ä¸ªåŠ¨ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åƒå¹³å¸¸ä¸€æ ·è°ƒç”¨<strong>reducer</strong>ï¼Œä½†æˆ‘ä»¬ä¹Ÿä¼šè·Ÿè¸ªå®ƒæ‰€äº§ç”Ÿçš„<strong>effects</strong>ã€‚ ç„¶åï¼Œå½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªæ­¥éª¤ï¼Œè¯´æˆ‘ä»¬æ­£åœ¨æ¥æ”¶ä¸€ä¸ªåŠ¨ä½œæ—¶ï¼Œæˆ‘ä»¬å°†ä»æˆ‘ä»¬æ­£åœ¨è·Ÿè¸ªçš„æ•°ç»„ä¸­å–å‡ºç¬¬ä¸€ä¸ªæ•ˆæœï¼Œè¿è¡Œå®ƒï¼Œå¹¶éªŒè¯å®ƒäº§ç”Ÿçš„åŠ¨ä½œå°±æ˜¯æ­¥éª¤ä¸­çš„åŠ¨ä½œã€‚</p>
<p>ä¸ºäº†å¤„ç†<strong>step</strong>ç±»å‹ï¼Œå¾ˆè‡ªç„¶åœ°è¦<strong>switch over</strong>å®ƒã€‚</p>
<pre><code class="language-swift">switch step.type {
case .send:
case .receive:
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å°†æ˜¾å¼è°ƒç”¨<strong>reducer</strong>çš„å·¥ä½œè½¬ç§»åˆ°<strong>send</strong>åˆ†æ”¯ï¼Œå‘é€åˆ†æ”¯å‘Šè¯‰æˆ‘ä»¬æ˜¾å¼å‘é€åŠ¨ä½œã€‚</p>
<pre><code class="language-swift">switch step.type {
case .send:
  _ = reducer(&amp;state, step.action)
case .receive:
  &lt;#code#&gt;
}
</code></pre>
<p>æˆ‘ä»¬ç›®å‰å¿½ç•¥äº†<strong>reducer</strong>è¿”å›çš„<strong>effects</strong>ã€‚ä¸ºäº†è·Ÿè¸ªå®ƒä»¬ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡åœ¨è°ƒç”¨<strong>reducer</strong>æ—¶å°±ä¼šè¢«è®¾ç½®ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦åœ¨<strong>forEach</strong>ä¹‹å¤–æ‰§è¡Œæ­¤æ“ä½œï¼Œä»¥ä¾¿æ¯ä¸ªæ­¥éª¤éƒ½èƒ½è®¿é—®å‰ä¸€æ­¥äº§ç”Ÿçš„<strong>effects</strong>ã€‚</p>
<pre><code class="language-swift">var effects: [Effect&lt;Action&gt;] = []
steps.forEach { step in
</code></pre>
<p>åœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å°†<strong>reducer</strong>è¿”å›çš„ä»»ä½•<strong>effects</strong>æ·»åŠ åˆ°æ•°ç»„ä¸­ã€‚</p>
<pre><code class="language-swift">effects.append(contentsOf: reducer(&amp;state, step.action))
</code></pre>
<p>å¥½å§ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å¤„ç†åœ¨è¿™ä¸ªæ•°ç»„ä¸­ç´¯ç§¯çš„ä»»ä½•<strong>effects</strong>ï¼Œå½“æˆ‘ä»¬æœŸæœ›æ¥æ”¶å®ƒä»¬æ—¶ã€‚åœ¨æ¥æ”¶åˆ†æ”¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»æ•°ç»„ä¸­å–å‡ºç¬¬ä¸€ä¸ª<strong>effect</strong>å¼€å§‹ã€‚</p>
<pre><code class="language-swift">case .receive:
  let effect = effects.removeFirst()
}
</code></pre>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥å¼•å…¥<strong>expectation dance</strong>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿è¡Œæˆ‘ä»¬çš„<strong>effects</strong>æ¥å®Œæˆå¹¶æå–é¢„æœŸçš„åŠ¨ä½œã€‚é¦–å…ˆä¸º<strong>effect</strong>è¿”å›çš„æ“ä½œå¼•å…¥ä¸€ä¸ªéšå¼æœªåŒ…è£…çš„å¯é€‰æ“ä½œå’Œä¸€ä¸ªæµ‹è¯•æœŸæœ›ã€‚</p>
<pre><code class="language-swift">var action: Action!
let receivedCompletion = self.expectation(description: &quot;receivedCompletion&quot;) // ğŸ›‘
</code></pre>
<blockquote>
<p>ğŸ›‘ Use of unresolved identifier â€˜selfâ€™</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨ä¸€ä¸ªè‡ªç”±å‡½æ•°ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ä¸€ä¸ª<strong>XCTestCase</strong>ä¸­ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨<strong>expectation</strong>æ–¹æ³•ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒçš„åˆå§‹åŒ–å™¨æ‰‹åŠ¨æ„é€ ä¸€ä¸ªã€‚</p>
<pre><code class="language-swift">let receivedCompletion = XCTestExpectation(description: &quot;receivedCompletion&quot;)
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<strong>sink</strong>è¿è¡Œ<strong>effect</strong>ï¼Œåœ¨å®Œæˆæ—¶æ»¡è¶³é¢„æœŸï¼Œå¹¶åœ¨æ¥æ”¶åˆ°åŠ¨ä½œæ—¶åˆ†é…æ“ä½œã€‚</p>
<pre><code class="language-swift">effect.sink(
  receiveCompletion: { _ in receivedCompletion.fulfill() },
  receiveValue: { action = $0 }
)
</code></pre>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ç­‰å¾…è¿™ä¸ª<strong>expectation</strong>ã€‚æˆ‘ä»¬æ— æ³•è®¿é—®<strong>XCTestCase</strong>ä¸Šçš„<strong>wait</strong>æ–¹æ³•ï¼Œä½†åœ¨<strong>XCTWaiter</strong>ç±»ä¸Šæœ‰ä¸€ä¸ªç±»ä¼¼çš„é™æ€å‡½æ•°ã€‚</p>
<pre><code class="language-swift">XCTWaiter.wait(for: [receivedCompletion], timeout: 0.01)
</code></pre>
<blockquote>
<p>âš ï¸ Result of call to â€˜wait(for:timeout:)â€™ is unused</p>
</blockquote>
<p>è™½ç„¶<strong>XCTestCase</strong>ä¸Šçš„<strong>wait</strong>æ–¹æ³•ä¼šå¯¼è‡´æµ‹è¯•å¤±è´¥ï¼Œä½†è¿™ä¸ªé™æ€å‡½æ•°åªè¿”å›ä¸€ä¸ª<strong>XCTWaiter.Result</strong>ï¼Œå…¶ä¸­æœ‰å‡ ä¸ª<strong>cases</strong>æè¿°ç­‰å¾…æœŸæœ›çš„å„ç§ç»“æœã€‚å¦‚æœ<strong>expectation</strong>æ²¡æœ‰å®ç°å’Œå®Œå…¨ï¼Œæˆ‘ä»¬å°±ä¼šå¤±è´¥:</p>
<pre><code class="language-swift">if XCTWaiter.wait(for: [receivedCompletion], timeout: 0.01) != .completed {
  XCTFail(
    &quot;Timed out waiting for the effect to complete&quot;,
    file: step.file,
    line: step.line
  )
} else {
</code></pre>
<p>å¦åˆ™ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†åŠ¨ä½œï¼Œæˆ‘ä»¬åº”è¯¥æ£€æŸ¥å®ƒæ˜¯å¦ä¸æˆ‘ä»¬é¢„æœŸçš„ç›¸åŒï¼Œå› æ­¤è®©æˆ‘ä»¬å¿«é€Ÿç¼–å†™ä¸€ä¸ªæ–­è¨€ã€‚</p>
<pre><code class="language-swift">XCTAssertEqual(action, step.action, file: step.file, line: step.line)
</code></pre>
<blockquote>
<p>ğŸ›‘ Global function â€˜XCTAssertEqual(::_:file:line:)â€™ requires that â€˜Actionâ€™ conform to â€˜Equatableâ€™</p>
</blockquote>
<p>è¿™æ„å‘³ç€æˆ‘ä»¬è¿˜å¿…é¡»æ›´æ–°<strong>assert</strong>æ¥é™åˆ¶<strong>Action</strong>æ˜¯<strong>equatable</strong>ã€‚</p>
<pre><code class="language-swift">func assert&lt;Value: Equatable, Action: Equatable&gt;(
</code></pre>
<p>æœ€åï¼Œæˆ‘ä»¬æƒ³å†æ¬¡è¿è¡Œ<strong>reducer</strong>ä¸æå–çš„åŠ¨ä½œã€‚</p>
<pre><code class="language-swift">reducer(&amp;state, action)
</code></pre>
<p>æˆ‘ä»¬æƒ³æŠŠå®ƒä»¬è¿”å›çš„<strong>effects</strong>é™„åŠ åˆ°æˆ‘ä»¬å¤„ç†çš„æ•°ç»„ä¸­ã€‚</p>
<pre><code class="language-swift">effects.append(contentsOf: reducer(&amp;value, action))
</code></pre>
<p>å¥½å§ï¼Œè¿™æ˜¯å¤§é‡çš„å·¥ä½œ! ä½†è¿™åŸºæœ¬ä¸Šæ˜¯æˆ‘ä»¬ä¹‹å‰æ‰‹å·¥åšçš„å·¥ä½œã€‚ç°åœ¨æˆ‘ä»¬åªéœ€åšä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨é‡å¤ï¼Œä¸€éåˆä¸€éã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼Œå®ƒè¿˜æ˜¯é€šè¿‡äº†! ä½†å®ƒå¹¶æ²¡æœ‰æ¯”ä¹‹å‰æ–­è¨€çš„æ›´å¤šã€‚ä»¥å‰ï¼Œå½“æˆ‘ä»¬æ–­è¨€æˆ‘ä»¬<strong>received</strong>äº†ä¸€ä¸ªåŠ¨ä½œæ—¶ï¼Œ<strong>helper</strong>åªæ˜¯ç›¸ä¿¡äº†æˆ‘ä»¬çš„è¯ã€‚ç°åœ¨ï¼Œ<strong>helper</strong>å®é™…ä¸Šè¿è¡Œè¿™äº›<strong>effects</strong>ï¼Œå¹¶åœ¨æ¥æ”¶åŠ¨ä½œä¹‹å‰å¯¹å…¶è¿›è¡Œæ–­è¨€ã€‚</p>
<p>ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬ç»ƒä¹ ä¸€ä¸‹<strong>helper</strong>ï¼Œä»¥ç¡®ä¿å®ƒæ­£åœ¨æµ‹è¯•ä¸€äº›çœŸå®çš„ä¸œè¥¿ã€‚ä¾‹å¦‚ï¼Œåœ¨æ­£ç¡®å¤„ç†<strong>assert helper</strong>ä¸­çš„<strong>effects</strong>ä¹‹å‰ï¼Œä¸‹é¢çš„æµ‹è¯•åº”è¯¥å·²ç»é€šè¿‡äº†:</p>
<pre><code class="language-swift">Current.nthPrime = { _ in .sync { 17 } }

assert(
  initialValue: CounterViewState(
    alertNthPrime: nil,
    isNthPrimeButtonDisabled: false
  ),
  reducer: counterViewReducer,
  steps:
  Step(.send, .counter(.nthPrimeButtonTapped)) {
    $0.isNthPrimeButtonDisabled = true
  },
  Step(.receive, .counter(.nthPrimeResponse(15))) {
    $0.alertNthPrime = PrimeAlert(prime: 15)
    $0.isNthPrimeButtonDisabled = false
  },
  Step(.send, .counter(.alertDismissButtonTapped)) {
    $0.alertNthPrime = nil
  }
)
</code></pre>
<p>è¿™æ˜¯å› ä¸ºè¿™ä¸ª<strong>effect</strong>å®é™…ä¸Šå¹¶æ²¡æœ‰è¿è¡Œï¼Œå®ƒä¸Current.nthPrimeæ˜¯ä»€ä¹ˆæ— å…³ã€‚å› ä¸ºæˆ‘ä»¬æ­£åœ¨æ‰‹åŠ¨é‡æ”¾æˆ‘ä»¬æ‰€æœŸæœ›çš„<strong>effects</strong>ï¼Œå¦‚æœå®ƒè¿è¡Œçš„è¯ã€‚ç„¶è€Œï¼Œç°åœ¨<strong>assert</strong>å®é™…ä¸Šæ­£åœ¨è¿è¡Œ<strong>effect</strong>ï¼Œå®é™…ä¸Šæ­£åœ¨ä½¿ç”¨<strong>Current.nthPrime effect</strong>ï¼Œè¿™ä¸ªæµ‹è¯•åº”è¯¥å¤±è´¥ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¾—åˆ°ä¸¤ä¸ªå¤±è´¥:</p>
<blockquote>
<p>âŒ XCTAssertEqual failed: (â€œCounterViewState(alertNthPrime: Optional(Counter.PrimeAlert(prime: 17)), count: 0, favoritePrimes: [], isNthPrimeButtonDisabled: false)â€) is not equal to (â€œCounterViewState(alertNthPrime: Optional(Counter.PrimeAlert(prime: 15)), count: 0, favoritePrimes: [], isNthPrimeButtonDisabled: false)â€) âŒ XCTAssertEqual failed: (â€œOptional(Counter.CounterViewAction.counter(Counter.CounterAction.nthPrimeResponse(Optional(17))))â€) is not equal to (â€œOptional(Counter.CounterViewAction.counter(Counter.CounterAction.nthPrimeResponse(Optional(15))))â€)</p>
</blockquote>
<p>ç¬¬ä¸€ä¸ªå¤±è´¥æ˜¯ç”±äº<strong>state</strong>å¹¶æ²¡æœ‰æŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„æ–¹å¼æ”¹å˜ã€‚å…¶æ¬¡æ˜¯ç”±äº<strong>action</strong>ä¸åŒ¹é…çš„äº‹å®ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯¹<strong>assert</strong>å‡½æ•°çš„æ›´æ–°è®©æˆ‘ä»¬èƒ½å¤Ÿæ•è·çœŸå®çš„<strong>effect</strong>è¡Œä¸ºã€‚å½“æˆ‘ä»¬æ–­è¨€ä¸€ä¸ª<strong>action</strong>è¢«å‘é€æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…æ–­è¨€çŠ¶æ€æ˜¯å¦‚ä½•æ”¹å˜çš„ï¼Œè€Œä¸”æˆ‘ä»¬è¿˜ç´¯ç§¯ä»å‡é€Ÿæœºè¿”å›çš„æ‰€æœ‰<strong>effects</strong>ã€‚ç„¶å,å½“æˆ‘ä»¬æ”¶åˆ°æ–­è¨€,ä¸€ä¸ª<strong>action</strong>,æˆ‘ä»¬ç¬¬ä¸€ä¸ª<strong>effect</strong>ä»æ•°ç»„,è¿è¡Œå®ƒ,å¹¶æ–­è¨€è¡ŒåŠ¨æˆ‘ä»¬å°†æ”¶åˆ°åŒ¹é…çš„å®é™…è¡ŒåŠ¨é‡Šæ”¾çš„<strong>effect</strong>,æˆ‘ä»¬å°†è¿™ä¸ª<strong>action</strong>åé¦ˆç»™<strong>reducer</strong>ä»¥ç¡®ä¿å®ƒä»¥æˆ‘ä»¬è®¤ä¸ºå®ƒåº”è¯¥çš„æ–¹å¼æ”¹å˜çŠ¶æ€ã€‚</p>
<h2 id="assertion-edge-cases">Assertion edge cases</h2>
<p>ä½†äº‹æƒ…è¿˜ä¸å¤ªå¯¹åŠ²ã€‚æœ‰å¾ˆå¤š<strong>assert</strong>ä¸ä¼šæ•æ‰åˆ°çš„è¾¹ç•Œæƒ…å†µï¼Œæ‰€ä»¥è®©æˆ‘ä»¬é€ä¸ªç ”ç©¶å®ƒä»¬ã€‚</p>
<p>é¦–å…ˆï¼Œå¦‚æœæˆ‘ä»¬æ³¨é‡Šæ‰ä¸­é—´æ­¥éª¤ï¼Œæˆ‘ä»¬æœŸæœ›ä»ä¸€ä¸ª<strong>effect</strong>ä¸­æ¥æ”¶ä¸€ä¸ª<strong>action</strong>:</p>
<pre><code class="language-swift">assert(
      initialValue: CounterViewState(
        alertNthPrime: nil,
        isNthPrimeButtonDisabled: false
      ),
      reducer: counterViewReducer,
      steps:
      Step(.send, .counter(.nthPrimeButtonTapped)) {
        $0.isNthPrimeButtonDisabled = true
      },
//          Step(.receive, .counter(.nthPrimeResponse(17))) {
//            $0.alertNthPrime = PrimeAlert(prime: 17)
//            $0.isNthPrimeButtonDisabled = false
//          },
      Step(.send, .counter(.alertDismissButtonTapped)) {
        $0.alertNthPrime = nil
      }
    )
</code></pre>
<p>æµ‹è¯•ä»ç„¶é€šè¿‡ï¼Œå³ä½¿æœ‰ä¸€ä¸ª<strong>effect</strong>åº”è¯¥è¢«æ‰§è¡Œã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åªåœ¨æ˜ç¡®æœŸæœ›æ¥æ”¶<strong>action</strong>æ—¶æ‰è€ƒè™‘<strong>effects</strong>ã€‚<br>
å³ä½¿æˆ‘ä»¬æ²¡æœ‰è€ƒè™‘åˆ°ä¸€äº›æ‚¬è€Œæœªå†³çš„<strong>effects</strong>ï¼Œ<strong>assert</strong>çš„<strong>send</strong>åˆ†æ”¯ä¹Ÿå°†æ„‰å¿«åœ°ç»§ç»­å‰è¿›ã€‚</p>
<pre><code class="language-swift">case .send:
  effects.append(contentsOf: reducer(&amp;value, step.action))
</code></pre>
<p>æˆ‘ä»¬è¦åšçš„æ˜¯ç¡®ä¿åœ¨ä¸ºä¸€ä¸ªå·²å‘é€çš„<strong>action</strong>è¿è¡Œ<strong>reducer</strong>ä¹‹å‰æ²¡æœ‰æ‚¬è€Œæœªå†³çš„<strong>effects</strong>ã€‚</p>
<pre><code class="language-swift">case .send:
  if !effects.isEmpty {
    XCTFail(
      &quot;Action sent before handling \(effects.count) pending effect(s)&quot;,
      file: step.file,
      line: step.line
    )
  }
  effects.append(contentsOf: reducer(&amp;value, step.action))
</code></pre>
<p>å½“æˆ‘ä»¬é‡æ–°è¿è¡Œæµ‹è¯•æ—¶ï¼Œå®ƒå¤±è´¥äº†:</p>
<pre><code class="language-swift">//      Step(.receive, .counter(.nthPrimeResponse(17))) {
//        $0.alertNthPrime = PrimeAlert(prime: 17)
//        $0.isNthPrimeButtonDisabled = false
//      },
      Step(.send, .counter(.alertDismissButtonTapped)) { // âŒ
        $0.alertNthPrime = nil
      }
</code></pre>
<blockquote>
<p>âŒ failed - Action sent before handling 1 pending effect(s)</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ³¨é‡Šæ‰æœ€åä¸€æ­¥ï¼Œäº‹æƒ…å°±ç»§ç»­äº†:</p>
<pre><code class="language-swift">Step(.send, .counter(.nthPrimeButtonTapped)) {
        $0.isNthPrimeButtonDisabled = true
      }//,
//      Step(.receive, .counter(.nthPrimeResponse(17))) {
//        $0.alertNthPrime = PrimeAlert(prime: 17)
//        $0.isNthPrimeButtonDisabled = false
//      },
//      Step(.send, .counter(.alertDismissButtonTapped)) {
//        $0.alertNthPrime = nil
//      }
</code></pre>
<blockquote>
<p>âœ… Executed 1 test, with 0 failures (0 unexpected)</p>
</blockquote>
<p>è¿™ä¸å¤ªç†æƒ³ã€‚æ²¡æœ‰æµ‹è¯•<strong>nthprimerresponse</strong>æ“ä½œè¿”å›çš„<strong>effect</strong>ã€‚æˆ‘ä»¬æƒ³è¦çš„æ˜¯æˆ‘ä»¬çš„<strong>helper</strong>ä¸ºæˆ‘ä»¬æŠ“ä½è¿™äº›é”™è¯¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šå¿˜è®°æ–­è¨€ä¸€ä¸ª<strong>effect</strong>ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€ä¸ªæœ€åçš„æ–­è¨€ã€‚åœ¨å¾ªç¯éå†æ‰€æœ‰ç»™å®šçš„æ­¥éª¤ä¹‹åï¼Œå¦‚æœ<strong>effect</strong>æ•°ç»„åŒ…å«ä»»ä½•æŒ‚èµ·çš„<strong>effect</strong>ï¼Œåˆ™åº”è¯¥å¤±è´¥ã€‚</p>
<pre><code class="language-swift">if !effects.isEmpty {
  XCTFail(
    &quot;Assertion failed to handle \(effects.count) pending effect(s)&quot;,
    file: file,
    line: line
  )
}
</code></pre>
<p>æœ‰äº†è¿™ä¸ªæ·»åŠ ï¼Œæˆ‘ä»¬çš„æµ‹è¯•åˆå¤±è´¥äº†:</p>
<pre><code class="language-swift">assert( // âŒ
</code></pre>
<blockquote>
<p>âŒ failed - Assertion failed to handle 1 pending effect(s)</p>
</blockquote>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ–­è¨€æœŸæœ›åœ¨æ²¡æœ‰<strong>effect</strong>çš„æƒ…å†µä¸‹æ”¶åˆ°<strong>effect</strong>ï¼Œè¯¥æ€ä¹ˆåŠå‘¢? æˆ‘ä»¬å¯ä»¥æ³¨é‡Šæ‰ç¬¬ä¸€æ­¥ï¼Œç„¶åæ³¨é‡Šç¬¬äºŒæ­¥ï¼Œè¿™æ ·åš:</p>
<pre><code class="language-swift">steps:
//      Step(.send, .counter(.nthPrimeButtonTapped)) {
//        $0.isNthPrimeButtonDisabled = true
//      },
      Step(.receive, .counter(.nthPrimeResponse(17))) {
        $0.alertNthPrime = PrimeAlert(prime: 17)
        $0.isNthPrimeButtonDisabled = false
      },
      Step(.send, .counter(.alertDismissButtonTapped)) {
        $0.alertNthPrime = nil
      }
</code></pre>
<p>è¿™ä¸€æ¬¡ï¼Œå½“æˆ‘ä»¬è¿è¡Œæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬é‡åˆ°äº†å´©æºƒ!</p>
<pre><code class="language-swift">case .receive:
  let effect = effects.removeFirst() // ğŸ›‘
</code></pre>
<blockquote>
<p>ğŸ›‘ Fatal error: Canâ€™t remove first element from an empty collection</p>
</blockquote>
<p>å› ä¸ºæ•°ç»„ä¸Šçš„<strong>removeFirst</strong>æ–¹æ³•è¿”å›ä¸€ä¸ªéå¯é€‰å…ƒç´ ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰è¿™æ ·çš„å…ƒç´ å­˜åœ¨ï¼Œå®ƒå°±å¿…é¡»å´©æºƒã€‚è™½ç„¶æˆ‘ä»¬å¸Œæœ›æµ‹è¯•åœ¨é¢„æœŸæœ‰<strong>effect</strong>è€Œå®é™…æ²¡æœ‰<strong>effect</strong>æ—¶å¤±è´¥ï¼Œä½†æˆ‘ä»¬ä¸å¸Œæœ›ä½¿æ•´ä¸ªæµ‹è¯•å¥—ä»¶å´©æºƒã€‚</p>
<p>æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬ä¸»åŠ¨å¤±è´¥ï¼Œå½“æˆ‘ä»¬æœŸæœ›æœ‰æ•ˆæœï¼Œä½†å®é™…æ²¡æœ‰æ—¶ã€‚</p>
<pre><code class="language-swift">case .receive:
  guard !effects.isEmpty else {
    XCTFail(
      &quot;No pending effects to receive from&quot;,
      file: step.file,
      line: step.line
    )
    break
  }
</code></pre>
<p>ç°åœ¨ï¼Œæµ‹è¯•å¤±è´¥å¾—ç¨å¾®å¥½ä¸€äº›ã€‚</p>
<pre><code class="language-swift">steps:
//      Step(.send, .counter(.nthPrimeButtonTapped)) {
//        $0.isNthPrimeButtonDisabled = true
//      },
      Step(.receive, .counter(.nthPrimeResponse(17))) { // âŒ
        $0.alertNthPrime = PrimeAlert(prime: 17)
        $0.isNthPrimeButtonDisabled = false
      },
</code></pre>
<blockquote>
<p>âŒ failed - No pending effects to receive from</p>
</blockquote>
<p>è¿™åº”è¯¥æ¶µç›–äº†å¤§å¤šæ•°å¸¸è§çš„è¾¹æƒ…å†µã€‚æ‰€ä»¥è®©æˆ‘ä»¬æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½æ³¨é‡Šå›æ¥ï¼Œä»¥è·å¾—ä¸€ä¸ªåˆæ ¼çš„æµ‹è¯•:</p>
<pre><code class="language-swift">Step(.send, .counter(.nthPrimeButtonTapped)) {
  $0.isNthPrimeButtonDisabled = true
},
Step(.receive, .counter(.nthPrimeResponse(17))) {
  $0.alertNthPrime = PrimeAlert(prime: 17)
  $0.isNthPrimeButtonDisabled = false
},
Step(.send, .counter(.alertDismissButtonTapped)) {
  $0.alertNthPrime = nil
}
</code></pre>
<blockquote>
<p>âœ… Executed 1 test, with 0 failures (0 unexpected)</p>
</blockquote>
<h2 id="conclusion">Conclusion</h2>
<p>å¥½äº†ï¼Œ<strong>assert</strong>åŠ©æ‰‹çœ‹èµ·æ¥çœŸçš„å¾ˆå¥½ã€‚å®ƒè®©æˆ‘ä»¬å‡†å¤‡ä¸€äº›çŠ¶æ€æ¥ç”¨<strong>reducer</strong>è¿›è¡Œæµ‹è¯•ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ç”¨æˆ‘ä»¬é¢„æœŸçš„çªå˜å’Œé¢„æœŸçš„<strong>effect</strong>åé¦ˆç»™ç³»ç»Ÿçš„åŠ¨ä½œæ¥å¯¹å®ƒè¿›è¡Œæ–­è¨€ï¼Œå¹¶æä¾›å°½å¯èƒ½å¤šçš„åŠ¨ä½œã€‚æˆ‘ä»¬è¿˜å¯ä»¥åšä¸€äº›äº‹æƒ…æ¥å¢å¼ºè¿™ä¸ª<strong>helpers</strong>ï¼Œæ¯”å¦‚æ·»åŠ å¯¹â€œ<strong>fire-and-forget</strong>â€<strong>effect</strong>çš„æ”¯æŒï¼Œä½†å®ƒå·²ç»ä¸ºæˆ‘ä»¬åšäº†å¾ˆå¤šã€‚</p>
<p>è®©æˆ‘ä»¬æ¸…ç†ä¸€ä¸‹ï¼Œæ›´å¥½åœ°ã€æ›´å…¨é¢åœ°çœ‹å¾…æˆ‘ä»¬æ‰€å–å¾—çš„æˆå°±ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°†<strong>assert helper</strong>åŠå…¶ä¾èµ–é¡¹ç§»åŠ¨åˆ°å®ƒä»¬è‡ªå·±çš„æ–‡ä»¶ä¸­ã€‚ä¸è¿‡ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œå®ƒä»¬åº”è¯¥å­˜åœ¨äºè‡ªå·±çš„æµ‹è¯•<strong>helper</strong>æ¨¡å—ä¸­ï¼Œå¯ä»¥å¯¼å…¥åˆ°ä»»ä½•ä½¿ç”¨å¯ç»„åˆæ¶æ„çš„æµ‹è¯•ç›®æ ‡ä¸­ã€‚</p>
<pre><code class="language-swift">import ComposableArchitecture
import XCTest

enum StepType {
  case send
  case receive
}

struct Step&lt;Value, Action&gt; {
  let type: StepType
  let action: Action
  let update: (inout Value) -&gt; Void
  let file: StaticString
  let line: UInt

  init(
    _ type: StepType,
    _ action: Action,
    file: StaticString = #file,
    line: UInt = #line,
    _ update: @escaping (inout Value) -&gt; Void
  ) {
    self.type = type
    self.action = action
    self.update = update
    self.file = file
    self.line = line
  }
}

func assert&lt;Value: Equatable, Action: Equatable&gt;(
  initialValue: Value,
  reducer: Reducer&lt;Value, Action&gt;,
  steps: Step&lt;Value, Action&gt;...,
  file: StaticString = #file,
  line: UInt = #line
) {
  var state = initialValue
  var effects: [Effect&lt;Action&gt;] = []

  steps.forEach { step in
    var expected = state

    switch step.type {
    case .send:
      if !effects.isEmpty {
        XCTFail(&quot;Action sent before handling \(effects.count) pending effect(s)&quot;, file: step.file, line: step.line)
      }
      effects.append(contentsOf: reducer(&amp;state, step.action))

    case .receive:
      guard !effects.isEmpty else {
        XCTFail(&quot;No pending effects to receive from&quot;, file: step.file, line: step.line)
        break
      }
      let effect = effects.removeFirst()
      var action: Action!
      let receivedCompletion = XCTestExpectation(description: &quot;receivedCompletion&quot;)
      _ = effect.sink(
        receiveCompletion: { _ in
          receivedCompletion.fulfill()
      },
        receiveValue: { action = $0 }
      )
      if XCTWaiter.wait(for: [receivedCompletion], timeout: 0.01) != .completed {
        XCTFail(&quot;Timed out waiting for the effect to complete&quot;, file: step.file, line: step.line)
      }
      XCTAssertEqual(action, step.action, file: step.file, line: step.line)
      effects.append(contentsOf: reducer(&amp;state, action))
    }

    step.update(&amp;expected)
    XCTAssertEqual(state, expected, file: step.file, line: step.line)
  }
  if !effects.isEmpty {
    XCTFail(&quot;Assertion failed to handle \(effects.count) pending effect(s)&quot;, file: file, line: line)
  }
}
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ é™¤ä¸€äº›æ³¨é‡Šæ‰çš„å’Œè¿‡æ—¶çš„æµ‹è¯•ä»£ç æ¥æ¸…ç†è®¡æ•°å™¨æµ‹è¯•æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨æ–­è¨€åŠ©æ‰‹ï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰æ‰‹åŠ¨æµ‹è¯•ä½“ç³»ç»“æ„çš„åœ°æ–¹ã€‚</p>
<pre><code class="language-swift">import XCTest
@testable import Counter

class CounterTests: XCTestCase {
  override class func setUp() {
    super.setUp()
    Current = .mock
  }

  func testIncrDecrButtonTapped() {
    assert(
      initialValue: CounterViewState(count: 2),
      reducer: counterViewReducer,
      steps:
      Step(.send, .counter(.incrTapped)) { $0.count = 3 },
      Step(.send, .counter(.incrTapped)) { $0.count = 4 },
      Step(.send, .counter(.decrTapped)) { $0.count = 3 }
    )
  }

  func testNthPrimeButtonHappyFlow() {
    Current.nthPrime = { _ in .sync { 17 } }

    assert(
      initialValue: CounterViewState(
        alertNthPrime: nil,
        isNthPrimeButtonDisabled: false
      ),
      reducer: counterViewReducer,
      steps:
      Step(.send, .counter(.nthPrimeButtonTapped)) {
        $0.isNthPrimeButtonDisabled = true
      },
      Step(.receive, .counter(.nthPrimeResponse(17))) {
        $0.alertNthPrime = PrimeAlert(prime: 17)
        $0.isNthPrimeButtonDisabled = false
      },
      Step(.send, .counter(.alertDismissButtonTapped)) {
        $0.alertNthPrime = nil
      }
    )
  }

  func testNthPrimeButtonUnhappyFlow() {
    Current.nthPrime = { _ in .sync { nil } }

    assert(
      initialValue: CounterViewState(
        alertNthPrime: nil,
        isNthPrimeButtonDisabled: false
      ),
      reducer: counterViewReducer,
      steps:
      Step(.send, .counter(.nthPrimeButtonTapped)) {
        $0.isNthPrimeButtonDisabled = true
      },
      Step(.receive, .counter(.nthPrimeResponse(nil))) {
        $0.isNthPrimeButtonDisabled = false
      }
    )
  }

  func testPrimeModal() {
    assert(
      initialValue: CounterViewState(
        count: 2,
        favoritePrimes: [3, 5]
      ),
      reducer: counterViewReducer,
      steps:
      Step(.send, .primeModal(.saveFavoritePrimeTapped)) {
        $0.favoritePrimes = [3, 5, 2]
      },
      Step(.send, .primeModal(.removeFavoritePrimeTapped)) {
        $0.favoritePrimes = [3, 5]
      }
    )
  }
}
</code></pre>
<p>æ‰€æœ‰çš„æµ‹è¯•ä»ç„¶é€šè¿‡äº†ï¼Œä½†æ˜¯å®ƒä»¬ç°åœ¨éå¸¸ç®€æ´åœ°å‡†ç¡®åœ°æè¿°äº†ç”¨æˆ·æ‰€åšçš„äº‹æƒ…ä»¥åŠåé¦ˆç»™ç³»ç»Ÿçš„å½±å“ã€‚</p>
<p>ç°åœ¨æ•´ä¸ªæ–‡ä»¶åªæœ‰80è¡Œä»£ç ï¼Œè€Œä»¥å‰ï¼Œæˆ‘ä»¬æœ‰å‡ ä¸ª60è¡Œæµ‹è¯•ï¼Œä½¿æ•´ä¸ªæ–‡ä»¶çš„ä»£ç è¶…è¿‡200è¡Œã€‚åœ¨ä½¿ç”¨è¿™ä¸ª<strong>helper</strong>çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»éšè—äº†å¾ˆå¤šæ ·æ¿å’Œç—›è‹¦! è¿™ä½¿å¾—å†™ä½œå’Œé˜…è¯»æµ‹è¯•æˆä¸ºä¸€ç§æ„‰å¿«çš„ä½“éªŒã€‚</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/i-r9uoo_2N/" class="tag">
                    PointFree
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/pointfree-episode-83testable-state-management-effects/">
                  <h3 class="post-title">
                    PointFree Episode 83:Testable State Management: Effects
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
