<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Swiftä¸­ç±»å‹å®‰å…¨çš„UserDefaults | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1680320045148">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="



Swiftä¸­ç±»å‹å®‰å…¨çš„UserDefaults


1.1. Wrong key âš ï¸
1.2. Wrong type âš ï¸
1.3. Keys overlapping âš ï¸
1.4. A safer way
1.5. What i..." />
    <meta name="keywords" content="type safety,userdefaults" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1680320045148" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
       <a href="https://beian.miit.gov.cn/">è±«ICPå¤‡2021012281å·-1</a> | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Swiftä¸­ç±»å‹å®‰å…¨çš„UserDefaults</h2>
            <div class="post-date">2021-05-13</div>
            
            <div class="post-content" v-pre>
              <!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#SwiftUserDefaults">Swiftä¸­ç±»å‹å®‰å…¨çš„UserDefaults</a></li>
</ol>
<ul>
<li>1.1. <a href="#Wrongkey">Wrong key âš ï¸</a></li>
<li>1.2. <a href="#Wrongtype">Wrong type âš ï¸</a></li>
<li>1.3. <a href="#Keysoverlapping">Keys overlapping âš ï¸</a></li>
<li>1.4. <a href="#Asaferway">A safer way</a></li>
<li>1.5. <a href="#Whatisfunction">What is #function?</a></li>
<li>1.6. <a href="#Test">Test ğŸ”¨</a></li>
<li>1.7. <a href="#Conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<h2 id="1-a-nameswiftuserdefaultsaswiftä¸­ç±»å‹å®‰å…¨çš„userdefaults">1. <a name='SwiftUserDefaults'></a>Swiftä¸­ç±»å‹å®‰å…¨çš„UserDefaults</h2>
<p>ä½œä¸ºä¸€åiOSå¼€å‘è€…ï¼Œä½ å¯èƒ½æ€»æ˜¯ä½¿ç”¨UserDefaultsæ¥ä¿å­˜å’Œæ£€ç´¢æœ¬åœ°æ•°æ®ã€‚</p>
<pre><code class="language-swift">// This is how you save a value
UserDefaults.standard.set(&quot;123&quot;, forKey: &quot;userID&quot;)
// This is how you read it
let userID = UserDefaults.standard.string(forKey: &quot;userID&quot;)
</code></pre>
<p>ç„¶è€Œï¼Œåœ¨ä¸€ä¸ªå¤§é¡¹ç›®ä¸­ä¸UserDefaultsäº¤äº’æ˜¯æœ‰é£é™©çš„ï¼Œå¯èƒ½ä¼šå‘ç”Ÿä»¥ä¸‹é”™è¯¯:</p>
<ul>
<li>Wrong key</li>
<li>Wrong type</li>
<li>Keys overlapping(é‡å )</li>
</ul>
<h3 id="11-a-namewrongkeyawrong-key-ï¸">1.1. <a name='Wrongkey'></a>Wrong key âš ï¸</h3>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªé”®ä¿å­˜ä¸€ä¸ªå€¼ï¼Œç„¶åå°è¯•ç”¨å¦ä¸€ä¸ªé”®è¯»å–å®ƒã€‚</p>
<pre><code class="language-swift">UserDefaults.standard.set(&quot;123&quot;, forKey: &quot;userID&quot;)
...
let userID = UserDefaults.standard.string(forKey: &quot;UserID&quot;)
</code></pre>
<p>å› ä¸ºé”®æ˜¯å¤§å°å†™æ•æ„Ÿçš„**userIDä¸åŒäºuserID **ã€‚è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“é¿å…çš„é”™è¯¯ï¼Œä½†åœ¨ä¸€ä¸ªæœ‰å¾ˆå¤šé”®çš„å¤§é¡¹ç›®ä¸­ï¼Œè¿™æ˜¯å¯èƒ½å‘ç”Ÿçš„ã€‚</p>
<h3 id="12-a-namewrongtypeawrong-type-ï¸">1.2. <a name='Wrongtype'></a>Wrong type âš ï¸</h3>
<p>æ¯æ¬¡æˆ‘ä»¬ä¸UserDefaultsäº¤äº’æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è®°ä½æˆ‘ä»¬ä¿å­˜å’ŒåŠ è½½çš„å€¼çš„ç±»å‹ã€‚</p>
<p>ä¸‹é¢çš„ç¤ºä¾‹åŒ…å«ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬å°†userIDä¿å­˜ä¸ºStringï¼Œä½†éšåè¯•å›¾å°†å…¶æ£€ç´¢ä¸ºIntã€‚</p>
<pre><code class="language-swift">UserDefaults.standard.set(&quot;123&quot;, forKey: &quot;userID&quot;)
...
let userID = UserDefaults.standard.int(forKey: &quot;userID&quot;)
</code></pre>
<p>åŒæ ·ï¼Œè¿™ä¼¼ä¹å¾ˆå®¹æ˜“åœ¨ä»£ç ä¸­å‘ç°ï¼Œä½†åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œè¿™æ˜¯å¯èƒ½å‘ç”Ÿçš„ã€‚</p>
<h3 id="13-a-namekeysoverlappingakeys-overlapping-ï¸">1.3. <a name='Keysoverlapping'></a>Keys overlapping âš ï¸</h3>
<p>æˆ‘ä»¬å¯èƒ½ä¼šå¿˜è®°åœ¨é¡¹ç›®çš„å¦ä¸€éƒ¨åˆ†ä¸­ä¸ºæŸä¸ªå€¼ä½¿ç”¨äº†ä¸€ä¸ªç»™å®šçš„é”®ï¼Œè€Œå†³å®šä¸ºå¦ä¸€ä¸ªå€¼ä½¿ç”¨ç›¸åŒçš„é”®ã€‚</p>
<pre><code class="language-swift">let currentUserID = &quot;123&quot;
UserDefaults.standard.set(currentUserID, forKey: &quot;userID&quot;)
// and then in another file of our project ğŸ‘‡
let messageRecipientUserID = &quot;456&quot;
UserDefaults.standard.set(messageRecipientUserID, forKey: &quot;userID&quot;)
</code></pre>
<h3 id="14-a-nameasaferwayaa-safer-way">1.4. <a name='Asaferway'></a>A safer way</h3>
<p>æˆ‘ä»¬å¯ä»¥æ”¹è¿›UserDefaultsæ¥è§£å†³ä¸Šé¢è®¨è®ºçš„ä¸‰ä¸ªé—®é¢˜å—?</p>
<p>è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥ç”¨Computed Propertiesè§£å†³çš„é—®é¢˜ã€‚</p>
<blockquote>
<p><em>é™¤äº†å­˜å‚¨å±æ€§ä¹‹å¤–ï¼Œç±»ã€ç»“æ„å’Œæšä¸¾è¿˜å¯ä»¥å®šä¹‰è®¡ç®—å±æ€§ï¼Œè®¡ç®—å±æ€§å®é™…ä¸Šå¹¶ä¸å­˜å‚¨å€¼ã€‚ç›¸åï¼Œå®ƒä»¬æä¾›äº†ä¸€ä¸ªgetterå’Œä¸€ä¸ªå¯é€‰setteræ¥é—´æ¥åœ°æ£€ç´¢å’Œè®¾ç½®å…¶ä»–å±æ€§å’Œå€¼</em>. â€” The Swift Programming Language</p>
</blockquote>
<p>Letâ€™s add the following extension to our project</p>
<pre><code class="language-swift">extension UserDefaults {
    var userID: String? {
        get {
            return string(forKey: #function)
        }
        set {
            set(newValue, forKey: #function)
        }
    }
}
</code></pre>
<p>userIDè®¡ç®—å±æ€§ä¸ä¼šåœ¨UserDefaultsçš„å½“å‰å®ä¾‹ä¸­å­˜å‚¨ä»»ä½•å€¼ã€‚ç›¸åï¼Œå®ƒæä¾›äº†ä¸€ä¸ªgetter(ä»æœ¬åœ°å­˜å‚¨æ£€ç´¢å€¼)å’Œä¸€ä¸ªsetter(å°†å€¼å†™å…¥æœ¬åœ°å­˜å‚¨)ã€‚</p>
<h3 id="15-a-namewhatisfunctionawhat-is-function">1.5. <a name='Whatisfunction'></a>What is #function?</h3>
<p>It is a special keyword and is automatically replaced with the name of the function that contains it.</p>
<p>E.g., in our example, it is replaced with the String userID.</p>
<p>è¿™å°†ç¡®ä¿æˆ‘ä»¬ç”¨æ¥ä¿å­˜(å’Œæ£€ç´¢)UserDefaultså€¼çš„é”®æ˜¯æˆ‘ä»¬å®šä¹‰çš„å±æ€§çš„åç§°ã€‚</p>
<h3 id="16-a-nametestatest">1.6. <a name='Test'></a>Test ğŸ”¨</h3>
<p>Letâ€™s run a quick test</p>
<pre><code class="language-swift">UserDefaults.standard.userID = &quot;123&quot;
if let userID = UserDefaults.standard.userID {
    print(userID)
}
&gt; 123
</code></pre>
<p>Cool right? ğŸ‰</p>
<p>å¦‚æœæˆ‘ä»¬ä¸ºæ¯ä¸ªé”®/å€¼å®šä¹‰ä¸€ä¸ªè®¡ç®—å±æ€§ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…¶å­˜å‚¨åˆ°UserDefaultsä¸­ï¼Œé‚£ä¹ˆå°±è‡ªåŠ¨è§£å†³äº†ä¸Šé¢è®¨è®ºçš„ä¸‰ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>Wrong key: âœ… fixed ç¼–è¯‘å™¨ä¸å…è®¸æˆ‘ä»¬ä½¿ç”¨æœªå®šä¹‰çš„å±æ€§ã€‚</li>
<li>Wrong type: âœ…  fixed å› ä¸ºæ¯ä¸ªè®¡ç®—å±æ€§éƒ½æœ‰ä¸€ä¸ªç±»å‹ã€‚</li>
<li>Keys overlapping: âœ… fixed å› ä¸ºç°åœ¨é”®æ˜¯è®¡ç®—å±æ€§çš„åç§°ï¼ŒSwiftç¼–è¯‘å™¨å°†ç¡®ä¿UserDefaultsä¸­å®šä¹‰çš„æ¯ä¸ªå±æ€§éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li>
</ol>
<h3 id="17-a-nameconclusionaconclusion">1.7. <a name='Conclusion'></a>Conclusion</h3>
<p>è¿™ç§æ–¹æ³•è¿˜æœ‰æœ€åä¸€ä¸ªå¥½å¤„:å°è£…ã€‚æˆ‘ä»¬ç°åœ¨éšè—(åˆ°æˆ‘ä»¬çš„æ‰©å±•)ä¸€äº›å…³äºå¦‚ä½•ä¿å­˜å€¼çš„ç»†èŠ‚ã€‚ä»»ä½•è°ƒç”¨è€…éƒ½å¯ä»¥ç®€å•åœ°ä½¿ç”¨æ­¤å±æ€§ï¼Œè€Œä¸å¿…æ‹…å¿ƒåº•å±‚ç»†èŠ‚ã€‚</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/MOO0pS2XVp/" class="tag">
                    type safety
                  </a>
                
                  <a href="https://kayouyou.github.io/tag/OMzhOR1No/" class="tag">
                    userdefaults
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/property-wrappers-in-swift-explained-with-code-examples/">
                  <h3 class="post-title">
                    Property Wrappers in Swift explained with code examples
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
