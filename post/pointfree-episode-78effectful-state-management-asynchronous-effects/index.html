<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>PointFree Episode 78:Effectful State Management: Asynchronous Effects | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1645876346136">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="



Introduction




Local state to global state




The async signature




The async effect




Refactor-related bugs
..." />
    <meta name="keywords" content="PointFree" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1645876346136" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">PointFree Episode 78:Effectful State Management: Asynchronous Effects</h2>
            <div class="post-date">2021-11-20</div>
            
            <div class="post-content" v-pre>
              <!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#Introduction">Introduction</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="#Localstatetoglobalstate">Local state to global state</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#Theasyncsignature">The async signature</a></li>
</ol>
</li>
<li>
<ol start="4">
<li><a href="#Theasynceffect">The async effect</a></li>
</ol>
</li>
<li>
<ol start="5">
<li><a href="#Refactor-relatedbugs">Refactor-related bugs</a></li>
</ol>
</li>
<li>
<ol start="6">
<li><a href="#Thinkingunidirectionally">Thinking unidirectionally</a></li>
</ol>
</li>
<li>
<ol start="7">
<li><a href="#Whatsthepoint">Whatâ€™s the point?</a></li>
</ol>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<!-- # PointFree Episode 78:Effectful State Management: Asynchronous Effects -->
<h2 id="1-a-nameintroductionaintroduction">1. <a name='Introduction'></a>Introduction</h2>
<p>åˆæå–äº†ä¸€ä¸ª<strong>effect</strong>ã€‚è®©æˆ‘ä»¬å†èŠ±ä¸€ç‚¹æ—¶é—´æ¥å›é¡¾ä¸€ä¸‹æˆ‘ä»¬æ‰€å–å¾—çš„æˆå°±ã€‚</p>
<p>æˆ‘ä»¬æƒ³ä»æˆ‘ä»¬çš„è§†å›¾ä¸­æå–ç£ç›˜<strong>effect</strong>çš„åŠ è½½ï¼Œå¹¶ä»¥æŸç§æ–¹å¼åœ¨<strong>reducer</strong>ä¸­å»ºæ¨¡ã€‚æˆ‘ä»¬å¾ˆå¿«æ„è¯†åˆ°è¿™ç§<strong>effect</strong>ä¸æˆ‘ä»¬ä¹‹å‰å¤„ç†çš„<strong>effect</strong>ä¸å¤ªä¸€æ ·ã€‚ä¿å­˜çš„<strong>effect</strong>æœ¬è´¨ä¸Šæ˜¯â€œå°„åä¸ç†â€ï¼Œå®ƒåªæ˜¯å®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œä¹‹åä¸éœ€è¦é€šçŸ¥ä»»ä½•äººä»»ä½•äº‹æƒ…ã€‚</p>
<p>ç„¶è€Œï¼Œ<strong>loading effect</strong>éœ€è¦ä»¥æŸç§æ–¹å¼å°†åŠ è½½çš„æ•°æ®åé¦ˆåˆ°<strong>reducer</strong>ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿä½œå‡ºååº”ã€‚è¿™å¯¼è‡´æˆ‘ä»¬å°†ç­¾åä»ä¸€ä¸ªç©ºåˆ°ç©ºçš„é—­åŒ…é‡æ„ä¸ºä¸€ä¸ªç©ºåˆ°å¯é€‰çš„åŠ¨ä½œé—­åŒ…ã€‚è¿™å…è®¸<strong>effects</strong>åšæœ€å°‘çš„å¿…è¦å·¥ä½œæ¥å®Œæˆå·¥ä½œï¼Œç„¶åé€šè¿‡å‘é€å¦ä¸€ä¸ªåŠ¨ä½œå°†ç»“æœè¿”å›åˆ°<strong>reducer</strong>ã€‚ç„¶å<strong>store</strong>æˆä¸ºè¿™äº›<strong>effects</strong>çš„è§£é‡Šå™¨ï¼Œé¦–å…ˆè¿è¡Œ<strong>reducer</strong>ï¼Œæ”¶é›†æ‰€æœ‰æƒ³è¦æ‰§è¡Œçš„<strong>effects</strong>ï¼Œè¿­ä»£é‚£ä¸ªé”™è¯¯æ¥æ‰§è¡Œ<strong>effects</strong>ï¼Œ ç„¶åå°†äº§ç”Ÿçš„ä»»ä½•åŠ¨ä½œå‘é€å›<strong>store</strong>ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦å¤„ç†åº”ç”¨ç¨‹åºä¸­æœ€å¤æ‚çš„<strong>effect</strong>ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿæ”¯æŒçš„:ä¸€ä¸ªå°†å½“å‰è®¡æ•°å‘é€åˆ°<strong>Wolfram Alpha</strong>ä»¥å¯»æ‰¾ç¬¬nä¸ªç´ æ•°çš„ç½‘ç»œè¯·æ±‚ã€‚æˆ‘ä»¬å¦‚ä½•å°†è¿™ç§å½±å“è½¬ç§»åˆ°æˆ‘ä»¬çš„æ¶æ„ä¸­?</p>
<p>æˆ‘ä»¬ç°åœ¨å°†ä½¿ç”¨è®¡æ•°å™¨å±å¹•ï¼Œå®ƒç›®å‰æ‰§è¡Œæˆ‘ä»¬çš„å¼‚æ­¥å‰¯ä½œç”¨ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œè®¡æ•°å™¨æ¨¡å—ç°åœ¨è¿˜ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æ›´æ–°å®ƒæ¥æ”¯æŒæˆ‘ä»¬å¯¹æ¶æ„æ‰€åšçš„æ›´æ”¹ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ›´æ–°å®ƒï¼Œé€šè¿‡ç»™æ¯ä¸ª<strong>reducer</strong>å¼•å…¥<strong>effect</strong>æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä»<strong>counter reducer</strong>å¼€å§‹ï¼Œæ›´æ–°å®ƒçš„ç­¾åä»¥è¿”å›ä¸€ä¸ª<strong>effects</strong>æ•°ç»„ã€‚</p>
<pre><code class="language-swift">public func counterReducer(state: inout Int, action: CounterAction) -&gt; [Effect&lt;CounterAction&gt;] {
</code></pre>
<p>ç„¶åæˆ‘ä»¬ä»æ¯ä¸ªå¤„ç†çš„æ“ä½œè¿”å›ä¸€ä¸ªç©ºæ•°ç»„ï¼Œå› ä¸ºæ— è®ºæ˜¯é€’å¢è¿˜æ˜¯é€’å‡è®¡æ•°éƒ½ä¸ä¼šäº§ç”Ÿ<strong>effect</strong>ã€‚</p>
<pre><code class="language-swift">case .decrTapped:
  state -= 1
  return []

case .incrTapped:
  state += 1
  return []
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°åŸºæœ¬æ¨¡æ€<strong>reducer</strong>ï¼Œå¹¶è¿›è¡Œå‡ ä¹ç›¸åŒçš„æ›´æ”¹ï¼Œä»å®ƒçš„ç­¾åå¼€å§‹:</p>
<pre><code class="language-swift">public func primeModalReducer(
  state: inout PrimeModalState, action: PrimeModalAction
) -&gt; [Effect&lt;PrimeModalAction&gt; {
</code></pre>
<p>ç„¶åè¿”å›ç©ºçš„<strong>effect</strong>æ•°ç»„ã€‚</p>
<pre><code class="language-swift">case .removeFavoritePrimeTapped:
  state.favoritePrimes.removeAll(where: { $0 == state.count })
  return []

case .saveFavoritePrimeTapped:
  state.favoritePrimes.append(state.count)
  return []
</code></pre>
<p><strong>counter</strong>æ¨¡å—ç°åœ¨æ­£åœ¨å†æ¬¡æ„å»ºï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„å¼‚æ­¥æ•ˆæœ:è¯¢é—®<strong>Wolfram Alpha API</strong>çš„â€œnç´ æ•°â€ï¼Œå…¶ä¸­â€œnâ€æ˜¯è®¡æ•°å™¨åº”ç”¨ç¨‹åºçš„å½“å‰è®¡æ•°ã€‚</p>
<p>è®¡æ•°å™¨è§†å›¾ä¸­æœ‰ä¸€ä¸ªæŒ‰é’®å¯ä»¥è§¦å‘æ­¤è¯·æ±‚ã€‚</p>
<pre><code class="language-swift">Button(
  &quot;What is the \(ordinal(self.store.value.count)) prime?&quot;,
  action: self.nthPrimeButtonAction
)
</code></pre>
<p>å®ƒè°ƒç”¨ä¸€ä¸ªå±€éƒ¨æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ”¹å˜ä¸€äº›å±€éƒ¨è§†å›¾çŠ¶æ€å¹¶å†…è”æ‰§è¡Œå¼‚æ­¥å‰¯ä½œç”¨ã€‚</p>
<pre><code class="language-swift">func nthPrimeButtonAction() {
  self.isNthPrimeButtonDisabled = true
  nthPrime(self.store.value.count) { prime in
    self.alertNthPrime = prime.map(PrimeAlert.init(prime:))
    self.isNthPrimeButtonDisabled = false
  }
}
</code></pre>
<p>æ‰€æ¶‰åŠçš„æœ¬åœ°çŠ¶æ€åŒ…æ‹¬åœ¨è¯·æ±‚æ­£åœ¨è¿è¡Œæ—¶ç¦ç”¨è¯¥æŒ‰é’®ï¼Œå¹¶åœ¨è¯·æ±‚æˆåŠŸæ—¶æ˜¾ç¤ºå¸¦æœ‰ç»“æœçš„<strong>alert</strong>ã€‚</p>
<p>ä¸ºäº†åœ¨æˆ‘ä»¬çš„<strong>reducer</strong>ä¸­æ•æ‰è¿™ç§<strong>effect</strong>ï¼Œè®©æˆ‘ä»¬éµå¾ªåˆ°ç›®å‰ä¸ºæ­¢ä¸ºæˆ‘ä»¬å·¥ä½œçš„ä¾‹è¡Œç¨‹åºã€‚ä¸å…¶ä»¥å†…è”æ–¹å¼æ‰§è¡Œè¿™é¡¹å·¥ä½œï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå‘é€ä¸€ä¸ªåŠ¨ä½œåˆ°<strong>store</strong>ï¼Œä»¥ä¾¿<strong>effect</strong>å¯ä»¥åœ¨<strong>reducer</strong>ä¸­æ•è·ã€‚</p>
<pre><code class="language-swift">func nthPrimeButtonAction() {
//    self.isNthPrimeButtonDisabled = true
//    nthPrime(self.store.value.count) { prime in
//      self.alertNthPrime = prime.map(PrimeAlert.init(prime:))
//      self.isNthPrimeButtonDisabled = false
//    }
    self.store.send(.nthPrimeButtonTapped)
  }
</code></pre>
<p>è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»å°†è¯¥æ“ä½œæ·»åŠ åˆ°å……æ»¡<strong>counter action</strong>çš„<strong>enum</strong>ä¸­ã€‚</p>
<pre><code class="language-swift">public enum CounterAction {
  case decrTapped
  case incrTapped
  case nthPrimeButtonTapped
}
</code></pre>
<p>æˆ‘ä»¬è¦ç”¨æˆ‘ä»¬çš„<strong>reducer</strong>å¤„ç†è¿™ä¸ªæ–°<strong>case</strong>ã€‚</p>
<pre><code class="language-swift">case .nthPrimeButtonTapped:
  &lt;#code#&gt;
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦å‘å°„ä¸€ä¸ª<strong>effect</strong>ã€‚</p>
<pre><code class="language-swift">case .nthPrimeButtonTapped:
  return [{

  }]
</code></pre>
<p>ç‰¹åˆ«æ˜¯ä¸€äº›æ•æ‰æˆ‘ä»¬åœ¨è§†å›¾ä¸­æ‰€åšçš„å·¥ä½œçš„ä¸œè¥¿ã€‚</p>
<pre><code class="language-swift">case .nthPrimeButtonTapped:
  return [{
    self.isNthPrimeButtonDisabled = true
    nthPrime(self.store.value.count) { prime in
      self.alertNthPrime = prime.map(PrimeAlert.init(prime:))
      self.isNthPrimeButtonDisabled = false
    }
  }]
</code></pre>
<blockquote>
<p>ğŸ›‘ Use of unresolved identifier â€˜selfâ€™</p>
</blockquote>
<p>æˆ‘ä»¬ä¸å†èƒ½å¤Ÿè®¿é—®è§†å›¾çš„æœ¬åœ°çŠ¶æ€ã€<strong>store</strong>å’Œ<strong>self</strong>ã€‚é€šè¿‡ç§»åŠ¨åˆ°<strong>reducer</strong>ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘çŠ¶æ€å’ŒåŠ¨ä½œä¸­çš„ä¸€åˆ‡ã€‚</p>
<h2 id="2-a-namelocalstatetoglobalstatealocal-state-to-global-state">2. <a name='Localstatetoglobalstate'></a>Local state to global state</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å¼•å…¥ä¸€äº›é™„åŠ çŠ¶æ€ï¼ŒåŒ…æ‹¬ç¬¬nä¸ªä¸»æŒ‰é’®æ˜¯å¦è¢«ç¦ç”¨ï¼Œä»¥åŠ<strong>alert state</strong>ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºå…ƒç»„å®šä¹‰ä¸€ä¸ªç±»å‹åˆ«åæ¥ä¿å­˜æ‰€æœ‰è¿™äº›çŠ¶æ€ã€‚</p>
<pre><code class="language-swift">public typealias CounterState = (
  alertNthPrime: PrimeAlert?,
  count: Int,
  isNthPrimeButtonDisabled: Bool
)
</code></pre>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®©<strong>PrimeAlert</strong>å…¬å¼€ã€‚</p>
<pre><code class="language-swift">public struct PrimeAlert: Identifiable {
  let prime: Int
  public var id: Int { self.prime }
}
</code></pre>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥æ›´æ–°è®¡æ•°å™¨<strong>reducer</strong>æ¥å¤„ç†è¿™ä¸ªé¢å¤–çš„çŠ¶æ€ã€‚</p>
<pre><code class="language-swift">public func counterReducer(
  state: inout CounterState, action: CounterAction
) -&gt; [Effect&lt;CounterAction&gt; {
</code></pre>
<p>å½“æˆ‘ä»¬æ”¹å˜è®¡æ•°æ—¶ï¼Œæˆ‘ä»¬ç°åœ¨å¿…é¡»æ›´æ·±å…¥åœ°æŒ–æ˜<strong>state</strong>çš„è®¡æ•°ã€‚</p>
<pre><code class="language-swift">case .decrTapped:
  state.count -= 1
  return []

case .incrTapped:
  state.count += 1
  return []
</code></pre>
<p>å¯¹äºæˆ‘ä»¬çš„æ–°åŠ¨ä½œï¼Œæˆ‘ä»¬å¯ä»¥ç§»é™¤ä¸€äº›<strong>selfs</strong>ã€‚æˆ‘ä»¬å¯ä»¥ä»æå–<strong>effect</strong>ä¹‹å¤–çš„çº¯<strong>isNthPrimeButtonDisabled</strong>çªå˜å¼€å§‹ã€‚</p>
<pre><code class="language-swift">case .nthPrimeButtonTapped:
  state.isNthPrimeButtonDisabled = true
</code></pre>
<p>ä¸ºäº†å°†è®¡æ•°ä¼ é€’ç»™<strong>nthPrime</strong>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªä¸å¯å˜çš„æœ¬åœ°å‰¯æœ¬ï¼Œè¿™æ ·<strong>effect</strong>é—­åŒ…å°±ä¸ä¼šè¯•å›¾æ•è·ä¸€ä¸ªå¯å˜çš„è¾“å…¥è¾“å‡ºå€¼ã€‚</p>
<pre><code class="language-swift">case .nthPrimeButtonTapped:
  state.isNthPrimeButtonDisabled = true
  let count = state.count
  return [{
    nthPrime(count) { prime in
</code></pre>
<p>åœ¨<strong>effect</strong>ä¸­å®Œæˆçš„å…¶ä½™å·¥ä½œæ˜¯åœ¨è¯·æ±‚å®Œæˆåå®Œæˆçš„ï¼Œæ­¤æ—¶æˆ‘ä»¬æœ‰å¸Œæœ›æµå›ç³»ç»Ÿçš„æ•°æ®ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œéœ€è¦å¼•å…¥ä¸€ä¸ªæ–°æ“ä½œæ¥å¤„ç†ç¬¬nä¸ªè´¨æ•°å“åº”ã€‚</p>
<pre><code class="language-swift">public enum CounterAction {
  case decrTapped
  case incrTapped
  case nthPrimeButtonTapped
  case nthPrimeResponse
}
</code></pre>
<p>è€Œ<strong>nthprimerresponse</strong>åº”è¯¥æ†ç»‘<strong>Wolfram Alpha</strong>è¿”å›çš„è´¨æ•°ã€‚</p>
<pre><code class="language-swift">case nthPrimeResponse(Int?)
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå¯é€‰çš„<strong>Int</strong>å€¼æ¥è¡¨ç¤ºåœ¨è·å–åˆå§‹å€¼æ—¶å¯èƒ½å‘ç”Ÿé”™è¯¯ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚å¯èƒ½å¤±è´¥ã€‚</p>
<p>reducerè¢«ç ´åäº†ï¼Œæˆ‘ä»¬åˆ‡æ¢å¦ä¸€ä¸ª<strong>case</strong>å§ã€‚</p>
<pre><code class="language-swift">case .nthPrimeResponse(_):
  &lt;#code#&gt;
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥æŠŠå·¥ä½œä»<strong>nthPrime</strong>å®Œæˆå¤„ç†ç¨‹åºç§»åˆ°è¿™é‡Œã€‚</p>
<pre><code class="language-swift">case .nthPrimeButtonTapped:
  state.isNthPrimeButtonDisabled = true
  let count = state.count
  return [{
    nthPrime(count) { prime in
    }
  }]

case let .nthPrimeResponse(prime):
  state.alertNthPrime = prime.map(PrimeAlert.init(prime:))
  state.isNthPrimeButtonDisabled = false
  return []
</code></pre>
<p>ä½†æˆ‘ä»¬å¦‚ä½•è®©è¿™ç§<strong>effect</strong>å‘æŒ¥ä½œç”¨å‘¢?</p>
<pre><code class="language-swift">return [{
  nthPrime(count) { prime in
  }
}]
</code></pre>
<blockquote>
<p>ğŸ›‘ Cannot convert value of type â€˜Voidâ€™ to closure result type â€˜CounterAction?â€™</p>
</blockquote>
<p>å› ä¸ºæˆ‘ä»¬åœ¨å›è°ƒå‡½æ•°ä¸­æ¥æ”¶ç´ æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä»…ä»…ä»é‚£é‡Œè¿”å›æ“ä½œã€‚</p>
<pre><code class="language-swift">return [{
  nthPrime(count) { prime in
    return .nthPrimeResponse(prime)
  }
}]
</code></pre>
<p>æˆ‘ä»¬éœ€è¦åœ¨å›è°ƒä¹‹å¤–è¿”å›<strong>nthprimerresponse</strong>åŠ¨ä½œã€‚</p>
<pre><code class="language-swift">return [{
  nthPrime(count) { prime in

  }
  return .nthPrimeResponse(prime)
}]
</code></pre>
<blockquote>
<p>ğŸ›‘ Use of unresolved identifier â€˜primeâ€™</p>
</blockquote>
<p>æˆ‘ä»¬éœ€è¦è®¿é—®è¿™é‡Œçš„åˆå§‹å€¼ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬åªèƒ½å¼‚æ­¥è®¿é—®çš„å€¼ï¼Œè€Œæˆ‘ä»¬çš„<strong>reducer</strong>çš„<strong>effect</strong>ç°åœ¨å¿…é¡»æ˜¯åŒæ­¥çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥ä¸€ä¸ª<strong>dispatch semaphore</strong>æ¥å¼ºåˆ¶æˆ‘ä»¬çš„ç½‘ç»œè¯·æ±‚æ˜¯åŒæ­¥çš„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å®ƒæ‰§è¡Œåè®¿é—®è®¡ç®—å¥½çš„è´¨æ•°:</p>
<pre><code class="language-swift">return [{
  var p: Int?
  let sema = DispatchSemaphore(value: 0)
  nthPrime(count) { prime in
    p = prime
    sema.signal()
  }
  sema.wait()
  return .nthPrimeResponse(p)
}]
</code></pre>
<p>è™½ç„¶æˆ‘ä»¬çš„<strong>reducer</strong>æ˜¯å¿«ä¹çš„ï¼Œäº‹æƒ…è¿˜æ²¡æœ‰å®Œå…¨å»ºç«‹ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æ”¹å˜äº†è®¡æ•°å™¨<strong>reducer</strong>çš„çŠ¶æ€ï¼Œä¸èƒ½ä»…ä»…é€šè¿‡è®¡æ•°å†æ‹‰å®ƒå›æ¨¡å—çš„<strong>reducer</strong>ã€‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€å †é¢å¤–çš„çŠ¶æ€è¦å¤„ç†ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ¨¡å—çš„æ ¹çŠ¶æ€ä¸­è€ƒè™‘è¿™ä¸ªé¢å¤–çš„çŠ¶æ€ï¼Œæ ¹çŠ¶æ€ç”¨å…ƒç»„è¡¨ç¤ºã€‚</p>
<pre><code class="language-swift">public typealias CounterViewState = (
  alertNthPrime: PrimeAlert?,
  count: Int,
  favoritePrimes: [Int],
  isNthPrimeButtonDisabled: Bool
)
</code></pre>
<p>ä½†è¿™æ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªå•ç‹¬çš„å…³é”®è·¯å¾„æ¥æå–è®¡æ•°å™¨<strong>reducer</strong>å’Œåˆå§‹æ¨¡æ€<strong>reducer</strong>æ‰€å…³å¿ƒçš„å­—æ®µã€‚<br>
ä¸ºäº†è®¿é—®è¿™æ ·ä¸€ä¸ªé”®è·¯å¾„ï¼Œæˆ‘ä»¬å¿…é¡»å®šä¹‰ä¸€äº›è®¡ç®—å±æ€§ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å°†<strong>CounterViewState</strong>å‡çº§ä¸ºä¸€ä¸ªç»“æ„ä½“ã€‚</p>
<pre><code class="language-swift">public struct CounterViewState {
  var alertNthPrime: PrimeAlert?
  var count: Int
  var favoritePrimes: [Int]
  var isNthPrimeButtonDisabled: Bool
)
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»‹ç»ä¸€äº›è®¡ç®—æ€§è´¨ï¼Œå®ƒä»¬å¯ä»¥æå–å‡º<strong>counter</strong> æ¨¡æ€<strong>reducer</strong>å’Œä¸»æ¨¡æ€<strong>reducer</strong>çš„å­æ€ã€‚</p>
<pre><code class="language-swift">var counter: CounterState {

}

var primeModal: PrimeModalState {

}
</code></pre>
<p>ä¸ºäº†è®©è¿™ä¸ªå…³é”®è·¯å¾„æ˜¯å¯å†™çš„ï¼Œè¿™æ˜¯å›è°ƒå‡½æ•°çš„è¦æ±‚ï¼Œæˆ‘ä»¬éœ€è¦getterå’Œsetterã€‚</p>
<pre><code class="language-swift">var counter: CounterState {
  get {}
  set {}
}
</code></pre>
<p><strong>getter</strong>éœ€è¦è¿”å›å®ƒå…³å¿ƒçš„<strong>CounterState</strong>å…ƒç»„ã€‚</p>
<pre><code class="language-swift">var counter: CounterState {
  get { (self.alertNthPrime, self.count, self.isNthPrimeButtonDisabled) }
  set {}
}
</code></pre>
<p><strong>setter</strong>éœ€è¦è§£æ„è¿™äº›å€¼å¹¶é‡æ–°èµ‹å€¼ã€‚</p>
<pre><code class="language-swift">var counter: CounterState {
  get { (self.alertNthPrime, self.count, self.isNthPrimeButtonDisabled) }
  set { (self.alertNthPrime, self.count, self.isNthPrimeButtonDisabled) = newValue }
}
</code></pre>
<p>ç´ æ¨¡æ€çŠ¶æ€æ˜¯ç›¸ä¼¼çš„ï¼Œä½†å®ƒå…³å¿ƒä¸åŒçš„åŸŸã€‚</p>
<pre><code class="language-swift">var primeModal: PrimeModalState {
  get { (self.count, self.favoritePrimes) }
  set { (self.count, self.favoritePrimes) = newValue }
}
</code></pre>
<p>æœ€åï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªå…¨æ–°çš„å…³é”®è·¯å¾„ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬ç»„æˆæ¨¡å—çš„æ ¹<strong>reducer</strong>ã€‚</p>
<pre><code class="language-swift">public let counterViewReducer = combine(
  pullback(counterReducer, value: \CounterViewState.counter, action: \CounterViewAction.counter),
  pullback(primeModalReducer, value: \.primeModal, action: \.primeModal)
)
</code></pre>
<p>ä¸€åˆ‡éƒ½åº”è¯¥æ„å»ºï¼Œä½†æˆ‘ä»¬éœ€è¦ç¡®ä¿å½“ç¬¬nä¸ªä¸»æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œæˆ‘ä»¬å°†<strong>CounterAction</strong>åŒ…è£…ä¸ºä¸€ä¸ª<strong>CounterViewAction</strong>ã€‚</p>
<pre><code class="language-swift">self.store.send(.counter(.nthPrimeButtonTapped))
</code></pre>
<p>äº‹æƒ…æ­£åœ¨å»ºè®¾ä¸­ï¼Œä½†æˆ‘ä»¬ä»ç„¶éœ€è¦æ›´æ–°è§†å›¾ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™ä¸€ç›´ä¾èµ–äºæœ¬åœ°çŠ¶æ€ã€‚</p>
<pre><code class="language-swift">public struct CounterView: View {
  @ObservedObject var store: Store&lt;CounterViewState, CounterViewAction&gt;
  @State var isPrimeModalShown = false
  @State var alertNthPrime: PrimeAlert?
  @State var isNthPrimeButtonDisabled = false
</code></pre>
<p>ä»¥å‰<strong>alertNthPrimeå’ŒisNthPrimeButtonDisabled</strong>æ˜¯ç”±SwiftUIä½¿ç”¨@<strong>State</strong>å±æ€§åŒ…è£…å™¨ç®¡ç†çš„æœ¬åœ°çŠ¶æ€ã€‚ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å·²ç»å°†è¿™ä¸ªçŠ¶æ€ç§»åˆ°äº†<strong>store</strong>ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿå°†å®ƒä»¬æ³¨é‡Šæ‰ã€‚</p>
<pre><code class="language-swift">//  @State var alertNthPrime: PrimeAlert?
//  @State var isNthPrimeButtonDisabled = false
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>store</strong>çš„çŠ¶æ€æ¥æ›´æ–°è§†å›¾ã€‚æ¯”å¦‚ç¬¬nä¸ªæŒ‰é’®æ˜¯å¦è¢«ç¦ç”¨ã€‚</p>
<pre><code class="language-swift">.disabled(self.store.value.isNthPrimeButtonDisabled)
</code></pre>
<p>ä»¥åŠæ˜¯å¦è¦å‘å‡ºè­¦æŠ¥ã€‚</p>
<pre><code class="language-swift">.alert(item: self.store.value.alertNthPrime) { alert in
</code></pre>
<p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªæ¥å£éœ€è¦ä¸€ä¸ªSwiftUIç»‘å®šï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå€¼ã€‚é‚£æˆ‘ä»¬ç°åœ¨è¯¥æ€ä¹ˆåš? ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥çœ‹çœ‹è‡ªå·±æ˜¯å¦æœ‰å¯èƒ½å»ºç«‹ä¸€ä¸ª<strong>binding</strong>,å®ƒæœ‰ä¸€ä¸ªåˆå§‹åŒ–å™¨ï¼Œæ¥å—ä¸€ä¸ªgetå‡½æ•°å’Œä¸€ä¸ªsetå‡½æ•°ã€‚</p>
<pre><code class="language-swift">Binding(get: &lt;#() -&gt; _#&gt;, set: &lt;#(_) -&gt; Void#&gt;)
</code></pre>
<p><strong>get</strong>å‡½æ•°å¯ä»¥è¿”å›<strong>store</strong>çš„å€¼ï¼Œè€Œå®ƒçš„<strong>setter</strong>å¯ä»¥æ˜¯ä¸€ä¸ªæ— æ“ä½œé—­åŒ…ã€‚</p>
<pre><code class="language-swift">Binding(get: { self.store.value.alertNthPrime }, set: { _ in })
</code></pre>
<p>ç°åœ¨ï¼Œä¸€åˆ‡éƒ½å¾ˆå¥½!</p>
<p>This doesnâ€™t look great, though:</p>
<pre><code class="language-swift">.alert(
  item: Binding(
    get: { self.store.value.alertNthPrime },
    set: { _ in }
  )
) { alert in
</code></pre>
<p>å®ƒéå¸¸å˜ˆæ‚ï¼Œè€Œä¸”ä¸ºåƒ<strong>alert binding</strong>è¿™æ ·ç®€å•å’Œå¸¸è§çš„ä¸œè¥¿å¼•å…¥è¿™ä¹ˆå¤šå˜ˆæ‚å¹¶ä¸å¥½ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒSwiftUIæä¾›äº†ä¸€ä¸ªç»‘å®šåŠ©æ‰‹ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®Œæˆè¿™é¡¹å·¥ä½œ! å®ƒè¢«ç§°ä¸ºâ€œ<strong>constant</strong>â€ç»‘å®šï¼Œå¯ä»¥ä½œä¸ºé™æ€æ–¹æ³•ä½¿ç”¨ã€‚</p>
<pre><code class="language-swift">.alert(
  item: Binding.constant(self.store.value.alertNthPrime)
) { aler
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»å‹æ¨æ–­æ¥ç¼©çŸ­æ—¶é—´ã€‚</p>
<pre><code class="language-swift">.alert(
  item: .constant(self.store.value.alertNthPrime)
) { alert in
</code></pre>
<p>æ‰€ä»¥è¿™ä¸ºæˆ‘ä»¬çš„å•å‘æ¶æ„æä¾›äº†ä¸€ç§å¾ˆå¥½çš„æ„å»ºSwiftUIç»‘å®šçš„æ–¹å¼ã€‚</p>
<p>ç°åœ¨ä¸€åˆ‡éƒ½åœ¨æ„å»ºä¸­ï¼Œä½†ä¸ºäº†è®©äº‹æƒ…å˜å¾—æ›´å¤æ‚ï¼Œæˆ‘ä»¬å¿…é¡»æœ€ç»ˆå°†<strong>CounterViewState</strong>åˆå§‹åŒ–å™¨å…¬å¼€åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å°†å®ƒä»å…ƒç»„å‡çº§ä¸ºç»“æ„ä½“ã€‚</p>
<pre><code class="language-swift">public struct CounterViewState {
  var alertNthPrime: PrimeAlert?
  var count: Int
  var favoritePrimes: [Int]
  var isNthPrimeButtonDisabled: Bool

  public init(
    alertNthPrime: PrimeAlert?,
    count: Int,
    favoritePrimes: [Int],
    isNthPrimeButtonDisabled: Bool
  ) {
    self.alertNthPrime = alertNthPrime
    self.count = count
    self.favoritePrimes = favoritePrimes
    self.isNthPrimeButtonDisabled = isNthPrimeButtonDisabled
  }
</code></pre>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨<strong>playground</strong>ä¸Šä½¿ç”¨è¿™ä¸ªåˆå§‹åŒ–å™¨!</p>
<pre><code class="language-swift">PlaygroundPage.current.liveView = UIHostingController(
  rootView: CounterView(
    Store: Store&lt;CounterViewState, CounterViewAction&gt;(
      initialValue: CounterViewState(
        alertNthPrime: nil,
        count: 0,
        favoritePrimes: [],
        isNthPrimeButtonDisabled: false
      ),
      reducer: counterViewReducer
    )
  )
)
</code></pre>
<h2 id="3-a-nametheasyncsignatureathe-async-signature">3. <a name='Theasyncsignature'></a>The async signature</h2>
<p>æˆ‘ä»¬èŠ±äº†ä¸€äº›æ—¶é—´æ‰åˆ°è¾¾è¿™é‡Œï¼Œå› ä¸ºæˆ‘ä»¬çš„å¼‚æ­¥å‰¯ä½œç”¨çº ç¼ åœ¨ä¸€äº›å±€éƒ¨çŠ¶æ€ä¸­ï¼Œè€Œå°†æ‰€æœ‰å†…å®¹ç§»åŠ¨åˆ°<strong>reducer</strong>ä¸­ä¼šå¼•èµ·ä¸€äº›æ¶Ÿæ¼ªæ•ˆåº”ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬å®ç°å¼‚æ­¥æ•ˆæœçš„æ–¹å¼å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆã€‚ä¸€æ–¹é¢ï¼Œè¿™ä¸ªæ•ˆæœç°åœ¨æ˜¯é˜»å¡çš„ï¼Œè¿™æ„å‘³ç€åœ¨å®ƒå®Œæˆä¹‹å‰ï¼Œå…¶ä»–æ•ˆæœéƒ½ä¸èƒ½è¿è¡Œã€‚è™½ç„¶æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œæˆæ‰€æœ‰è¿æ¥ï¼Œä½†è‡³å°‘è®©æˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹ä¸ºä»€ä¹ˆè¿™æ˜¯æœ‰é—®é¢˜çš„ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è½¬åˆ°è®¡æ•°å™¨å±å¹•ï¼Œå¹¶è¯·æ±‚ç¬¬äº”ä¸ªç´ æ•°ï¼Œæˆ‘ä»¬å°†æ³¨æ„åˆ°åœ¨ç­‰å¾…ç½‘ç»œè¯·æ±‚å®Œæˆæ—¶æ¥å£å†»ç»“ã€‚è¿™å½“ç„¶å¾ˆç³Ÿç³•ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åšçš„ä¸€ä»¶äº‹å½“ç„¶æ˜¯å®Œå…¨æ”¹å˜æˆ‘ä»¬çš„<strong>store</strong>è¿è¡Œæ•ˆæœï¼Œä»¥æ”¯æŒå¼‚æ­¥:</p>
<pre><code class="language-swift">DispatchQueue.global().async {
  effects.forEach { effect in
    if let action = effect() {
      DispatchQueue.main.async {
        self.send(action)
      }
    }
  }
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥é‡æ–°è¿è¡Œæ“åœºï¼Œçœ‹çœ‹æƒ…å†µæ˜¯ä¸æ˜¯å¥½ä¸€ç‚¹äº†ã€‚</p>
<p>ä½†è¿™æ˜¯æœ‰é—®é¢˜çš„å‡ ä¸ªåŸå› ã€‚</p>
<ul>
<li>æˆ‘ä»¬ç¡¬ç¼–ç äº†ä¸€ä¸ªè°ƒåº¦é˜Ÿåˆ—æ¥è¿è¡Œæˆ‘ä»¬çš„å¼‚æ­¥å·¥ä½œï¼Œæœ€ç³Ÿç³•çš„æ˜¯ï¼Œè¿™æ˜¯ä¸º<strong>store</strong>çš„æ‰€æœ‰ç”¨æˆ·åšå‡ºçš„ä¸€ä¸ªä¸çµæ´»çš„é€‰æ‹©ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥è®©æ¯ç§<strong>effect</strong>å†³å®šå®ƒä»¬çš„å¼‚æ­¥ç¨‹åº¦ã€‚</li>
<li>æˆ‘ä»¬çš„å¼‚æ­¥æ•ˆæœå¿…é¡»ä½¿ç”¨<strong>GCD</strong>ä¿¡å·é‡åœ¨å†…éƒ¨ç®¡ç†å®ƒçš„å¼‚æ­¥æ€§ã€‚è¿™åªæ˜¯å¤„ç†é—®é¢˜çš„ä¸€ç§éå¸¸ç¬¨æ‹™çš„æ–¹æ³•ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿé‡æ–°å»ºæ¨¡æ•ˆæœï¼Œä»¥æ›´è‡ªç„¶çš„æ–¹å¼å¤„ç†å¼‚æ­¥ï¼Œè€Œä¸éœ€è¦åˆ›å»ºéœ€è¦è¢«å‘ŠçŸ¥ç­‰å¾…å’Œç¨åå‘å‡ºä¿¡å·çš„ä¿¡å·é‡ï¼Œé‚£å°±å¤ªå¥½äº†ã€‚</li>
</ul>
<p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å·²ç»åœ¨Point-Freeä¸Šå¤šæ¬¡è®¨è®ºäº†ä¸€ä¸ªç±»å‹ï¼Œå®ƒä»£è¡¨äº†å¼‚æ­¥å·¥ä½œçš„æœ¬è´¨ã€‚ æˆ‘ä»¬ä¹‹å‰å°†å…¶ç§°ä¸º<strong>Parallel</strong>ç±»å‹ï¼Œå®ƒçœ‹èµ·æ¥å¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-swift">struct Parallel&lt;A&gt; {
  let run: (@escaping (A) -&gt; Void) -&gt; Void
}
</code></pre>
<p>è¿™ä¸ªç‰¹å¾è™½ç„¶ä¹ä¸€çœ‹å¾ˆå¥‡æ€ªï¼Œä½†å´æ˜¯æˆ‘ä»¬åœ¨iOSå¼€å‘ä¸­ç»å¸¸é‡åˆ°çš„å½¢çŠ¶ã€‚å®ƒæ˜¯æˆ‘ä»¬ç»å¸¸å¤„ç†çš„è®¸å¤šå¼‚æ­¥apiçš„ç²¾ç¡®å½¢çŠ¶ï¼Œå¦‚è°ƒåº¦å¼‚æ­¥ï¼ŒUIViewåŠ¨ç”»å’ŒURLä¼šè¯æ•°æ®ä»»åŠ¡:</p>
<pre><code class="language-swift">//DispatchQueue.main.async(execute: () -&gt; Void) -&gt; Void
//UIView.animate(withDuration: TimeInterval, animations: () -&gt; Void) -&gt; Void
//URLSession.shared.dataTask(with: URL, completionHandler: (Data?, URLResponse?, Error?) -&gt; Void) -&gt; Void
</code></pre>
<p>è¿™ä¸ªç­¾åå…è®¸æˆ‘ä»¬å°†æ§åˆ¶æƒç§»äº¤ç»™æ­£åœ¨è°ƒç”¨çš„å‡½æ•°ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨å‡†å¤‡å¥½æ—¶è¿”å›å€¼ï¼Œè€Œä¸æ˜¯ç«‹å³è¦æ±‚ä¸€ä¸ªå€¼ã€‚</p>
<p>ä¼¼ä¹<strong>Parallel</strong>ç±»å‹å¯ä»¥åœ¨è¿™é‡Œå¸®åŠ©æˆ‘ä»¬!</p>
<p>æˆ‘ä»¬ç°åœ¨åŸºæœ¬ä¸Šéœ€è¦é‡å¤è¿™ä¸ªæ•…äº‹æ¥è¾¾åˆ°æ•ˆæœã€‚æˆ‘ä»¬éœ€è¦æŠ›å¼ƒè¿™ä¸ªè¦æ±‚æˆ‘ä»¬ç«‹å³è¿”å›å¯é€‰åŠ¨ä½œçš„åŒæ­¥æ•ˆæœç­¾åï¼Œè€Œä½¿ç”¨å…è®¸æˆ‘ä»¬åœ¨å‡†å¤‡å¥½æ—¶æä¾›åŠ¨ä½œçš„å¼‚æ­¥ç­¾åã€‚</p>
<h2 id="4-a-nametheasynceffectathe-async-effect">4. <a name='Theasynceffect'></a>The async effect</h2>
<p>æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬å†æ¬¡æ›´æ–°æˆ‘ä»¬çš„æ•ˆæœç­¾åï¼Œçœ‹çœ‹æ‰€æœ‰éœ€è¦ä¿®å¤çš„:</p>
<pre><code class="language-swift">public typealias Effect&lt;Action&gt; = (@escaping (Action) -&gt; Void) -&gt; Void
</code></pre>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨<strong>store</strong>ä¸Šçš„<strong>send</strong>æ–¹æ³•ä¸å†æ­£ç¡®ã€‚ æˆ‘ä»¬ä¸å¸Œæœ›<strong>store</strong>å¤„ç†åˆ†æ´¾å¼‚æ­¥é€»è¾‘ã€‚ç›¸åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æä¾›ä¸€ä¸ªå›è°ƒæ¥è¿è¡Œæ¯ä¸ª<strong>effect</strong>ï¼Œç„¶åå½“é‚£ä¸ªå›è°ƒè¢«è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å°†æŠŠç»“æœåŠ¨ä½œè½¬å‘ç»™æˆ‘ä»¬çš„<strong>send</strong>æ–¹æ³•:</p>
<pre><code class="language-swift">public func send(_ action: Action) {
  let effects = self.reducer(&amp;self.value, action)
  effects.forEach { effect in
    effect { action in self.send(action) }
  }
}
</code></pre>
<p>åœ¨ä¼ é€’å›è°ƒé—­åŒ…<strong>effect</strong>çš„åœ°æ–¹ï¼Œæˆ‘ä»¬æœ‰æœºä¼šæ‰§è¡Œä¸€äº›å¼‚æ­¥å·¥ä½œï¼Œå› ä¸ºæ•ˆæœæœ¬èº«å†³å®šä»€ä¹ˆæ—¶å€™å°†ä¸€ä¸ªåŠ¨ä½œåé¦ˆå›<strong>send</strong>ã€‚</p>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥é€šè¿‡ä¼ é€’<strong>self.send</strong>ä¸ºå›è°ƒå€¼æ¥ç¼©çŸ­ä»£ç ã€‚</p>
<pre><code class="language-swift">effects.forEach { effect in
  effect(self.send)
}
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰äº†å›è°ƒå‡½æ•°ã€‚å®ƒéœ€è¦é€šè¿‡è¿è¡Œè¿™äº›<strong>effects</strong>å°†å…¶å±€éƒ¨<strong>effect</strong>è½¬æ¢ä¸ºå…¨å±€<strong>effect</strong>ï¼Œç„¶åä½¿ç”¨å›è°ƒå‡½æ•°å°†å±€éƒ¨<strong>effect</strong>åµŒå…¥åˆ°å…¨å±€<strong>effect</strong>ä¸­:</p>
<pre><code class="language-swift">public func pullback&lt;LocalValue, GlobalValue, LocalAction, GlobalAction&gt;(
  _ reducer: @escaping (inout LocalValue, LocalAction) -&gt; [Effect&lt;LocalAction&gt;],
  value: WritableKeyPath&lt;GlobalValue, LocalValue&gt;,
  action: WritableKeyPath&lt;GlobalAction, LocalAction?&gt;
) -&gt; (inout GlobalValue, GlobalAction) -&gt; [Effect&lt;GlobalAction&gt;] {
  return { globalValue, globalAction in
    guard let localAction = globalAction[keyPath: action] else { return [] }
    let localEffects = reducer(&amp;globalValue[keyPath: value], localAction)
    return localEffects.map { localEffect in
      { callback in
//        guard let localAction = localEffect() else { return nil }
        localEffect { localAction in
          var globalAction = globalAction
          globalAction[keyPath: action] = localAction
          callback(globalAction)
        }
      }
    }
  }
}
</code></pre>
<p>åœ¨æˆ‘ä»¬çš„å¯ç»„åˆæ¶æ„æ¨¡å—ä¸­å”¯ä¸€æ²¡æœ‰ç¼–è¯‘çš„æ˜¯æ—¥å¿—é«˜é˜¶<strong>reducer</strong>ï¼Œè¿™å¾ˆå®¹æ˜“ä¿®å¤ã€‚æˆ‘ä»¬å¯ä»¥å¿½ç•¥<strong>callback</strong>å‚æ•°ï¼Œå¹¶å»æ‰<strong>return</strong>è¯­å¥ã€‚</p>
<pre><code class="language-swift">public func logging&lt;Value, Action&gt;(
  _ reducer: @escaping (inout Value, Action) -&gt; [Effect&lt;Action&gt;]
) -&gt; (inout Value, Action) -&gt; [Effect&lt;Action&gt;] {
  return { value, action in
    let effects = reducer(&amp;value, action)
    let newValue = value
    return [{ _ in
      print(&quot;Action: \(action)&quot;)
      print(&quot;Value:&quot;)
      dump(newValue)
      print(&quot;---&quot;)
    }] + effects
  }
}
</code></pre>
<p>ç°åœ¨è®©æˆ‘ä»¬æ¥è§£å†³å…¶ä»–æ¨¡å—ä¸­çš„é—®é¢˜ã€‚é¦–å…ˆæˆ‘ä»¬å¾—åˆ°äº†è®¡æ•°å™¨æ¨¡å—ã€‚æˆ‘ä»¬è¿”å›çš„æ‰€æœ‰ç©ºæ•°ç»„[]ä»ç„¶æ˜¯æ­£å¸¸çš„ï¼Œä½†æˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€äº›<strong>effect</strong>çš„ä½ç½®éœ€è¦æ›´æ–°ï¼Œä¾‹å¦‚å½“ç¬¬nä¸ªä¸»æŒ‰é’®è¢«ç‚¹å‡»æ—¶:</p>
<pre><code class="language-swift">case .nthPrimeButtonTapped:
  state.isNthPrimeButtonDisabled = true
  let count = state.count
  return [{ callback in
    nthPrime(count) { prime in
      callback(.nthPrimeResponse(prime))
    }
  }]
</code></pre>
<h2 id="5-a-namerefactor-relatedbugsarefactor-related-bugs">5. <a name='Refactor-relatedbugs'></a>Refactor-related bugs</h2>
<p>è®¡æ•°å™¨æ¨¡å—ç°åœ¨æ­£åœ¨å»ºé€ ä¸­å’Œè¿™ä¸ª<strong>effect</strong>ç°åœ¨æ˜¯ç®€å•å¾—å¤šã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬åœ¨å¦ä¸€ä¸ªèˆå°ä¸Šæ—‹è½¬æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°äº‹æƒ…å¹¶ä¸åƒæˆ‘ä»¬é¢„æœŸçš„é‚£æ ·è¿è¡Œã€‚é¦–å…ˆï¼Œå½“æˆ‘ä»¬ç‚¹å‡»ç¬¬nä¸ªè´¨æ•°æŒ‰é’®æ—¶ï¼Œä¼¼ä¹è¦èŠ±ç›¸å½“é•¿çš„æ—¶é—´æ‰èƒ½å¾—åˆ°å“åº”ã€‚æˆ‘ä»¬å¯ä»¥åœ¨<strong>reducer</strong>ä¸­æ·»åŠ ä¸€äº›æ—¥å¿—è®°å½•ï¼Œä»¥ä½¿ç”¨æˆ‘ä»¬åœ¨å‰é¢ç« èŠ‚ä¸­å®šä¹‰çš„æ—¥å¿—é«˜é˜¶<strong>reducer</strong>è¿›è¡Œè°ƒè¯•ã€‚</p>
<pre><code class="language-swift">reducer: logging(counterViewReducer)
</code></pre>
<p>å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨è­¦æŠ¥æ˜¾ç¤ºåœ¨å±å¹•ä¸Šä¹‹å‰å¾ˆä¹…å°±å¾—åˆ°äº†<strong>nthprimerresponse</strong>ã€‚</p>
<p>é€šè¿‡å°†è¿™ä¸ªå¼‚æ­¥<strong>effect</strong>ç§»åŠ¨åˆ°<strong>reducer</strong>ä¸­ï¼Œå¹¶å°†åŠ¨ä½œå‘é€åˆ°<strong>store</strong>ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªSwiftUIä¹‹å‰ä¸ºæˆ‘ä»¬è§£å†³çš„é—®é¢˜ã€‚</p>
<p>é—®é¢˜æ˜¯æˆ‘ä»¬åœ¨åå°çº¿ç¨‹ä¸Šæ”¹å˜äº†<strong>store</strong>çš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>URLSession</strong>æ•°æ®ä»»åŠ¡åœ¨åå°çº¿ç¨‹ä¸Šæ‰§è¡Œå®ƒä»¬çš„å®Œæˆä»£ç å—ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åœ¨åå°çº¿ç¨‹ä¸ŠæŠŠåŠ¨ä½œå‘é€å›<strong>store</strong>ï¼Œè¿™æ„å‘³ç€<strong>store</strong>çš„å€¼åœ¨åå°çº¿ç¨‹ä¸Šè¢«ä¿®æ”¹ï¼Œè¿™æ„å‘³ç€è¿™ä¸ªå€¼åœ¨åå°çº¿ç¨‹ä¸Šè¢«å‘å¸ƒåˆ°SwiftUIã€‚</p>
<p>ä»¥å‰ï¼ŒçŠ¶æ€ä½äºè§†å›¾ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è§†å›¾çš„@<strong>state wrapped</strong>å±æ€§æ›´æ–°å®ƒã€‚è¿™ä¼¼ä¹ç¡®ä¿äº†çªå˜æ€»æ˜¯å‘ç”Ÿåœ¨ä¸»çº¿ä¸Šã€‚ä½†ç°åœ¨æˆ‘ä»¬å·²ç»å°†è¿™ä¸ªçŠ¶æ€ç§»åŠ¨åˆ°ä¸€ä¸ª<strong>store</strong>ä¸­ï¼Œå¹¶ç›´æ¥é€šè¿‡<strong>ObservableObjectå’Œ@Published</strong>æœºåˆ¶å‘å¸ƒè¿™äº›æ›´æ–°ã€‚</p>
<p>è§£å†³åŠæ³•å¾ˆç®€å•ã€‚æˆ‘ä»¬å¯ä»¥æ›´æ–°æ•ˆæœï¼Œä½¿å…¶ç»“æœåœ¨ä¸»é˜Ÿåˆ—ä¸Šåˆ†æ´¾:</p>
<pre><code class="language-swift">nthPrime(n) { prime in
  DispatchQueue.main.async {
    callback(.nthPrimeResponse(prime))
  }
}
</code></pre>
<p>å½“æˆ‘ä»¬æ„å»ºå¹¶è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è­¦å‘Šä¼šåœ¨å“åº”è¿”å›æ—¶ç«‹å³å¼¹å‡ºï¼Œæ§åˆ¶å°ä¸­ä¸å†æœ‰è¿™äº›è­¦å‘Šã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬å†ç‚¹å‡»ä¸€æ¬¡æŒ‰é’®ï¼Œæç¤ºå°±ä¸ä¼šå‡ºç°äº†! æˆ‘ä»¬å¯ä»¥æ£€æŸ¥æ§åˆ¶å°ä»¥ç¡®è®¤å“åº”è‚¯å®šæ­£åœ¨ä¼ å…¥ï¼Œé‚£ä¹ˆé—®é¢˜æ˜¯ä»€ä¹ˆ?æ›´å¥‡æ€ªçš„æ˜¯ï¼Œå½“æˆ‘ä»¬é—®å…¶ä»–æœ€å–œæ¬¢çš„è´¨æ•°æ—¶ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¼šé‡åˆ°å´©æºƒã€‚</p>
<h2 id="6-a-namethinkingunidirectionallyathinking-unidirectionally">6. <a name='Thinkingunidirectionally'></a>Thinking unidirectionally</h2>
<p>æˆ‘ä»¬ä¼¼ä¹è¿˜æ¼æ‰äº†ä»€ä¹ˆã€‚å½“æˆ‘ä»¬ä¿®å¤äº†çº¿ç¨‹é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€äº›æ–°çš„ä¸œè¥¿ã€‚</p>
<p>è¿™å¯èƒ½ä¸æˆ‘ä»¬å¦‚ä½•å°†æˆ‘ä»¬çš„æ¶æ„ä¸SwiftUIçš„è­¦æŠ¥ç»‘å®šAPIæ¥å£æœ‰å…³ã€‚é€šå¸¸ï¼Œä½ å¯ä»¥é€šè¿‡ç»‘å®šæ¥æ§åˆ¶æŸäº›ç±»å‹çš„æ¼”ç¤ºï¼Œè¿™æ ·SwiftUIå°±å¯ä»¥ä¸ºä½ ç½®ç©ºä¸€äº›çŠ¶æ€ã€‚ä½†æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªâ€œ<strong>constant</strong>â€çº¦æŸï¼Œè¿™å¯èƒ½ä¼šé˜²æ­¢æˆ‘ä»¬çš„çŠ¶æ€åœ¨è­¦å‘Šè§£é™¤æ—¶æ­£ç¡®åœ°å°†äº‹æƒ…æŠ›åœ¨ä¸€è¾¹ã€‚</p>
<p>é—®é¢˜åœ¨äºè¿™ç§çŠ¶æ€æ˜¯å¦‚ä½•è¢«æ”¹å˜çš„:</p>
<pre><code class="language-swift">case let .nthPrimeResponse(nthPrime):
  state.alertNthPrime = nthPrime
</code></pre>
<p>è€Œ<strong>reducer</strong>å°†å“åº”çš„ç»“æœè®¾ç½®ä¸º<strong>nthPrime</strong>ã€‚å®ƒæ°¸è¿œä¸ä¼šæŠŠè¿™ä¸ªçŠ¶æ€ç½®ç©ºã€‚</p>
<p>å½“å†æ¬¡ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æŠŠä¸œè¥¿è®¾ä¸º<strong>nil</strong>ã€‚</p>
<pre><code class="language-swift">case .nthPrimeButtonTapped:
  state.alertNthPrime = nil
</code></pre>
<p>è¿™å…è®¸æˆ‘ä»¬è¿ç»­å¤šæ¬¡è¯·æ±‚è´¨æ•°ã€‚</p>
<p>ä½†ç­‰å¾…å¦ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»å¹¶ä¸æ˜¯ç½®ç©ºè­¦æŠ¥çŠ¶æ€çš„æ­£ç¡®ä½ç½®ã€‚å½“è­¦æŠ¥è¢«è§£é™¤æ—¶ï¼Œè­¦æŠ¥çŠ¶æ€æ¶ˆå¤±ä¼šæ›´æœ‰æ„ä¹‰ã€‚ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å¸¸é‡ç»‘å®šï¼Œæ‰€ä»¥å½“è­¦æŠ¥è¢«å–æ¶ˆæ—¶ï¼ŒSwiftUIä¸èƒ½è‡ªåŠ¨å†™åˆ°è¿™ä¸ªçŠ¶æ€ã€‚</p>
<pre><code class="language-swift">.alert(
  item: .constant(self.store.value.nthPrime)
) { alert in
  Alert(
    title: Text(&quot;The \(ordinal(self.store.value.count)) prime is \(alert.prime)&quot;),
    dismissButton: .default(Text(&quot;Ok&quot;))
  )
}
</code></pre>
<p>è­¦æŠ¥æŒ‰é’®å¯ä»¥é€‰æ‹©æ‰§è¡Œæ“ä½œã€‚</p>
<pre><code class="language-swift">Alert.Button.default(&lt;#label: Text#&gt;, action: &lt;#(() -&gt; Void)?#&gt;)
</code></pre>
<p>è¿™å¯¹äºåº”è¯¥æ‰§è¡ŒæŸäº›ä»»åŠ¡çš„è­¦æŠ¥é€‰æ‹©å¾ˆé‡è¦ã€‚ä¾‹å¦‚ï¼Œå¸¦æœ‰ç¡®è®¤æŒ‰é’®çš„è­¦æŠ¥åº”è¯¥åªåœ¨å•å‡»ç¡®è®¤æŒ‰é’®æ—¶æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªä»£ç å—å°†ä¸€ä¸ªå–æ¶ˆæ“ä½œè¿”å›ç»™<strong>store</strong>ï¼Œä»è€Œç½®ç©ºè­¦æŠ¥çŠ¶æ€ã€‚</p>
<pre><code class="language-swift">Alert(
  title: Text(&quot;The \(ordinal(self.store.value.count)) prime is \(alert.prime)&quot;),
  dismissButton: .default(Text(&quot;Ok&quot;)) {
    self.store.send(.counter(.alertDismissButtonTapped))
  }
)
</code></pre>
<p>æˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªåŠ¨ä½œå¼•å…¥åˆ°æˆ‘ä»¬çš„<strong>CounterAction</strong>ç±»å‹ä¸­ã€‚</p>
<pre><code class="language-swift">public enum CounterAction {
  case alertDismissButtonTapped
</code></pre>
<p>æˆ‘ä»¬éœ€è¦ç”¨<strong>reducer</strong>æ¥å¤„ç†å®ƒã€‚</p>
<pre><code class="language-swift">case .alertDismissButtonTapped:
  state.alertNthPrime = nil
  return []
</code></pre>
<p>å½“æˆ‘ä»¬æ„å»ºå¹¶è¿è¡Œplaygroundæ—¶ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥è¯·æ±‚ä¸€ä¸ªprimeï¼Œå–æ¶ˆè­¦æŠ¥ï¼Œå¹¶çœ‹åˆ°è¿™ä¸ªå–æ¶ˆåœ¨æ—¥å¿—ä¸­åæ˜ å‡ºæ¥ã€‚</p>
<p>æˆ‘ä»¬æœ€ç»ˆå®Œå…¨æå–äº†åº”ç”¨ç¨‹åºä¸­æœ€å¤æ‚çš„å¼‚æ­¥å‰¯ä½œç”¨ï¼Œä½¿å…¶åœ¨æˆ‘ä»¬çš„æ¶æ„ä¸­å®Œå…¨åƒä»¥å‰ä¸€æ ·å·¥ä½œã€‚åœ¨å‰è¿›çš„é“è·¯ä¸Šæœ‰ä¸€äº›éšœç¢ï¼Œä½†æˆ‘ä»¬èƒ½å¤Ÿè§£å†³æ¯ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>è¿™ä¸ª<strong>effect</strong>è‚¯å®šæ¯”å…¶ä»–çš„æ›´å¤æ‚ï¼Œæœ‰ä¸¤ä¸ªåŸå› :</p>
<ul>
<li>
<p>é¦–å…ˆï¼Œè¿™ç§<strong>effect</strong>ä¸æ˜¾ç¤ºå’Œå–æ¶ˆè­¦æŠ¥çš„æƒ³æ³•æ†ç»‘åœ¨ä¸€èµ·ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨æ¶æ„ä¸­æ²¡æœ‰è€ƒè™‘åˆ°çš„ã€‚è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦æˆ‘ä»¬è€ƒè™‘æå–ä¸è­¦æŠ¥è¡¨ç¤ºç›¸å…³è”çš„æœ¬åœ°çŠ¶æ€æ„å‘³ç€ä»€ä¹ˆï¼Œå¦‚ä½•ç®¡ç†ç»‘å®šã€åˆ é™¤ç­‰ç­‰ã€‚å¤§éƒ¨åˆ†çš„bugéƒ½å›´ç»•ç€è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥åœ¨æœªæ¥æˆ‘ä»¬å°†æ¢ç´¢ä¸SwiftUI apiæ›´å¥½çš„æ¥å£æ–¹å¼ã€‚</p>
</li>
<li>
<p>å…¶æ¬¡ï¼Œæ•ˆæœæ˜¯å¼‚æ­¥çš„!å®ƒæœ¬è´¨ä¸Šæ¯”åŒæ­¥æ•ˆåº”æ›´å¤æ‚ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘çº¿ç¨‹é—®é¢˜ï¼Œå°½ç®¡è¿™ä¸æ˜¯æ¶æ„çš„é”™è¯¯ï¼Œè€Œæ˜¯ä»»ä½•ä»è§†å›¾æå–é€»è¾‘åˆ°å¯è§‚å¯Ÿå¯¹è±¡çš„äººéƒ½ä¼šé‡åˆ°çš„é—®é¢˜ã€‚</p>
</li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†æˆ‘ä»¬çš„<strong>effect</strong>ç±»å‹:ç±»ä¼¼äºå¹³è¡Œçš„å½¢çŠ¶ï¼Œåœ¨è¿™é‡Œæ‚¨å¯ä»¥å°†ä¸€ä¸ªå‡½æ•°ä¼ é€’ç»™å…¶ä»–äººï¼Œä»–ä»¬å¯ä»¥åšä»–ä»¬çš„å·¥ä½œï¼Œå¹¶åœ¨å‡†å¤‡å¥½çš„æ—¶å€™è°ƒç”¨è¯¥å‡½æ•°ã€‚æˆ‘ä»¬æœ‰<strong>reducer</strong>çš„å½¢çŠ¶ï¼Œå®ƒå¯ä»¥åœ¨æ•°ç»„ä¸­è¿”å›ä»»æ„æ•°é‡çš„<strong>effect</strong>ï¼Œç»“æœå¯ä»¥åé¦ˆåˆ°<strong>store</strong>ä¸­ã€‚<br>
åšä¸€ä¸ª<a href="https://www.pointfree.co/episodes/ep40-async-functional-refactoring">å¼‚æ­¥çš„å‡½æ•°é‡æ„</a>ï¼Œè®©ä¸€åˆ‡éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<p>æˆ‘ä»¬è¿˜èƒ½å¤Ÿæ¥å—â€œå•å‘æ•°æ®æµâ€çš„æƒ³æ³•ã€‚å³ä½¿æœ‰äº†æ•ˆæœå’Œå¼‚æ­¥æ€§å¸¦æ¥çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿæ¨æ–­å‡ºæ•°æ®å¦‚ä½•åœ¨åº”ç”¨ä¸­æµåŠ¨ï¼Œå› ä¸º<strong>effect</strong>åªèƒ½é€šè¿‡é€šè¿‡<strong>store</strong>å‘é€å›çš„åŠ¨ä½œæ”¹å˜åº”ç”¨çš„çŠ¶æ€ã€‚<strong>store</strong>æ˜¯çªå˜çš„å”¯ä¸€å…¥å£ã€‚è¿™æ˜¯æˆ‘ä»¬æ¶æ„ä¸­<strong>effects</strong>æ•…äº‹çš„åŸºæœ¬ç‰ˆæœ¬ã€‚</p>
<h2 id="7-a-namewhatsthepointawhats-the-point">7. <a name='Whatsthepoint'></a>Whatâ€™s the point?</h2>
<p>è¿™äº›éƒ½æ˜¯å¾ˆé…·çš„ä¸œè¥¿ï¼Œä½†æ˜¯åœ¨point - freeçš„æ¯ä¸€é›†çš„ç»“å°¾ï¼Œæˆ‘ä»¬å–œæ¬¢åæ€ä¸€ä¸‹å·²ç»å®Œæˆäº†ä»€ä¹ˆï¼Œå¹¶é—®â€œæœ‰ä»€ä¹ˆæ„ä¹‰?â€ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè™½ç„¶å®ƒå¾ˆé…·ï¼Œæˆ‘ä»¬èƒ½å¤ŸæŠŠä¸€äº›ä»£ç ä»è§†å›¾ä¸­é‡æ„åˆ°<strong>reducer</strong>ä¸­ï¼Œä½†å®ƒçœŸçš„æ„Ÿè§‰æˆ‘ä»¬åªæ˜¯åœ¨ç§»åŠ¨ä»£ç ã€‚ä¸å…¶åœ¨è§†å›¾ä¸­çš„é—­åŒ…ä¸­ä¿å­˜å‰¯ä½œç”¨ä»£ç ï¼Œä¸å¦‚åœ¨<strong>reducer</strong>ä¸­çš„é—­åŒ…ä¸­ä¿å­˜å‰¯ä½œç”¨ä»£ç ã€‚è¿™çœŸçš„æœ‰æ•ˆæœå—?é‡æ„çš„ç›®çš„æ˜¯ä»€ä¹ˆ?</p>
<p>è™½ç„¶è¿™çœ‹èµ·æ¥åªæ˜¯ä¸€ä¸ªä»£ç é‡ç»„ï¼Œä½†å®é™…ä¸Šè¿™åªæ˜¯å°†æˆ‘ä»¬çš„ç®€åŒ–ç¨‹åºè½¬å˜ä¸ºæ”¯æŒæˆ‘ä»¬æ•´ä¸ªåº”ç”¨ç¨‹åºçš„å¥å£®ä¸šåŠ¡é€»è¾‘å•å…ƒçš„è®¸å¤šæ­¥éª¤ä¸­çš„ç¬¬ä¸€æ­¥ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œ<strong>reducer</strong>æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„ã€å¯ç»„åˆçš„å•å…ƒï¼Œå¯ä»¥è¿è¡Œæˆ‘ä»¬çš„çŠ¶æ€ç®¡ç†å’Œçªå˜ï¼Œå› æ­¤ï¼Œè®©å®ƒä»¬è´Ÿè´£äº§ç”Ÿå‰¯ä½œç”¨ä¹Ÿå¯èƒ½æœ‰å¾ˆå¤šå¥½å¤„ã€‚æˆ‘ä»¬ä¸‹æ¬¡å†æ¥çœ‹çœ‹å§!</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/i-r9uoo_2N/" class="tag">
                    PointFree
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/pointfree-episode-77effectful-state-management-unidirectional-effects/">
                  <h3 class="post-title">
                    PointFree Episode 77:Effectful State Management: Unidirectional Effects
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
