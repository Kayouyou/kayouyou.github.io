<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>PointFree Episode 75:Modular State Management: The Point | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1656760144499">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="



The favorite primes app




The prime modal app




The counter app




Fixing the root app




Conclusion






1. ..." />
    <meta name="keywords" content="PointFree" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1656760144499" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">PointFree Episode 75:Modular State Management: The Point</h2>
            <div class="post-date">2021-11-20</div>
            
            <div class="post-content" v-pre>
              <!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#Thefavoriteprimesapp">The favorite primes app</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="#Theprimemodalapp">The prime modal app</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#Thecounterapp">The counter app</a></li>
</ol>
</li>
<li>
<ol start="4">
<li><a href="#Fixingtherootapp">Fixing the root app</a></li>
</ol>
</li>
<li>
<ol start="5">
<li><a href="#Conclusion">Conclusion</a></li>
</ol>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<!-- # PointFree Episode 75:Modular State Management: The Point -->
<h2 id="1-a-namethefavoriteprimesappathe-favorite-primes-app">1. <a name='Thefavoriteprimesapp'></a>The favorite primes app</h2>
<p><strong>FavoritesPrimeView</strong>å¯èƒ½æ˜¯æœ€ç®€å•çš„å¼€å§‹ï¼Œæ‰€æœ‰æˆ‘ä»¬è¦åšçš„æ˜¯åˆ›å»ºä¸€ä¸ªæ‰˜ç®¡è§†å›¾æ§åˆ¶å™¨ï¼Œæˆ‘ä»¬çš„è§†å›¾é…ç½®äº†ä¸€ä¸ª<strong>store</strong>:</p>
<pre><code class="language-swift">import ComposableArchitecture
import FavoritePrimes
import SwiftUI
import PlaygroundSupport

PlaygroundPage.current.liveView = UIHostingController(
  rootView: FavoritePrimesView(
    store: Store&lt;[Int], FavoritePrimesAction&gt;(
      initialValue: [],
      reducer: favoritePrimesReducer
    )
  )
)
</code></pre>
<p>è¿™ä¸ªè§†å›¾åªåŒ…å«ä¸€ä¸ªç©ºçš„thisï¼Œä½†é‚£æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ç»™å®ƒä»»ä½•åˆå§‹å€¼çš„æ•°æ®ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æä¾›ä¸€äº›æ•°æ®ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å—æ¬¢è¿çš„åˆ—è¡¨ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ä»åˆ—è¡¨ä¸­åˆ é™¤:</p>
<pre><code class="language-swift">PlaygroundPage.current.liveView = UIHostingController(
  rootView: FavoritePrimesView(
    store: Store&lt;[Int], FavoritePrimesAction&gt;(
      initialValue: [2, 3, 5, 7, 11],
      reducer: favoritePrimesReducer
    )
  )
)
</code></pre>
<p>æ‰€ä»¥è¿™ä¸ªè§†å›¾å¯ä»¥å•ç‹¬è¿è¡Œï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ª<strong>store</strong>æ¥ä¿å­˜å®ƒçš„çªå˜ï¼Œå°±åœ¨<strong>playground</strong>ä¸Šã€‚ ç„¶è€Œï¼Œå½“å®ƒåœ¨å®Œæ•´çš„åº”ç”¨ç¨‹åºä¸­è¿è¡Œæ—¶ï¼Œå®ƒæ‰€æäº¤çš„<strong>store</strong>å®é™…ä¸Šåªæ˜¯å¯¹é©±åŠ¨æ•´ä¸ªåº”ç”¨ç¨‹åºçš„å…¨å±€<strong>store</strong>çš„ä¸€ä¸ªè§†å›¾ã€‚äº‹å®ä¸Šï¼Œ<strong>playground</strong>ä¸å‡†ä¹Ÿä¸èƒ½è®¿é—®ä¸»åº”ç”¨ç¨‹åºä»£ç ã€‚</p>
<h2 id="2-a-nametheprimemodalappathe-prime-modal-app">2. <a name='Theprimemodalapp'></a>The prime modal app</h2>
<p>æœ€å—æ¬¢è¿è´¨æ•°è§†å›¾å¾ˆç®€å•ï¼Œè®©æˆ‘ä»¬è¯•è¯•æ›´å¤æ‚çš„ä¸œè¥¿:è´¨æ•°æ¨¡æ€è§†å›¾ã€‚æˆ‘ä»¬èƒ½åœ¨ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„<strong>store</strong>é‡Œè¿è¡Œå—?</p>
<pre><code class="language-swift">import PrimeModal

PlaygroundPage.current.liveView = UIHostingController(
  rootView: IsPrimeModalView(
    store: Store&lt;PrimeModalState, PrimeModalAction&gt;(
      initialValue: (0, []),
      reducer: primeModalReducer
    )
  )
)
</code></pre>
<p>è¿™é©¬ä¸Šå°±å‘Šè¯‰æˆ‘ä»¬ï¼Œå½“æˆ‘ä»¬æ˜¾ç¤ºä¸€ä¸ªéç´ æ•°æ—¶ï¼Œè§†å›¾æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚ å¦‚æœæˆ‘ä»¬æ›´æ–°åˆå§‹å€¼æˆ‘ä»¬ä¼šçœ‹åˆ°è´¨æ•°æ˜¯ä»€ä¹ˆæ ·å­çš„:</p>
<pre><code class="language-swift">initialValue: (2, []),
</code></pre>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥ç‚¹å‡»æ·»åŠ /åˆ é™¤æŒ‰é’®å‡ æ¬¡ï¼Œå®ƒå®é™…ä¸Šæ”¹å˜äº†è¿™ä¸ªæ”¶è—æ•°ç»„ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨åˆå§‹å€¼ä¸­åŠ å…¥ä¸€äº›æˆ‘ä»¬å–œæ¬¢çš„å…ƒç´ ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç¡®ä¿çœ‹èµ·æ¥æ˜¯æ­£ç¡®çš„:</p>
<pre><code class="language-swift">initialValue: (2, [2, 3, 5]),
</code></pre>
<p>è¿™æ˜¯åœ¨æ“åœºä¸Šåˆ›å»ºçš„<strong>store</strong>çš„å¦ä¸€ä¸ªè§†å›¾ã€‚å®ƒä¸æ˜¯åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„å…¨å±€<strong>store</strong>ä¸­è¿è¡Œçš„ã€‚</p>
<h2 id="3-a-namethecounterappathe-counter-app">3. <a name='Thecounterapp'></a>The counter app</h2>
<p>å› æ­¤ï¼Œè¿™ä¸¤ä¸ªå±å¹•éå¸¸å®¹æ˜“åŠ è½½å¹¶ç‹¬ç«‹è¿è¡Œã€‚è®©æˆ‘ä»¬è¯•è¯•æœ€åä¸€ä¸ªå±å¹•ï¼Œ<strong>counter view</strong>ã€‚å¦‚æœæˆ‘ä»¬å°è¯•åšä¹‹å‰çš„å±å¹•ï¼Œæˆ‘ä»¬å°†é‡åˆ°ä¸€ä¸ªé—®é¢˜:</p>
<pre><code class="language-swift">import Counter

PlaygroundPage.current.liveView = UIHostingController(
  rootView: CounterView(
    store: Store&lt;CounterViewState, CounterViewAction&gt;(
      initialValue: (0, []),
      reducer: ???
    )
  )
)
</code></pre>
<p>æˆ‘ä»¬è¿™é‡Œæ²¡æœ‰è®¡æ•°å™¨è§†å›¾<strong>reducer</strong>ã€‚ æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¡æ•°å™¨<strong>reducer</strong>ï¼Œä½†å®ƒåªå…³æ³¨é€’å¢å’Œé€’å‡çš„é€»è¾‘ã€‚æˆ‘ä»¬ä¹Ÿæœ‰ä¸€ä¸ªä¸»è¦æ¨¡æ€<strong>reducer</strong>ï¼Œå®ƒä¸“æ³¨äºæ˜¾ç¤ºä¸»è¦æ¨¡æ€å’Œç®¡ç†ä»ä¸€ä¸ªæ”¶è—å¤¹ä¸­æ·»åŠ å’Œåˆ é™¤ä¸€ä¸ªä¸»è¦æ¨¡æ€ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŠŠè¿™ä¸¤ä¸ª<strong>reducer</strong>æ†ç»‘åœ¨ä¸€èµ·çš„<strong>reducer</strong>ã€‚</p>
<p>çœ‹èµ·æ¥å¥½åƒæˆ‘ä»¬çš„<strong>reducers</strong>æ²¡æœ‰è¢«æ­£ç¡®åˆ†è§£ã€‚è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¸€ä¸ªä»£è¡¨<strong>counter</strong>è§†å›¾çš„å•ä¸€<strong>reducer</strong>ï¼Œè€Œæ˜¯æˆ‘ä»¬æœ‰ä¸¤ä¸ª<strong>reducers</strong>åˆå¹¶åœ¨åº”ç”¨<strong>reducer</strong>ä¸­:</p>
<pre><code class="language-swift">pullback(counterReducer, value: \.count, action: \.counter),
pullback(primeModalReducer, value: \.primeModal, action: \.primeModal),
</code></pre>
<p>è¿™ä¸ª<strong>reducer</strong>çš„ç»„åˆå®é™…ä¸Šæ˜¯<strong>counter view</strong>çš„åŠ¨åŠ›ï¼Œä½†å®ƒå­˜åœ¨äºæˆ‘ä»¬çš„åº”ç”¨ç›®æ ‡ä¸­ï¼Œè€Œä¸æ˜¯<strong>Counter model</strong>ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œåº”ç”¨ç›®æ ‡ä¸­çš„æ‰€æœ‰å†…å®¹åœ¨<strong>playgrounds</strong>éƒ½æ˜¯ä¸å¯è®¿é—®çš„ã€‚</p>
<p>ä¹Ÿè®¸è¿™ä¸ªç»„åˆçš„<strong>reducer</strong>åº”è¯¥è¢«æ‹‰å‡ºåˆ°æ“ä½œ<strong>CounterView</strong>çš„<strong>counterViewReducer</strong>ä¸­ã€‚è®©æˆ‘ä»¬å¤åˆ¶è¿™äº›è¡Œï¼Œå°†å®ƒä»¬æ³¨é‡Šæ‰ï¼Œç„¶ååˆ‡æ¢åˆ°<strong>Counter</strong>æ¨¡å—(å®é™…ä¸Šä¹Ÿå°†ç›®æ ‡åˆ‡æ¢åˆ°<strong>Counter</strong>)æ¥è®¾ç½®ä¸€ä¸ªåŸºæœ¬çš„<strong>reducer</strong>ç­¾å:</p>
<pre><code class="language-swift">let counterViewReducer: (inout CounterViewState, CounterViewAction) -&gt; Void = combine(
  pullback(counterReducer, value: \.count, action: \.counter),
  pullback(primeModalReducer, value: \.primeModal, action: \.primeModal),
)
</code></pre>
<p>è¿™åŸºæœ¬ä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†è¿™é‡Œçš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬ä¸å†æœ‰ç”¨äºå›æ‹‰çš„<strong>enum</strong>é”®è·¯å¾„ã€‚æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå°†è®¡æ•°å™¨å’Œä¸»è¦æ¨¡æ€åŠ¨ä½œæ‹‰å›<strong>CounterViewAction enum</strong>ä¸­ã€‚è¿™äº›å…³é”®è·¯å¾„ç›®å‰ä½äº<strong>AppAction</strong>ä¸Šï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦æå–åˆ°<strong>Counter</strong>æ¨¡å—ä¸­çš„å†…å®¹ã€‚</p>
<p>æˆ‘ä»¬æŠŠå®ƒä»¬å‰ªåˆ‡ç²˜è´´åˆ°<strong>CounterViewAction</strong>æšä¸¾ä¸­:</p>
<pre><code class="language-swift">var counter: CounterAction? {
  get {
    guard case let .counter(value) = self else { return nil }
    return value
  }
  set {
    guard case .counter = self, let newValue = newValue else { return }
    self = .counter(newValue)
  }
}

var primeModal: PrimeModalAction? {
  get {
    guard case let .primeModal(value) = self else { return nil }
    return value
  }
  set {
    guard case .primeModal = self, let newValue = newValue else { return }
    self = .primeModal(newValue)
  }
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬çš„ç»„åˆ<strong>reducer</strong>å·²ç»æ¥è¿‘ç¼–è¯‘ï¼Œä½†æˆ‘ä»¬ä¸å†éœ€è¦å›æ‹‰ä¸»æ¨¡æ€çŠ¶æ€ï¼Œå› ä¸ºå®ƒç°åœ¨åœ¨å…¨è®¡æ•°å™¨è§†å›¾çŠ¶æ€ä¸‹è¿è¡Œã€‚</p>
<p>è¿™ä¸¤ä¸ªåŠŸèƒ½éƒ½ä½¿ç”¨è®¡æ•°å™¨å’Œæœ€å–œæ¬¢çš„è´¨æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡è¯†é”®è·¯å¾„æ¥ä¿®å¤è¿™ä¸ªç¼–è¯‘å™¨é”™è¯¯:</p>
<pre><code class="language-swift">public let counterViewReducer: (inout CounterViewState, CounterViewAction) -&gt; Void = combine(
  pullback(counterReducer, value: \.count, action: \.counter),
  pullback(primeModalReducer, value: \.self, action: \.primeModal)
)
</code></pre>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥åˆ é™¤æ˜¾å¼çš„<strong>reducer</strong>ç­¾åå¦‚æœæˆ‘ä»¬åªéœ€è¦è¾“å…¥ä¸€äº›é”®è·¯å¾„ç±»å‹ï¼Œè¿™å¯èƒ½ä¼šå°‘ä¸€ç‚¹å¹²æ‰°:</p>
<pre><code class="language-swift">public let counterViewReducer = combine(
  pullback(counterReducer, value: \CounterViewState.count, action: \CounterViewAction.counter),
  pullback(primeModalReducer, value: \.self, action: \.primeModal)
)
</code></pre>
<p>æˆ‘ä»¬çš„<strong>Counter</strong>æ¨¡å—ç°åœ¨æ­£åœ¨æ„å»ºï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åˆ‡æ¢å›<strong>playground</strong>ï¼Œæ›´æ–°ä»£ç æ¥ä½¿ç”¨è¿™ä¸ªæ–°çš„<strong>reducer</strong>ï¼Œå¹¶å®Œå…¨ç‹¬ç«‹åœ°è¿è¡Œè¿™ä¸ªå±å¹•:</p>
<pre><code class="language-swift">import Counter

PlaygroundPage.current.liveView = UIHostingController(
  rootView: CounterView(
    store: Store&lt;CounterViewState, CounterViewAction&gt;(
      initialValue: (2, []),
      reducer: counterViewReducer
    )
  )
)
</code></pre>
<p>ä½†ç°åœ¨æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æµ‹è¯•é‚£äº›åœ¨å…¶ä»–æƒ…å†µä¸‹å¾ˆéš¾é‡å»ºçš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿæ•°åˆ°ä¸€ç™¾ä¸‡ã€‚</p>
<pre><code class="language-swift">initialValue: (1_000_000, []),
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥é—®Wolfram Alphaç¬¬ä¸€ç™¾ä¸‡ä¸ªè´¨æ•°ã€‚</p>
<p>è¿™å¤ªä¸å¯æ€è®®äº†! è¿™3ä¸ªå±å¹•å¯ä»¥å®Œå…¨ç‹¬ç«‹è¿è¡Œï¼Œä½†å®ƒä»¬ä¹Ÿå¯ä»¥è¢«æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œè¿™æ ·å®ƒä»¬å°±éƒ½è„±ç¦»äº†ç›¸åŒçš„å…¨å±€çŠ¶æ€ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æ¨¡å—åŒ–ã€å¯ç»„åˆçš„æ¶æ„!</p>
<p>å¾ˆå¿«ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åˆ é™¤è¿™ä¸ªæ¸¸ä¹åœºï¼Œè€Œä½¿ç”¨Xcodeé¢„è§ˆï¼Œå®ƒå…è®¸ä½ ç›´æ¥åœ¨Xcodeä¸­è¿è¡Œä½ çš„è§†å›¾ã€‚è¿™å°†æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬æ­£åœ¨å½•åˆ¶çš„ç”µè„‘æ²¡æœ‰å®‰è£…å¡ç‰¹ç³å¨œæ¥æ¼”ç¤ºè¿™ä¸€ç‚¹ï¼Œè€Œä¸”é¢„è§ˆåŠŸèƒ½ä¸å¤Ÿç¨³å®šï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨ä¸€é›†ä¸­ä½¿ç”¨ã€‚</p>
<p>è¿™é‡Œå‘ç”Ÿçš„äº‹æƒ…å¾ˆç¥å¥‡ã€‚ç°åœ¨æˆ‘ä»¬çš„<strong>storeå’ŒSwiftUI</strong>å‡ ä¹æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å°†åœ¨æœªæ¥çš„ç« èŠ‚ä¸­å±•ç¤ºå¦‚ä½•å°†æˆ‘ä»¬çš„<strong>store</strong>ç”¨äºUIKitåº”ç”¨ç¨‹åºï¼Œç”šè‡³ä½¿ç”¨é—ç•™çš„Objective-Cä»£ç !  æ‰€ä»¥è¿™ä¸ªæ¶æ„è¿œä¸æ­¢äº<strong>SwiftUI</strong>ï¼Œå°½ç®¡å®ƒåœ¨ä½¿ç”¨<strong>SwiftUI</strong>æ—¶ç¡®å®å¾ˆå‡ºè‰²ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ç”šè‡³å¯ä»¥åƒè¿™æ ·å•ç‹¬è¿è¡Œ<strong>uiviewå’Œuiviewcontroller</strong>ã€‚æ‚¨å°†èƒ½å¤Ÿä½¿ç”¨é€‚å½“çš„åˆå§‹å€¼å’Œ<strong>reducer</strong>åˆ›å»ºä¸€ä¸ª<strong>store</strong>ï¼Œå°†å…¶äº¤ç»™æ§åˆ¶å™¨ï¼Œç„¶åæ‚¨å°±å¯ä»¥ç¦»å¼€äº†!è¿™å°†â€œæ¸¸ä¹åœºé©±åŠ¨å¼€å‘â€å¸¦åˆ°ä¸€ä¸ªå…¨æ–°çš„æ°´å¹³ã€‚</p>
<h2 id="4-a-namefixingtherootappafixing-the-root-app">4. <a name='Fixingtherootapp'></a>Fixing the root app</h2>
<p>ä½†ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œæˆ‘ä»¬çš„é‡æ„å®é™…ä¸Šç ´åäº†æˆ‘ä»¬çš„ä¸»åº”ç”¨ç›®æ ‡ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿä¿®å¤å®ƒã€‚</p>
<p>æˆ‘ä»¬æƒ³è¦åšçš„æ˜¯ç”¨æœ€å–œæ¬¢çš„è´¨æ•°<strong>reducer</strong>å’Œå…¨æ–°çš„è®¡æ•°å™¨è§†å›¾<strong>reducer</strong>ç»„æˆåº”ç”¨ç¨‹åº<strong>reducer</strong>ã€‚</p>
<pre><code class="language-swift">let appReducer: (inout AppState, AppAction) -&gt; Void = combine(
//  pullback(counterReducer, value: \.count, action: \.counter),
//  pullback(primeModalReducer, value: \.primeModal, action: \.primeModal),
  pullback(counterViewReducer, value: \.counterView, action: \.counterView),
  pullback(favoritePrimesReducer, value: \.favoritePrimes, action: \.favoritePrimes)
)
</code></pre>
<p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›è¿›å…¥counterViewçš„å…³é”®è·¯å¾„ç°åœ¨å¹¶ä¸å­˜åœ¨ã€‚æˆ‘ä»¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬é‡æ„<strong>AppAction</strong>ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨æƒ³æŠŠæ‰€æœ‰çš„<strong>counter</strong>è§†å›¾æ“ä½œæ†ç»‘åˆ°ä¸€ä¸ª<strong>case</strong>ä¸­:</p>
<pre><code class="language-swift">//  case counter(CounterAction)
//  case primeModal(PrimeModalAction)
case counterView(CounterViewAction)
</code></pre>
<p>æˆ‘ä»¬è¿˜æƒ³ä¸º<strong>counterView</strong>æ¡ˆä¾‹ç”Ÿæˆä¸€ä¸ªæ–°çš„<strong>enum</strong>å±æ€§ã€‚æ¯æ¬¡æˆ‘ä»¬åœ¨å…¨å±€æ“ä½œä¸­åµŒå…¥ä¸€ä¸ªæ›´å±€éƒ¨çš„æ“ä½œæ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¸€ä¸ª<strong>enum</strong>é”®è·¯å¾„ï¼Œè¯¥è·¯å¾„å°†å…è®¸æˆ‘ä»¬æ²¿ç€è¯¥è§†å›¾æ‹‰å›ä»¥ä¾¿å°†<strong>reducer</strong>ç»„åˆåœ¨ä¸€èµ·ã€‚<strong>Enum</strong>å±æ€§ä¸ºæˆ‘ä»¬æä¾›äº†è¿™äº›å…³é”®è·¯å¾„ï¼Œåœ¨è¿‡å»çš„å‡ èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™äº†ä¸€ä¸ªå·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆè¿™äº›å±æ€§ã€‚</p>
<p>è®©æˆ‘ä»¬è·³åˆ°å‘½ä»¤è¡Œå¹¶è¿è¡Œå®ƒã€‚</p>
<pre><code class="language-swift">$ swift run generate-enum-properties ./PrimeTime/ContentView.swift
Updating PrimeTime/ContentView.swift
</code></pre>
<p>è¯¥å·¥å…·ç°åœ¨å·²ç»è‡ªåŠ¨ä¸º<strong>counterView case</strong>æ’å…¥äº†ä¸€ä¸ªæ–°çš„<strong>enum</strong>å±æ€§ã€‚</p>
<pre><code class="language-swift">var counterView: CounterViewAction? {
  get {
    guard case let .counterView(value) = self else { return nil }
    return value
  }
  set {
    guard case .counterView = self, let newValue = newValue else { return }
    self = .counterView(newValue)
  }
}
</code></pre>
<p>è¿™å·²ç»æ»¡è¶³äº†ä¸€åŠçš„æ‹‰å›è®¡æ•°å™¨è§†å›¾<strong>reducer</strong>ã€‚</p>
<pre><code class="language-swift">pullback(counterViewReducer, value: \.counterView, action: \.counterView),
</code></pre>
<p>å¯¹äºè®¡æ•°å™¨è§†å›¾çŠ¶æ€ï¼Œè·å¾—ä¸€ä¸ªå¯å†™çš„é”®è·¯å¾„æ˜¯ç›¸å½“å®¹æ˜“çš„ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª<strong>getter</strong>ï¼Œæˆ‘ä»¬ä»¥å‰ç”¨è¿‡æ‹‰å›ä¸»è¦æ¨¡å¼çŠ¶æ€ï¼Œå¹¶å°†å…¶å‡çº§åˆ°è®¡æ•°å™¨è§†å›¾çŠ¶æ€:</p>
<pre><code class="language-swift">extension AppState {
  var counterView: CounterViewState {
    get {
      CounterViewState(
        count: self.count,
        favoritePrimes: self.favoritePrimes
      )
    }
    set {
      self.count = newValue.count
      self.favoritePrimes = newValue.favoritePrimes
    }
  }
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥åœ¨é€‚å½“çš„åœ°æ–¹æ›´æ–°å®ƒï¼Œå› ä¸ºæˆ‘ä»¬ç”šè‡³ä¸éœ€è¦åº”ç”¨ç¨‹åºç›®æ ‡æ¥æ‹…å¿ƒä¸»è¦æ¨¡æ€çŠ¶æ€ã€‚æ‰€æœ‰è¿™äº›é—®é¢˜éƒ½è¢«ä¸‹æ¨åˆ°è®¡æ•°å™¨æ¨¡å—ä¸­ã€‚</p>
<p><strong>app reducer</strong> ç°åœ¨å·²ç»æˆåŠŸåœ°ç”±è®¡æ•°å™¨è§†å›¾<strong>reducer</strong>å’Œæœ€å–œçˆ±çš„prime<strong>reducer</strong>ç»„æˆï¼Œä½†æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œå…¨æ„å»ºï¼Œå› ä¸ºæ´»åŠ¨feedä»ç„¶åœ¨<strong>counterå’Œprime</strong>æ¨¡æ€åŠ¨ä½œçš„å¹³é¢ä¸–ç•Œä¸­å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿›ä¸€æ­¥åµŒå¥—è¿™äº›æƒ…å†µæ¥è½»æ¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<pre><code class="language-swift">case .counterView(.counter):
  â€¦
case .counterView(.primeModal(.removeFavoritePrimeTapped)):
  â€¦
case .counterView(.primeModal(.saveFavoritePrimeTapped)):
</code></pre>
<p>æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†æœ€åä¸€ç»„é”™è¯¯ï¼Œå³å°†å…¨å±€<strong>store</strong>è½¬æ¢ä¸ºè®¡æ•°å™¨è§†å›¾<strong>store</strong>ã€‚</p>
<pre><code class="language-swift">NavigationLink(
  &quot;Counter demo&quot;,
  destination: CounterView(
    store: self.store
      .view(
        value: { ($0.count, $0.favoritePrimes) },
        action: {
          switch $0 {
          case let .counter(action):
            return AppAction.counter(action)
          case let .primeModal(action):
            return AppAction.primeModal(action)
          }
      }
    )
  )
)
</code></pre>
<blockquote>
<p>ğŸ›‘ Type â€˜AppActionâ€™ has no member â€˜counterâ€™<br>
ğŸ›‘ Type â€˜AppActionâ€™ has no member â€˜primeModalâ€™</p>
</blockquote>
<p>è¿™é‡Œæˆ‘ä»¬æ‰‹åŠ¨åˆ‡æ¢æ¯ä¸ªè®¡æ•°å™¨è§†å›¾ï¼Œä»¥ä¾¿å°†å…¶é‡æ–°åµŒå…¥åˆ°é€‚å½“çš„åº”ç”¨ç¨‹åºæ“ä½œä¸­ã€‚ä½†ç°åœ¨<strong>AppAction</strong>æœ‰ä¸€ä¸ªç‰¹å®šçš„<strong>counterView</strong>æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç®€åŒ–ä¸ºä¸€è¡Œä»£ç ã€‚</p>
<pre><code class="language-swift">NavigationLink(
  &quot;Counter demo&quot;,
  destination: CounterView(
    store: self.store
      .view(
        value: { ($0.count, $0.favoritePrimes) },
        action: { .counterView($0) }
      }
    )
  )
)
</code></pre>
<p>æˆ‘ä»¬åœ¨<strong>AppState</strong>ä¸Šä¹Ÿæœ‰<strong>counterView</strong>å±æ€§ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è®©ä¸œè¥¿çœ‹èµ·æ¥æ¼‚äº®å’Œå¯¹ç§°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒè€Œä¸æ˜¯æ‰‹åŠ¨æ„å»ºå…ƒç»„ã€‚</p>
<pre><code class="language-swift">NavigationLink(
  &quot;Counter demo&quot;,
  destination: CounterView(
    store: self.store
      .view(
        value: { $0.counterView },
        action: { .counterView($0) }
      }
    )
  )
)
</code></pre>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ä¸»åº”ç”¨å˜å¾—å¤šä¹ˆç®€å•! å®ƒæ‰€è´Ÿè´£çš„åªæ˜¯å£°æ˜å®Œæ•´çš„åº”ç”¨çŠ¶æ€ã€åº”ç”¨åŠ¨ä½œï¼Œç„¶åä»å®ƒå¯¼å…¥çš„æ¨¡å—ä¸­å°†æ‰€æœ‰å…¶ä»–å†…å®¹ç»„åˆåˆ°ä¸€ä¸ª<strong>app reducer</strong>å’Œæ ¹å†…å®¹è§†å›¾ä¸­ã€‚å®ƒç”šè‡³æ¯”è¿™ä¸ªå…³äºæ¨¡å—åŒ–çš„ç³»åˆ—å¼€å§‹æ—¶ç¼©å‡äº†200è¡Œ!</p>
<p>åœ¨æˆ‘ä»¬æœ€è¿‘çš„é‡æ„ä¸­ï¼Œæˆ‘ä»¬æŠŠå…³äº<strong>prime</strong>æ¨¡æ€æ¨¡å—çš„æ‰€æœ‰ä¸œè¥¿éƒ½æ¨åˆ°<strong>counter</strong>è§†å›¾æ¨¡å—ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”šè‡³å¯ä»¥åˆ é™¤é¢å¤–çš„ä¸€è¡Œï¼Œåœ¨è¿™ä¸€è¡Œæˆ‘ä»¬å¯¼å…¥<strong>prime</strong>æ¨¡æ€æ¨¡å—ï¼Œè¿™ä¿è¯äº†ä¸»åº”ç”¨ç¨‹åºå¯¹<strong>prime</strong>æ¨¡æ€å±å¹•ä¸€æ— æ‰€çŸ¥ã€‚</p>
<pre><code class="language-swift">//import PrimeModal
</code></pre>
<h2 id="5-a-nameconclusionaconclusion">5. <a name='Conclusion'></a>Conclusion</h2>
<p>æˆ‘ä»¬å·²ç»åšäº†æˆ‘ä»¬æƒ³åšçš„äº‹æƒ…:é€šè¿‡å°†æ¯ä¸ªå±å¹•çš„çŠ¶æ€ã€åŠ¨ä½œã€å‡é€Ÿå™¨å’Œè§†å›¾ç§»åŠ¨åˆ°å®ƒä»¬è‡ªå·±çš„æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®Œå…¨æ¨¡å—åŒ–äº†åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¯¹å®ƒè¿›è¡Œäº†æ¨¡å—åŒ–ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å®ƒè‡ªå·±çš„æ“åœºä¸Šè¿è¡Œæ¯ä¸ªå±å¹•ï¼Œä¸ä¸»åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å®Œå…¨éš”ç¦»ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿™å°±æ˜¯åœ¨å‡é€Ÿå™¨æ¶æ„ä¸ŠæŠ•å…¥æ›´å¤šèƒ½é‡çš„è¦ç‚¹ã€‚é€šè¿‡ä¸“é—¨ç ”ç©¶å¦‚ä½•åˆ†è§£å’Œç»„åˆ<strong>reducer</strong>å’Œ<strong>store</strong>ï¼Œæˆ‘ä»¬å·²ç»ä¸ºè‡ªå·±æä¾›äº†å°†åº”ç”¨ç¨‹åºåˆ†è§£ä¸ºè®¸å¤šæ›´å°çš„åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚è¿™äº›åº”ç”¨ç¨‹åºç”šè‡³å¯ä»¥å­˜åœ¨äºå®ƒä»¬è‡ªå·±çš„Swiftæ¨¡å—ä¸­ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªåº”ç”¨ç¨‹åºå®Œå…¨ä¸å¯èƒ½ä¸å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºäº¤äº’ï¼Œé™¤éå…¶ä¸­ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºå­˜åœ¨æ˜¾å¼ä¾èµ–å…³ç³»ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æµ‹è¯•è¿™äº›æ¨¡å—:ä¸ä»…æ˜¯å•å…ƒæµ‹è¯•ï¼Œè¿˜æœ‰å¿«ç…§æµ‹è¯•! æ‚¨å°†èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªå…·æœ‰æ‚¨æƒ³è¦çš„ä»»ä½•åˆå§‹çŠ¶æ€çš„<strong>store</strong>ï¼Œå°†å…¶ä¼ é€’ç»™è§†å›¾ï¼Œç„¶åå¿«ç…§æ§åˆ¶å™¨ã€‚ä½ ç”šè‡³å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œå‘<strong>store</strong>å‘é€åŠ¨ä½œï¼Œæ¨¡æ‹Ÿç”¨æˆ·åœ¨å±å¹•ä¸Šç‚¹å‡»æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œç„¶åå†å¯¹æ§åˆ¶å™¨è¿›è¡Œå¿«ç…§ã€‚</p>
<p>å¥½çš„ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°æˆ‘ä»¬å¯ä»¥å®Œå…¨æ¨¡å—åŒ–æˆ‘ä»¬çš„<strong>reducers</strong>å’Œå®ƒä»¬çš„è§†å›¾ã€‚æˆ‘ä»¬å·²ç»å®Œå…¨è§£å†³äº†5ä¸ªé—®é¢˜ä¸­çš„3ä¸ªï¼Œè¿™äº›é—®é¢˜å¾€å¾€ä¼šé˜»ç¢åº”ç”¨ç¨‹åºæ¶æ„ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬è¿˜æœ‰ä¸¤ä¸ªé—®é¢˜è¦è§£å†³:</p>
<ul>
<li>æˆ‘ä»¬è¿˜æ²¡æœ‰ä»‹ç»å‰¯ä½œç”¨ã€‚</li>
<li>æˆ‘ä»¬è¿˜éœ€è¦è¯æ˜æˆ‘ä»¬çš„æ¶æ„æ˜¯å¦‚ä½•å¯æµ‹è¯•çš„ã€‚</li>
</ul>
<p>è¿™æ˜¯ä¸¤ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼Œè§£å†³èµ·æ¥ä¼šå¾ˆæœ‰è¶£ã€‚æœŸå¾…ä¸‹æ¬¡å§!</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/i-r9uoo_2N/" class="tag">
                    PointFree
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/pointfree-episode-74modular-state-management-view-actions/">
                  <h3 class="post-title">
                    PointFree Episode 74:Modular State Management: View Actions
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
