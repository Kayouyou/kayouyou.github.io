<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Observers in Swift - Part 2 | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1663223563046">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="æœ¬å‘¨ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ¢ç´¢åœ¨Swiftä¸­å®ç°è§‚å¯Ÿè€…æ¨¡å¼çš„å„ç§æ–¹æ³•ã€‚ä¸Šå‘¨æˆ‘ä»¬çœ‹äº†ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨NotificationCenter APIå’Œè§‚å¯Ÿåè®®æ¥è®©AudioPlayerè¢«è§‚å¯Ÿï¼Œæœ¬å‘¨ï¼Œæˆ‘ä»¬å°†åšåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯å°†é‡ç‚¹æ”¾åœ¨å¤šç§åŸºäºé—­åŒ…çš„æŠ€æœ¯ä¸Šã€‚
Cl..." />
    <meta name="keywords" content="observers,design pattern" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1663223563046" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Observers in Swift - Part 2</h2>
            <div class="post-date">2018-04-22</div>
            
            <div class="post-content" v-pre>
              <p>æœ¬å‘¨ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ¢ç´¢åœ¨Swiftä¸­å®ç°è§‚å¯Ÿè€…æ¨¡å¼çš„å„ç§æ–¹æ³•ã€‚ä¸Šå‘¨æˆ‘ä»¬çœ‹äº†ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨NotificationCenter APIå’Œè§‚å¯Ÿåè®®æ¥è®©AudioPlayerè¢«è§‚å¯Ÿï¼Œæœ¬å‘¨ï¼Œæˆ‘ä»¬å°†åšåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯å°†é‡ç‚¹æ”¾åœ¨å¤šç§åŸºäºé—­åŒ…çš„æŠ€æœ¯ä¸Šã€‚</p>
<h2 id="closures">Closures</h2>
<p>é—­åŒ…æ˜¯ç°ä»£APIè®¾è®¡çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä»å¸¦æœ‰å›è°ƒçš„å¼‚æ­¥apiï¼Œåˆ°å‡½æ•°æ“ä½œ(æ¯”å¦‚åœ¨é›†åˆä¸Šä½¿ç”¨forEachæˆ–map)â€”â€”é—­åŒ…æ— å¤„ä¸åœ¨ï¼Œæ— è®ºæ˜¯åœ¨Swiftæ ‡å‡†åº“ä¸­ï¼Œè¿˜æ˜¯æˆ‘ä»¬ä½œä¸ºç¬¬ä¸‰æ–¹å¼€å‘è€…ç¼–å†™çš„åº”ç”¨ç¨‹åºä¸­ã€‚</p>
<p>é—­åŒ…çš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼Œå®ƒå…è®¸APIç”¨æˆ·æ•è·ä»–ä»¬æ‰€åœ¨çš„å½“å‰ä¸Šä¸‹æ–‡ï¼Œå¹¶åœ¨å¯¹äº‹ä»¶åšå‡ºååº”æ—¶ä½¿ç”¨å®ƒ - åœ¨å½“å‰çš„æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬çš„éŸ³é¢‘æ’­æ”¾å™¨çš„çŠ¶æ€æ”¹å˜æ—¶ã€‚è¿™æ”¯æŒä¸€ä¸ªæ›´â€œè½»é‡çº§â€çš„è°ƒç”¨ç«™ç‚¹ï¼Œå¯ä»¥å¯¼è‡´æ›´ç®€å•çš„ä»£ç â€”â€”ä½†æ˜¯é—­åŒ…ä¹Ÿæœ‰è‡ªå·±çš„ä¸€å¥—æƒè¡¡ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å°†åŸºäºé—­åŒ…çš„è§‚å¯ŸAPIæ·»åŠ åˆ°æˆ‘ä»¬çš„AudioPlayerä¸­ã€‚ æˆ‘ä»¬å°†ä»å®šä¹‰ä¸€ä¸ªå…ƒç»„å¼€å§‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥è·Ÿè¸ªè§‚å¯Ÿâ€”â€”å¯åŠ¨ã€æš‚åœå’Œåœæ­¢â€”â€”æˆ‘ä»¬çš„ä¸‰ä¸ªäº‹ä»¶ç»„æˆçš„è§‚å¯Ÿé—­åŒ…æ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-swift">class AudioPlayer {
    private var observations = (
        started: [(AudioPlayer, Item) -&gt; Void](),
        paused: [(AudioPlayer, Item) -&gt; Void](),
        stopped: [(AudioPlayer) -&gt; Void]()
    )
}
</code></pre>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢ä½¿ç”¨å•ç‹¬çš„å±æ€§â€”â€”ä½†å°±åƒæˆ‘ä»¬åœ¨â€œåœ¨Swiftä¸­ä½¿ç”¨å…ƒç»„ä½œä¸ºè½»é‡çº§ç±»å‹â€ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚-ä½¿ç”¨å…ƒç»„å°†ç›¸å…³çš„å±æ€§ç»„åˆåœ¨ä¸€èµ·æ˜¯ä¸€ç§éå¸¸ç®€æ´çš„æ–¹å¼æ¥ç»„ç»‡äº‹ç‰©ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„è§‚å¯Ÿæ–¹æ³•ã€‚ä¸å‰é¢çš„æ–¹æ³•ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä¸ºæ¯ä¸ªè§‚å¯Ÿäº‹ä»¶å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä½¿äº‹ç‰©æ¸…æ™°åœ°åˆ†å¼€ã€‚æ¯ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ªé—­åŒ…ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä¼ é€’å½“å‰æ’­æ”¾é¡¹ç›®ç»™å¼€å§‹å’Œæš‚åœçš„è§‚å¯Ÿè€…ï¼Œè€Œåªæ˜¯ä¼ é€’æ’­æ”¾å™¨æœ¬èº«ç»™åœæ­¢çš„:</p>
<pre><code class="language-swift">extension AudioPlayer {
    func observePlaybackStarted(using closure: @escaping (AudioPlayer, Item) -&gt; Void) {
        observations.started.append(closure)
    }

    func observePlaybackPaused(using closure: @escaping (AudioPlayer, Item) -&gt; Void) {
        observations.paused.append(closure)
    }

    func observePlaybackStopped(using closure: @escaping (AudioPlayer) -&gt; Void) {
        observations.stopped.append(closure)
    }
}
</code></pre>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè®©playerè‡ªå·±è¿›å…¥æ‰€æœ‰å…³é—­æœºåˆ¶æ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ï¼Œå¯ä»¥é¿å…æ„å¤–çš„ä¿ç•™å¾ªç¯- å¦‚æœplayeræ˜¯åœ¨è‡ªå·±çš„è§‚å¯Ÿé—­åŒ…ä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬å°±ä¼šå¿˜è®°å¾®å¼±åœ°æ•æ‰å®ƒã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹â€œæ•æ‰Swifté—­åŒ…ä¸­çš„å¯¹è±¡â€ã€‚</p>
<p>æœ‰äº†ä¸Šè¿°è®¾ç½®ï¼Œå‰©ä¸‹çš„å°±æ˜¯å½“ç©å®¶çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨åŒ¹é…äº‹ä»¶çš„æ‰€æœ‰è§‚å¯Ÿé—­åŒ…ï¼Œå¦‚ä¸‹:</p>
<pre><code class="language-swift">private extension AudioPlayer {
    func stateDidChange() {
        switch state {
        case .idle:
            observations.stopped.forEach { closure in
                closure(self)
            }
        case .playing(let item):
            observations.started.forEach { closure in
                closure(self, item)
            }
        case .paused(let item):
            observations.paused.forEach { closure in
                closure(self, item)
            }
        }
    }
}
</code></pre>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬çš„æ–°APIå§!å½“æˆ‘ä»¬ä½¿ç”¨æ–°çš„åŸºäºé—­åŒ…çš„è§‚å¯ŸAPIæ—¶ï¼Œæˆ‘ä»¬çš„NowPlayingViewController(ç¬¬ä¸€éƒ¨åˆ†)çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p>
<pre><code class="language-swift">class NowPlayingViewController: UIViewController {
    override func viewDidLoad() {
        super.viewDidLoad()

        let titleLabel = self.titleLabel
        let durationLabel = self.durationLabel

        player.observePlaybackStarted { player, item in
            titleLabel.text = item.title
            durationLabel.text = &quot;\(item.duration)&quot;
        }
    }
}
</code></pre>
<p>åˆæ¼‚äº®åˆå¹²å‡€!ğŸ‘</p>
<p>ç„¶è€Œï¼Œä¸Šè¿°æ–¹æ³•æœ‰ä¸€ä¸ªä¸»è¦çš„ç¼ºç‚¹â€”â€”æ— æ³•ç§»é™¤è§‚å¯Ÿç»“æœã€‚è™½ç„¶è¿™å¯¹äºæ‹¥æœ‰ä»–ä»¬æ­£åœ¨è§‚å¯Ÿçš„å¯¹è±¡çš„å¯¹è±¡å¾ˆå¥½(å› ä¸ºè¢«è§‚å¯Ÿçš„å¯¹è±¡å°†ä¸å®ƒçš„æ‰€æœ‰è€…ä¸€èµ·è¢«åˆ†é…)ï¼Œä½†å¯¹äºå…±äº«å¯¹è±¡(æˆ‘ä»¬çš„AudioPlayerå¾ˆå¯èƒ½æ˜¯)å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºæ–°å¢çš„è§‚æµ‹æ•°æ®å°†ä¼šæ°¸è¿œå­˜åœ¨ã€‚</p>
<h2 id="tokens">Tokens</h2>
<p>ä¸€ç§å…è®¸åˆ é™¤è§‚å¯Ÿæ•°æ®çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ ‡è®°ã€‚å°±åƒæˆ‘ä»¬åœ¨â€œä½¿ç”¨ä»¤ç‰Œå¤„ç†å¼‚æ­¥Swiftä»£ç â€ä¸­æ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡æ·»åŠ ä¸€ä¸ªè§‚å¯Ÿé—­åŒ…æ—¶è¿”å›ä¸€ä¸ªObservationToken-ç¨åå¯ä»¥ç”¨æ¥å–æ¶ˆè§‚å¯Ÿå’Œç§»é™¤é—­åŒ…ã€‚</p>
<p>è®©æˆ‘ä»¬ä»åˆ›å»ºtokenç±»æœ¬èº«å¼€å§‹ï¼Œå®ƒåªæ˜¯ä½œä¸ºä¸€ä¸ªå°è£…å™¨ï¼Œå¯ä»¥è°ƒç”¨å®ƒæ¥å–æ¶ˆä¸€ä¸ªè§‚å¯Ÿ:</p>
<pre><code class="language-swift">class ObservationToken {
    private let cancellationClosure: () -&gt; Void

    init(cancellationClosure: @escaping () -&gt; Void) {
        self.cancellationClosure = cancellationClosure
    }

    func cancel() {
        cancellationClosure()
    }
}
</code></pre>
<p>å› ä¸ºé—­åŒ…å¹¶æ²¡æœ‰çœŸæ­£çš„æ ‡è¯†æ¦‚å¿µï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº›æ–¹æ³•æ¥æƒŸä¸€åœ°æ ‡è¯†ä¸€ä¸ªè§‚å¯Ÿï¼Œä»¥ä¾¿èƒ½å¤Ÿåˆ é™¤å®ƒã€‚ä¸€ç§æ–¹æ³•æ˜¯å°†ä¹‹å‰çš„é—­åŒ…æ•°ç»„è½¬æ¢æˆå­—å…¸ï¼Œç”¨UUIDå€¼ä½œä¸ºé”®ï¼Œåƒè¿™æ ·:</p>
<pre><code class="language-swift">class AudioPlayer {
    private var observations = (
        started: [UUID : (AudioPlayer, Item) -&gt; Void](),
        paused: [UUID : (AudioPlayer, Item) -&gt; Void](),
        stopped: [UUID : (AudioPlayer) -&gt; Void]()
    )
}
</code></pre>
<p>ç„¶åï¼Œå½“æ¯ä¸ªé—­åŒ…è¢«æ’å…¥æ—¶ï¼Œæˆ‘ä»¬å°†ä¸ºå®ƒåˆ†é…ä¸€ä¸ªæ–°çš„UUIDå€¼ã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œå½“é”®ç±»å‹ä¸ºUUIDæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Dictionaryä¸Šæ·»åŠ ä¸€ä¸ªç®€å•çš„æ‰©å±•ï¼Œä½¿æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ‰§è¡Œæ’å…¥å’Œåˆ›å»ºæ ‡è¯†ç¬¦çš„æ“ä½œ:</p>
<pre><code class="language-swift">private extension Dictionary where Key == UUID {
    mutating func insert(_ value: Value) -&gt; UUID {
        let id = UUID()
        self[id] = value
        return id
    }
}
</code></pre>
<p>æœ‰äº†ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´æ–°è§‚å¯Ÿæ–¹æ³•ä»¥è¿”å›ä»¤ç‰Œäº†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨@discardableResultä½¿å®é™…ä½¿ç”¨è¿”å›çš„ä»¤ç‰Œæˆä¸ºå¯é€‰çš„ï¼Œä»¥é¿å…åœ¨è§‚å¯Ÿè§‚å¯Ÿè€…è‡ªèº«æ‹¥æœ‰çš„å¯¹è±¡æ—¶äº§ç”Ÿä»»ä½•è­¦å‘Šã€‚</p>
<p>åœ¨æ¯ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éƒ½å°†ä½¿ç”¨ä¸Šé¢æåˆ°çš„insertæ–¹æ³•ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªObservationTokenå®ä¾‹ï¼Œå¹¶ç”¨é—­åŒ…æ¥åˆ é™¤è¿™ä¸ªè§‚å¯Ÿï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-swift">extension AudioPlayer {
    @discardableResult
    func observePlaybackStarted(using closure: @escaping (AudioPlayer, Item) -&gt; Void)
        -&gt; ObservationToken {
        let id = observations.started.insert(closure)

        return ObservationToken { [weak self] in
            self?.observations.started.removeValue(forKey: id)
        }
    }

    @discardableResult
    func observePlaybackPaused(using closure: @escaping (AudioPlayer, Item) -&gt; Void)
        -&gt; ObservationToken {
        let id = observations.paused.insert(closure)

        return ObservationToken { [weak self] in
            self?.observations.paused.removeValue(forKey: id)
        }
    }

    @discardableResult
    func observePlaybackStopped(using closure: @escaping (AudioPlayer) -&gt; Void)
        -&gt; ObservationToken {
        let id = observations.stopped.insert(closure)

        return ObservationToken { [weak self] in
            self?.observations.stopped.removeValue(forKey: id)
        }
    }
}
</code></pre>
<p>åœ¨æˆ‘ä»¬å‡†å¤‡å¥½ç»™æˆ‘ä»¬æ–°çš„åŸºäºä»¤ç‰Œçš„APIä¸€ä¸ªå°è¯•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„æ’­æ”¾å™¨çš„stateDidChangeæ–¹æ³•åšä¸€ä¸ªè½»å¾®çš„ä¿®æ”¹ï¼Œå½“è¿­ä»£æ¯ä¸ªå­—å…¸æ—¶ä½¿ç”¨valueså±æ€§(å› ä¸ºæˆ‘ä»¬ä¸æ„Ÿå…´è¶£åœ¨è¿™é‡Œçš„é”®):</p>
<pre><code class="language-swift">private extension AudioPlayer {
    func stateDidChange() {
        switch state {
        case .idle:
            observations.stopped.values.forEach { closure in
                closure(self)
            }
        case .playing(let item):
            observations.started.values.forEach { closure in
                closure(self, item)
            }
        case .paused(let item):
            observations.paused.values.forEach { closure in
                closure(self, item)
            }
        }
    }
}
</code></pre>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥è®©æˆ‘ä»¬çš„NowPlayingViewControlleråœ¨å®ƒè¢«é‡Šæ”¾çš„æ—¶å€™æŠŠå®ƒè‡ªå·±æ³¨é”€ä¸ºä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œåƒè¿™æ ·:</p>
<pre><code class="language-swift">class NowPlayingViewController: UIViewController {
    private var observationToken: ObservationToken?

    deinit {
        observationToken?.cancel()
    }

    override func viewDidLoad() {
        super.viewDidLoad()

        let titleLabel = self.titleLabel
        let durationLabel = self.durationLabel

        observationToken = player.observePlaybackStarted { player, item in  
            titleLabel.text = item.title
            durationLabel.text = &quot;\(item.duration)&quot;
        }
    }
}
</code></pre>
<p>å½“ä½ æƒ³åŠ¨æ€åœ°åˆ›å»ºå’Œåˆ é™¤å¤šä¸ªå¯¹è±¡çš„è§‚å¯Ÿæ—¶ï¼ŒåŸºäºä»¤ç‰Œçš„APIæ˜¯éå¸¸å¥½çš„ï¼Œæ­£å¦‚ä½ åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œå½“æˆ‘ä»¬æƒ³è¦åšçš„åªæ˜¯æ·»åŠ ä¸€ä¸ªç®€å•çš„è§‚å¯Ÿæ—¶ï¼Œè¿™å˜å¾—æœ‰ç‚¹éº»çƒ¦ã€‚å¿˜è®°å¯¹ä»¤ç‰Œè°ƒç”¨cancelä¹Ÿæ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ï¼Œå®ƒè¦æ±‚æˆ‘ä»¬åœ¨è§‚å¯Ÿè€…ä¸­ä¿æŒæ›´å¤šçš„çŠ¶æ€(é€šè¿‡å­˜å‚¨ä»¤ç‰Œ)ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦èƒ½æ‰¾åˆ°æ”¹è¿›æ–¹æ¡ˆçš„æ–¹æ³•ã€‚ğŸ¤”</p>
<h2 id="the-best-of-both-worlds">The best of both worlds</h2>
<p>è®©æˆ‘ä»¬æ¢ç´¢ä¸€ç§æ–¹æ³•æ¥ä¿æŒæˆ‘ä»¬çš„åŸºäºä»¤ç‰Œçš„API(å› ä¸ºå®ƒé€šè¿‡è®©æˆ‘ä»¬å¯¹è§‚å¯Ÿç»“æœè¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶è€Œå¢åŠ äº†ä»·å€¼)ï¼Œä½†ä»ç„¶å‡å°‘æ ·æ¿ã€‚</p>
<p>ä¸€ç§æ–¹æ³•æ˜¯å°†ä¸€ä¸ªè§‚å¯Ÿé—­åŒ…ä¸è§‚å¯Ÿè€…è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šåœ¨ä¸€èµ·ï¼Œè€Œä¸éœ€è¦è§‚å¯Ÿè€…éµå®ˆç‰¹å®šçš„åè®®(å°±åƒæˆ‘ä»¬ä¸Šå‘¨å¯¹AudioPlayerObserveræ‰€åšçš„é‚£æ ·)ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯æ·»åŠ ä¸€ä¸ªAPIï¼Œè®©æˆ‘ä»¬æŠŠä»»ä½•å¯¹è±¡ä½œä¸ºè§‚å¯Ÿè€…ä¼ é€’ï¼ŒåŒæ—¶ä¹Ÿåƒä¹‹å‰ä¸€æ ·ä¼ é€’ä¸€ä¸ªé—­åŒ…ã€‚<br>
ç„¶åæˆ‘ä»¬å°†å¼±åœ°æ•è·è¯¥å¯¹è±¡ï¼Œå¹¶é˜²æ­¢å®ƒä¸ºnilï¼Œä»¥ç¡®å®šè§‚å¯Ÿæ˜¯å¦ä»ç„¶æœ‰æ•ˆï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="language-swift">extension AudioPlayer {
    @discardableResult
    func addPlaybackStartedObserver&lt;T: AnyObject&gt;(
        _ observer: T,
        closure: @escaping (T, AudioPlayer, Item) -&gt; Void
    ) -&gt; ObservationToken {
        let id = UUID()

        observations.started[id] = { [weak self, weak observer] player, item in
            // If the observer has been deallocated, we can
            // automatically remove the observation closure.
            guard let observer = observer else {
                self?.observations.started.removeValue(forKey: id)
                return
            }

            closure(observer, player, item)
        }

        return ObservationToken { [weak self] in
            self?.observations.started.removeValue(forKey: id)
        }
    }
}
</code></pre>
<p>é€šè¿‡ä»¥ä¸Šçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¯´æ˜¯ä¸¤å…¨å…¶ç¾ã€‚å¦‚æœéœ€è¦æˆ–å–œæ¬¢ä½¿ç”¨ä»¤ç‰Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¤ç‰Œï¼Œè€Œä¸”å½“å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªåŠ¨åˆ é™¤å®ƒæ³¨å†Œçš„ä»»ä½•è§‚å¯Ÿå€¼ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°åœ¨NowPlayingViewControllerä¸­è§‚å¯Ÿæˆ‘ä»¬çš„ç©å®¶ï¼Œå°±åƒè¿™æ ·:</p>
<pre><code class="language-swift">lass NowPlayingViewController: UIViewController {
    override func viewDidLoad() {
        super.viewDidLoad()

        player.addPlaybackStartedObserver(self) {
            vc, player, item in

            vc.titleLabel.text = item.title
            vc.durationLabel.text = &quot;\(item.duration)&quot;
        }
    }
}
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>åœ¨è¿™ç¯‡åˆ†ä¸¤éƒ¨åˆ†çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°è¯•äº†å¤šç§æ–¹æ³•æ¥ç»™å¯¹è±¡æ·»åŠ è§‚å¯ŸåŠŸèƒ½â€”â€”é€šè¿‡ä½¿ç”¨é€šçŸ¥ã€è§‚å¯Ÿåè®®ã€é—­åŒ…å’Œæ ‡è®°ã€‚å½“ç„¶ï¼ŒSwiftä¸­è¿˜æœ‰å¾ˆå¤šä½¿ç”¨è§‚å¯Ÿè€…çš„æ–¹å¼â€”â€”åŒ…æ‹¬ä½¿ç”¨å‡½æ•°å¼å“åº”å¼ç¼–ç¨‹å’Œäº‹ä»¶è°ƒåº¦ï¼Œæ‰€ä»¥è¿™è‚¯å®šæ˜¯æˆ‘ä»¬åœ¨ä»¥åçš„æ–‡ç« ä¸­ä¼šè®¨è®ºçš„è¯é¢˜ã€‚</p>
<p><a href="https://www.swiftbysundell.com/articles/observers-in-swift-part-2/">åŸæ–‡é“¾æ¥</a></p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/3kIoTw_PC/" class="tag">
                    observers
                  </a>
                
                  <a href="https://kayouyou.github.io/tag/4g5XtbTAR/" class="tag">
                    design pattern
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/observers-in-swift-part-1/">
                  <h3 class="post-title">
                    Observers in Swift - Part 1
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
