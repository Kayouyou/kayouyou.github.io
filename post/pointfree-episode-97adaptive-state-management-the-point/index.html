<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>PointFree Episode 97:Adaptive State Management: The Point | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1669781686626">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="



Cross-platform SwiftUI views




Dedicated platform SwiftUI views




Conclusion






1. Cross-platform SwiftUI vie..." />
    <meta name="keywords" content="PointFree" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1669781686626" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
       <a href="https://beian.miit.gov.cn/">è±«ICPå¤‡2021012281å·-1</a> | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">PointFree Episode 97:Adaptive State Management: The Point</h2>
            <div class="post-date">2021-12-18</div>
            
            <div class="post-content" v-pre>
              <!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#Cross-platformSwiftUIviews">Cross-platform SwiftUI views</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="#DedicatedplatformSwiftUIviews">Dedicated platform SwiftUI views</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#Conclusion">Conclusion</a></li>
</ol>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<!-- # PointFree Episode 97:Adaptive State Management: The Point -->
<h2 id="1-a-namecross-platformswiftuiviewsacross-platform-swiftui-views">1. <a name='Cross-platformSwiftUIviews'></a>Cross-platform SwiftUI views</h2>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ï¼Œå¦‚æœæˆ‘ä»¬å¤©çœŸåœ°æ”¹å˜ä¸€äº›viewsï¼Œè®©å®ƒå¯¹Macå‹å¥½ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›å·¥ä½œæ¥è®©Xcodeé¡¹ç›®æˆå‹ï¼Œä»¥ä¾¿å®ƒèƒ½å¤ŸåŒæ—¶ä¸ºiOSå’ŒmacOSæ„å»ºæ¡†æ¶ã€‚ç‰¹åˆ«åœ°ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æœ‰è¿™äº›<strong>xcconfig</strong>æ–‡ä»¶ï¼Œå¹¶ä¸”å®ƒä»¬å·²ç»è¢«æ·»åŠ åˆ°é¡¹ç›®ä¸­çš„æ‰€æœ‰æ¡†æ¶ä¸­ã€‚</p>
<p>ä¸€æ—¦å®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä¸ºMacæ„å»º<strong>Counter</strong>æ¨¡å—ï¼Œä½†æˆ‘ä»¬ä¼šç«‹å³å¾—åˆ°ä¸€ä¸ªé”™è¯¯:</p>
<pre><code class="language-swift">.navigationBarTitle(&quot;Counter demo&quot;)
ğŸ›‘ Value of type â€˜some Viewâ€™ has no member â€˜navigationBarTitleâ€™
</code></pre>
<p>åŸæ¥macOSåº”ç”¨ç¨‹åºæ²¡æœ‰â€œ<strong>navigation bar titles</strong>â€çš„æ¦‚å¿µï¼Œå› ä¸ºè¿™ä¸æ˜¯Macåº”ç”¨ç¨‹åºçš„UIå¤–è§‚ã€‚åªæœ‰iOSã€watchOSå’ŒtvOSåº”ç”¨ç¨‹åºèƒ½å¤Ÿä½¿ç”¨è¿™ä¸ªè§†å›¾ä¿®é¥°ç¬¦ã€‚å¯¹äºmacOSï¼Œæˆ‘ä»¬éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·åšçš„ä¸€ç§æ–¹æ³•æ˜¯ä¸ºè§†å›¾æå–ä¸€ä¸ªå°åŠ©æ‰‹å±æ€§ï¼Œå®ƒåœ¨è¿™ä¸ªç‰¹æ®Šçš„é€»è¾‘ä¸­çƒ˜ç„™:</p>
<pre><code class="language-swift">extension View {
  var counterNavBarTitle: some View {
    #if os(macOS)
    return self
    #else
    return self.navigationBarTitle(&quot;Counter demo&quot;)
    #endif
  }
}
</code></pre>
<p>ç„¶ååœ¨è§†å›¾ä¸­æˆ‘ä»¬å¯ä»¥è¿™æ ·åš:</p>
<pre><code class="language-swift">.counterNavBarTitle
</code></pre>
<p>å¦‚æœæˆ‘ä»¬åœ¨macOSå¹³å°ä¸Šï¼Œå®ƒä»€ä¹ˆéƒ½ä¸ä¼šåšã€‚</p>
<p>ä½†è¿™åªæ˜¯å†°å±±ä¸€è§’ã€‚æœ‰å¾ˆå¤šapiåªé€‚ç”¨äºå•ä¸ªå¹³å°æˆ–å¹³å°çš„ä¸€ä¸ªå­é›†ã€‚ä¾‹å¦‚ï¼ŒåŠ¨ä½œè¡¨å•ä¸åœ¨macOSä¸Šï¼Œæ‰€ä»¥å¦‚æœæ‚¨è®¡åˆ’åœ¨è·¨å¹³å°åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›apiï¼Œé‚£ä¹ˆæ‚¨å°†éœ€è¦æ‰§è¡Œæ›´å¤šç‰¹ä¾‹æ“ä½œã€‚ä¹Ÿæœ‰ä¸€äº›apiæ˜¯åœ¨iOSå’ŒmacOSä¸Šï¼Œä½†ä¸æ˜¯åœ¨<strong>watchOSæˆ–tvOS</strong>ä¸Šï¼Œå¦‚<strong>RotationGestureå’Œmagnationgesture</strong>ã€‚</p>
<p>ä½†é™¤äº†è¿™ä¸ªå°é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æœ‰è¿™æ®µä»£ç ï¼Œæ¯å½“ä½ ç‚¹å‡»â€œ<strong>is this prime</strong>â€æŒ‰é’®æ—¶ï¼Œå®ƒä¼šæ˜¾ç¤ºä¸€ä¸ªæ¨¡å¼:</p>
<pre><code class="language-swift">.sheet(
  item: .constant(self.viewStore.value.isPrimeModal),
  onDismiss: { self.viewStore.send(.primeModalDismissed) }
) { isPrimeDetail in
  IsPrimeModalView(
    store: self.store.scope(
      value: { (isPrimeDetail.count, $0.favoritePrimes) },
      action: { .primeModal($0) }
    )
  )
}
</code></pre>
<p>å¯¹äºè¿™ä¸ªåº”ç”¨ç¨‹åºçš„macOSç‰ˆæœ¬ï¼Œæˆ‘ä»¬å®é™…ä¸Šæƒ³ä½¿ç”¨ä¸€ä¸ªå¼¹çª—è€Œä¸æ˜¯ä¸€ä¸ªæ¨¡æ€ã€‚æˆ‘ä»¬æƒ³è¦<strong>popovers</strong>æ˜¯ä¸€ç§è¶…è½»é‡çš„æ–¹å¼æ¥æ˜¾ç¤ºä¸€äº›é¢å¤–çš„UIä¸å…¶ä»–UIç›¸å…³ï¼Œ<strong>popovers</strong>ç”šè‡³ä¸èƒ½åœ¨iphoneä¸Šå·¥ä½œï¼Œåªèƒ½åœ¨ipadä¸Šã€‚</p>
<p><strong>popovers</strong>çš„APIéå¸¸ç±»ä¼¼äºæ¨¡æ€ï¼Œä½†æˆ‘ä»¬ä»ç„¶éœ€è¦åšé¢å¤–çš„ç‰¹æ®Šçš„å¤–å£³é€»è¾‘ï¼Œä»¥ä¾¿æ ¹æ®å¹³å°æ˜¾ç¤ºå¼¹çª—æˆ–æ¨¡æ€ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°è¯•åœ¨è§†å›¾æ‰©å±•åŠ©æ‰‹ä¸­åšé‚£ä¸ªç‰¹æ®Šçš„åŠ å·¥ï¼Œæ¯”å¦‚:</p>
<pre><code class="language-swift">extension View {
  var primeDetail: some View {
    #if os(iOS)
    // modal
    #elseif os(macOS)
    // popover
    #endif
  }
}
</code></pre>
<hr>
<h2 id="2-a-namededicatedplatformswiftuiviewsadedicated-platform-swiftui-views">2. <a name='DedicatedplatformSwiftUIviews'></a>Dedicated platform SwiftUI views</h2>
<p>æ‰€æœ‰è¿™äº›å¾®å°çš„å·®å¼‚çœŸçš„ä¼šç´¯ç§¯èµ·æ¥ã€‚åœ¨å¼€å‘è¿™ä¸ªåŠŸèƒ½çš„å‡ ä¸ªæœˆé‡Œï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨è¿™ä¸ªè§†å›¾ä¸­è¿›è¡Œå‡ åä¸ªå°è°ƒæ•´ï¼Œè¿™å–å†³äºæˆ‘ä»¬è¿è¡Œçš„æ˜¯iOSåº”ç”¨ç¨‹åºè¿˜æ˜¯Macåº”ç”¨ç¨‹åºã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒSwiftUIå¯¹äºæˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„é—®é¢˜æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ•…äº‹ã€‚SwiftUIçš„ç«‹åœºæ˜¯ï¼ŒUIçš„æ„é€ åº”è¯¥æ˜¯åº”ç”¨ç¨‹åºä¸­æœ€ç®€å•çš„éƒ¨åˆ†ã€‚æ¯•ç«Ÿï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå®ƒå°†è§†å›¾çš„çŠ¶æ€æ˜ å°„åˆ°SwiftUIç±»å‹çš„å±‚æ¬¡ç»“æ„ï¼ŒåŒ…æ‹¬å †æ ˆã€æŒ‰é’®ã€æ–‡æœ¬è§†å›¾ã€åˆ—è¡¨ç­‰ç­‰ã€‚ è€Œä¸”ï¼Œç”±äºUIçš„æ„é€ å¯ä»¥å˜å¾—å¦‚æ­¤ç®€å•ï¼Œæ‰€ä»¥å½“æ‚¨æƒ³è¦æ”¯æŒçš„æ¯ä¸ªå¹³å°çš„UIæ˜¾è‘—åç¦»æ—¶ï¼Œä¸ºå®ƒä»¬å¤åˆ¶è§†å›¾ä»£ç å¯èƒ½æ˜¯å¯è¡Œçš„ã€‚</p>
<p>æˆ‘ä»¬å®Œå…¨åŒæ„SwiftUIçš„è¿™ä¸€ç«‹åœºã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒMacè§†å›¾çš„æƒ¯ä¾‹å’Œè®¾è®¡ä¸iOSè§†å›¾æœ‰å¾ˆå¤§ä¸åŒï¼Œæ‰€ä»¥æœ€å¥½æ˜¯ä¸ºæ¯ä¸ªå¹³å°ä»å¤´åˆ›å»ºè§†å›¾ï¼Œè€Œä¸æ˜¯æŠ½è±¡å®ƒä»¬çš„å…±æ€§å¹¶ç»Ÿä¸€å®ƒä»¬çš„å·®å¼‚ã€‚</p>
<p>è¿™å°±æ˜¯æˆ‘ä»¬è¦åšçš„ã€‚æˆ‘ä»¬å°†æå–å‡ºæˆ‘ä»¬çš„<strong>CounterView</strong>åˆ°ä¸€ä¸ªåä¸º<strong>CounterView_iOS</strong>.swiftçš„æ–°æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒçš„å®šä¹‰åŒ…è£…åœ¨:</p>
<pre><code class="language-swift">#if os(iOS)
import ComposableArchitecture
import PrimeAlert
import PrimeModal
import SwiftUI
â€¦
#endif
</code></pre>
<p>ç„¶åæˆ‘ä»¬è¦å¤åˆ¶è¿™ä¸ªæ–‡ä»¶ï¼Œå°†å…¶å‘½åä¸º<strong>CounterView_macOS</strong>.swiftï¼Œå¹¶å°†æ¡ä»¶æ›´æ”¹ä¸º:</p>
<pre><code class="language-swift">#if os(macOS)
â€¦
#endif
</code></pre>
<p>æ¯”åˆ°å¤„éƒ½æ˜¯#ifæ¡ä»¶è¯­å¥æ›´å¥½çš„æ–¹æ³•æ˜¯åˆ›å»ºæ‰€æœ‰æ–°çš„æ¡†æ¶ï¼Œåªä¿å­˜iOSæˆ–macOSç‰¹å®šçš„å†…å®¹ã€‚ç„¶åCounteræ¨¡å—å¯ä»¥åªå…³æ³¨ä¸šåŠ¡é€»è¾‘ä¸­ä¸å¯çŸ¥çš„éƒ¨åˆ†ï¼Œä¸ç‰¹å®šäºå¹³å°çš„å®ç°æ— å…³ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªä¸“é—¨ä¸ºmacOSåˆ›å»ºçš„è§†å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä½¿å…¶èƒ½å¤Ÿç¼–è¯‘ï¼Œå¹¶ä¸”æ›´é€‚åˆmacOSã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬å»æ‰å¯¼èˆªæ çš„æ ‡é¢˜:</p>
<pre><code class="language-swift">// .navigationBarTitle(&quot;Counter demo&quot;)
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è§£å†³æ¨¡æ€è¡¨å•çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨macOSä¸Šä»¥å¼¹å‡ºçª—å£çš„å½¢å¼å‘ˆç°å®ƒã€‚æˆ‘ä»¬åªéœ€è¦ä»<strong>sheet</strong>APIåˆ‡æ¢åˆ°<strong>popover</strong>APIï¼Œå¹¶ä»æˆ‘ä»¬çš„å­˜å‚¨ä¸­æ„é€ ä¸€ä¸ªç»‘å®šã€‚</p>
<pre><code class="language-swift">.popover(
  isPresented: Binding(
    get: { self.viewStore.value.isPrimeModalShown },
    set: { _ in self.viewStore.send(.primeModalDismissed) }
  )
) {
  IsPrimeModalView(
    store: self.store.scope(
      value: { ($0.count, $0.favoritePrimes) },
      action: { .primeModal($0) }
    )
  )
}
</code></pre>
<p>ä½†æˆ‘ä»¬çš„<strong>stateå’Œactions</strong>çš„å‘½åå¹¶ä¸ç†æƒ³ã€‚å‡ ä¸ªæœˆåï¼Œå½“æˆ‘ä»¬é‡åˆ°è¿™æ®µä»£ç æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ„Ÿåˆ°å›°æƒ‘ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨æ˜¾ç¤ºä¸€ä¸ª<strong>popover</strong>ï¼Œå³ä½¿çŠ¶æ€æ¸…æ¥šåœ°å‘Šè¯‰æˆ‘ä»¬å®ƒæ˜¯ä¸€ä¸ª<strong>modal</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ã€‚æˆ‘ä»¬å°†ä½¿æˆ‘ä»¬çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¯¹UIæ›´åŠ ä¸å¯çŸ¥ï¼Œå¹¶å…è®¸æˆ‘ä»¬çš„æ¯ä¸ªè§†å›¾å°†è¿™ç§ä¸å¯çŸ¥çŠ¶æ€è½¬æ¢ä¸ºå¯¹å®ƒä»¬æœ‰æ„ä¹‰çš„çŠ¶æ€ã€‚</p>
<p>å› æ­¤ï¼Œä¸å…¶ä»¥å°†è¦æ˜¾ç¤ºçš„UIç±»å‹æ¥å‘½åçŠ¶æ€ï¼Œå½“ä½ é—®å½“å‰è®¡æ•°æ˜¯å¦ä¸ºè´¨æ•°æ—¶æˆ‘ä»¬ä¼šæ˜¾ç¤ºä¸€äº›ç»†èŠ‚å±å¹•ï¼Œå®ƒå¯èƒ½æ˜¯<strong>modal, a popover, an alert</strong> ç­‰ç­‰ã€‚æˆ‘ä»¬å°†å®ƒå‘½åä¸º<strong>isPrimeDetailShown</strong>:</p>
<pre><code class="language-swift">public typealias CounterState = (
   â€¦
   isPrimeDetailShown: Bool
 )
</code></pre>
<p>è€Œä¸æ˜¯è°ƒç”¨æ“ä½œ<strong>isPrimeModalDismissed</strong>ï¼Œæˆ‘ä»¬å°†é€šè¿‡è°ƒç”¨<strong>isPrimeDetailDismissed</strong>ä½¿å®ƒæ›´åŠ ä¸å¯çŸ¥:</p>
<pre><code class="language-swift">public enum CounterAction: Equatable {
  â€¦
  case primeDetailDismissed
}
</code></pre>
<p>è¿™æ„å‘³ç€åœ¨<strong>reducer</strong>ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦ä¸æ–°çš„çŠ¶æ€å’ŒåŠ¨ä½œä¸€èµ·å·¥ä½œ:</p>
<pre><code class="language-swift">case .isPrimeButtonTapped:
  state.isPrimeDetailShown = true
  return []

case .primeDetailDismissed:
  state.isPrimeDetailShown = false
  return []
</code></pre>
<p>ç„¶åæˆ‘ä»¬éœ€è¦æ›´æ–°<strong>CounterFeatureState</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«è®¡æ•°å™¨UIå’Œ<strong>the prime modal</strong>çš„æ‰€æœ‰æ•°æ®çš„ç»“æ„ä½“:</p>
<pre><code class="language-swift">public struct CounterFeatureState: Equatable {
  â€¦
  public var isPrimeDetailShown: Bool

  public init(
    â€¦
    isPrimeDetailShown: Bool = false
  ) {
    â€¦
    self.isPrimeDetailShown = isPrimeDetailShown
  }

  var counter: CounterState {
    get { (self.alertNthPrime, self.count, self.isNthPrimeRequestInFlight, self.isPrimeDetailShown) }
    set { (self.alertNthPrime, self.count, self.isNthPrimeRequestInFlight, self.isPrimeDetailShown) = newValue }
  }

  â€¦
}
</code></pre>
<p>è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ›´æ–°çš„ï¼Œè®©æˆ‘ä»¬è·³è½¬åˆ°<strong>counterview_macos</strong>.swiftï¼Œæ„å»ºæˆ‘ä»¬çš„Macåº”ç”¨ç¨‹åºã€‚å®ƒçš„æœ¬åœ°åŸŸæ˜¯ä¸å¯¹çš„ï¼Œå› ä¸ºå®ƒæåˆ°äº†<strong>modal</strong>ï¼Œæˆ‘ä»¬æƒ³ä¸ºmacOSåº”ç”¨ç¨‹åºä½¿ç”¨<strong>popovers</strong>ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç›¸åº”åœ°é‡å‘½å:</p>
<pre><code class="language-swift">struct State: Equatable {
  â€¦
  let isPrimePopoverShown: Bool
}
enum Action {
  â€¦
  case primePopoverDismissed
}
</code></pre>
<p>è¿˜è¦è®°ä½ï¼Œæˆ‘ä»¬å·²ç»æŠŠ<strong>modal</strong>æ¢æˆäº†<strong>popovers</strong>ï¼Œä»£ç çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p>
<pre><code class="language-swift">.popover(
  isPresented: Binding(
    get: { self.viewStore.value.isPrimePopoverShown },
    set: { _ in self.viewStore.send(.primePopoverDismissed) }
  )
  ) {
    IsPrimeModalView(
      store: self.store.scope(
        value: { ($0.count, $0.favoritePrimes) },
        action: { .primeModal($0) }
      )
    )
}
</code></pre>
<p>ç„¶åæˆ‘ä»¬éœ€è¦æ›´æ–°è½¬æ¢ï¼Œä½¿æˆ‘ä»¬çš„çŠ¶æ€å’ŒåŠ¨ä½œä¸º<strong>view store</strong>çš„å½¢çŠ¶:</p>
<pre><code class="language-swift">extension CounterView.State {
  init(counterFeatureState state: CounterFeatureState) {
    â€¦
    self.isPrimePopoverShown = state.isPrimeDetailShown
  }
}

extension CounterFeatureAction {
  init(counterViewAction action: CounterView.Action) -&gt; CounterFeatureAction {
    switch action {
    â€¦
    case .primePopoverDismissed:
      return .counter(.primeDetailDismissed)
    â€¦
    }
  }
}
</code></pre>
<p>ç°åœ¨ä¸€åˆ‡éƒ½åœ¨æ„å»ºä¸­ï¼Œä½†ä»æœ‰ä¸€äº›é¢†åŸŸç‰¹å®šçš„å‘½åæˆ‘ä»¬å¯ä»¥æ»¡è¶³ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<strong>IsPrimeModalView</strong>åç§°å¯èƒ½æœ‰ç‚¹è¯¯å¯¼äººã€‚å®ƒå¯èƒ½ä¹Ÿåº”è¯¥æ¨å¹¿åˆ°<strong>IsPrimeDetailView</strong>ï¼Œä½†å®ƒçš„åŠŸèƒ½å¯èƒ½éœ€è¦åœ¨å°†æ¥çš„æŸä¸€å¤©è¢«åˆ†æˆmacOSå’ŒiOSç‰ˆæœ¬ã€‚</p>
<p>æˆ‘ä»¬è¿˜æƒ³ä»Macåº”ç”¨ä¸­åˆ é™¤ä¸€äº›é€»è¾‘ã€‚æˆ‘ä»¬ä¸æƒ³æ”¯æŒåŒå‡»æ‰‹åŠ¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å…¶æ³¨é‡Šæ‰ã€‚</p>
<pre><code class="language-swift">// .frame(minWidth: 0, maxWidth: .infinity, minHeight: 0, maxHeight: .infinity)
// .background(Color.white)
// .onTapGesture(count: 2) {
//   self.viewStore.send(.doubleTap)
// }
</code></pre>
<p>è¿™æ„å‘³ç€æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨<strong>action enum</strong>ä¸­å»æ‰<strong>case doubleTap</strong>:</p>
<pre><code class="language-swift">enum Action {
  â€¦
//  case doubleTap
}

â€¦

extension CounterFeatureAction {
  init(counterViewAction action: CounterView.Action) -&gt; CounterFeatureAction {
    switch action {
    â€¦
//    case .doubleTap:
//      return .counter(.requestNthPrime)
    }
  }
}
</code></pre>
<p>è™½ç„¶æˆ‘ä»¬æ­£åœ¨ä¸ºMacåˆ›é€ å†…å®¹ï¼Œä½†æˆ‘ä»¬å´åœ¨æ”¹å˜ä½œç”¨åŸŸæ—¶ç ´åäº†iOSå®ç°ã€‚è®©æˆ‘ä»¬è·³è½¬åˆ°<strong>CounterView_iOS</strong>.swiftæ–‡ä»¶ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬éœ€è¦åšä¸¤ä¸ªå°çš„æ”¹å˜ï¼Œæˆ‘ä»¬æ„å»ºäº†<strong>view store</strong>çŠ¶æ€å’ŒåŠ¨ä½œ:</p>
<pre><code class="language-swift">extension CounterView.State {
  init(counterFeatureState state: CounterFeatureState) {
    â€¦
    self.isPrimeModalShown = state.isPrimeDetailShown
  }
}

extension CounterFeatureAction {
  init(counterViewAction action: CounterView.Action) -&gt; CounterFeatureAction {
    switch action {
    â€¦
    case .primeModalDismissed:
      return .counter(.primeDetailDismissed)
    }
  }
}
</code></pre>
<p>è¿™å¾ˆé…·ã€‚è¿™é‡Œæˆ‘ä»¬å¾—åˆ°äº†<strong>isPrimeDetailShown</strong>çš„ä¸å¯çŸ¥å€¼ï¼Œæˆ‘ä»¬å°†å®ƒæ˜ å°„åˆ°ä¸€ä¸ªæ›´ç‰¹å®šäºé¢†åŸŸçš„<strong>isPrimeModalShown</strong>çš„å€¼ï¼Œå› ä¸ºè¿™æ˜¯iOS UIæ‰€å…³å¿ƒçš„ã€‚ç„¶åæˆ‘ä»¬å¾—åˆ°äº†æ›´ç‰¹å®šäºä½œç”¨åŸŸçš„<strong>primeModalDismissed</strong>å€¼ï¼Œå¹¶å°†å®ƒæ˜ å°„åˆ°ä¸å¯çŸ¥çš„.<strong>counter(.primeDetailDismissed)</strong>ï¼Œè¿™æ˜¯é©±åŠ¨ä¸šåŠ¡é€»è¾‘çš„reduceræ‰€ç†è§£çš„ã€‚</p>
<p>å°±åƒè¿™æ ·ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸ºiOSå’ŒmacOSç¼–è¯‘çš„æ¡†æ¶ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªå¹³å°ä¹‹é—´å…±äº«çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä»¥åŠä¸ºæ¯ä¸ªå¹³å°é€‚å½“è°ƒæ•´çš„è§†å›¾ã€‚æ¯ä¸ªå¹³å°è§†å›¾éƒ½å¤„ç†å¯¹å…¶å¹³å°æœ‰æ„ä¹‰çš„çŠ¶æ€å’Œæ“ä½œï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•éœ€è¦è§£é‡Šçš„æœªçŸ¥åŸŸï¼Œæˆ–è€…ä¸é€‚ç”¨äºè§†å›¾çš„é¢å¤–åŸŸã€‚</p>
<hr>
<h2 id="3-a-nameconclusionaconclusion">3. <a name='Conclusion'></a>Conclusion</h2>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è®¤ä¸ºä¸ºäº†æ”¯æŒå…±äº«ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è§†å›¾ä¸­åŠ å…¥ä¸€ç‚¹å¤åˆ¶ã€‚æˆ‘ä»¬å°†åœ¨ä¸¤ä¸ªä¸ºä¸åŒå¹³å°é‡èº«å®šåˆ¶çš„è§†å›¾ä¹‹é—´åˆ†äº«æˆ‘ä»¬åŠŸèƒ½çš„çœŸæ­£å¤§è„‘ã€‚äº‹å®ä¸Šï¼Œæ”¯æŒiOSåº”ç”¨çš„effectsèƒ½å¤Ÿæ— ç¼åœ°åº”ç”¨äºMacåº”ç”¨æ˜¯ä¸€ä»¶ä»¤äººæƒŠè®¶çš„äº‹æƒ…ã€‚è¯·è®°ä½ï¼Œæˆ‘ä»¬å¯¹è¿™äº›effectsè¿›è¡Œäº†å¾ˆå¥½çš„æµ‹è¯•è¦†ç›–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒï¼Œåœ¨iOSå’ŒmacOSä¸Šè¿è¡Œæ—¶ï¼Œäº‹æƒ…éƒ½èƒ½åƒæˆ‘ä»¬é¢„æœŸçš„é‚£æ ·è¿è¡Œã€‚</p>
<p>æˆ‘ä»¬å·²ç»å¼€å¯äº†ä½¿æˆ‘ä»¬çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸å—UIä¸­ç”¨ä¾‹å½±å“çš„èƒ½åŠ›ï¼Œè¿™æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰çœŸæ­£å›°éš¾çš„å·¥ä½œå‘ç”Ÿçš„åœ°æ–¹ï¼ŒåŒæ—¶ä»ç„¶å…è®¸æˆ‘ä»¬å°†è¿™ç§ä¸å—å½±å“çš„ç‰¹æ€§åº”ç”¨åˆ°ç‰¹å®šäºæˆ‘ä»¬çš„è§†å›¾çš„é¢†åŸŸä¸­ã€‚</p>
<p>æˆ‘ä»¬åŒæ—¶å¾—åˆ°äº†å¤šå±‚æ¬¡çš„å¥½å¤„ã€‚æˆ‘ä»¬ä¸€æ–¹é¢é€šè¿‡ä¸€èˆ¬åŒ–å¤„ç†ä¸šåŠ¡é€»è¾‘çš„æ–¹å¼æ¥ç®€åŒ–ï¼Œå¦ä¸€æ–¹é¢é€šè¿‡ä¸“é—¨åŒ–ä»åº”ç”¨ç¨‹åºçŠ¶æ€æ„é€ è§†å›¾çš„æ–¹å¼æ¥ç®€åŒ–ã€‚</p>
<p>æˆ‘ä»¬å·²ç»åˆ°äº†å°†å¯ç»„åˆæ¶æ„(**Composable Architecture)**å¼•å…¥ç”Ÿäº§å°±ç»ªçŠ¶æ€çš„æœ€åé˜¶æ®µã€‚</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/i-r9uoo_2N/" class="tag">
                    PointFree
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/pointfree-episode-96adaptive-state-management-actions/">
                  <h3 class="post-title">
                    PointFree Episode 96:Adaptive State Management: Actions
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
