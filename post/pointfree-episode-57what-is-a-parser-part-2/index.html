<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>PointFree Episode 57:What Is a Parser?: Part 2 | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1679904102931">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="



PointFree Episode 57:What Is a Parser?: Part 2




What is a parser?




Parsing as a multi-step process




Optimiz..." />
    <meta name="keywords" content="parser,PointFree" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1679904102931" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
       <a href="https://beian.miit.gov.cn/">è±«ICPå¤‡2021012281å·-1</a> | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">PointFree Episode 57:What Is a Parser?: Part 2</h2>
            <div class="post-date">2022-01-15</div>
            
            <div class="post-content" v-pre>
              <!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#PointFreeEpisode57:WhatIsaParser:Part2">PointFree Episode 57:What Is a Parser?: Part 2</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="#Whatisaparser">What is a parser?</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#Parsingasamulti-stepprocess">Parsing as a multi-step process</a></li>
</ol>
</li>
<li>
<ol start="4">
<li><a href="#Optimizedparsingwithinout">Optimized parsing with inout</a></li>
</ol>
</li>
<li>
<ol start="5">
<li><a href="#Optimizedparsingwithsubstring">Optimized parsing with substring</a></li>
</ol>
</li>
<li>
<ol start="6">
<li><a href="#Tillnexttime">Till next time</a></li>
</ol>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<!-- ##  1. <a name='PointFreeEpisode57:WhatIsaParser:Part2'></a>PointFree Episode 57:What Is a Parser?: Part 2 -->
<h2 id="2-a-namewhatisaparserawhat-is-a-parser">2. <a name='Whatisaparser'></a>What is a parser?</h2>
<p>æ ¹æ®æˆ‘ä»¬åˆšæ‰æ‰€åšçš„å·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°†è§£æå™¨å®šä¹‰ä¸ºä»å­—ç¬¦ä¸²åˆ°å…¶ä»–ç±»å‹çš„å‡½æ•°ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å°†å…¶å®šä¹‰ä¸ºä¸€ä¸ªç®€å•çš„ç±»å‹åˆ«åï¼š</p>
<pre><code class="language-swift">typealias Parser&lt;A&gt; = (String) -&gt; A
</code></pre>
<p>ç»™å®ƒä¸€ä¸ªåˆé€‚çš„ç±»å‹ä¼šå¾ˆæ–¹ä¾¿ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨æ–¹æ³•æ¥æ‰©å±•å®ƒï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°†å‡½æ•°åŒ…è£…åœ¨ä¸€ä¸ªç»“æ„ä¸­ï¼š</p>
<pre><code class="language-swift">struct Parser&lt;A&gt; {
  let run: (String) -&gt; A
}
</code></pre>
<p>ç„¶è€Œï¼Œç›®å‰è§£æå™¨çš„å½¢çŠ¶å¹¶ä¸ååˆ†æ­£ç¡®ï¼Œå› ä¸ºè§£æå¹¶ä¸æ€»æ˜¯ä¿è¯æˆåŠŸå¹¶äº§ç”Ÿå€¼ã€‚æ€»ä¼šæœ‰ä¸€äº›æ ¼å¼ä¸æ­£ç¡®çš„æ•°æ®å—ï¼Œæˆ‘ä»¬å°±æ˜¯æ— æ³•è§£æå®ƒã€‚é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥ä»‹ç»ä¸€äº›æ•…éšœæ€§ï¼š</p>
<pre><code class="language-swift">struct Parser&lt;A&gt; {
  let run: (String) -&gt; A?
}
</code></pre>
<p>è¿™ç§ç®€å•çš„ç±»å‹åœ¨åº”ç”¨ç¨‹åºå¼€å‘ä¸­ç»å¸¸å‡ºç°ã€‚æˆ‘ä»¬é€šå¸¸æ‹¥æœ‰éç»“æ„åŒ–æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªè£¸å­—ç¬¦ä¸²ï¼Œå¹¶å¸Œæœ›å°†å…¶è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®ã€‚ä¾‹å¦‚ï¼ŒiOSåº”ç”¨ç¨‹åºä¸­çš„æ·±åº¦é“¾æ¥è·¯ç”±å¯ä»¥è¢«è§†ä¸ºè§£æå™¨ï¼š</p>
<pre><code class="language-swift">let router = Parser&lt;Route&gt; { str in
  fatalError()
}
</code></pre>
<p><strong>Route</strong>è¡¨ç¤ºåº”ç”¨ç¨‹åºä¸­æ”¯æŒçš„è·¯ç”±æ ‘ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-swift">enum Route {
  case home
  case profile
  case episodes
  case episode(id: Int)
}
</code></pre>
<p>å¦‚æœæˆ‘ä»¬å¯ä»¥æ„é€ è¯¥<strong>router</strong>å€¼ï¼Œé‚£ä¹ˆæ¯å½“æ·±åº¦é“¾æ¥è¯·æ±‚é€šè¿‡æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå§”æ‰˜æ—¶ï¼Œæˆ‘ä»¬åªéœ€åœ¨å…¶ä¸Šè¿è¡Œè§£æå™¨ï¼Œä»ä¸­è·å–ä¸€çº§<strong>Router</strong>å€¼ï¼Œ<strong>switch</strong>è¯¥å€¼ï¼Œç„¶åæ‰§è¡Œä¸€äº›åŸºæœ¬é€»è¾‘ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æ˜¾ç¤ºæ­£ç¡®çš„å±å¹•ï¼š</p>
<pre><code class="language-swift">router.run(&quot;/&quot;)
// .home

router.run(&quot;/episodes/42&quot;)
// .episode(42)
</code></pre>
<p>ä¸€æ—¦ä½ æœ‰äº†è¿™ä¸ªè®¾å¤‡ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<strong>switch</strong>è¯­å¥æ¥è·¯ç”±ä¼ å…¥çš„æ·±åº¦é“¾æ¥ã€‚</p>
<pre><code class="language-swift">switch router.run(&quot;/&quot;) {
case .none:
case .some(.home):
case .some(.profile):
case .some(.episodes):
case let .some(.episode(id)):
}
</code></pre>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å°†å‘½ä»¤è¡Œå·¥å…·è§†ä¸ºè§£æå™¨ï¼š</p>
<pre><code class="language-swift">let cli = Parser&lt;EnumPropertyGenerator&gt; { _ in
  fatalError()
}
</code></pre>
<p><strong>EnumPropertyGenerator</strong>è¡¨ç¤ºå¯ä»¥ä½¿ç”¨è¯¥å·¥å…·çš„æ‰€æœ‰æ–¹å¼ã€‚</p>
<pre><code class="language-swift">enum EnumPropertyGenerator {
  case help
  case version
  case invoke(urls: [URL], dryRun: Bool)
}
</code></pre>
<p>å°±åƒæˆ‘ä»¬çš„è·¯ç”±å™¨ä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬æ„é€ å…¶ä¸­ä¸€ä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥<strong>switch</strong>å®ƒæ¥å¤„ç†è¾“å…¥ã€‚</p>
<pre><code class="language-swift">cli.run(&quot;generate-enum-properties --version&quot;)
// .version

cli.run(&quot;generate-enum-properties --help&quot;)
// .help

cli.run(&quot;generate-enum-properties --dry-run path/to/file&quot;)
// .invoke(urls: [&quot;path/to/file&quot;], dryRun: true)

switch cli.run(&quot;generate-enum-properties --dry-run path/to/file&quot;) {
case .none:
case .some(.help):
case .some(.version):
case let .some(.invoke(urls, dryRun)):
}
</code></pre>
<hr>
<h2 id="3-a-nameparsingasamulti-stepprocessaparsing-as-a-multi-step-process">3. <a name='Parsingasamulti-stepprocess'></a>Parsing as a multi-step process</h2>
<p>å› æ­¤ï¼Œå°½ç®¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‹¥æœ‰è¿™äº›è§£æå™¨æ˜¯å¤šä¹ˆæœ‰ç”¨ï¼Œä½†åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å®šä¹‰çš„ç±»å‹ä»ç„¶ä¸å¤ªæ­£ç¡®ã€‚åˆ›å»ºè¿™æ ·ä¸€ä¸ªè§£æå™¨æ„å‘³ç€æˆ‘ä»¬å¿…é¡»æ˜ç¡®å›ç­”å¦‚ä½•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºAå€¼çš„é—®é¢˜ï¼Œå› æ­¤è¿™ä¸åˆ©äºåˆ›å»ºèƒ½å¤Ÿè¿›è¡Œå°‘é‡è§£æçš„å°å‹è§£æå™¨ï¼Œå¹¶å°†å®ƒä»¬æ‹¼æ¥åˆ°èƒ½å¤Ÿè§£æå¤§å‹äº‹ç‰©çš„è§£æå™¨ä¸­ã€‚</p>
<p>ä¸€ç§æ–¹æ³•æ˜¯å°†è§£æè§†ä¸ºä¸€ä¸ªå¤šæ­¥éª¤çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”è§£æå™¨ç±»å‹åº”è¯¥åªæè¿°è¯¥è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªæ­¥éª¤ã€‚è¿™æ„å‘³ç€æ›´æ”¹å‡½æ•°ç­¾åä»¥è¿”å›ä¸è¦è§£æçš„å­—ç¬¦ä¸²å…¶ä½™éƒ¨åˆ†ä¸€èµ·çš„ç»“æœã€‚</p>
<p>æˆ‘ä»¬å¸Œæœ›ä¸º<strong>Parser</strong>ç±»å‹æä¾›æ­¤åŠŸèƒ½ã€‚è§£æçš„ä¸€ä¸ªæ­¥éª¤æ˜¯ä½¿ç”¨è¾“å…¥å­—ç¬¦ä¸²çš„ä¸€äº›å­é›†ï¼Œç„¶åè¿”å›è¦è§£æçš„å­—ç¬¦ä¸²çš„å‰©ä½™éƒ¨åˆ†ä»¥åŠè§£æç»“æœã€‚</p>
<pre><code class="language-swift">struct Parser&lt;A&gt; {
  let run: (String) -&gt; (match: A?, rest: String)
}
</code></pre>
<p>ä½œä¸ºä¸€ä¸ªéå¸¸ç®€å•çš„ç¤ºä¾‹ï¼Œè®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªæ•´æ•°è§£æå™¨ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œå®ƒå°†è§£æå­—ç¬¦ä¸²å¼€å¤´çš„æ•´æ•°ï¼Œå¹¶å°†å…¶ä¸å­—ç¬¦ä¸²çš„å…¶ä½™éƒ¨åˆ†ä¸€èµ·è¿”å›ã€‚è®©æˆ‘ä»¬ä»è§£æå™¨çš„åŸºæœ¬è®¾ç½®å¼€å§‹ï¼š</p>
<pre><code class="language-swift">let int = Parser&lt;Int&gt; { str in
  // (Int?, String)
}
</code></pre>
<p>ä¸çŸ¥ä½•æ•…ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¿…é¡»è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²è¡¨ç¤ºåœ¨æˆ‘ä»¬ä»å¼€å¤´æ¶ˆè€—äº†ä¸€ä¸ªæ•´æ•°ä¹‹åçš„è¾“å…¥å­—ç¬¦ä¸²ï¼Œä»¥åŠå°†æ¶ˆè€—çš„å‰ç¼€è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„ç»“æœã€‚è®©æˆ‘ä»¬ä»è·å–ç»™å®šå­—ç¬¦ä¸²çš„æ‰€æœ‰æ•°å­—å­—ç¬¦çš„å‰ç¼€å¼€å§‹ï¼š</p>
<pre><code class="language-swift">let int = Parser&lt;Int&gt; { str in
  let prefix = str.prefix(while: { $0.isNumber })
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨Intåˆå§‹åŒ–å™¨å°†æ­¤å‰ç¼€è½¬æ¢ä¸ºæ•´æ•°ã€‚</p>
<pre><code class="language-swift">let int = Parser&lt;Int&gt; { str in
  let prefix = str.prefix(while: { $0.isNumber })
  let int = Int(prefix)
</code></pre>
<p>ä½†æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤±è´¥çš„æ“ä½œï¼Œå¦‚æœå­—ç¬¦ä¸²çš„å‰ç¼€ä¸æ˜¯æ•°å­—ï¼Œintå°†æ˜¯nilï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›é˜²æ­¢è¿™ç§æƒ…å†µï¼Œå¹¶é€šè¿‡è¿”å›nilå’ŒåŸå§‹å­—ç¬¦ä¸²æ¥é¿å…ï¼Œå› ä¸ºå¦‚æœè§£æå¤±è´¥ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ä½¿ç”¨ä»»ä½•å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-swift">let int = Parser&lt;Int&gt; { str in
  let prefix = str.prefix(while: { $0.isNumber })
  guard let int = Int(prefix) else { return (nil, str) }
</code></pre>
<p>æˆ‘ä»¬è¶Šæ¥è¶Šæ¥è¿‘äº†ï¼Œæˆ‘ä»¬æœ‰äº†æƒ³è¦è¿”å›çš„æ•´æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨çš„å­—ç¬¦ä¸²çš„â€œrestâ€ã€‚å¦‚æœæ‰§è¡Œæ­¤æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ç»“æŸç´¢å¼•è¿”å›æœªä½¿ç”¨çš„å­—ç¬¦ï¼š</p>
<pre><code class="language-swift">let int = Parser&lt;Int&gt; { str in
  let prefix = str.prefix(while: { $0.isNumber })
  guard let int = Int(prefix) else { return (nil, str) }
  let rest = String(str[prefix.endIndex...])
  return (int, rest)
}
</code></pre>
<p>è¿™æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè§£æå™¨ï¼è¿™æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨å­—ç¬¦ä¸²ç´¢å¼•ï¼Œè¿™å¯èƒ½å¾ˆæ£˜æ‰‹ï¼Œä½†å®ƒåº”è¯¥å°è£…ä»å­—ç¬¦ä¸²å¼€å¤´è§£ææ•´æ•°çš„æ‰€æœ‰å«ä¹‰ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥è¯•ä¸€è¯•ï¼š</p>
<pre><code class="language-swift">int.run(&quot;42&quot;)
// (match 42, rest &quot;&quot;)

int.run(&quot;42 Hello World&quot;)
// (match 42, rest &quot; Hello World&quot;

int.run(&quot;Hello World&quot;)
// (match nil, rest &quot;Hello World&quot;
</code></pre>
<p>å°±åƒè¿™æ ·ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªè§£æå™¨ã€‚å®ƒå¯èƒ½çœ‹èµ·æ¥ä¸å¤šï¼Œä½†è¿™ä¸ªå°å•å…ƒå°†æˆä¸ºè®¸å¤šä»¤äººæƒŠå¥‡çš„äº‹æƒ…çš„åŸºç¡€ã€‚</p>
<hr>
<h2 id="4-a-nameoptimizedparsingwithinoutaoptimized-parsing-with-inout">4. <a name='Optimizedparsingwithinout'></a>Optimized parsing with inout</h2>
<p>ä½†æ˜¯åœ¨æˆ‘ä»¬ç»§ç»­å¼€å‘è§£æå™¨ç±»å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆè®¨è®ºä¸€äº›å¿«é€Ÿä¼˜åŒ–çš„æœºä¼šã€‚ç°åœ¨ï¼Œè§£æå™¨çš„<strong>run</strong>å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ä¸€ä¸ªå…¨æ–°çš„å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²è¡¨ç¤ºåœ¨è§£æè¿‡ç¨‹ä¸­ä½¿ç”¨äº†è¾“å…¥çš„æŸä¸ªå­é›†åå‰©ä¸‹çš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜è¾“å…¥æ¥è¡¨ç¤ºæ¶ˆè€—æ¥æé«˜æ•ˆç‡ã€‚</p>
<p>æˆ‘ä»¬ä»¥å‰åœ¨å¯ç»„åˆæ¶æ„ä¸­è¯æ˜äº†åœ¨Aä¸­è·å–å€¼å¹¶åœ¨Aä¸­è¿”å›å€¼çš„å‡½æ•°ä¸ä»…è·å–inout Aå¹¶è¿”å›Voidçš„å‡½æ•°ä¹‹é—´å­˜åœ¨ç­‰ä»·æ€§ï¼š</p>
<pre><code class="language-swift">// (A)       -&gt; A
// (inout A) -&gt; Void
</code></pre>
<p>æ‚¨å¯ä»¥è½»æ¾æ„å»ºåœ¨è¿™ä¸¤ç§ç±»å‹çš„å‡½æ•°ä¹‹é—´é€šç”¨è½¬æ¢ã€‚é€šå¸¸æ¥è¯´ï¼Œå¦‚æœå‡½æ•°ç­¾åä¸­çš„æŸä¸ªç±»å‹åœ¨å‡½æ•°ç®­å¤´çš„æ¯ä¸€ä¾§å‡ºç°ä¸€æ¬¡ï¼Œåˆ™å¯ä»¥å°†å…¶è½¬æ¢ä¸ºæ¥å—inoutè¾“å…¥ä¸”ä¸å†è¿”å›è¯¥ç±»å‹çš„å‡½æ•°ã€‚</p>
<pre><code class="language-swift">struct Parser&lt;A&gt; {
//  let run: (String) -&gt; (match: A?, rest: String)
  let run: (inout String) -&gt; A?
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¿…é¡»ä¿®å¤<strong>int</strong>è§£æå™¨ã€‚æˆ‘ä»¬å°†å¯¹å­—ç¬¦ä¸²è¿›è¡Œé€‚å½“çš„å˜å¼‚ä»¥ä½¿ç”¨å‰ç¼€ï¼Œè€Œä¸æ˜¯è¿”å›æ–°å­—ç¬¦ä¸²å’Œç»“æœã€‚</p>
<pre><code class="language-swift">let int = Parser&lt;Int&gt; { str in
  let prefix = str.prefix(while: { $0.isNumber })
  guard let match = Int(prefix) else { return nil }
  str.removeFirst(prefix.count)
  return match
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬çš„æ„å»ºä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦ä¸€ä¸ª<strong>inout</strong>å‚æ•°ï¼Œæ‰€ä»¥ç°åœ¨è®©æˆ‘ä»¬é‡æ–°åˆ›å»º<strong>run</strong>çš„éå˜å¼‚ç‰ˆæœ¬ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç»§ç»­ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨å®ƒï¼š</p>
<pre><code class="language-swift">extension Parser {
  func run(_ str: String) -&gt; (match: A?, rest: String) {
    var str = str
    let match = self.run(&amp;str)
    return (match, str)
  }
}
</code></pre>
<p>ä¸€åˆ‡éƒ½åƒä»¥å‰ä¸€æ ·ç»§ç»­å·¥ä½œã€‚</p>
<hr>
<h2 id="5-a-nameoptimizedparsingwithsubstringaoptimized-parsing-with-substring">5. <a name='Optimizedparsingwithsubstring'></a>Optimized parsing with substring</h2>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åšä¸€ä¸ªä¼˜åŒ–ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŒ–ã€‚ç°åœ¨æˆ‘ä»¬æ­£åœ¨å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œï¼Œæ¯æ¬¡ä»å­—ç¬¦ä¸²çš„å‰é¢æ¶ˆè€—ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±ä»<strong>run</strong>å‡½æ•°è¿”å›åˆ›å»ºçš„ä¸€ä¸ªå…¨æ–°çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæˆ‘ä»¬è¯•å›¾è§£æå¤§çš„è¾“å…¥å­—ç¬¦ä¸²ï¼Œè¿™å¯èƒ½ä¼šéå¸¸ä½æ•ˆã€‚ä½†ä¸ä¸€å®šè¦è¿™æ ·ã€‚ç”±äºæˆ‘ä»¬é€šå¸¸ä»å­—ç¬¦ä¸²çš„å‰é¢å¼€å§‹æ¶ˆè´¹ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥åšä¸€äº›éå¸¸è½»é‡çº§çš„äº‹æƒ…ï¼Œæ¯”å¦‚æ›´æ”¹å­—ç¬¦ä¸²çš„<strong>startIndex</strong>ä»¥æŒ‡å‘å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œè¯¥æ€ä¹ˆåŠã€‚</p>
<p>äº‹å®è¯æ˜ï¼Œè¿™æ­£æ˜¯Swiftä¸­<strong>Substring</strong>ç±»å‹çš„å·¥ä½œæ–¹å¼ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å­—ç¬¦ä¸²çš„å­å­—ç¬¦ä¸²ï¼Œä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ç§»åŠ¨ç´¢å¼•ï¼Œä½¿äº‹æƒ…çœŸæ­£æœ‰æ•ˆæœã€‚</p>
<p>å­å­—ç¬¦ä¸²æ˜¯ä¸€äº›å­—ç¬¦ä¸²å­˜å‚¨çš„åŒ…è£…å™¨ï¼Œå®ƒæ—¨åœ¨ä¸å…¶ä»–<strong>Substring</strong>å®ä¾‹å…±äº«è¯¥å­˜å‚¨ã€‚ç„¶åï¼Œå­å­—ç¬¦ä¸²çš„æŸäº›çªå˜å¯ä»¥éå¸¸æœ‰æ•ˆåœ°å®Œæˆï¼Œå› ä¸ºåœ¨å†…éƒ¨å®ƒæ‰€åšçš„åªæ˜¯åœ¨æŒ‡ç¤ºå­—ç¬¦ä¸²å¼€å§‹å’Œç»“æŸä½ç½®çš„ç´¢å¼•ä¹‹é—´ç§»åŠ¨ã€‚</p>
<p>æ¯ä¸ªSwifté›†åˆéƒ½æœ‰ä¸€ä¸ªåº•å±‚<strong>SubSequence</strong>ç±»å‹ï¼Œå®ƒä»¬éƒ½æ—¨åœ¨æé«˜é›†åˆçš„ä½¿ç”¨æ•ˆç‡ã€‚</p>
<p>è®©æˆ‘ä»¬å°è¯•æ›´æ–°è§£æå™¨æ¥å¤„ç†<strong>Substring</strong>ï¼Œçœ‹çœ‹å“ªäº›æ˜¯æ­£ç¡®çš„ï¼Œå“ªäº›æ˜¯é”™è¯¯çš„ã€‚æˆ‘ä»¬å°†é¦–å…ˆæ›´æ”¹å®ƒçš„<strong>mutating run</strong>å‡½æ•°ä»¥ä½¿ç”¨<strong>inout Substring</strong>è€Œä¸æ˜¯<strong>String</strong>ã€‚</p>
<pre><code class="language-swift">struct Parser&lt;A&gt; {
  let run: (inout Substring) -&gt; A?
}
</code></pre>
<p>è¿™ç ´åäº†æˆ‘ä»¬çš„<strong>run</strong>çš„éå˜å¼‚ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä»åœ¨ä½¿ç”¨æ™®é€šoleå­—ç¬¦ä¸²ï¼š</p>
<pre><code class="language-swift">func run(_ str: String) -&gt; (match: A?, rest: String) {
  var str = str
  let match = self.run(&amp;str)
</code></pre>
<blockquote>
<p>ğŸ›‘ Cannot invoke â€˜runâ€™ with an argument list of type â€˜(inout String)â€™</p>
</blockquote>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å…¶<strong>substring</strong>è¡¨ç¤ºæ¥é¿å…å­—ç¬¦ä¸²å¤åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨Swiftæ‰€ç§°çš„â€œæ— ç•ŒèŒƒå›´è¡¨è¾¾å¼â€è¿›è¡Œè®¢é˜…æ¥è·å¾—è¯¥è¡¨ç¤ºï¼š</p>
<pre><code class="language-swift">var str = str[...]
</code></pre>
<p>è¿™çœ‹èµ·æ¥æœ‰ç‚¹æ—¶é«¦ï¼Œä½†å®ƒå®é™…ä¸Šç»™äº†æˆ‘ä»¬å¯¹å­—ç¬¦ä¸²çš„çœ‹æ³•ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬åº”è¯¥æ›´æ–°è¿”å›å€¼ä»¥è¿”å›è¯¥å­å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-swift">func run(_ str: String) -&gt; (match: A?, rest: Substring) {
  var str = str[...]
  let match = self.run(&amp;str)
  return (match, str)
}
</code></pre>
<p>è¿™å°±æ˜¯éœ€è¦æ”¹å˜çš„ä¸€åˆ‡ï¼ç”¨äºçªå˜å­å­—ç¬¦ä¸²çš„æ¥å£ä¸ç”¨äºçªå˜å­—ç¬¦ä¸²çš„æ¥å£ç›¸åŒï¼Œä½†æˆ‘ä»¬å°†é€šè¿‡åœ¨å­—ç¬¦ä¸²ä¸­ä½¿ç”¨è§†å›¾è€Œä¸æ˜¯å‰¯æœ¬æ¥æé«˜æ€§èƒ½ã€‚</p>
<p>æˆ‘ä»¬ä»ç„¶æœ‰æ•´ä¸ªå­—ç¬¦ä¸²å¿…é¡»åœ¨å†…å­˜ä¸­çš„é™åˆ¶ï¼Œè¿™æ„å‘³ç€è§£æä¸€ä¸ªéå¸¸å¤§çš„å­—ç¬¦ä¸²æ˜¯æ²¡æœ‰æ•ˆç‡çš„ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æ‰€åšçš„ä¼˜åŒ–éå¸¸ç®€å•ï¼Œå·²ç»ç»™æˆ‘ä»¬å¸¦æ¥äº†å¾ˆå¤šå¥½å¤„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­åŠªåŠ›å§ã€‚</p>
<hr>
<h2 id="6-a-nametillnexttimeatill-next-time">6. <a name='Tillnexttime'></a>Till next time</h2>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†è§£æå™¨çš„â€œ<strong>final form</strong>â€ï¼šå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè·å–ä¸€ä¸ªin-outå­å­—ç¬¦ä¸²å¹¶ç”Ÿæˆä¸€ä¸ªå¯é€‰çš„åŒ¹é…é¡¹ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å†åˆ›å»ºå‡ ä¸ªè§£æå™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥äº†è§£è¿™æ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/IQVuijH5g/" class="tag">
                    parser
                  </a>
                
                  <a href="https://kayouyou.github.io/tag/i-r9uoo_2N/" class="tag">
                    PointFree
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/pointfree-episode-56what-is-a-parser-part-1/">
                  <h3 class="post-title">
                    PointFree Episode 56:What Is a Parser?: Part 1
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
