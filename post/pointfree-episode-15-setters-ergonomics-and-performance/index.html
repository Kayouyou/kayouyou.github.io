<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>PointFree Episode 15: Setters: Ergonomics &amp; Performance | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1680320045148">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="



Introduction




Refining things




Overloading prop




Double-overloading prop




Over and set




Generalizing ..." />
    <meta name="keywords" content="PointFree" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1680320045148" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
       <a href="https://beian.miit.gov.cn/">è±«ICPå¤‡2021012281å·-1</a> | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">PointFree Episode 15: Setters: Ergonomics &amp; Performance</h2>
            <div class="post-date">2021-11-07</div>
            
            <div class="post-content" v-pre>
              <!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#Introduction">Introduction</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="#Refiningthings">Refining things</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#Overloadingprop">Overloading prop</a></li>
</ol>
</li>
<li>
<ol start="4">
<li><a href="#Double-overloadingprop">Double-overloading prop</a></li>
</ol>
</li>
<li>
<ol start="5">
<li><a href="#Overandset">Over and set</a></li>
</ol>
</li>
<li>
<ol start="6">
<li><a href="#Generalizingoverandset">Generalizing over and set</a></li>
</ol>
</li>
<li>
<ol start="7">
<li><a href="#Setterasatype">Setter as a type</a></li>
</ol>
</li>
<li>
<ol start="8">
<li><a href="#Refactoringanearlierexample">Refactoring an earlier example</a></li>
</ol>
</li>
<li>
<ol start="9">
<li><a href="#Settersandperformance">Setters and performance</a></li>
</ol>
</li>
<li>
<ol start="10">
<li><a href="#Onemoremutablerefactor">One more mutable refactor</a></li>
</ol>
</li>
<li>
<ol start="11">
<li><a href="#Whatsthepoint">Whatâ€™s the point?</a></li>
</ol>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<!-- # PointFree Episode 15: Setters: Ergonomics & Performance -->
<h2 id="1-a-nameintroductionaintroduction">1. <a name='Introduction'></a>Introduction</h2>
<p>æˆ‘ä»¬ç°åœ¨å·²ç»èŠ±äº†å‡ é›†æ—¶é—´æ¥æ¢ç´¢â€œ<strong>functional setters</strong>â€:å…è®¸æˆ‘ä»¬ä»å°å•ä½æ„å»ºå…·æœ‰è¡¨ç°åŠ›çš„ã€ä¸å¯å˜çš„æ•°æ®è½¬æ¢çš„å‡½æ•°ã€‚æˆ‘ä»¬å·²ç»æ¢ç´¢äº†å®ƒä»¬å¦‚ä½•ä»¥ä»¤äººæƒŠè®¶çš„æ–¹å¼ç»„åˆåœ¨ä¸€èµ·ï¼Œä»è€Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå¯¹æ·±åº¦åµŒå¥—çš„å€¼è¿›è¡Œæ›´æ”¹:é€šå¸¸è¿›è¡Œè¿™äº›æ›´æ”¹æ˜¯å¾ˆéº»çƒ¦çš„ã€‚ æˆ‘ä»¬è¿˜åˆ©ç”¨äº†ä¸€ä¸ªç¾å¦™è€Œç‹¬ç‰¹çš„Swiftç‰¹æ€§ï¼Œ<strong>å…³é”®è·¯å¾„(key paths</strong>)ï¼Œä¸ºæˆ‘ä»¬çš„ç±»å’Œç»“æ„çš„å±æ€§ä»ç¨€è–„çš„ç©ºæ°”ä¸­æå–settersã€‚</p>
<p><strong>Setters</strong>æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§å’Œå¹¿æ³›æœ‰ç”¨çš„å·¥å…·ï¼Œä½†å½“ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œæˆ‘ä»¬ç›®å‰ç¼–å†™çš„å‡½æ•°æœ‰äº›ç²—ç³™ã€‚å®ƒä»¬ä¹Ÿä¸æ˜¯ä¸–ç•Œä¸Šæ€§èƒ½æœ€å¥½çš„ä¸œè¥¿:å› ä¸ºsettersæ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥å®ƒä»¬åœ¨æ¯ä¸€æ­¥ä¸­éƒ½ä¼šåˆ›å»ºå®ƒä»¬çš„å€¼çš„å‰¯æœ¬ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ¶ˆé™¤è¿™äº›ç²—ç³™çš„è¾¹ç¼˜ï¼Œå¹¶æ¢ç´¢å¦‚ä½•ä½¿ç”¨Swiftçš„å€¼å˜å¼‚è¯­ä¹‰æ¥æé«˜æ€§èƒ½ã€‚</p>
<h2 id="2-a-namerefiningthingsarefining-things">2. <a name='Refiningthings'></a>Refining things</h2>
<p>è®©æˆ‘ä»¬ä»ä¸ŠèŠ‚è¯¾çš„ä¸€ä¸ªä¾‹å­å¼€å§‹ã€‚æˆ‘ä»¬æœ‰<strong>Food, Location, User</strong>ç»“æ„ä½“ä»¥åŠ<strong>user</strong>å€¼ã€‚</p>
<pre><code class="language-swift">struct Food {
  var name: String
}

struct Location {
  var name: String
}

struct User {
  var favoriteFoods: [Food]
  var location: Location
  var name: String
}

var user = User(
  favoriteFoods: [Food(name: &quot;Tacos&quot;), Food(name: &quot;Nachos&quot;)],
  location: Location(name: &quot;Brooklyn&quot;),
  name: &quot;Blob&quot;
)
</code></pre>
<p>ä¸ºäº†è½¬æ¢è¿™äº›å±æ€§ï¼Œæˆ‘ä»¬ç¼–å†™äº†<strong>prop</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç»™å®šä¸€ä¸ªå¯å†™çš„é”®è·¯å¾„ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªsetterå‡½æ•°ã€‚å¦‚æœæ²¡æœ‰å…³é”®è·¯å¾„ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ä¸ºæ¯ä¸ªæƒ³è¦ä¿®æ”¹çš„å±æ€§ç¼–å†™æˆ–ç”Ÿæˆsetterï¼Œè¿™å¯èƒ½ä¼šé˜»æ­¢æˆ‘ä»¬åœ¨ä¸€å¼€å§‹ä½¿ç”¨å®ƒä»¬!</p>
<pre><code class="language-swift">func prop&lt;Root, Value&gt;(_ kp: WritableKeyPath&lt;Root, Value&gt;)
  -&gt; (@escaping (Value) -&gt; Value)
  -&gt; (Root) -&gt; Root {

    return { update in
      { root in
        var copy = root
        copy[keyPath: kp] = update(copy[keyPath: kp])
        return copy
      }
    }
}
</code></pre>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›æ­£åœ¨ä½¿ç”¨çš„<strong>setters</strong>ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ä¸€å¯¹<strong>prop</strong> setterså°†<strong>user</strong>ç®¡é“åŒ–:ä¸€ä¸ªæŠŠä»–ä»¬çš„åå­—å¤§å†™ï¼Œå¦ä¸€ä¸ªæŠŠä»–ä»¬æ¬åˆ°æ´›æ‰çŸ¶ã€‚</p>
<pre><code class="language-swift">user
  |&gt; (prop(\.name)) { $0.uppercased() }
  &lt;&gt; (prop(\.location.name)) { _ in &quot;Los Angeles&quot; }
</code></pre>
<p>ä½¿ç”¨propåœ¨å®è·µä¸­çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œå› ä¸ºå®ƒæ˜¯curryè¿‡çš„:ä½¿ç”¨key-pathè°ƒç”¨propå°†è¿”å›å¦ä¸€ä¸ªå‡½æ•°ã€‚ æˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºåŒ…è£…åœ¨æ‹¬å·ä¸­ï¼Œä½œä¸ºä¸€ç§èšä¼šæŠ€å·§æ¥æ¢å¤å°¾éšé—­åŒ…è¯­æ³•ï¼Œä½†åƒè¿™æ ·çš„æŠ€å·§æ¯”å…¶ä»–ä»»ä½•æŠ€å·§éƒ½æ›´ä»¤äººå›°æƒ‘ã€‚ æˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°è¿™äº›é¢å¤–çš„æ‹¬å·ï¼Œå¹¶æƒ³çŸ¥é“:å®ƒä»¬ä¸ºä»€ä¹ˆåœ¨é‚£é‡Œ? æˆ‘ä»¬è¯•å›¾åˆ é™¤å®ƒä»¬ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªä»¤äººå›°æƒ‘çš„ç¼–è¯‘é”™è¯¯ã€‚</p>
<pre><code class="language-swift">prop(\.name) { $0.uppercased() }
</code></pre>
<blockquote>
<p>ğŸ›‘ Extra argument in call</p>
</blockquote>
<p>è¿™æ ·å†™è¿™äº›è¡Œæ¯”è¾ƒå®¹æ˜“ç†è§£:</p>
<pre><code class="language-swift">user
  |&gt; prop(\.name)({ $0.uppercased() })
  &lt;&gt; prop(\.location.name)({ _ in &quot;Los Angeles&quot; })
</code></pre>
<p>ä½†è¿™æ„Ÿè§‰æœ‰ç‚¹æ¶å¿ƒã€‚ä¸ºä»€ä¹ˆè¿™äº›å‡½æ•°è¦<strong>curry</strong> ? <strong>Setter</strong>å‡½æ•°éœ€è¦ç»è¿‡curryå¤„ç†ä»¥å®ç°å¤åˆï¼Œè€Œæˆ‘ä»¬éœ€è¦å¤åˆæ¥å¯¹æ•°æ®ç»“æ„è¿›è¡Œæ·±åº¦ä¿®æ”¹ã€‚ä¸è¿‡ï¼Œä½¿ç”¨setteråº”è¯¥å’Œç¼–å†™å®ƒä»¬ä¸€æ ·å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšäº›ä»€ä¹ˆæ¥æ¶ˆé™¤è°ƒç”¨è¿™äº›curryè¿‡çš„å‡½æ•°çš„å°´å°¬æ–¹å¼å‘¢?</p>
<p>è€ƒè™‘ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨è¿™äº›setterçš„ä¸¤ç§å¸¸è§æƒ…å†µå¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©: æˆ‘ä»¬è¦ä¹ˆé‡‡ç”¨ç°æœ‰çš„å€¼å¹¶è½¬æ¢å®ƒä»¬ï¼Œå°±åƒæˆ‘ä»¬å°†ç”¨æˆ·åå¤§å†™æ—¶æ‰€åšçš„é‚£æ ·ï¼Œè¦ä¹ˆå®Œå…¨æ›¿æ¢è¿™äº›å€¼ï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨å®ƒä»¬çš„ä½ç½®åæ‰€åšçš„é‚£æ ·ã€‚æˆ‘ä»¬çœ‹çœ‹èƒ½ä¸èƒ½æŠŠè¿™ä¸¤ç§æƒ…å†µä¸“é—¨åŒ–ä¸€ä¸‹ã€‚</p>
<h2 id="3-a-nameoverloadingpropaoverloading-prop">3. <a name='Overloadingprop'></a>Overloading prop</h2>
<p>åº”ç”¨ä¸€ä¸ªæ²¡æœ‰é¢å¤–æ‹¬å·çš„è½¬æ¢åº”è¯¥åƒç¼–å†™ä¸€ä¸ªæœªcurryçš„propç‰ˆæœ¬ä¸€æ ·ç®€å•ã€‚æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªé‡è½½æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<pre><code class="language-swift">func prop&lt;Root, Value&gt;(
  _ kp: WritableKeyPath&lt;Root, Value&gt;,
  _ f: @escaping (Value) -&gt; Value
  )
  -&gt; (Root) -&gt; Root {

    return prop(kp)(f)
}
</code></pre>
<p>è¿™å…è®¸æˆ‘ä»¬æ›´æ–°ä¹‹å‰çš„ä»£ç ï¼Œä½¿å…¶çœ‹èµ·æ¥æ›´åˆç†ã€‚</p>
<pre><code class="language-swift">user
  |&gt; prop(\.name) { $0.uppercased() }
  &lt;&gt; prop(\.location.name) { _ in &quot;Los Angeles&quot; }
</code></pre>
<p>æ”¹å˜æ˜¯å¾®å¦™çš„ï¼Œä½†å€¼å¾—! å¦‚æœæˆ‘ä»¬ä¼ é€’ä¸€ä¸ªå‘½åå‡½æ•°ï¼Œè¿™ç§æƒ…å†µå°±ä¼šæ›´åŠ æ˜æ˜¾ã€‚</p>
<pre><code class="language-swift">let addCourtesyTitle = { $0 + &quot;, Esq.&quot; }

user
  |&gt; prop(\.name, addCourtesyTitle)
  |&gt; prop(\.name) { $0.uppercased() }
  &lt;&gt; prop(\.location.name) { _ in &quot;Los Angeles&quot; }
</code></pre>
<p>æ²¡æœ‰æ‹¬å·ä½¿å¾—ä»£ç æ›´å®¹æ˜“é˜…è¯»å’Œç†è§£ã€‚</p>
<h2 id="4-a-namedouble-overloadingpropadouble-overloading-prop">4. <a name='Double-overloadingprop'></a>Double-overloading prop</h2>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦å®Œå…¨æ›¿æ¢æˆ‘ä»¬çš„å€¼ï¼Œæ¯”å¦‚ç”¨æˆ·çš„ä½ç½®åï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢? ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª<strong>transform</strong>å‡½æ•°ï¼Œå¿½ç•¥å½“å‰å€¼å¹¶è¿”å›ä¸€ä¸ªå¸¸é‡å­—ç¬¦ä¸²ã€‚èŠ±æ‹¬å·ã€ä¸‹åˆ’çº¿å’Œ<strong>in</strong>å…³é”®å­—ç»™ä¸€ä¸ªéå¸¸ç®€å•çš„æ“ä½œæ·»åŠ äº†å¾ˆå¤šæ‚éŸ³ã€‚æˆ‘ä»¬å†™ä¸€ä¸ªå‡½æ•°æ¥æ¶ˆé™¤è¿™äº›å¹²æ‰°ã€‚æˆ‘ä»¬å¯ä»¥å†æ¬¡é‡è½½é“å…·ï¼Œä¸ºä»€ä¹ˆä¸å‘¢? å®ƒä¼šå–ä¸€ä¸ªé”®è·¯å¾„ï¼Œä¸€ä¸ªå€¼ï¼Œç„¶åäº§ç”Ÿå¦ä¸€ä¸ª<strong>Root</strong>è½¬æ¢å‡½æ•°ã€‚</p>
<pre><code class="language-swift">func prop&lt;Root, Value&gt;(
  _ kp: WritableKeyPath&lt;Root, Value&gt;,
  _ value: Value
  )
  -&gt; (Root) -&gt; Root {
    return prop(kp) { _ in value }
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°åªæ˜¯è°ƒç”¨<strong>uncurried prop</strong>ï¼Œå¹¶éšè—äº†ä¸€äº›å™ªéŸ³ã€‚</p>
<p>è¿™å°†å¦‚ä½•æ”¹å˜æˆ‘ä»¬çš„ç®¡é“?</p>
<pre><code class="language-swift">user
  |&gt; prop(\.name, addCourtesyTitle)
  &lt;&gt; prop(\.name) { $0.uppercased() }
//  &lt;&gt; prop(\.location.name) { _ in &quot;Los Angeles&quot; }
  &lt;&gt; prop(\.location.name, &quot;Los Angeles&quot;)
</code></pre>
<p>æˆ‘ä»¬æŠŠå¾ˆå¤šå™ªéŸ³éƒ½è—èµ·æ¥äº†!</p>
<h2 id="5-a-nameoverandsetaover-and-set">5. <a name='Overandset'></a>Over and set</h2>
<p>æˆ‘ä»¬å¯èƒ½è®¤ä¸ºè¿™é‡Œå·²ç»å®Œæˆäº†ï¼Œä½†æˆ‘ä»¬å¿½ç•¥äº†<strong>setter</strong>æœºåˆ¶çš„ä¸€ä¸ªå…³é”®éƒ¨åˆ†ï¼Œå³å°†<strong>setter</strong>å‡½æ•°ç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥æ›´æ”¹æ•°æ®ç»“æ„ä¸­æ·±æ·±åµŒå¥—çš„å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†<strong>prop</strong>ç»„åˆåˆ°Arrayä¸Šçš„free <strong>map</strong>ä¸­ï¼Œå¹¶å†æ¬¡ç»„åˆåˆ°<strong>prop</strong>ä¸­ï¼Œä»¥æ›´æ”¹ç”¨æˆ·æœ€å–œæ¬¢çš„é£Ÿç‰©çš„åç§°ã€‚</p>
<pre><code class="language-swift">user
  |&gt; prop(\.name, addCourtesyTitle)
  &lt;&gt; prop(\.name) { $0.uppercased() }
  &lt;&gt; prop(\.location.name, &quot;Los Angeles&quot;)
  &lt;&gt; (prop(\.favoriteFoods) &lt;&lt;&lt; map &lt;&lt;&lt; prop(\.name)) { $0 + &quot; &amp; Salad&quot; }
</code></pre>
<p>è¿™å°±æ˜¯<strong>setter</strong>å¦‚æ­¤å¼ºå¤§çš„åŸå› :æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ï¼Œåˆ›å»ºå…¨æ–°çš„<strong>setter</strong>ï¼Œæ”¹å˜ä½äºæ•°æ®ç»“æ„æ·±å¤„çš„å€¼ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬åˆè¦ç”¨æ‹¬å·æ¥åŒ…è£…äº†ã€‚ ä¸ºäº†åŒ…å«æ„å›¾ï¼Œè¿™é‡Œçš„parensæ„Ÿè§‰æ˜¯å¿…è¦çš„ï¼Œä½†ä¸æˆ‘ä»¬å…¶ä»–é‡è½½çš„é“å…·ç›¸æ¯”ï¼Œå®ƒæ„Ÿè§‰æˆ‘ä»¬ç”Ÿæ´»åœ¨ä¸¤ä¸ªä¸åŒçš„ä¸–ç•Œ: ä¸€ä¸ªä¸–ç•Œé«˜åº¦é€‚åº”äºæ”¹å˜æˆ–è®¾å®šä»·å€¼ï¼Œå¦ä¸€ä¸ªä¸–ç•Œé«˜åº¦é€‚åº”äºåˆ›ä½œã€‚</p>
<p>ä½†æ˜¯å½“æˆ‘ä»¬æå–è¿™ä¸ªå˜æ¢å‡½æ•°å¹¶å‘½åå®ƒçš„æ—¶å€™äº‹æƒ…å°±å¼€å§‹èµ°ä¸‹å¡è·¯äº†ã€‚</p>
<pre><code class="language-swift">let healthierOption = { $0 + &quot; &amp; Salad&quot; }

user
  |&gt; prop(\.name, addCourtesyTitle)
  &lt;&gt; prop(\.name) { $0.uppercased() }
  &lt;&gt; prop(\.location.name, &quot;Los Angeles&quot;)
  &lt;&gt; (prop(\.favoriteFoods) &lt;&lt;&lt; map &lt;&lt;&lt; prop(\.name))(healthierOption)
</code></pre>
<p>æˆ‘ä»¬åˆå›åˆ°äº†ä¹‹å‰çš„åŒæ‹¬å·ã€‚</p>
<p>ä¹Ÿè®¸é‡è½½é“å…·ä¸æ˜¯æœ€å¥½çš„åŠæ³•ã€‚ä¹Ÿè®¸<strong>prop</strong>åº”è¯¥ç¨³ç¨³åœ°å­˜åœ¨äºåˆæˆå’Œ<strong>setters</strong>çš„åˆ›å»ºä¸–ç•Œä¸­ï¼Œè€Œæˆ‘ä»¬å°†æ¨å‡ºä¸“é—¨ç”¨äºä½¿ç”¨<strong>setters</strong>çš„æ–°å‘½åçš„<strong>helpers</strong>ã€‚è®©æˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªåŠ©æ‰‹ç§°ä¸º<strong>over</strong>ï¼Œè¿™æ˜¯Haskellç¤¾åŒºä¸­ç”¨äºç±»ä¼¼è½¬æ¢çš„è‰ºæœ¯æœ¯è¯­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºå¸¦æœ‰è½¬æ¢çš„<strong>setter</strong>å‡½æ•°çš„æ˜ å°„ã€‚</p>
<pre><code class="language-swift">func over&lt;Root, Value&gt;(
  _ setter: (@escaping (Value) -&gt; Value) -&gt; (Root) -&gt; Root,
  _ f: @escaping (Value) -&gt; Value
  )
  -&gt; (Root) -&gt; Root {

    return setter(f)
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°çš„ä¸»ä½“æœ€ç»ˆæ˜¯æ™®é€šçš„oleå‡½æ•°åº”ç”¨ç¨‹åºï¼Œè¿™æ˜¯æœ‰æ„ä¹‰çš„ç»™å®šcurryå’Œè°ƒç”¨ï¼Œä½†å½“å…³é”®è·¯å¾„ä¹Ÿåœ¨è¿è¡Œæ—¶å°±ä¼šéšè—èµ·æ¥ã€‚</p>
<p>è®©æˆ‘ä»¬ä¹Ÿä¸€èˆ¬åŒ–æ›¿æ¢å€¼çš„propé‡è½½ã€‚ æˆ‘ä»¬å°†å…¶é‡å‘½åä¸º<strong>set</strong>ï¼Œè¿™æ˜¯å¦ä¸€ä¸ªæ²¡æœ‰é“å…·åŒ…è¢±çš„è‰ºæœ¯æœ¯è¯­ã€‚</p>
<pre><code class="language-swift">func set&lt;Root, Value&gt;(
  _ setter: (@escaping (Value) -&gt; Value) -&gt; (Root) -&gt; Root,
  _ value: Value
  )
  -&gt; (Root) -&gt; Root {

    return over(setter) { _ value }
}
</code></pre>
<p>è¿™äº›å‡½æ•°å¦‚ä½•å½±å“æˆ‘ä»¬çš„ç®¡é“?</p>
<pre><code class="language-swift">user
  |&gt; prop(\.name, addCourtesyTitle)
  &lt;&gt; prop(\.name) { $0.uppercased() }
  &lt;&gt; prop(\.location.name, &quot;Los Angeles&quot;)
  &lt;&gt; over(prop(\.favoriteFoods) &lt;&lt;&lt; map &lt;&lt;&lt; prop(\.name), healthierOption)
</code></pre>
<p>è¿™ç¡®å®æ›´å¥½ï¼Œä½†æˆ‘ä»¬æœ‰ç‚¹å›°åœ¨ä¸¤ä¸ªä¸–ç•Œä¹‹é—´: æˆ‘ä»¬çš„<strong>prop</strong>é‡è½½helpersä»¥åŠæ›´é€šç”¨çš„overå’Œset helpersã€‚è®©æˆ‘ä»¬æŠŠä¸œè¥¿å®Œå…¨è½¬æ¢æˆä½¿ç”¨<strong>overå’Œset</strong>ã€‚</p>
<pre><code class="language-swift">user
  |&gt; over(prop(\.name), addCourtesyTitle)
  &lt;&gt; over(prop(\.name)) { $0.uppercased() }
  &lt;&gt; set(prop(\.location.name), &quot;Los Angeles&quot;)
  &lt;&gt; over(prop(\.favoriteFoods) &lt;&lt;&lt; map &lt;&lt;&lt; prop(\.name), healthierOption)
</code></pre>
<p>è¿™è¡Œå¾—é€šï¼Œæˆ‘ä»¬é¿å…äº†<strong>prop</strong>é‡è½½å¹¶ä¿æŒä¸€è‡´ï¼Œä½†åˆ°å¤„éƒ½é‡è½½äº†<strong>prop</strong>ã€‚</p>
<p>åœ¨å…³äº<strong>getter</strong>çš„é‚£ä¸€é›†ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªgetå‡½æ•°ï¼Œå®ƒä»ä»»æ„é”®è·¯å¾„ç”Ÿæˆä¸€ä¸ª(<strong>Root) -&gt; Value</strong>å‡½æ•°ã€‚ è¿™æ‰“å¼€äº†ä¸€ä¸ªå…¨æ–°çš„åˆæˆä¸–ç•Œï¼Œè®©æˆ‘ä»¬å¯ä»¥æ›´æœ‰è¡¨ç°åŠ›åœ°è°ƒç”¨æ˜ å°„ã€è¿‡æ»¤å’Œå…¶ä»–é«˜é˜¶å‡½æ•°ã€‚ åœ¨æœ¬é›†çš„æœ€åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‰ç¼€æ“ä½œç¬¦^ï¼Œä½œä¸ºgetçš„ç¼©å†™ï¼Œè¿™å¸®åŠ©æˆ‘ä»¬å‡å°‘äº†å¾ˆå¤šå¹²æ‰°ã€‚</p>
<pre><code class="language-swift">^\User.name
// (User) -&gt; String
</code></pre>
<p>ä¼¼ä¹propä¹Ÿèƒ½ä»ç±»ä¼¼çš„å¤„ç†æ–¹å¼ä¸­å—ç›Š! è®©æˆ‘ä»¬ä½¿ç”¨ä¸getç›¸åŒçš„æ“ä½œç¬¦æ¥åˆ«åå®ƒã€‚</p>
<pre><code class="language-swift">prefix func ^ &lt;Root, Value&gt;(kp: WritableKeyPath&lt;Root, Value&gt;)
  -&gt; (@escaping (Value) -&gt; Value)
  -&gt; (Root) -&gt; Root {

    return prop(kp)
}
</code></pre>
<p>è¿™å¦‚ä½•æ¸…ç†æˆ‘ä»¬çš„ç»„åˆsetterså‘¢?</p>
<pre><code class="language-swift">user
  |&gt; over(^\.name, addCourtesyTitle)
  &lt;&gt; over(^\.name) { $0.uppercased() }
  &lt;&gt; set(^\.location.name, &quot;Los Angeles&quot;)
  &lt;&gt; over(^\.favoriteFoods &lt;&lt;&lt; map &lt;&lt;&lt; ^\.name, healthierOption)
</code></pre>
<p>å“‡!è¿™å¾ˆæœ‰ç”¨!å¦‚æœæ²¡æœ‰æ— å¤„ä¸åœ¨çš„é“å…·ï¼Œå°±æ›´å®¹æ˜“ç†è§£è¿™ä¸¤æ¡çº¿çš„å®è´¨å†…å®¹ã€‚</p>
<p>é‚£äº›å¤šè½½é›†åˆå¹¶æ²¡æœ‰å°½åˆ°ä»–ä»¬çš„è´£ä»»! æˆ‘ä»¬å‰©ä¸‹çš„æ˜¯æ›´åŠ ä¸€è‡´çš„: å…³é”®è·¯å¾„é€šå¸¸ä»¥^ä½œä¸ºå‰ç¼€ï¼Œæˆ‘ä»¬åªéœ€è¦å¤„ç†ä¸¤ä¸ªæ ¹è¿ç®—<strong>overå’Œset</strong>ã€‚</p>
<p>æˆ‘ä»¬å†™äº†ä¸€ä¸ªæ–°çš„è¿ç®—ç¬¦å‡½æ•°ã€‚æˆ‘ä»¬éœ€è¦æ‰“å‹¾å—? å½“æˆ‘ä»¬é€‰æ‹©^ on getæ—¶ï¼Œæˆ‘ä»¬å‘ç°å®ƒå¯èƒ½åªé€‰æ‹©äº†æˆ‘ä»¬çš„ä¸€åŠ:æˆ‘ä»¬è®¤ä¸ºå®ƒå¾ˆå¥½ï¼Œä½†ä¸åƒå…¶ä»–ä¸€äº›æ“ä½œç¬¦é‚£ä¹ˆé€šç”¨ã€‚è¿™ä¸ªæ“ä½œç¬¦æ˜¯ä¸€ç§â€œæ¥å—æˆ–ç¦»å¼€â€æ“ä½œç¬¦:å¦‚æœä½ ä¸æƒ³ä½¿ç”¨æ“ä½œç¬¦ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨propï¼Œå› ä¸º^å®é™…ä¸Šå°±æ˜¯propï¼Œ ä½†æ˜¯å¦‚æœä½ ä¸ä»‹æ„ä½¿ç”¨ä¸€ä¸ªæ“ä½œç¬¦ï¼Œ^æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ“ä½œç¬¦ï¼Œç”¨æ¥å°†ä¸€ä¸ªé”®è·¯å¾„æå‡åˆ°setterä¸–ç•Œã€‚</p>
<h2 id="6-a-namegeneralizingoverandsetageneralizing-over-and-set">6. <a name='Generalizingoverandset'></a>Generalizing over and set</h2>
<p>å…³äº<strong>overå’Œset</strong>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>åœ¨å…³äº<strong>setters</strong>çš„ç¬¬ä¸€é›†ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€å¯¹è½¬æ¢å…ƒç»„å…ƒç´ çš„å‡½æ•°:<strong>firstå’Œsecond</strong>ã€‚</p>
<pre><code class="language-swift">(&quot;Hello, world!&quot;, 42)
  |&gt; first { _ in [1, 2, 3] }
  |&gt; second(String.init)
// ([1, 2, 3], &quot;42&quot;)
</code></pre>
<p>è¿™éå¸¸ç®€æ´ï¼Œä½†æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿä½¿ç”¨<strong>set</strong>æ¥æ¸…ç†èŠ±æ‹¬å·å’Œä¸‹åˆ’çº¿å¹²æ‰°ï¼Œ<strong>over</strong>å°†ä½¿äº‹æƒ…ä¸æˆ‘ä»¬çš„å…¶ä»–setterä¸€è‡´ã€‚</p>
<pre><code class="language-swift">(&quot;Hello, world!&quot;, 42)
  |&gt; set(first, [1, 2, 3])
  |&gt; over(second, String.init)
</code></pre>
<blockquote>
<p>ğŸ›‘ Generic parameter â€˜Valueâ€™ could not be inferred</p>
</blockquote>
<p>çœ‹æ¥æˆ‘ä»¬è¿˜ä¸å¤Ÿä¸€èˆ¬åŒ–! æˆ‘ä»¬çš„<strong>overå’Œset</strong>å‡½æ•°è¢«é™åˆ¶ä¸ºæ ¹å’Œå€¼æ³›å‹å‚æ•°ï¼Œè¿™é˜»æ­¢äº†å®ƒä»¬æ›´æ”¹ä¸ºä¸åŒçš„ç±»å‹!  æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ æ›´å¤šçš„æ³›å‹æ¥æ”¾æ¾è¿™äº›çº¦æŸã€‚</p>
<pre><code class="language-swift">func over&lt;S, T, A, B&gt;(
  _ setter: (@escaping (A) -&gt; B) -&gt; (S) -&gt; T,
  _ set: @escaping (A) -&gt; B
  )
  -&gt; (S) -&gt; T {
    return setter(set)
}
</code></pre>
<p>è¿™æ ·æˆ‘ä»¬å°±å®Œå…¨æ³›åŒ–äº†å¯ä»¥ç”¨ä»»ä½•setteräº†ã€‚æˆ‘ä»¬çš„å…ƒç»„è½¬æ¢å¯ä»¥ç¼–è¯‘ï¼Œè¯»èµ·æ¥ä¹Ÿå¾ˆå¥½!</p>
<pre><code class="language-swift">(&quot;Hello, world!&quot;, 42)
  |&gt; set(first, [1, 2, 3])
  |&gt; over(second, String.init)
// ([1, 2, 3], &quot;42&quot;)
</code></pre>
<h2 id="7-a-namesetterasatypeasetter-as-a-type">7. <a name='Setterasatype'></a>Setter as a type</h2>
<p>è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹setterçš„å½¢çŠ¶ã€‚ è™½ç„¶æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¾ˆå¤šsettersï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰çœŸæ­£ç»Ÿä¸€å®ƒä»¬ã€‚å°†setteræœ¬èº«çœ‹ä½œä¸€ç§ç±»å‹å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</p>
<pre><code class="language-swift">typealias Setter&lt;S, T, A, B&gt; = (@escaping (A) -&gt; B) -&gt; (S) -&gt; T
</code></pre>
<p>æˆ‘ä»¬å·²ç»è§è¿‡è¿™ä¸ªå½¢çŠ¶å¾ˆå¤šæ¬¡äº†ã€‚å®ƒè¯´ï¼Œå¦‚æœä½ ç»™æˆ‘ä¸€ç§æŠŠAè½¬æ¢æˆBçš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ›´å¤§ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œ ç„¶åæˆ‘ä¼šç»™ä½ ä»¬ä¸€ç§æŠŠSå˜æ¢æˆTçš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥è¢«è®¤ä¸ºæ˜¯æ•´ä¸ªç»“æ„ã€‚</p>
<p>æˆ‘ä»¬åœ¨æ•°ç»„ä¸Šçš„<strong>map</strong>ä¸­çœ‹åˆ°äº†è¿™ä¸€ç‚¹:</p>
<pre><code class="language-swift">// ((A) -&gt; B) -&gt; ([A]) -&gt; [B]
</code></pre>
<p>è¿™æ˜¯å‰é¢å®šä¹‰çš„<strong>Setter</strong>ç±»å‹åˆ«åçš„ä¸€ä¸ªæ›´å…·ä½“çš„ç‰ˆæœ¬ï¼Œ[A]å’Œ[B]ä»£æ›¿Så’ŒTä½œä¸ºâ€œ<strong>whole</strong>â€ç»“æ„ã€‚</p>
<p>æˆ‘ä»¬åœ¨å¯é€‰å€¼çš„<strong>map</strong>ä¸­ä¹Ÿçœ‹åˆ°äº†è¿™ä¸€ç‚¹:</p>
<pre><code class="language-swift">// ((A) -&gt; B) -&gt; (A?) -&gt; B?
</code></pre>
<p>åœ¨è¿™é‡Œ,A?å’ŒB?æ˜¯Så’ŒTã€‚</p>
<p>æˆ‘ä»¬ç”šè‡³åœ¨<strong>firstå’Œsecond</strong>å‡½æ•°ä¸­çœ‹åˆ°è¿‡ã€‚</p>
<pre><code class="language-swift">// ((A) -&gt; B) -&gt; ((A, C)) -&gt; (B, C)
</code></pre>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°è¾ƒå¤§çš„å…ƒç»„ç»“æ„æ˜¯<strong>Så’ŒT</strong>ï¼Œè€Œç¬¬ä¸€ä¸ª(<strong>A) -&gt; B</strong>è½¬æ¢å‡½æ•°è´Ÿè´£è½¬æ¢è¯¥å…ƒç»„çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>æ‰€æœ‰è¿™äº›settersç»“æœéƒ½æ˜¯ç›¸åŒçš„ï¼Œå¤§è‡´å½¢çŠ¶ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è€ƒè™‘<strong>overå’Œset</strong>è¿™ä¸ªç±»å‹åˆ«å!</p>
<pre><code class="language-swift">func over&lt;S, T, A, B&gt;(
  _ setter: Setter&lt;S, T, A, B&gt;,
  _ set: @escaping (A) -&gt; B
  )
  -&gt; (S) -&gt; T {
    return setter(set)
}

func set&lt;S, T, A, B&gt;(
  _ setter: Setter&lt;S, T, A, B&gt;,
  _ value: B
  )
  -&gt; (S) -&gt; T {
    return over(setter) { _ in value }
}
</code></pre>
<p>æˆ‘ä»¬åœ¨è¿™é‡Œè¿›è¡Œäº†è¿›ä¸€æ­¥çš„æŠ½è±¡ï¼Œè¿™å¾ˆå¥½ï¼Œå› ä¸ºè¿™ä¸¤ä¸ª<strong>helper</strong>ä¸»è¦ä½¿ç”¨<strong>setters</strong>ä½œä¸ºå€¼ã€‚</p>
<h2 id="8-a-namerefactoringanearlierexamplearefactoring-an-earlier-example">8. <a name='Refactoringanearlierexample'></a>Refactoring an earlier example</h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†è¿™äº›ä¸‡èƒ½çš„ï¼Œäººä½“å·¥ç¨‹å­¦çš„å·¥å…·ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨å®ƒä»¬å§! æˆ‘ä»¬å¯ä»¥å›é¡¾ä¸ŠèŠ‚è¯¾å®é™…çš„<strong>URLRequest</strong>ä»£ç ã€‚</p>
<pre><code class="language-swift">let guaranteeHeaders = (prop(\URLRequest.allHTTPHeaderFields)) { $0 ?? [:] }

let postJson =
  guaranteeHeaders
    &lt;&gt; (prop(\.httpMethod)) { _ in &quot;POST&quot; }
    &lt;&gt; (prop(\.allHTTPHeaderFields) &lt;&lt;&lt; map &lt;&lt;&lt; prop(\.[&quot;Content-Type&quot;])) { _ in
      &quot;application/json; charset=utf-8&quot;
}

let gitHubAccept =
  guaranteeHeaders
    &lt;&gt; (prop(\.allHTTPHeaderFields) &lt;&lt;&lt; map &lt;&lt;&lt; prop(\.[&quot;Accept&quot;])) { _ in
      &quot;application/vnd.github.v3+json&quot;
}

let attachAuthorization = { token in
  guaranteeHeaders
    &lt;&gt; (prop(\.allHTTPHeaderFields) &lt;&lt;&lt; map &lt;&lt;&lt; prop(\.[&quot;Authorization&quot;])) { _ in
      &quot;Token &quot; + token
  }
}

URLRequest(url: URL(string: &quot;https://www.pointfree.co/hello&quot;)!)
  |&gt; attachAuthorization(&quot;deadbeef&quot;)
  &lt;&gt; gitHubAccept
  &lt;&gt; postJson
</code></pre>
<p>è¿™äº›æ˜¯æˆ‘ä»¬ç”¨<strong>prop</strong>æ„å»ºçš„ä¸€å †è¾…åŠ©å‡½æ•°ã€‚ä»–ä»¬ç¡®ä¿æˆ‘ä»¬è®¾ç½®å¤´æ–‡ä»¶ï¼Œå³ä½¿ç±»å‹ç³»ç»Ÿä½¿å®ƒå˜å¾—å›°éš¾ï¼Œä»–ä»¬å…è®¸æˆ‘ä»¬åœ¨éå¸¸å°‘çš„ä»£ç ä¸­ç»„åˆä¸€å †è½¬æ¢!</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å½“æˆ‘ä»¬ä½¿ç”¨æ–°çš„åŠ©æ‰‹æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<pre><code class="language-swift">let guaranteeHeaders = over(^\URLRequest.allHTTPHeaderFields) { $0 ?? [:] }

let postJson =
  guaranteeHeaders
    &lt;&gt; set(^\.httpMethod, &quot;POST&quot;)
    &lt;&gt; set(
      ^\.allHTTPHeaderFields) &lt;&lt;&lt; map &lt;&lt;&lt; ^\.[&quot;Content-Type&quot;],
      &quot;application/json; charset=utf-8&quot;
)

let gitHubAccept =
  guaranteeHeaders
    &lt;&gt; set(
      ^\.allHTTPHeaderFields &lt;&lt;&lt; map &lt;&lt;&lt; ^\.[&quot;Accept&quot;],
     &quot;application/vnd.github.v3+json&quot;
)

let attachAuthorization = { token in
  guaranteeHeaders
    &lt;&gt; over(^\.allHTTPHeaderFields &lt;&lt;&lt; map &lt;&lt;&lt; ^\.[&quot;Authorization&quot;]) { _ in
      &quot;Token &quot; + token
  }
}
</code></pre>
<p>è¿™ä¸ªçœ‹èµ·æ¥å·²ç»å¥½å¤šäº†ã€‚æˆ‘ä»¬èƒ½å¤Ÿéš”ç¦»æ˜ å°„å€¼çš„è½¬æ¢ï¼Œä»¥åŠå°†å€¼è®¾ç½®ä¸ºæ–°å€¼çš„è½¬æ¢ã€‚</p>
<p>é‡æ„å¯èƒ½ä¼šæœ‰ä¸€ç‚¹æ»šé›ªçƒæ•ˆåº”ã€‚æ¸…ç†ä»£ç å¯ä»¥æ­ç¤ºä¹‹å‰è¢«æ©ç›–çš„æ¨¡å¼ï¼Œä»è€Œå¯¼è‡´è¿›ä¸€æ­¥çš„æ¸…ç†! ç°åœ¨å¾ˆå®¹æ˜“çœ‹åˆ°æˆ‘ä»¬å¦‚ä½•è®¾ç½®å¤´æ–‡ä»¶çš„å¤åˆ¶!  æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¼ºå¤§çš„éå†åˆ°å¯é€‰å€¼çš„å¯é€‰å­—å…¸ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°ä½¿ç”¨ä½çº§ç»„åˆå­è®¾ç½®æ–°å€¼! å¯¼èˆªè¿™äº›ç±»å‹éœ€è¦å¾ˆå¤šå¤æ‚çš„é‡å¤ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç”¨ä¸€ä¸ªæ›´ç®€å•çš„æ¥å£å°†è¿™ä¸ªé€»è¾‘åŒ…è£…åœ¨å‡½æ•°ä¸­å‘¢?</p>
<pre><code class="language-swift">let setHeader = { name, value in
  guaranteeHeaders
    &lt;&gt; set(^\.allHTTPHeaderFields &lt;&lt;&lt; map &lt;&lt;&lt; ^\.[name], value)
}
</code></pre>
<p>è¿™å¾ˆå®¹æ˜“!è®©æˆ‘ä»¬è¯•è¯•å§!</p>
<pre><code class="language-swift">let postJson =
  set(^\.httpMethod, &quot;POST&quot;)
    &lt;&gt; setHeader(&quot;Content-Type&quot;, &quot;application/json; charset=utf-8&quot;)

let gitHubAccept =
  setHeader(&quot;Accept&quot;, &quot;application/vnd.github.v3+json&quot;)

let attachAuthorization = { token in
  setHeader(&quot;Authorization&quot;, &quot;Token &quot; + token)
}
</code></pre>
<p>ç°åœ¨è¿™ä¸ªè¶…çŸ­äº†! æˆ‘ä»¬ç”¨å¾ˆå°‘çš„ä»£ç ä¸º<strong>URLRequest</strong>æ„å»ºäº†é«˜åº¦å¯é‡ç”¨å’Œå¯è¯»çš„<strong>setter</strong>ã€‚æˆ‘ä»¬èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹ï¼Œåªéœ€è¦å‡ ä¸ªå°å‡½æ•°ã€‚ä¸éœ€è¦å¤–éƒ¨åº“!</p>
<h2 id="9-a-namesettersandperformanceasetters-and-performance">9. <a name='Settersandperformance'></a>Setters and performance</h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å®šä¹‰çš„<strong>setters</strong>å¯¹äºä¿è¯ç»“æ„çš„ä¸å˜æ€§å’Œä¿®æ”¹ç»“æ„çš„æ·±å±‚éƒ¨åˆ†éå¸¸é‡è¦ï¼Œå¦åˆ™è¿™äº›éƒ¨åˆ†ä¼šå¾ˆéº»çƒ¦ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä»¬ä¸æ˜¯ä¸–ç•Œä¸Šæ€§èƒ½æœ€å¥½çš„ä¸œè¥¿ã€‚å½“å‰ï¼Œæ¯ä¸ª<strong>setter</strong>æ“ä½œéƒ½ä¼šåˆ›å»ºæ ¹ç»“æ„çš„ä¸€ä¸ªå…¨æ–°å‰¯æœ¬ã€‚æ¯æ¬¡æˆ‘ä»¬è°ƒç”¨æˆ–è®¾ç½®æ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿæ€§èƒ½æˆæœ¬ã€‚è¿™å°±å¥½åƒæˆ‘ä»¬è¿ç»­å¤šæ¬¡è°ƒç”¨ç»“æ„ä¸Šçš„<strong>map</strong>ï¼Œè€Œä¸æ˜¯ä»¥æŸç§æ–¹å¼ä¸€æ¬¡å°†è¿™ä¸ªçªå˜ç»„åˆåœ¨ä¸€èµ·ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬çœ‹åˆ°Swiftæœ‰ä¸€ä¸ªç²¾å½©çš„æ•…äº‹:<strong>inout</strong>ã€‚ <strong>inout setter</strong>æ˜¯ä»€ä¹ˆæ ·çš„å‘¢?è®©æˆ‘ä»¬å†çœ‹çœ‹æˆ‘ä»¬çš„ä¸å¯å˜<strong>setter</strong>å‡½æ•°ã€‚</p>
<pre><code class="language-swift">typealias Setter&lt;S, T, A, B&gt; = (@escaping (A) -&gt; B) -&gt; (S) -&gt; T

func over&lt;S, T, A, B&gt;(
  _ setter: Setter&lt;S, T, A, B&gt;,
  _ set: @escaping (A) -&gt; B
  )
  -&gt; (S) -&gt; T {
    return setter(set)
}

func set&lt;S, T, A, B&gt;(
  _ setter: Setter&lt;S, T, A, B&gt;,
  _ value: B
  )
  -&gt; (S) -&gt; T {
    return over(setter) { _ in value }
}
</code></pre>
<p>æˆ‘ä»¬å°è¯•å°†å…¶é‡æ„åˆ°<strong>inout</strong>ä¸–ç•Œã€‚æˆ‘ä»¬å¯ä»¥ä»åˆ›å»º<strong>Setter</strong>ç±»å‹åˆ«åçš„å¯å˜å˜ä½“å¼€å§‹ã€‚</p>
<pre><code class="language-swift">typealias MutableSetter&lt;S, A&gt; = (@escaping (inout A) -&gt; Void) -&gt; (inout S) -&gt; Void
</code></pre>
<p>å› ä¸ºå‡½æ•°ä»å•ä¸€ç±»å‹å˜æˆäº†<strong>Void</strong>ï¼Œæˆ‘ä»¬å¤±å»äº†ä¸€äº›æ³›å‹å‚æ•°å’Œæ”¹å˜ç±»å‹å½¢çŠ¶çš„èƒ½åŠ›ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨<strong>overå’Œset</strong>ä¸­äº¤æ¢<strong>Setter</strong>ã€‚</p>
<pre><code class="language-swift">func over&lt;S, A&gt;(
  _ setter: MutableSetter&lt;S, A&gt;,
  _ set: @escaping (inout A) -&gt; Void
  )
  -&gt; (inout S) -&gt; Void {
    return setter(set)
}

func set&lt;S, A&gt;(
  _ setter: MutableSetter&lt;S, A&gt;,
  _ value: A
  )
  -&gt; (S) -&gt; T {
    return over(setter) { $0 = value }
}
</code></pre>
<p>æˆ‘ä»¬ç°åœ¨æœ‰<strong>overå’Œset</strong>çš„ä¸å¯å˜å’Œå¯å˜ç‰ˆæœ¬ï¼Œè¿™å¯èƒ½æ˜¯è¿‡åº¦çš„é‡è½½ã€‚ è°ƒç”¨è¿™äº›å‡½æ•°<strong>mverå’Œmut</strong>å¯èƒ½æ›´åˆé€‚ï¼Œä»¥é¿å…æ½œåœ¨çš„æ­§ä¹‰ã€‚</p>
<pre><code class="language-swift">func mver&lt;S, A&gt;(
  _ setter: MutableSetter&lt;S, A&gt;,
  _ set: @escaping (inout A) -&gt; Void
  )
  -&gt; (inout S) -&gt; Void {
    return setter(set)
}

func mut&lt;S, A&gt;(
  _ setter: MutableSetter&lt;S, A&gt;,
  _ value: A
  )
  -&gt; (S) -&gt; T {
    return over(setter) { $0 = value }
}
</code></pre>
<p>ç°åœ¨è®©æˆ‘ä»¬å†çœ‹ä¸€ä¸‹åŸæ¥çš„ä¾‹å­ã€‚</p>
<pre><code class="language-swift">user
  |&gt; over(^\.name) { $0.uppercased() }
  &lt;&gt; set(^\.location.name, &quot;Los Angeles&quot;)
</code></pre>
<p>ä½¿ç”¨æˆ‘ä»¬å˜å¼‚çš„å˜ç§ä¼šæ˜¯ä»€ä¹ˆæ ·å­?</p>
<pre><code class="language-swift">user
  |&gt; mver(^\.name) { $0 = $0.uppercased() }
  &lt;&gt; mut(^\.location.name, &quot;Los Angeles&quot;)
</code></pre>
<p>æˆ‘ä»¬åªéœ€è¦äº¤æ¢åå­—å¹¶æ›´æ”¹å¤§å†™ï¼Œå°±å¯ä»¥ä½¿ç”¨èµ‹å€¼äº†!ä½†äº‹æƒ…ä»ç„¶æ²¡æœ‰è¿›å±•ã€‚</p>
<blockquote>
<p>ğŸ›‘ Type of expression is ambiguou</p>
</blockquote>
<p>æˆ‘ä»¬çš„<strong>prop</strong>æ“ä½œç¬¦ä»…ä¸ºä¸å¯å˜çš„<strong>setter</strong>ä¸–ç•Œå®šä¹‰ã€‚è®©æˆ‘ä»¬å†™ä¸€ä¸ªä½¿ç”¨å¯å˜çš„ç‰ˆæœ¬ã€‚</p>
<pre><code class="language-swift">prefix func ^ &lt;Root, Value&gt;(
  _ kp: WritableKeyPath&lt;Root, Value&gt;
  )
  -&gt; (@escaping (inout Value) -&gt; Void)
  -&gt; (inout Root) -&gt; Void {

    return { update in
      { root in
        update(&amp;root[keyPath: kp])
      }
    }
}
</code></pre>
<p>å¥½äº†ï¼Œæˆ‘ä»¬è®²å¾—æ›´è¿œäº†ï¼Œä½†æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çš„<strong>user</strong>æ˜¯letï¼Œæˆ‘ä»¬çš„|&gt;ç‰ˆæœ¬åœ¨inoutä¸Šå·¥ä½œéœ€è¦ä¸€ä¸ªinoutè¾“å…¥ã€‚<br>
æˆ‘ä»¬å¯ä»¥å¤åˆ¶ä¸€ä»½ã€‚</p>
<pre><code class="language-swift">var newUser = user
newUser
  |&gt; mver(^\.name) { $0 = $0.uppercased() }
  &lt;&gt; mut(^\.location.name, &quot;Los Angeles&quot;)
</code></pre>
<p>è¿™åœ¨é€‚å½“çš„åœ°æ–¹æ›´æ–°äº†<strong>newUser</strong>ï¼Œä½†å®ƒå¢åŠ äº†å™ªéŸ³ï¼Œè¿™åˆ é™¤äº†å¾ˆå¤šæˆ‘ä»¬åœ¨ä½¿ç”¨|&gt;æ—¶æ‰€æœŸæœ›çš„è¡¨ç°åŠ›ã€‚æˆ‘è®¤ä¸ºæˆ‘ä»¬åº”è¯¥é‡æ–°è€ƒè™‘æˆ‘ä»¬æœ€åˆå¯¹|&gt;çš„å®šä¹‰ã€‚</p>
<p>å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡ç”¨<strong>inout</strong>å®šä¹‰|&gt;æ—¶ï¼Œæˆ‘ä»¬å¹³è¡¡äº†ç­¾åï¼Œä½¿å®ƒä¹Ÿè¿”å›<strong>Void</strong>ã€‚</p>
<pre><code class="language-swift">func |&gt; &lt;A&gt;(_ a: inout A, _ f: (inout A) -&gt; Void) -&gt; Void {
  f(&amp;a)
}
</code></pre>
<p>è¿™æ„Ÿè§‰å¾ˆæœ‰åŸåˆ™ï¼Œä½†ä¸å®é™…ã€‚æˆ‘ä»¬å®šä¹‰|&gt;æ˜¯å¯Œäºè¡¨ç°åŠ›çš„ï¼Œä½†åœ¨è¿™é‡Œä¸æˆç«‹ã€‚æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåœ¨ä¸€ä¸ªè¡¨è¾¾å¼ä¸­ä½¿ç”¨|&gt;å¹¶é…ç½®ä¸€äº›æ•°æ®ã€‚æˆ‘ä»¬è‚¯å®šæé”™äº†ã€‚æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ª<strong>A</strong>ï¼Œå¤åˆ¶å®ƒï¼Œç„¶ååœ¨è¿”å›å®ƒä¹‹å‰å¯¹è¿™ä¸ªå‰¯æœ¬åº”ç”¨ä¸€ä¸ªå¯å˜å˜æ¢ã€‚</p>
<pre><code class="language-swift">func |&gt; &lt;A&gt;(_ a: A, _ f: (inout A) -&gt; Void) -&gt; A {
  var a = a
  f(&amp;a)
  return a
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ–°çš„ã€ç»è¿‡è½¬æ¢çš„ç”¨æˆ·ï¼Œè€Œæˆ‘ä»¬ä»¥å‰çš„ç”¨æ³•æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚</p>
<pre><code class="language-swift">var newUser = user
newUser
  |&gt; mver(^\.name) { $0 = $0.uppercased() }
  &lt;&gt; mut(^\.location.name, &quot;Los Angeles&quot;)
</code></pre>
<p>ç®¡é“è½¬å‘ç°åœ¨ç”Ÿæˆå‰¯æœ¬ï¼Œè€Œä¸æ˜¯å°±åœ°æ›´æ”¹å€¼ï¼Œè¿™æ„å‘³ç€<strong>newUser</strong>ä¸ä¼šå¾—åˆ°æ›´æ–°ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬éœ€è¦åšçš„åªæ˜¯åˆ é™¤ä¸€è¡Œã€‚</p>
<pre><code class="language-swift">var newUser = user
  |&gt; mver(^\.name) { $0 = $0.uppercased() }
  &lt;&gt; mut(^\.location.name, &quot;Los Angeles&quot;)
</code></pre>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥å°†varæ”¹ä¸ºlet!</p>
<pre><code class="language-swift">let newUser = user
  |&gt; mver(^\.name) { $0 = $0.uppercased() }
  &lt;&gt; mut(^\.location.name, &quot;Los Angeles&quot;)
</code></pre>
<p>è¿™å¤ªé…·äº†! æˆ‘ä»¬å·²ç»èƒ½å¤Ÿå°†ä¸¤ä¸ªå¯å˜<strong>setters</strong>å‹ç¼©åˆ°ä¸€ä¸ªå‰¯æœ¬ä¸­ï¼Œå¹¶æœ€ç»ˆå°†å€¼é‡æ–°èµ‹ç»™ä¸€ä¸ªä¸èƒ½è¢«çªå˜çš„å¸¸é‡!</p>
<p>é‚£æ“çºµæ•°ç»„å€¼çš„setterå‘¢?</p>
<pre><code class="language-swift">let newUser = user
  |&gt; mver(^\.name) { $0 = $0.uppercased() }
  &lt;&gt; mut(^\.location.name, &quot;Los Angeles&quot;)
  &lt;&gt; mver(^\.favoriteFoods &lt;&lt;&lt; map &lt;&lt;&lt; ^\.name) { $0 += &quot; &amp; Salad&quot; }
</code></pre>
<blockquote>
<p>ğŸ›‘ Type of expression is ambiguous</p>
</blockquote>
<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªé—®é¢˜:å…è´¹mapæ— æ³•ä¸inoutä¸–ç•Œè”åˆèµ·æ¥ã€‚</p>
<pre><code class="language-swift">func map&lt;A, B&gt;(_ f: @escaping (A) -&gt; B) -&gt; ([A]) -&gt; [B] {
  return { $0.map(f) }
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å»æ‰ç¬¬äºŒä¸ªæ³›å‹å‚æ•°Bï¼Œç›´æ¥åœ¨inout Aä¸–ç•Œä¸­å·¥ä½œã€‚</p>
<pre><code class="language-swift">func map&lt;A&gt;(_ f: @escaping (inout A) -&gt; Void) -&gt; (inout [A]) -&gt; Void {
  return {
    for i in $0.indices {
      f(&amp;$0[i])
    }
  }
}
</code></pre>
<p>ç”±äºæˆ‘ä»¬è¢«å›°åœ¨å•ä¸€ç±»å‹ä¸­ï¼Œ<strong>map</strong>å¯èƒ½ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„åç§°ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶ç§°ä¸º<strong>mutEach</strong>ã€‚</p>
<pre><code class="language-swift">func mutEach&lt;A&gt;(_ f: @escaping (inout A) -&gt; Void) -&gt; (inout [A]) -&gt; Void {
  return {
    for i in $0.indices {
      f(&amp;$0[i])
    }
  }
}
</code></pre>
<p>è®©æˆ‘ä»¬ä»£å…¥:</p>
<pre><code class="language-swift">let newUser = user
  |&gt; mver(^\.name) { $0 = $0.uppercased() }
  &lt;&gt; mut(^\.location.name, &quot;Los Angeles&quot;)
  &lt;&gt; mver(^\.favoriteFoods &lt;&lt;&lt; mutEach &lt;&lt;&lt; ^\.name) { $0 += &quot; &amp; Salad&quot; }
</code></pre>
<h2 id="10-a-nameonemoremutablerefactoraone-more-mutable-refactor">10. <a name='Onemoremutablerefactor'></a>One more mutable refactor</h2>
<p><strong>URLRequest</strong>çš„<strong>setters</strong>å‘¢?  å®ƒä»¬åˆ›å»ºäº†ç›¸å½“æ•°é‡çš„å‰¯æœ¬ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨<strong>setHeaders</strong>ä¹Ÿä¼šè°ƒç”¨<strong>guaranteeHeaders</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°æ¯ä¸ªå¤´æ–‡ä»¶æœ‰ä¸¤ä¸ªå‰¯æœ¬! è®©æˆ‘ä»¬å°è¯•å†æ¬¡é‡æ„å®ƒä»¬ä»¥ä½¿ç”¨<strong>inout setters</strong>ã€‚</p>
<p>æˆ‘ä»¬å°†ä»<strong>guaranteeHeaders</strong>å¼€å§‹ã€‚</p>
<pre><code class="language-swift">let guaranteeHeaders = mver(^\URLRequest.allHTTPHeaderFields) { $0 = $0 ?? [:] }
</code></pre>
<p>è¿™ä¸ªéå¸¸ç®€å•:<strong>over</strong>å˜æˆäº†<strong>mver</strong>ï¼Œæˆ‘ä»¬çš„blockç°åœ¨åŒ…å«äº†ä¸€ä¸ªæ˜¾å¼çš„èµ‹å€¼ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€äº›æ›´å¤æ‚çš„ä¸œè¥¿:</p>
<pre><code class="language-swift">let setHeader = { name, value in
  guaranteeHeaders
    &lt;&gt; mut(^\.allHTTPHeaderFields &lt;&lt;&lt; map &lt;&lt;&lt; ^\.[name], value)
}
</code></pre>
<p>ç”¨<strong>mut</strong>æ›¿æ¢<strong>set</strong>ä¸ä¼šåˆ‡æ–­å®ƒï¼Œæˆ‘ä»¬æœ‰å¦ä¸€ä¸ª<strong>map</strong>è¦å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºå¯é€‰å€¼å®šä¹‰ä¸€ä¸ª<strong>mutEach</strong>ç­‰ä»·é¡¹ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å¯é€‰é“¾æ¥æ¥åˆ©ç”¨Swiftäººæœºå·¥ç¨‹å­¦!</p>
<pre><code class="language-swift">let setHeader = { name, value in
  guaranteeHeaders
    &lt;&gt; { $0.allHTTPHeaderFields?[name] = value }
}
</code></pre>
<p>æ¯ä¸ªå¯å˜<strong>setter</strong>éƒ½æç‚¼ä¸ºä¸€ä¸ª(<strong>inout Root) -&gt; Void</strong>å‡½æ•°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ½œå…¥è¿™ä¸ªä¸–ç•Œ!</p>
<p>The other helpers are a cinch.</p>
<pre><code class="language-swift">let postJson =
  mut(^\.httpMethod, &quot;POST&quot;)
    &lt;&gt; setHeader(&quot;Content-Type&quot;, &quot;application/json; charset=utf-8&quot;)
</code></pre>
<p>æˆ‘ä»¬åªéœ€è¦å†å¤šä¸€ä¸ª <strong>mut</strong>ï¼Œå…¶ä»–ä¸€åˆ‡å°±éƒ½é¡ºåˆ©äº†ã€‚æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<pre><code class="language-swift">URLRequest(url: URL(string: &quot;https://www.pointfree.co/hello&quot;)!)
  |&gt; postJson,
  &lt;&gt; gitHubAccept
  &lt;&gt; attachAuthorization(&quot;deadbeef&quot;)
</code></pre>
<p>æˆ‘ä»¬åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„<strong>URLRequest</strong>ï¼Œä»¥ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼å¯¹å®ƒåº”ç”¨äº†è®¸å¤šå¯ç»„åˆçš„çªå˜ï¼Œç”šè‡³ä¸ºä½œç”¨åŸŸçš„å…¶ä½™éƒ¨åˆ†å°†å®ƒåˆ†é…ç»™ä¸€ä¸ªä¸å¯å˜çš„let !</p>
<pre><code class="language-swift">let request = URLRequest(url: URL(string: &quot;https://www.pointfree.co/hello&quot;)!)
  |&gt; postJson,
  &lt;&gt; gitHubAccept
  &lt;&gt; attachAuthorization(&quot;deadbeef&quot;)
</code></pre>
<h2 id="11-a-namewhatsthepointawhats-the-point">11. <a name='Whatsthepoint'></a>Whatâ€™s the point?</h2>
<p>å¥½å§ï¼Œä¹Ÿè®¸æ˜¯æ—¶å€™é—®é—®â€œè¿™æœ‰ä»€ä¹ˆæ„ä¹‰?â€åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•å¯¹<strong>setter</strong>è¿›è¡Œä¸¥æ ¼çš„ç ”ç©¶ï¼Œä»è€Œå¯¼è‡´æ•°æ®ç±»å‹çš„ä¸€äº›ä»¤äººå°è±¡æ·±åˆ»çš„è½¬æ¢ã€‚ä»Šå¤©çš„è¯¾ç¨‹å®Œå…¨æ˜¯å…³äºåŠ å¼ºäººç±»å·¥ç¨‹å­¦å’Œæˆ‘ä»¬ä»¥å‰å·¥ä½œçš„ä»·å€¼ä¸»å¼ ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™æ•´ä»¶äº‹å°±æ˜¯é‡ç‚¹ã€‚</p>
<p>æˆ‘ä»¬å¸Œæœ›äººä»¬ä¸ä»…èƒ½çœ‹åˆ°å‡½æ•°å¼setterçš„å¼ºå¤§åŠŸèƒ½ï¼Œè¿˜èƒ½æ¶ˆé™¤æ‰€æœ‰å¯èƒ½é˜»æ­¢ä»–ä»¬åœ¨ä»£ç åº“ä¸­é‡‡ç”¨å®ƒä»¬çš„éšœç¢ã€‚è¿™æ„å‘³ç€ä¸ºæœ€å¸¸è§çš„ç”¨ä¾‹æä¾›æ¯”<strong>prop</strong>æ›´å‹å¥½çš„APIï¼Œä»¥ä¾¿åœ¨è°ƒç”¨ç«™ç‚¹æ›´æ¸…æ¥šåœ°äº†è§£æˆ‘ä»¬æ­£åœ¨æ‰§è¡Œçš„è½¬æ¢ç±»å‹ã€‚å®ƒè¿˜æ„å‘³ç€å…è®¸<strong>setters</strong>å¾ˆå¥½åœ°å¤„ç†Swiftå€¼çªå˜è¯­ä¹‰ï¼Œè¿™æ ·å¯¹æ€§èƒ½æ•æ„Ÿçš„ç”¨ä¾‹å°±ä¸å¿…æ‹…å¿ƒåˆ›å»ºå¤ªå¤šå‰¯æœ¬ã€‚</p>
<p>ç°åœ¨ï¼Œå¯¹äºåº”è¯¥ä½¿ç”¨ä¸å¯å˜å€¼è¿˜æ˜¯å¯å˜å€¼æ²¡æœ‰æ­£ç¡®çš„é€‰æ‹©ã€‚æ¯ä¸ªäººéƒ½æœ‰æƒè¡¡ã€‚åœ¨å…³äºå‰¯ä½œç”¨çš„é‚£ä¸€é›†ä¸­ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸€ç‚¹åšäº†ä¸€äº›ç ”ç©¶ï¼Œå…¶ä¸­æˆ‘ä»¬å°†ä¸€äº›å¤„ç†å¼•ç”¨å’Œå‡½æ•°çš„ä»£ç è½¬æ¢ä¸ºä½¿ç”¨ä¸å¯å˜å€¼çš„ä»£ç å’Œè¿”å›æ‰€æœ‰æ–°å€¼è€Œä¸æ˜¯ä¿®æ”¹å®ƒä»¬çš„å‡½æ•°ã€‚è¿™ä¸ªæ›´æ”¹ä¿®å¤äº†æˆ‘ä»¬çš„ä¸€ä¸ªå¾®å°é”™è¯¯ï¼Œä½†ä»£ä»·æ˜¯åˆ›å»ºå€¼çš„å‰¯æœ¬ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¯¥ä»£ç è½¬æ¢ä¸ºå…·æœ‰å¯å˜å€¼çš„inoutæ ·å¼ï¼Œè¿™å…è®¸æˆ‘ä»¬é¿å…å¤åˆ¶ï¼Œä½†åˆé‡æ–°å¼•å…¥äº†bugã€‚ æ–°ç‰ˆæœ¬çš„è¯­æ³•è®°å½•äº†å…è®¸å‘ç”Ÿçªå˜çš„åœ°æ–¹ï¼Œè¿™è‡³å°‘å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šä½é”™è¯¯ã€‚</p>
<p>å¾ˆæœ‰å¯èƒ½æ‚¨ç”šè‡³ä¸ä¼šæ³¨æ„åˆ°é˜²æ­¢è¿™äº›é¢å¤–å‰¯æœ¬æ‰€å¸¦æ¥çš„æ€§èƒ½æå‡ï¼Œå› æ­¤ä¸å¯å˜æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åˆ‡å…¥ç‚¹ã€‚ä¸è¿‡ï¼Œå¾ˆé«˜å…´æˆ‘ä»¬æœ‰å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿåœ°ä»ä¸€ä¸ªä¸å¯å˜çš„ä¸–ç•Œè½¬æ¢åˆ°ä¸€ä¸ªå¯å˜çš„ä¸–ç•Œï¼Œè€Œä¸éœ€è¦åšå¾ˆå¤šå·¥ä½œã€‚ç”šè‡³æœ‰å¯èƒ½æœ‰ä¸€å¤©Swiftä¼šå˜å¾—è¶³å¤Ÿèªæ˜ï¼Œä¼˜åŒ–æ‰ä¸å¯å˜ç‰ˆæœ¬ä¸­çš„æ‰€æœ‰ä¸­é—´å‰¯æœ¬ã€‚</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/i-r9uoo_2N/" class="tag">
                    PointFree
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/pointfree-episode-14-contravariance/">
                  <h3 class="post-title">
                    PointFree Episode 14: Contravariance
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
