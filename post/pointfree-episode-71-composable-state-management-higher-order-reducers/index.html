<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>PointFree Episode 71: Composable State Management: Higher-Order Reducers | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1661042947575">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="



Whatâ€™s a higher-order reducer?




Higher-order activity feeds




Higher-order logging




Whatâ€™s the point?






..." />
    <meta name="keywords" content="PointFree" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1661042947575" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">PointFree Episode 71: Composable State Management: Higher-Order Reducers</h2>
            <div class="post-date">2021-11-20</div>
            
            <div class="post-content" v-pre>
              <!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#Whatsahigher-orderreducer">Whatâ€™s a higher-order reducer?</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="#Higher-orderactivityfeeds">Higher-order activity feeds</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#Higher-orderlogging">Higher-order logging</a></li>
</ol>
</li>
<li>
<ol start="4">
<li><a href="#Whatsthepoint">Whatâ€™s the point?</a></li>
</ol>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<!-- # PointFree Episode 71: Composable State Management: Higher-Order Reducers -->
<h2 id="1-a-namewhatsahigher-orderreducerawhats-a-higher-order-reducer">1. <a name='Whatsahigher-orderreducer'></a>Whatâ€™s a higher-order reducer?</h2>
<p>é‚£ä¹ˆâ€œ<strong>higher-order reducer</strong>â€åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„å‘¢?ä¸€ä¸ªå‡½æ•°ä»¥<strong>reducer</strong>ä½œä¸ºè¾“å…¥ï¼Œä»¥<strong>reducer</strong>ä¸ºè¾“å‡ºï¼Œè¿™æ„å‘³ç€ä»€ä¹ˆ?äº‹å®ä¸Šï¼Œæˆ‘ä»¬ç”šè‡³å·²ç»å®šä¹‰äº†ä¸€å¯¹!</p>
<ul>
<li>
<p><strong>combine</strong> æ˜¯ä¸€ä¸ª<strong>higher-order reducer</strong>:å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»¥è®¸å¤š<strong>reducer</strong>ä½œä¸ºè¾“å…¥(åªè¦å®ƒä»¬ä½¿ç”¨ç›¸åŒçš„å€¼å’ŒåŠ¨ä½œç±»å‹)ï¼Œå¹¶é€šè¿‡è¿è¡Œæ¯ä¸ªç»™å®šçš„<strong>reducer</strong>è¿”å›ä¸€ä¸ªå…¨æ–°çš„<strong>reducer</strong>ä½œä¸ºè¾“å‡ºã€‚</p>
</li>
<li>
<p><strong>pullbac</strong>kæ˜¯ä¸€ä¸ª<strong>higher-order reducer</strong>:å®ƒæ˜¯ä¸€ä¸ªä»¥<strong>reducer</strong>ä½œä¸ºè¾“å…¥çš„å‡½æ•°ï¼Œç»™å®šå¯¹å±€éƒ¨çŠ¶æ€å’Œè¡Œä¸ºè¿›è¡Œæ“ä½œçš„å…³é”®è·¯å¾„ï¼Œè¿”å›ä¸€ä¸ªå…¨æ–°çš„<strong>reducer</strong>ä½œä¸ºè¾“å‡ºï¼Œå¯¹æ›´å¤šå…¨å±€çŠ¶æ€å’Œè¡Œä¸ºè¿›è¡Œæ“ä½œã€‚</p>
</li>
</ul>
<p>è€ƒè™‘åˆ°è¿™ä¸¤ä¸ªå‡½æ•°çš„å¼ºå¤§åŠŸèƒ½ï¼Œæˆ‘ä»¬æœ‰ç†ç”±é—®ä¸€ä¸‹ï¼Œè¿˜æœ‰ä»€ä¹ˆ <strong>higher-order reducers</strong> ç­‰ç€æˆ‘ä»¬å»å‘ç°å‘¢? ä¸ºäº†æ¢ç©¶è¿™ä¸ªé—®é¢˜ï¼Œè®©æˆ‘ä»¬å†™å‡ºä¸€ä¸ª<strong>higher-order reducers</strong>çš„ç­¾åæ¥æ¢ç©¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„ä¸œè¥¿ã€‚</p>
<pre><code class="language-swift">func higherOrderReducer(
  _ reducer: @escaping (inout AppState, AppAction) -&gt; Void
) -&gt; (inout AppState, AppAction) -&gt; Void {

}
</code></pre>
<p>ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™ä¸ª<strong>higher-order reducers</strong>åªæ˜¯åœ¨ä¸€ä¸ª<strong>reducer</strong>ä¸Šè¿è¡Œï¼Œè¯¥<strong>reducer</strong>è¿è¡Œäºå®Œæ•´çš„åº”ç”¨ç¨‹åºçŠ¶æ€å’Œåº”ç”¨ç¨‹åºè¡Œä¸ºã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œ<strong>higher-order reducers</strong>æ²¡æœ‰å¿…è¦ä¿æŒæ‰€æœ‰è¿™äº›ç±»å‹ç›¸åŒï¼Œå®ƒè‚¯å®š<strong>å¯ä»¥æ¥å—ä¸€ä¸ªç±»å‹</strong>çš„<strong>reducer</strong>ï¼Œå¹¶è¿”å›ä¸€ä¸ª<strong>å®Œå…¨ä¸åŒ</strong>çš„ç±»å‹ã€‚</p>
<p>æ— è®ºæˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ¥è¿”å›ä¸€ä¸ªæœ‰<strong>stateå’Œaction</strong>çš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»é‚£é‡Œå¼€å§‹:</p>
<pre><code class="language-swift">func higherOrderReducer(
  _ reducer: @escaping (inout AppState, AppAction) -&gt; Void
) -&gt; (inout AppState, AppAction) -&gt; Void {

  return { state, action in

  }
}
</code></pre>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åšçš„äº‹æƒ…æ²¡æœ‰é™åˆ¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å°†å®ƒä»¬å‘é€åˆ°<strong>reducer</strong>ä¹‹å‰æ£€æŸ¥çŠ¶æ€å’Œè¡Œä¸º:</p>
<pre><code class="language-swift">func higherOrderReducer(
  _ reducer: @escaping (inout AppState, AppAction) -&gt; Void
) -&gt; (inout AppState, AppAction) -&gt; Void {

  return { state, action in
    // do some computations with state and action
    reducer(&amp;state, action)
  }
}
</code></pre>
<p>æˆ–è€…æˆ‘ä»¬å¯ä»¥å°†<strong>stateå’Œaction</strong>å‘é€åˆ°<strong>reducer</strong>ï¼Œç„¶åæ£€æŸ¥ä»å¦ä¸€è¾¹å‡ºæ¥çš„æ˜¯ä»€ä¹ˆ:</p>
<pre><code class="language-swift">func higherOrderReducer(
  _ reducer: @escaping (inout AppState, AppAction) -&gt; Void
) -&gt; (inout AppState, AppAction) -&gt; Void {

  return { state, action in
    // do some computations with state and action
    reducer(&amp;state, action)
    // inspect what happened to state?
  }
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥è¿‡æ»¤å…è®¸é€šè¿‡å“ªäº›<strong>actions</strong>ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨è°ƒç”¨<strong>reducer</strong>ä¹‹å‰å’Œä¹‹åå¯¹<strong>stateå’Œaction</strong>æ‰§è¡Œæ›´æ”¹ã€‚è¿™ä¸ªå‡½æ•°æœ‰å¾ˆå¤§çš„å¹‚ï¼Œè¿™å®Œå…¨æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ª<strong>higher-order reducer</strong>ã€‚</p>
<p>äº‹å®è¯æ˜ï¼Œè¿™ä¸ª<strong>higher-order reducer</strong>æ­£æ˜¯ç”¨æ¥ä¿®å¤ä¸€ä¸ªbugçš„ï¼Œè¿™ä¸ªbugæ˜¯æˆ‘ä»¬åœ¨ç”¨ä¼ ç»Ÿçš„SwiftUIæ¦‚å¿µæ„å»ºåº”ç”¨æ—¶æ— æ„ä¸­å¼•å…¥çš„ã€‚å‡ é›†ä¹‹å‰ï¼Œåœ¨æ„å»ºäº†åº”ç”¨çš„åŸºæœ¬ç‰ˆæœ¬åï¼Œæˆ‘ä»¬å†³å®šæ·»åŠ ä¸€ä¸ªæ´»åŠ¨feedçš„æ–°åŠŸèƒ½ã€‚å®ƒåªæ˜¯è·Ÿè¸ªä¸€ä¸ªæ—¶é—´æˆ³å’Œä¸€äº›æˆ‘ä»¬æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œç‰¹åˆ«æ˜¯å½“ä¸€ä¸ªç´ æ•°è¢«æ·»åŠ æˆ–åˆ é™¤åˆ°æˆ‘ä»¬çš„æ”¶è—å¤¹æ—¶ã€‚</p>
<p>æˆ‘ä»¬å¾ˆå¤©çœŸåœ°å®ç°äº†è¿™ä¸ªç‰¹æ€§ï¼Œåªæ˜¯å¯¹ä¸»è¦æ¨¡å¼åšäº†ä¸€äº›å°ä¿®æ”¹ï¼Œä»¥ä¾¿å°†è¿™äº›äº‹ä»¶æ·»åŠ åˆ°çŠ¶æ€ä¸­ã€‚ç°åœ¨ï¼Œè¿™ç§é€»è¾‘å­˜åœ¨äºæˆ‘ä»¬çš„<strong>reducer</strong>ä¸­:</p>
<pre><code class="language-swift">func primeModalReducer(state: inout AppState, action: PrimeModalAction) -&gt; Void {
  switch action {
  case .removeFavoritePrimeTapped:
    state.favoritePrimes.removeAll(where: { $0 == state.count })
    state.activityFeed.append(.init(timestamp: Date(), type: .removedFavoritePrime(state.count)))

  case .saveFavoritePrimeTapped:
    state.favoritePrimes.append(state.count)
    state.activityFeed.append(.init(timestamp: Date(), type: .addedFavoritePrime(state.count)))
  }
}
</code></pre>
<p>ç„¶è€Œï¼Œè¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬å”¯ä¸€æ”¹å˜å–œçˆ±çš„è´¨æ•°åˆ—è¡¨çš„åœ°æ–¹ã€‚ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å±å¹•ï¼Œæ”¶è—è´¨æ•°åˆ—è¡¨ï¼Œä½ ä¹Ÿå¯ä»¥ä»æ”¶è—åˆ—è¡¨ä¸­åˆ é™¤è´¨æ•°ã€‚å¼€å§‹æˆ‘ä»¬å¹¶æ²¡æœ‰æƒ³è¿‡æ”¹å˜æˆ‘ä»¬çš„æ´»åŠ¨åŠ¨æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬é”™è¿‡äº†ä¸€äº›äº‹ä»¶ã€‚</p>
<p>ä¿®å¤éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨è§†å›¾ä¸­æ·»åŠ äº†é¢å¤–çš„çªå˜é€»è¾‘ã€‚ç°åœ¨ï¼Œè¿™ç§é€»è¾‘å°±å­˜åœ¨äº<strong>reducer</strong>ä¸­:</p>
<pre><code class="language-swift">func favoritePrimesReducer(state: inout FavoritePrimesState, action: FavoritePrimesAction) -&gt; Void {
  switch action {
  case let .deleteFavoritePrimes(indexSet):
    for index in indexSet {
      state.activityFeed.append(.init(timestamp: Date(), type: .removedFavoritePrime(state.favoritePrimes[index])))
      state.favoritePrimes.remove(at: index)
    }
  }
}
</code></pre>
<p>ç„¶è€Œï¼Œè¿™ä»ç„¶ä¸æ˜¯å¾ˆå¥½ã€‚è¿™ä¸¤ç§é€»è¾‘æ˜¯å¯†åˆ‡ç›¸å…³çš„ï¼Œä½†åœ¨ä¸¤ä¸ªä¸åŒçš„<strong>reducer</strong>ä¸­åˆç›¸éš”ç”šè¿œã€‚è¿™äº›<strong>reducer</strong>å¯èƒ½å­˜åœ¨äºä¸åŒçš„æ–‡ä»¶ç”šè‡³ä¸åŒçš„æ¨¡å—ä¸­ï¼Œå¹¶ä¸”å¾ˆéš¾ç¡®ä¿åœ¨è¿™ä¸¤ä¸ªåœ°æ–¹éƒ½è¿›è¡Œæ›´æ”¹ã€‚ å¦‚æœæˆ‘ä»¬æƒ³è¦æ·»åŠ æ–°çš„æ´»åŠ¨ç±»å‹å‘¢? æˆ‘ä»¬éœ€è¦å®¡è®¡æˆ‘ä»¬çš„<strong>reducer</strong>ä¸­çš„æ‰€æœ‰<strong>actions</strong>ï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬è¿æ¥åˆ°æ·»åŠ æ–°äº‹ä»¶çš„æ­£ç¡®ä½ç½®ã€‚</p>
<h2 id="2-a-namehigher-orderactivityfeedsahigher-order-activity-feeds">2. <a name='Higher-orderactivityfeeds'></a>Higher-order activity feeds</h2>
<p>ç„¶è€Œï¼Œ<strong>higher-order reducers</strong>å¯ä»¥è®©æˆ‘ä»¬åšå¾—æ›´å¥½ã€‚å› ä¸ºå®ƒä»¬ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨è¾ƒé«˜çš„å±‚æ¬¡ä¸Šæ£€æŸ¥ä¼ å…¥çš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„æ´»åŠ¨è·Ÿè¸ªé€»è¾‘é›†ä¸­åˆ°ä¸€ä¸ªåœ°æ–¹ã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡æ›´æ–°è¿™ä¸ª<strong>higher-order reducers</strong>çš„æ¨¡æ¿æ¥å°è¯•ä¸€ä¸‹ã€‚æˆ‘ä»¬å¿…é¡»å†³å®šæ˜¯å¸Œæœ›ä¼ å…¥çš„<strong>reducer</strong>åœ¨æ´»åŠ¨æè¦é€»è¾‘ä¹‹å‰è¿è¡Œè¿˜æ˜¯ä¹‹åè¿è¡Œã€‚ å¦‚æœå®ƒåœ¨ä¹‹å‰è¿è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å·²ç»æ”¹å˜äº†æœ€çˆ±çš„è´¨æ•°æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä¸€å®šçŸ¥é“å“ªä¸ªè´¨æ•°è¢«åˆ é™¤äº†ã€‚æ‰€ä»¥æˆ‘ä»¬æƒ³è®©<strong>reducer</strong>æŒ‰ç…§æˆ‘ä»¬çš„é€»è¾‘è¿è¡Œã€‚è®©æˆ‘ä»¬ä»<strong>switching action</strong>ä½œå¼€å§‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘æ‰€æœ‰å¯èƒ½å‡ºç°çš„åº”ç”¨è¡Œä¸º:</p>
<pre><code class="language-swift">func higherOrderReducer(
  _ reducer: @escaping (inout AppState, AppAction) -&gt; Void
) -&gt; (inout AppState, AppAction) -&gt; Void {

  return { state, action in
    switch action {
    case .counter(_):

    case .primeModal(_):

    case .favoritePrimes(_):

    }

</code></pre>
<p>æœ‰è®¸å¤šè·¨å±å¹•çš„æ“ä½œéœ€è¦è€ƒè™‘ï¼Œä½†æœ‰äº›æ“ä½œå¯¹äºæˆ‘ä»¬çš„æ´»åŠ¨æè¦æ¥è¯´å¹¶ä¸é‡è¦ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›æƒ…å†µä¸‹å¿½ç•¥å®ƒä»¬:</p>
<pre><code class="language-swift">func higherOrderReducer(
  _ reducer: @escaping (inout AppState, AppAction) -&gt; Void
) -&gt; (inout AppState, AppAction) -&gt; Void {

  return { state, action in
    switch action {
    case .counter:
      break
    case .primeModal(_):

    case .favoritePrimes(_):

    }
</code></pre>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥æ‰©å±•æˆ‘ä»¬å…³å¿ƒçš„<strong>cases</strong>ã€‚</p>
<pre><code class="language-swift">func higherOrderReducer(
  _ reducer: @escaping (inout AppState, AppAction) -&gt; Void
) -&gt; (inout AppState, AppAction) -&gt; Void {

  return { state, action in
    switch action {
    case .counter:
      break
    case .primeModal(.removeFavoritePrimeTapped):

    case .primeModal(.saveFavoritePrimeTapped):

    case let .favoritePrimes(.deleteFavoritePrimes(indexSet)):

    }
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ´»åŠ¨æè¦é€»è¾‘ï¼Œå¹¶ç›¸åº”åœ°é‡å‘½åå‡½æ•°:</p>
<pre><code class="language-swift">func activityFeed(
  _ reducer: @escaping (inout AppState, AppAction) -&gt; Void
) -&gt; (inout AppState, AppAction) -&gt; Void {

  return { state, action in
    switch action {
    case .counter:
      break

    case .primeModal(.removeFavoritePrimeTapped):
      value.activityFeed.append(
        .init(timestamp: Date(), type: .removedFavoritePrime(value.count))
      )

    case .primeModal(.addFavoritePrime):
      value.activityFeed.append(
        .init(timestamp: Date(), type: .saveFavoritePrimeTapped(value.count))
      )

    case let .favoritePrimes(.deleteFavoritePrimes(indexSet)):
      for index in indexSet {
        value.activityFeed.append(
          .init(timestamp: Date(), type: .removedFavoritePrime(value.favoritePrimes[index]))
        )
      }
    }

    reducer(&amp;state, action)
  }
}
</code></pre>
<p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆç”¨è¿™ä¸ª<strong>higher-order reducers</strong>å‘¢? æˆ‘ä»¬åªéœ€è¦ç»™å®ƒè¾“å…¥<strong>appReducer</strong>ï¼Œå®ƒä¼šç»™æˆ‘ä»¬ä¸€ä¸ªå…¨æ–°çš„<strong>reducer</strong>ï¼Œè¿™å°†æ˜¯æˆ‘ä»¬åœ¨å•†åº—ä¸­ä½¿ç”¨çš„<strong>reducer</strong>ã€‚</p>
<pre><code class="language-swift">ContentView(
  store: Store(
    initialValue: AppState(),
    reducer: activityFeed(appReducer)
  )
)
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥ä»æˆ‘ä»¬çš„å…¶ä»–<strong>reducer</strong>ä¸­åˆ é™¤æ‰€æœ‰çš„æ´»åŠ¨é¦ˆé€é€»è¾‘ï¼Œè¿™ä½¿å¾—å®ƒä»¬æ›´ç®€çŸ­å’Œç”œèœœ:</p>
<pre><code class="language-swift">func counterReducer(state: inout Int, action: CounterAction) -&gt; Void {
  switch action {
  case .decrTapped:
    state -= 1
  case .incrTapped:
    state += 1
  }
}

func primeModalReducer(state: inout AppState, action: PrimeModalAction) -&gt; Void {
  switch action {
  case .addFavoritePrime:
    state.favoritePrimes.append(state.count)

  case .removeFavoritePrime:
    state.favoritePrimes.removeAll(where: { $0 == state.count })
  }
}

func favoritePrimesReducer(state: inout FavoritePrimesState, action: FavoritePrimesAction) -&gt; Void {
  switch action {
  case let .removeFavoritePrimes(indexSet):
    for index in indexSet {
      state.favoritePrimes.remove(at: index)
    }
  }
}
</code></pre>
<p>æå–æ´»åŠ¨æè¦é€»è¾‘è¿˜å…è®¸æˆ‘ä»¬è¿›ä¸€æ­¥ç®€åŒ–!æˆ‘ä»¬æœ€å–œæ¬¢çš„<strong>reducer</strong>ä¸å†éœ€è¦æ‰€æœ‰<strong>state</strong>çš„æ”¯æŒã€‚</p>
<pre><code class="language-swift">struct FavoritePrimesState {
  var favoritePrimes: [Int]
  var activityFeed: [AppState.Activity]
}
</code></pre>
<p>å®ƒä¸å†éœ€è¦æ´»åŠ¨æè¦:å®ƒåªå…³å¿ƒæœ€å–œæ¬¢çš„è´¨æ•°ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥å»æ‰ä¸­é—´çŠ¶æ€äº†ã€‚</p>
<pre><code class="language-swift">//struct FavoritePrimesState {
//  var favoritePrimes: [Int]
//  var activityFeed: [AppState.Activity]
//}
</code></pre>
<p>æ›´æ–°<strong>reducer</strong>ä»¥å¤„ç†æ•´æ•°æ•°ç»„ã€‚</p>
<pre><code class="language-swift">func favoritePrimesReducer(state: inout [Int], action: FavoritePrimesAction) -&gt; Void {
  switch action {
  case let .removeFavoritePrimes(indexSet):
    for index in indexSet {
      state.remove(at: index)
    }
  }
}
</code></pre>
<p>æˆ‘ä»¬æœ‰ä¸¤ä¸ªç¼–è¯‘å™¨é”™è¯¯ã€‚ä¸€ä¸ªæ˜¯<strong>app state</strong>çš„æ‰©å±•ï¼Œç”¨æ¥å¤„ç†æœ€å–œæ¬¢çš„è´¨æ•°å­çŠ¶æ€ã€‚</p>
<pre><code class="language-swift">extension AppState {
  var favoritePrimesState: FavoritePrimesState {
</code></pre>
<blockquote>
<p>ğŸ›‘ Use of undeclared type â€˜FavoritePrimesStateâ€™</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥æ³¨é‡Šæ‰æ‰€æœ‰ä»£ç ã€‚</p>
<pre><code class="language-swift">//extension AppState {
//  var favoritePrimesState: FavoritePrimesState {
//    get {
//      return FavoritePrimesState(
//        favoritePrimes: self.favoritePrimes,
//        activityFeed: self.activityFeed
//      )
//    }
//    set {
//      self.activityFeed = newValue.activityFeed
//      self.favoritePrimes = newValue.favoritePrimes
//    }
//  }
//}
</code></pre>
<p>åœ¨æˆ‘ä»¬çš„<strong>pullback</strong>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å–å‡ºåº”ç”¨çŠ¶æ€æœ€å–œæ¬¢çš„è´¨æ•°ï¼Œå°†å…¶ä¼ é€’ç»™æœ€å–œæ¬¢çš„è´¨æ•°<strong>reducer</strong>ã€‚</p>
<pre><code class="language-swift">pullback(favoritePrimesReducer, value: \.favoritePrimes, action: \.favoritePrimes)

</code></pre>
<p><strong>activityFeed</strong>çš„<strong>higher-order reducer</strong>ç”šè‡³å…è®¸æˆ‘ä»¬é€šè¿‡ä»ç°æœ‰çš„<strong>reducers</strong>ä¸­åˆ é™¤åŸæœ¬ä¸éœ€è¦çš„åŠŸèƒ½æ¥ç®€åŒ–å®ƒä»¬ã€‚</p>
<h2 id="3-a-namehigher-orderloggingahigher-order-logging">3. <a name='Higher-orderlogging'></a>Higher-order logging</h2>
<p>ç°åœ¨åªæœ‰24è¡Œéå¸¸ç®€æ´çš„åº”ç”¨ç¨‹åºé€»è¾‘ï¼Œæ‰€æœ‰çš„æ´»åŠ¨æè¦å†…å®¹éƒ½ç§»åˆ°äº†æ›´é«˜é˜¶çš„<strong>reducers</strong>ä¸­ã€‚ å¦‚æœæˆ‘ä»¬è¿è¡Œåº”ç”¨ç¨‹åºï¼Œä¸€åˆ‡å·¥ä½œéƒ½åƒä»¥å‰ä¸€æ ·ã€‚ä½†æ˜¯è¿™å¾ˆç”·ç†è§£ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æ´»åŠ¨æè¦çš„å±å¹•ã€‚æ²¡æœ‰åŠæ³•çœŸæ­£ç¡®è®¤æ´»åŠ¨æè¦çŠ¶æ€çš„å˜åŒ–æ˜¯å¦ä¸ä¹‹å‰å®Œå…¨ä¸€æ ·ã€‚</p>
<p>é€šè¿‡ä¸ºåº”ç”¨ç¨‹åºæ„å»ºä¸€ä¸ªæ—¥å¿—è®°å½•å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬è‡ªåŠ¨è®°å½•ç”¨æˆ·æ‰§è¡Œçš„æ¯ä¸€ä¸ªæ“ä½œä»¥åŠè¯¥æ“ä½œçš„ç»“æœçŠ¶æ€ï¼Œé‚£ä¸æ˜¯å¾ˆå¥½å—? è¿™å¯¹äºè°ƒè¯•å’Œæ£€æŸ¥åº”ç”¨ç¨‹åºä¸­æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…éå¸¸æœ‰ç”¨ã€‚</p>
<p>æˆ‘ä»¬å¯èƒ½ä¼šå¿ä¸ä½å°†æ­¤æ—¥å¿—è®°å½•æ·»åŠ åˆ°æˆ‘ä»¬çš„å­˜å‚¨ä¸­ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨<strong>send</strong>æ–¹æ³•ä¸­æ·»åŠ ä¸€äº›æ—¥å¿—è®°å½•:</p>
<pre><code class="language-swift">func send(_ action: Action) {
  self.reducer(&amp;self.value, action)
  print(&quot;Action: \(action)&quot;)
  print(&quot;Value:&quot;)
  dump(self.value)
  print(&quot;---&quot;)
}
</code></pre>
<p>ç„¶è€Œï¼Œè¿™æ„å‘³ç€ä»»ä½•ä½¿ç”¨è¿™ä¸ª<strong>store</strong>ç±»(å¯ä»¥æ”¾åˆ°åº“ä¸­å¹¶å…±äº«çš„ä¸œè¥¿)çš„äººéƒ½å°†è¢«è¿«åœ¨å…¶åº”ç”¨ç¨‹åºä¸­è¿›è¡Œæ—¥å¿—è®°å½•ã€‚ä»–ä»¬å¯èƒ½ä¸æƒ³è®°å½•æ—¥å¿—ï¼Œæˆ–è€…ä»–ä»¬ç”šè‡³æƒ³ç”¨ä¸åŒçš„æ–¹å¼æ ¼å¼åŒ–æ—¥å¿—ï¼Œç”šè‡³æŠŠæ—¥å¿—å‘é€åˆ°<strong>os_log</strong>ï¼Œè€Œä¸æ˜¯åƒæˆ‘ä»¬åœ¨è¿™é‡Œåšçš„é‚£æ ·åšç®€å•çš„æ‰“å°è¯­å¥ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦å°†<strong>logging</strong>çš„æ¦‚å¿µç›´æ¥å†™å…¥æˆ‘ä»¬çš„<strong>store</strong>ã€‚ç›¸åï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥åœ¨ç”¨æˆ·ä¸–ç•Œä¸­å®ç°ï¼Œåœ¨åº“çš„èŒƒå›´ä¹‹å¤–ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¦ä¸€ä¸ª<strong>higher-order reducer</strong>æ¥å®ç°å®ƒã€‚</p>
<p>æ—¥å¿—è®°å½•å¯ä»¥æ˜¯ä¸€ä¸ªæ›´<strong>higher-order reducer</strong>ï¼Œåœ¨è¯¥<strong>reducer</strong>ä¸­æˆ‘ä»¬å°è£…ç°æœ‰çš„<strong>reducer</strong>ï¼Œå¹¶åœ¨<strong>reducer</strong>è¿è¡Œåè¿›è¡Œä¸€äº›æ‰“å°ã€‚è®©æˆ‘ä»¬è¿™æ ·åš:</p>
<pre><code class="language-swift">func logging(
  _ reducer: @escaping (inout AppState, AppAction) -&gt; Void
) -&gt; (inout AppState, AppAction) -&gt; Void {
  return { value, action in
    reducer(&amp;value, action)
    print(&quot;Action: \(action)&quot;)
    print(&quot;State:&quot;)
    dump(value)
    print(&quot;---&quot;)
  }
}
</code></pre>
<p>æœ‰äº†è¿™ä¸ªæ›´é«˜é˜¶çš„<strong>higher-order reducer</strong>ï¼Œæˆ‘ä»¬å¯ä»¥åŒ…è£…æˆ‘ä»¬çš„<strong>appReducer</strong>ï¼Œä»¥è·å¾—ä¸€ä¸ªå…¨æ–°çš„<strong>reducer</strong>ï¼Œè¿›è¡Œæ—¥å¿—è®°å½•ã€‚ ç„¶è€Œï¼Œè¿™ç§é€»è¾‘æ˜¯ä¸å¿…è¦çš„å…·ä½“ã€‚æˆ‘ä»¬æ²¡æœ‰åœ¨ä¸»ä½“ä¸­ä½¿ç”¨ä»»ä½•å…³äº<strong>AppState</strong>æˆ–<strong>AppAction</strong>çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥è®©å®ƒæ³›å‹åœ°è¦†ç›–ä»»ä½•ç±»å‹çš„<strong>valueå’Œaction</strong>:</p>
<pre><code class="language-swift">func logging&lt;Value, Action&gt;(
  _ reducer: @escaping (inout Value, Action) -&gt; Void
) -&gt; (inout Value, Action) -&gt; Void {
  return { value, action in
    reducer(&amp;value, action)
    print(&quot;Action: \(action)&quot;)
    print(&quot;State:&quot;)
    dump(value)
    print(&quot;---&quot;)
  }
}
</code></pre>
<p>ç”±äºè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å¼•å…¥é¢å¤–çš„é…ç½®ä½œä¸ºè¾“å…¥ï¼Œæ¯”å¦‚æŒ‡å®šæ—¥å¿—è®°å½•å¦‚ä½•ä»¥åŠåœ¨å“ªé‡Œå‘ç”Ÿã€‚</p>
<p>è¦ä½¿ç”¨è¿™ç§æ–°çš„é«˜é˜¶å‡é€Ÿå™¨ï¼Œæˆ‘ä»¬è¦å°†<strong>appReducer</strong>æ’å…¥å…¶ä¸­ã€‚ä½†æ˜¯æˆ‘ä»¬çš„<strong>appReducer</strong>å·²ç»è¢«åŒ…è£…åœ¨å¦ä¸€ä¸ªæ›´é«˜é˜¶çš„<strong>reducer</strong>ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬çœŸçš„å¿…é¡»åµŒå¥—è¿™äº›:</p>
<pre><code class="language-swift">ContentView(
  store: Store(
    value: AppState(),
    reducer: logging(activityFeed(appReducer))
  )
)
</code></pre>
<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªåº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€åˆ‡éƒ½å’Œä¹‹å‰ä¸€æ ·ï¼Œä½†æˆ‘ä»¬ç°åœ¨åœ¨æ§åˆ¶å°å¾—åˆ°ä¸€äº›æ—¥å¿—è®°å½•ã€‚æˆ‘ä»¬ç»ˆäºå¯ä»¥ä¿è¯æ·»åŠ å’Œåˆ é™¤æ”¶è—å¤¹çš„è´¨æ•°ä¼šåƒæˆ‘ä»¬é¢„æœŸçš„é‚£æ ·é™„åŠ åˆ°æˆ‘ä»¬çš„æ´»åŠ¨æè¦ä¸­ã€‚</p>
<p>æˆ‘ä»¬ç»„æˆè¿™äº›é«˜é˜¶çº¦åŒ–å­çš„æ–¹æ³•è¿˜ä¸æ˜¯å¾ˆå¥½ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€å †è¿™æ ·çš„ä¸œè¥¿ï¼Œè¿™ä¸ªç»„åˆåµŒå¥—ä¼šå¾ˆå¿«å˜å¾—æ··ä¹±:</p>
<pre><code class="language-swift">bar(foo(logger(activityFeed(appReducer))))
</code></pre>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨å‡½æ•°ç»„åˆåŠ©æ‰‹åº“(ç§°ä¸º<strong>Overture</strong>)ä¸­æä¾›çš„ä¸€äº›å‡½æ•°ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨è¿™ä¸ªåº“ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º<strong>compose</strong>çš„å‡½æ•°ç”¨äºå°†å‡½æ•°ç»„åˆåœ¨ä¸€èµ·ï¼Œè€Œè°ƒç”¨<strong>with</strong>å‡½æ•°åªæ˜¯ä¸ºå‡½æ•°åº”ç”¨ç¨‹åºæŒ‡å®šä¸€ä¸ªåç§°ã€‚ æˆ‘ä»¬å·²ç»å°†è¿™äº›åŠ©æ‰‹å¤åˆ¶åˆ°æˆ‘ä»¬çš„<strong>Sources</strong>ç›®å½•ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä½¿ç”¨å®ƒä»¬:</p>
<pre><code class="language-swift">// import Overture

ContentView(
  store: Store(
    value: AppState(),
    reducer: with(
      appReducer,
      compose(
        logger,
        activityFeed
      )
    )
  )
)
</code></pre>
<p>è¿™å¾ˆå¥½ï¼Œå¾ˆæ•´æ´ã€‚æˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬çš„ä¸»<strong>appReducer</strong>è´Ÿè´£æˆ‘ä»¬æ‰€æœ‰çš„åº”ç”¨ç¨‹åºé€»è¾‘ï¼Œç„¶åæˆ‘ä»¬ç”¨å®ƒåº”ç”¨æ‰€æœ‰é«˜é˜¶<strong>reducer</strong>çš„ç»„åˆï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•å’Œæ´»åŠ¨æè¦ã€‚</p>
<p>æˆ‘ä»¬æœ‰å¿…è¦èŠ±ç‚¹æ—¶é—´æ„è¯†åˆ°è¿™æ˜¯å¤šä¹ˆå¼ºå¤§ã€‚<strong>higher-order reducers</strong>ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»¥å¾ˆå°‘çš„å·¥ä½œé‡ä¸ºåº”ç”¨ç¨‹åºæ·»åŠ å¹¿æ³›çš„åŠŸèƒ½ã€‚è¿™æœ‰æ—¶è¢«ç§°ä¸ºâ€œ<strong>aspect oriented programming</strong>â€æˆ–â€œæ¨ªåˆ‡å…³æ³¨ç‚¹(<strong>cross-cutting concerns</strong>)â€ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»èƒ½å¤Ÿæ·±å…¥åˆ°åº”ç”¨ç¨‹åºçš„è®¸å¤šåŸºæœ¬æ–¹é¢ï¼Œè€Œä¸ä¼šè®©åº”ç”¨ç¨‹åºè¢«å®ƒåŸºæœ¬ä¸Šä¸å…³å¿ƒçš„é€»è¾‘æ‰€å¹²æ‰°ã€‚</p>
<p>è€Œè¿™ä¸€åˆ‡éƒ½ä¸å¯èƒ½æ˜¯<strong>SwiftUI</strong>è‡ªèº«æ»¡è¶³çš„ã€‚æ²¡æœ‰åŠæ³•æ—¥å¿—è®°å½•ç”¨æˆ·æ‰§è¡Œçš„æ¯ä¸ªæ“ä½œï¼Œå¹¶åœ¨æ¯æ¬¡æ›´æ”¹åè®°å½•ç»„ä»¶çš„çŠ¶æ€ã€‚è€Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯å…è´¹çš„ã€‚</p>
<p>è€Œè¿™åªæ˜¯<strong>higher-order reducers</strong>çš„å¼€å§‹ã€‚å®ƒä»¬ä¹Ÿä¸ºæˆ‘ä»¬å¼€å¯äº†æå‡<strong>reducers</strong>çš„èƒ½åŠ›ï¼Œè®©å®ƒä»¬å¯ä»¥åœ¨æ¸…å•ä¸Šå·¥ä½œã€‚å®ƒä»¬è¿˜å¯ä»¥å°†å¤„ç†æ¨¡å‹æ•°ç»„çš„<strong>reducers</strong>è½¬æ¢ä¸ºä¹ŸçŸ¥é“å¦‚ä½•åˆ†é¡µçš„<strong>reducers</strong>ã€‚ å½“æ¶‰åŠåˆ°<strong>higher-order reducers</strong>æ—¶ï¼Œå¤©ç©ºæ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚</p>
<h2 id="4-a-namewhatsthepointawhats-the-point">4. <a name='Whatsthepoint'></a>Whatâ€™s the point?</h2>
<p>æˆ‘ä»¬ç°åœ¨å·²ç»ä»‹ç»äº†â€œå¯ç»„åˆï¼ˆ<strong>composable</strong>ï¼‰â€çŠ¶æ€ç®¡ç†çš„è®¸å¤šä¸åŒæ–¹é¢ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å±•ç¤ºäº†å¦‚ä½•å°†åº”ç”¨ç¨‹åºçŠ¶æ€ç®¡ç†çš„æœ¬è´¨æå–åˆ°<strong>reducers</strong>çš„æ¦‚å¿µä¸­ï¼Œåœ¨<strong>reducers</strong>ä¸­æˆ‘ä»¬è·å–åº”ç”¨ç¨‹åºçš„å½“å‰<strong>state</strong>å’Œç”¨æˆ·<strong>action</strong>ï¼Œå¹¶å°†å®ƒä»¬ç»„åˆèµ·æ¥è·å¾—åº”ç”¨ç¨‹åºçš„æ–°çŠ¶æ€ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å±•ç¤ºäº†<strong>reducers</strong>è¡ç”Ÿçš„4ç§ç±»å‹çš„ç»„æˆ:</p>
<ul>
<li>å…·æœ‰ç›¸åŒ<strong>state</strong>å’Œ<strong>action</strong>çš„<strong>reducer</strong>å¯ä»¥ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªå•ä¸€çš„<strong>reducer</strong></li>
<li>åœ¨å°å—<strong>sub-state</strong>ä¸Šæ“ä½œçš„<strong>reducer</strong>å¯ä»¥è¢«æ‹‰å›å…¨å±€<strong>state</strong>ä¸Šå·¥ä½œ</li>
<li>æ“ä½œä¸€å°éƒ¨åˆ†<strong>action</strong>çš„<strong>reducer</strong>å¯ä»¥è¢«æ‹‰å›ç”¨äºå…¨å±€<strong>action</strong>ã€‚</li>
<li>å°†<strong>reducer</strong>ä½œä¸ºè¾“å…¥å’Œè¿”å›<strong>reducer</strong>ä½œä¸ºè¾“å‡ºçš„å‡½æ•°å¯ä»¥ç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥æ·»åŠ è®¸å¤šé¢å¤–çš„åŠŸèƒ½ã€‚</li>
</ul>
<p>ä½¿ç”¨æ‰€æœ‰è¿™äº›ç»„åˆå½¢å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†åº”ç”¨ç¨‹åºé€»è¾‘åˆ†è§£æˆè®¸å¤šå°çš„<strong>reducer</strong>ï¼Œæ¯ä¸€ä¸ªéƒ½å¾ˆå®¹æ˜“ç†è§£ï¼Œç„¶åå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ã€‚</p>
<p>è¿™ä¸€åˆ‡éƒ½å¾ˆé…·ï¼Œæˆ‘å¯ä»¥æ˜ç¡®åœ°çœ‹åˆ°å‡½æ•°å¼ç¼–ç¨‹åœ¨è®¾è®¡è¿™ä¸ªæ¶æ„æ–¹é¢çš„å½±å“ï¼Œä½†æˆ‘ä»¬å¿…é¡»é—®è‡ªå·±ï¼Œâ€œæœ‰ä»€ä¹ˆæ„ä¹‰?â€å½“å®ƒä¸æ˜¯è‹¹æœç›´æ¥æä¾›ç»™æˆ‘ä»¬çš„ä¸œè¥¿æ—¶ï¼Œæ˜¯å¦å€¼å¾—é‡‡ç”¨è¿™ç§æ¶æ„ã€‚æˆ‘ä»¬åœ¨<strong>SwiftUI</strong>ä¸Šå¼•å…¥è¿™ä¸€å±‚æ˜¯ä¸æ˜¯å¤ªè¿èƒŒäº†åˆè¡·?</p>
<p>æˆ‘ä»¬è®¤ä¸ºï¼Œåœ¨SwiftUIä¸­æ¢ç´¢åº”ç”¨æ¶æ„çš„è¿™ä¸ªæ–¹å‘æ˜¯ç»å¯¹å€¼å¾—çš„ã€‚è™½ç„¶è‹¹æœå¹¶æ²¡æœ‰ç›´æ¥æ”¯æŒè¿™ä¸€æ¶æ„ï¼Œä½†è‹¹æœè¿˜æœ‰å¾ˆå¤šæœªè§£å†³çš„é—®é¢˜éœ€è¦æˆ‘ä»¬å»è§£å†³ã€‚æ‰€ä»¥æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨<strong>SwiftUI</strong>ä¹‹ä¸Šå¼•å…¥ä¸€äº›å±‚æ¥å¤„ç†è¿™äº›é—®é¢˜ï¼Œè€Œæˆ‘ä»¬åœ¨è¿™äº›ç« èŠ‚ä¸­å‘ç°çš„å±‚ä»¤äººæƒŠè®¶åœ°è½»é‡çº§ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å¯ä»¥è¢«è§†ä¸ºâ€œåº“â€ä»£ç çš„éƒ¨åˆ†:</p>
<pre><code class="language-swift">class Store&lt;Value, Action&gt;: ObservableObject {
  let reducer: (inout Value, Action) -&gt; Void
  @Published var value: Value

  init(initialValue: Value, reducer: @escaping (inout Value, Action) -&gt; Void) {
    self.value = value
    self.reducer = reducer
  }

  func send(_ action: Action) {
    self.reducer(&amp;self.value, action)
  }
}

func combine&lt;Value, Action&gt;(
  _ reducers: (inout Value, Action) -&gt; Void...
) -&gt; (inout Value, Action) -&gt; Void {
  return { value, action in
    for reducer in reducers {
      reducer(&amp;value, action)
    }
  }
}

func pullback&lt;GlobalValue, LocalValue, GlobalAction, LocalAction&gt;(
  _ reducer: @escaping (inout LocalValue, LocalAction) -&gt; Void,
  value: WritableKeyPath&lt;GlobalValue, LocalValue&gt;,
  action: WritableKeyPath&lt;GlobalAction, LocalAction?&gt;
) -&gt; (inout GlobalValue, GlobalAction) -&gt; Void {
  return { globalValue, globalAction in
    guard let localAction = globalAction[keyPath: action] else { return }
    reducer(&amp;globalValue[keyPath: value], localAction)
  }
}
</code></pre>
<p>è¿™åªæœ‰34è¡Œä»£ç ï¼ŒåŒ…æ‹¬æ¢è¡Œå’Œåªæ˜¯è¯­æ³•çš„è¡Œã€‚çœŸæ­£çš„å†…å®¹åªæœ‰14è¡Œå·¦å³ã€‚</p>
<p>æ‰€ä»¥ä½œä¸ºä¸€ä¸ªæ¶æ„å±‚ï¼Œå®ƒçœŸçš„æ²¡æœ‰é‚£ä¹ˆå¤šã€‚ä½†æ˜¯ï¼Œé€šè¿‡æ‹¥æŠ±è¿™ä¸€è–„å±‚ï¼Œæˆ‘ä»¬å¼€å§‹çœ‹åˆ°å¤§é‡çš„å¥½å¤„ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„<strong>views</strong>å˜å¾—éå¸¸ç®€å•ã€‚å®ƒä»¬ä¸å†ç›´æ¥æ”¹å˜<strong>state</strong>ã€‚å®ƒä»¬æ˜¯ç®€å•åœ°å°†ä¸€äº›å¯è§‚å¯Ÿå¯¹è±¡è½¬æ¢ä¸ºè§†å›¾å±‚æ¬¡ç»“æ„çš„å‡½æ•°ï¼Œè€Œæˆ‘ä»¬éœ€è¦è¿›å…¥åŠ¨ä½œå›è°ƒçš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬ç®€å•åœ°å°†åŠ¨ä½œè½¬æ¢ä¸ºå…·ä½“çš„æ•°æ®ç±»å‹å¹¶å°†å…¶å‘é€åˆ°<strong>store</strong>ä¸­ã€‚ä»¥å‰ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªåŠ¨ä½œé—­åŒ…ä¸­éƒ½æœ‰å¤šè¡Œçªå˜ã€‚</p>
<p>æ­¤å¤–ï¼Œåº”ç”¨ç¨‹åºä¸­çš„å“ªäº›åœ°æ–¹å‘ç”Ÿäº†çªå˜å˜å¾—éå¸¸æ¸…æ™°ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯æœç´¢.<strong>send</strong>(åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ¯ä¸ª<strong>state</strong>çš„å˜åŒ–ã€‚è¿™æ˜¯ä»¤äººéš¾ä»¥ç½®ä¿¡çš„å¼ºå¤§åŠŸèƒ½ï¼Œå¯¹äºè¿™ä¸ªä»£ç åº“çš„æ–°æ‰‹æ¥è¯´ï¼ŒçŸ¥é“æœ‰ä¸€ä¸ªä¸€è‡´çš„åœ°æ–¹å¯ä»¥æœç´¢çªå˜å’Œæ‰§è¡Œçªå˜çš„ä¸€ç§è®¤å¯çš„æ–¹å¼æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚</p>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥æ›´è¿›ä¸€æ­¥ã€‚æˆ‘ä»¬å¯ä»¥å¼ºåˆ¶æ‰€æœ‰çš„çªå˜é€šè¿‡<strong>store</strong>ï¼Œè¿™æ ·å°±ç»å¯¹ä¸å¯èƒ½ä»¥ä»»ä½•å…¶ä»–æ–¹å¼æ”¹å˜åº”ç”¨çŠ¶æ€ã€‚æˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯å°†<strong>store</strong>ä¸­çš„<strong>value</strong>å±æ€§æ›´æ”¹ä¸º<strong>private(set)</strong>:</p>
<pre><code class="language-swift">@Published private(set) var value: Value
</code></pre>
<p>ç°åœ¨ï¼Œå¦‚æœä¸ä½¿ç”¨<strong>send</strong>æ–¹æ³•ï¼Œå°±ä¸å¯èƒ½æ”¹å˜åº”ç”¨çš„çŠ¶æ€ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥æœç´¢åº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„æ‰€æœ‰çªå˜ï¼Œåªéœ€æœç´¢.**send(**è¿™æ˜¯éå¸¸å¼ºå¤§çš„ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨éå¸¸è¡¨é¢çš„å±‚é¢ä¸Šï¼Œæˆ‘ä»¬æ‰€é€‰æ‹©çš„æ¶æ„å·²ç»ç»™äº†æˆ‘ä»¬æŸç§ç¨‹åº¦çš„ä¸€è‡´æ€§ï¼Œè¿™æ˜¯æ™®é€šçš„<strong>SwiftUI</strong>æ‰€æ²¡æœ‰çš„ã€‚ä½†æ˜¯ï¼Œæ— è®ºä½•æ—¶æˆ‘ä»¬åœ¨è‹¹æœæä¾›çš„ä»»ä½•äº§å“ä¸Šæ·»åŠ ä¸€å±‚ï¼Œæˆ‘ä»¬éƒ½æœ‰å¯èƒ½å°†è‡ªå·±é™·å…¥å›°å¢ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„ä¸œè¥¿ä¸æ˜¯è¶…çº§çµæ´»çš„ï¼Œè™½ç„¶æˆ‘ä»¬å¯èƒ½è§£å†³äº†ä¸€ä¸ªé—®é¢˜ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯èƒ½ä¼šé¢å¯¹è®¸å¤šæ–°çš„é—®é¢˜!</p>
<p>ç„¶è€Œï¼Œæˆ‘ä»¬ä¸è®¤ä¸ºè¿™é‡Œæ˜¯è¿™æ ·ã€‚æˆ‘ä»¬å‘ç°æˆ‘ä»¬çš„æ¶æ„æ˜¯è¶…çº§å¯ç»„åˆçš„ã€‚äº‹å®ä¸Šï¼Œå®ƒæ”¯æŒ4ç§ç±»å‹çš„ç»„æˆï¼Œæ¯ä¸€ç§ç±»å‹éƒ½ä½¿æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºåªä¸“æ³¨äºå®Œæˆå·¥ä½œçš„åŸºæœ¬è¦ç´ çš„<strong>reducer</strong>ï¼ŒåŒæ—¶ä»å°†å®ƒä»¬è‡ªå·±å¼€æ”¾ï¼Œä»¥æ¥å…¥æ›´å¤§çš„åº”ç”¨ç¨‹åºã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºæˆ‘ä»¬é€‰æ‹©åœ¨ç®€å•çš„åŠŸèƒ½ä¸Šä¸ºæ¶æ„å»ºæ¨¡ï¼Œè¿™æ˜¯å¯ç»„åˆæ€§çš„é¡¶å³°ã€‚</p>
<p>ä½†ä¹Ÿè®¸è¿™ä¸ªæ¶æ„æœ€é…·çš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æœ€å¤§çš„å¥½å¤„ä¹‹ä¸€ï¼Œæ˜¯å®ƒä¸æˆ‘ä»¬è¿‡å»åœ¨Point-Freeä¸Šè®¨è®ºè¿‡çš„è®¸å¤šæ¦‚å¿µæƒŠäººåœ°ç›¸ä¼¼ã€‚åœ¨è®¨è®º<a href="https://www.pointfree.co/episodes/ep3-uikit-styling-with-functions">è§†å›¾æ ·å¼åŒ–</a>ã€<a href="https://www.pointfree.co/episodes/ep30-composable-randomness">éšæœºæ€§</a>ã€<a href="https://www.pointfree.co/episodes/ep39-witness-oriented-library-design">å¿«ç…§æµ‹è¯•</a>å’Œ<a href="https://www.pointfree.co/episodes/ep59-composable-parsing-map">è§£æ</a>ç­‰é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬ä¸¥æ ¼åœ°å…³æ³¨äºæ„å»ºæ­£ç¡®çš„åŸå­åŸè¯­ä»¥åŠå…è®¸æˆ‘ä»¬ä»åŸå­å•å…ƒæ„å»ºå¤æ‚å¯¹è±¡çš„æ“ä½œã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºéšæœºæ€§ï¼Œæˆ‘ä»¬ä»å•ä¸ªçš„<strong>uint32</strong>ç”Ÿæˆå™¨å¼€å§‹ï¼Œå¹¶ä½¿ç”¨<strong>map, zipå’ŒflatMap</strong>æ¥æ„å»ºå¯†ç ç”Ÿæˆå™¨ï¼Œç”šè‡³æ˜¯åˆ›å»ºéšæœºè‰ºæœ¯ä½œå“çš„ç”Ÿæˆå™¨ã€‚ç„¶åå¯¹äºå¿«ç…§æµ‹è¯•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä»å¿«ç…§<strong>UIImages</strong>çš„å•ä¸€ç­–ç•¥å¼€å§‹ï¼Œç„¶åä½¿ç”¨<strong>pullback</strong>åœ¨<strong>CALayer, UIViewå’ŒUIViewController</strong>ä¸Šåˆ›å»ºç­–ç•¥ã€‚ç„¶åå†è§£ææˆ‘ä»¬ä»ä¸€äº›åŸºæœ¬çš„è§£æå™¨å¼€å§‹,åƒæ–‡å­—çš„è§£æå™¨,<strong>doubleå’Œcharacter</strong>,æˆ‘ä»¬ä½¿ç”¨<strong>map,zipå’ŒflatMap</strong>å»ºç«‹çœŸæ­£å¤æ‚çš„è§£æå™¨,åƒä¸€ä¸ªè§£æå™¨çš„é©¬æ‹‰æ¾æ¯”èµ›ä»ä¸€ä¸ªå­—ç¬¦ä¸²,ç«èµ›çš„åå­—,é—¨ç¥¨å’Œè·¯çº¿åœ°ç†åæ ‡ã€‚</p>
<p>æˆ‘ä»¬è®¤ä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è°ˆè®ºéšæœºæ€§ã€å¿«ç…§æµ‹è¯•å’Œè§£æçš„æ–¹å¼æ¥è°ˆè®ºåº”ç”¨ç¨‹åºæ¶æ„ï¼Œè¿™æ˜¯ä»¤äººæƒŠè®¶çš„ã€‚è¿™è¡¨æ˜è¿™äº›æƒ³æ³•æ˜¯å¤šä¹ˆæ™®éã€‚æˆ‘ä»¬ä¸æ–­åœ°ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯æ¥è§£å†³é—®é¢˜ï¼Œå¹¶ä¸æ–­åœ°ä»ä¸­è·å¾—å¥½å¤„ï¼Œå¹¶ä¸”å¶ç„¶å‘ç°è¿™äº›æŠ€æœ¯çš„æ–°åº”ç”¨ï¼Œè¿™äº›åº”ç”¨ä»ä¸€å¼€å§‹å°±éš¾ä»¥é¢„æµ‹ã€‚</p>
<p>é‚£ä¹ˆï¼Œå…³äºå¯ç»„åˆçŠ¶æ€ç®¡ç†çš„ç³»åˆ—æ–‡ç« åˆ°æ­¤ç»“æŸã€‚ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜è¿œè¿œæ²¡æœ‰å®Œæˆè¿™ä¸ªæ¶æ„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åªè§£å†³äº†æœ¬ç³»åˆ—æ–‡ç« å¼€å§‹æ—¶æ¦‚è¿°çš„5ä¸ªé—®é¢˜ä¸­çš„2ä¸ªåŠã€‚</p>
<p>æˆ‘ä»¬è¯´è¿‡ï¼Œæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªæ¨¡å—åŒ–çš„æ¶æ„ï¼Œè¿™æ ·ç»„ä»¶å¯ä»¥è¢«éš”ç¦»ï¼Œç”šè‡³å¯ä»¥æ”¾åˆ°å®ƒä»¬è‡ªå·±çš„æ¨¡å—ä¸­ã€‚é€šè¿‡å°†<strong>reducer</strong>åˆ†è§£æˆæ›´å°çš„<strong>reducer</strong>ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†ä¸€åŠçš„ç›®æ ‡ï¼Œä½†è§†å›¾æœ¬èº«ä»ç„¶ä¾èµ–äºå®Œæ•´çš„åº”ç”¨<strong>state</strong>å’Œåº”ç”¨<strong>action</strong>çš„<strong>store</strong>ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥åˆ†è§£è¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬ä¸‹æ¬¡ä¼šå¼€å§‹è¿™ä¸ªè¯é¢˜ã€‚</p>
<p>æˆ‘ä»¬è¿˜è¯´è¿‡ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªå…³äºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¦‚ä½•å¤„ç†å‰¯ä½œç”¨çš„æ•…äº‹ï¼Œæˆ‘ä»¬ç”šè‡³è¿˜æ²¡æœ‰è§¦åŠè¿™ä¸ªä¸»é¢˜ã€‚è¿™ä¹Ÿå°†å¾ˆå¿«å®ç°ã€‚æœ€åï¼Œæˆ‘ä»¬å£°æ˜ï¼Œä»¥è¿™ç§æ¶æ„é£æ ¼å¼€å‘åº”ç”¨ç¨‹åºå°†ä½¿æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæ›´å¯æµ‹è¯•çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰è§¦åŠï¼Œä½†è¯·æ”¾å¿ƒï¼Œè¿™æ˜¯å¯èƒ½çš„ï¼Œæˆ‘ä»¬ä¹Ÿå°†å¾ˆå¿«è¦†ç›–!</p>
<p>Until next time!</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/i-r9uoo_2N/" class="tag">
                    PointFree
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/pointfree-episode-70composable-state-management-action-pullbacks/">
                  <h3 class="post-title">
                    PointFree Episode 70:Composable State Management: Action Pullbacks
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
