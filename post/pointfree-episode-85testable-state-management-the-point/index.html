<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>PointFree Episode 85:Testable State Management: The Point | Kayouyou&#39;s Den</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kayouyou.github.io/favicon.ico?v=1663223563046">
<link rel="stylesheet" href="https://kayouyou.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="



Introduction




A tour of the vanilla SwiftUI code base




Testing vanilla SwiftUI




Testing the prime modal



..." />
    <meta name="keywords" content="PointFree" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kayouyou.github.io">
        <img src="https://kayouyou.github.io/images/avatar.png?v=1663223563046" class="site-logo">
        <h1 class="site-title">Kayouyou&#39;s Den</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The wise build bridges, while the foolish build barriers.
    </div>
    <div class="site-footer">
      è±«ICPå¤‡2021012281å·-1  | <a class="rss" href="https://kayouyou.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">PointFree Episode 85:Testable State Management: The Point</h2>
            <div class="post-date">2021-12-18</div>
            
            <div class="post-content" v-pre>
              <!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#Introduction">Introduction</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="#AtourofthevanillaSwiftUIcodebase">A tour of the vanilla SwiftUI code base</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#TestingvanillaSwiftUI">Testing vanilla SwiftUI</a></li>
</ol>
</li>
<li>
<ol start="4">
<li><a href="#Testingtheprimemodal">Testing the prime modal</a></li>
</ol>
</li>
<li>
<ol start="5">
<li><a href="#Testingthefavoriteprimesview">Testing the favorite primes view</a></li>
</ol>
</li>
<li>
<ol start="6">
<li><a href="#Testingthecounterview:ObservedObject">Testing the counter view: @ObservedObject</a></li>
</ol>
</li>
<li>
<ol start="7">
<li><a href="#Testingthecounterview:State">Testing the counter view: @State</a></li>
</ol>
</li>
<li>
<ol start="8">
<li><a href="#Conclusion">Conclusion</a></li>
</ol>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<!-- # PointFree Episode 85:Testable State Management: The Point -->
<h2 id="1-a-nameintroductionaintroduction">1. <a name='Introduction'></a>Introduction</h2>
<p>å› æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»è¯æ˜äº†ï¼Œæˆ‘ä»¬å¼€å‘çš„å¯ç»„åˆæ¶æ„ä¸ä»…æ˜¯è¶…çº§å¯æµ‹è¯•çš„ï¼Œè€Œä¸”å®ƒè¿˜å¯ä»¥æµ‹è¯•åº”ç”¨ç¨‹åºçš„æ·±å±‚æ–¹é¢ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡æœ€å°çš„è®¾ç½®å’Œä»ªå¼æ¥å®Œæˆã€‚å¦‚æœè¦æ¿€å‘äººä»¬ç¼–å†™æµ‹è¯•ï¼Œè¿™æ˜¯å…³é”®ã€‚åœ¨ç¼–å†™æµ‹è¯•æ—¶åº”è¯¥å°½å¯èƒ½å°‘åœ°é‡åˆ°æ‘©æ“¦ï¼Œå¹¶ä¸”æˆ‘ä»¬åº”è¯¥ç¡®ä¿¡æˆ‘ä»¬æ­£åœ¨æµ‹è¯•åº”ç”¨ç¨‹åºçš„ä¸€äº›ç°å®ä¸–ç•Œæ–¹é¢ã€‚</p>
<p>é‚£ä¹ˆï¼Œæœ‰å¿…è¦åšæ‰€æœ‰è¿™äº›å·¥ä½œæ¥è·å¾—è¿™ç§æ°´å¹³çš„å¯æµ‹è¯•æ€§å—?æˆ‘ä»¬èƒ½ä¸èƒ½ä¸ç”¨æ™®é€šçš„SwiftUIæ¥åšè¿™ç§æµ‹è¯•å‘¢?</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ç¡®å®è®¤ä¸ºåœ¨SwiftUIåº”ç”¨ç¨‹åºä¸­åšä¸€äº›å·¥ä½œæ¥è·å¾—å¯æµ‹è¯•æ€§æ˜¯å¿…è¦çš„ã€‚ä½ ä¸ä¸€å®šéœ€è¦ä½¿ç”¨æˆ‘ä»¬æ„å»ºçš„å¯ç»„åˆæ¶æ„ï¼Œä½†å¦‚æœä½ æƒ³æµ‹è¯•ä½ çš„SwiftUIåº”ç”¨ç¨‹åºï¼Œä½ å°†ä¸å¯é¿å…åœ°è¦åœ¨SwiftUIä¸Šå¼•å…¥ä¸€äº›å±‚æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<p>ä¸ºäº†äº†è§£è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å¾ˆä¹…ä»¥å‰ç¼–å†™çš„æ™®é€šçš„SwiftUIåº”ç”¨ç¨‹åºï¼Œè¿™æ˜¯æˆ‘ä»¬å¯¹SwiftUIçš„ä»‹ç»ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¼€å§‹è¿™ä¸€ç³»åˆ—æ¶æ„ç« èŠ‚çš„å…¨éƒ¨åŸå› ã€‚</p>
<hr>
<h2 id="2-a-nameatourofthevanillaswiftuicodebaseaa-tour-of-the-vanilla-swiftui-code-base">2. <a name='AtourofthevanillaSwiftUIcodebase'></a>A tour of the vanilla SwiftUI code base</h2>
<p>å®ƒä»ä¸€ä¸ªä¿å­˜åº”ç”¨ç¨‹åºçŠ¶æ€çš„ç±»å¼€å§‹:</p>
<pre><code class="language-swift">class AppState: ObservableObject {
  @Published var count = 0
  @Published var favoritePrimes: [Int] = []
  @Published var loggedInUser: User? = nil
  @Published var activityFeed: [Activity] = []

  struct Activity {
    let timestamp: Date
    let type: ActivityType

    enum ActivityType {
      case addedFavoritePrime(Int)
      case removedFavoritePrime(Int)
    }
  }

  struct User {
    let id: Int
    let name: String
    let bio: String
  }
}

struct PrimeAlert: Identifiable {
  let prime: Int
  var id: Int { self.prime }
}
</code></pre>
<p>è¿™ä¸ªç±»ç¬¦åˆ<strong>ObservableObject</strong>åè®®ï¼Œå› æ­¤è§†å›¾å¯ä»¥è¢«è‡ªåŠ¨é€šçŸ¥å‘ç”Ÿäº†æ›´æ”¹ï¼Œè§†å›¾éœ€è¦é‡æ–°æ¸²æŸ“ã€‚æˆ‘ä»¬è¿˜è®©æ‰€æœ‰åº”è¯¥å‚ä¸è¿™ä¸ªå˜æ›´é€šçŸ¥è¿‡ç¨‹çš„å­—æ®µä½¿ç”¨@<strong>Published</strong>ï¼Œè¿™å¤šäºäº†ä¸€äº›Swiftè¿è¡Œæ—¶çš„é­”åŠ›ã€‚</p>
<p><strong>count</strong>å’Œ<strong>favoritePrimes</strong>çš„æ•°ç»„æ˜¯æˆ‘ä»¬å¸Œæœ›åœ¨åº”ç”¨ç¨‹åºä¸­è·¨å±å¹•æŒä¹…åŒ–çš„æ ¸å¿ƒæ•°æ®ã€‚æˆ‘ä»¬åæ¥æ·»åŠ äº†ä¸€äº›é¢å¤–çš„çŠ¶æ€ï¼Œåªæ˜¯ä¸ºäº†æ¢ç´¢æ¶æ„ä¸­éœ€è¦è§£å†³çš„å…¶ä»–ç±»å‹çš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªç™»å½•<strong>userå’Œactivity feed</strong>ï¼Œå°½ç®¡æˆ‘ä»¬å®é™…ä¸Šå¹¶ä¸ä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚</p>
<p>è¿™ä¸ªç±»å°±åƒæ˜¯å¯ç»„åˆæ¶æ„çš„<strong>Store</strong>çš„ä¸€ä¸ªä¸é‚£ä¹ˆå›ºæ‰§å·±è§çš„ã€æ›´ç‰¹åˆ«çš„ç‰ˆæœ¬ï¼Œå®ƒä¹Ÿç¬¦åˆ<strong>ObservableObject</strong>ï¼Œå¹¶ä¸”å¯¹äºå®ƒçš„æ•´ä¸ªçŠ¶æ€åªæœ‰ä¸€ä¸ª@<strong>Published</strong>å­—æ®µã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯<strong>ContentView</strong>ï¼Œå®ƒæ˜¯åº”ç”¨ç¨‹åºçš„æ ¹è§†å›¾ï¼Œå®ƒç®€å•åœ°æ˜¾ç¤ºäº†åœ¨åº”ç”¨ç¨‹åºä¸­å¯ä»¥åšçš„ä¸¤ä»¶äº‹:</p>
<pre><code class="language-swift">struct ContentView: View {
  @ObservedObject var state: AppState

  var body: some View {
    NavigationView {
      List {
        NavigationLink(destination: CounterView(state: self.state)) {
          Text(&quot;Counter demo&quot;)
        }
        NavigationLink(
          destination: FavoritePrimesView(
            favoritePrimes: self.$state.favoritePrimes,
            activityFeed: self.$state.activityFeed
          )
        ) {
          Text(&quot;Favorite primes&quot;)
        }
      }
      .navigationBarTitle(&quot;State management&quot;)
    }
  }
}
</code></pre>
<p><strong>CounterView</strong>æˆ–è€…<strong>FavoritePrimesView</strong>ã€‚è¿™äº›è§†å›¾è¢«åŒ…è£…åœ¨ä¸€ä¸ª<strong>NavigationView</strong>ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å‘ä¸‹æ·±å…¥å­å±å¹•ã€‚åœ¨å¯¼èˆªè§†å›¾çš„å†…éƒ¨æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ˜¾ç¤ºå‡ ä¸ªå †å åœ¨ä¸€èµ·çš„æŒ‰é’®ã€‚ç„¶ååœ¨åˆ—è¡¨ä¸­æ˜¯ä¸€äº›<strong>NavigationLinks</strong>ï¼Œå®ƒå…è®¸æˆ‘ä»¬æ·±å…¥åˆ°å­å±å¹•ã€‚</p>
<p>è®©æˆ‘ä»¬ä»è¿™ä¸¤ä¸ªå±å¹•ä¸­æ¯”è¾ƒç®€å•çš„<strong>FavoritePrimesView</strong>å¼€å§‹ã€‚é¦–å…ˆæ³¨æ„æˆ‘ä»¬å¦‚ä½•åˆ›å»ºè¿™ä¸ªè§†å›¾:</p>
<pre><code class="language-swift">FavoritePrimesView(
  favoritePrimes: self.$state.favoritePrimes,
  activityFeed: self.$state.activityFeed
)
</code></pre>
<p>è¿™ä¸ªå¥‡æ€ªçš„<strong>self.$state</strong>è¯­æ³•å…è®¸æˆ‘ä»¬è·å–åº”ç”¨çŠ¶æ€çš„åº•å±‚å¯è§‚å¯Ÿå¯¹è±¡ï¼Œç„¶åè¿›ä¸€æ­¥é“¾æ¥<strong>favoritePrimes</strong>ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä»<strong>observable object</strong>è·å¾—è¯»å†™ç»‘å®šã€‚é€šè¿‡å‘ä¸‹ä¼ é€’ç»‘å®šåˆ°<strong>FavoritePrimesView</strong>ï¼Œæˆ‘ä»¬å…è®¸è¯¥è§†å›¾å¯¹è¿™äº›å€¼è¿›è¡Œæ›´æ”¹ï¼Œå¹¶è®©è¿™äº›å˜åŒ–å¾€å›ä¼ æ’­ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬åªä¼ é€’åŸå§‹å€¼â€¦</p>
<pre><code class="language-swift">FavoritePrimesView(
  favoritePrimes: self.state.favoritePrimes,
  activityFeed: self.state.activityFeed
)
</code></pre>
<p>ç„¶å<strong>FavoritePrimesView</strong>å°±ä¸èƒ½æ”¹å˜è¿™äº›å€¼ï¼Œä¹Ÿä¸èƒ½è®©å…¶ä»–äººçœ‹åˆ°è¿™äº›å˜åŒ–ã€‚</p>
<p>å¾€ä¸‹æ»šåŠ¨ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¼šå‘ç°<strong>FavoritePrimesView</strong>çš„å®ç°:</p>
<pre><code class="language-swift">struct FavoritePrimesView: View {
  @Binding var favoritePrimes: [Int]
  @Binding var activityFeed: [AppState.Activity]

  var body: some View {
    List {
      ForEach(self.favoritePrimes, id: \.self) { prime in
        Text(&quot;\(prime)&quot;)
      }
      .onDelete { indexSet in
        for index in indexSet {
          let prime = self.favoritePrimes[index]
          self.favoritePrimes.remove(at: index)
          self.activityFeed.append(
            .init(timestamp: Date(), type: .removedFavoritePrime(prime))
          )
        }
      }
    }
    .navigationBarTitle(Text(&quot;Favorite Primes&quot;))
    .navigationBarItems(
      trailing: HStack {
        Button(&quot;Save&quot;, action: self.saveFavoritePrimes)
        Button(&quot;Load&quot;, action: self.loadFavoritePrimes)
      }
    )
  }

  func saveFavoritePrimes() {
    let data = try! JSONEncoder().encode(self.favoritePrimes)
      let documentsPath = NSSearchPathForDirectoriesInDomains(
        .documentDirectory, .userDomainMask, true
        )[0]
      let documentsUrl = URL(fileURLWithPath: documentsPath)
      let favoritePrimesUrl = documentsUrl
        .appendingPathComponent(&quot;favorite-primes.json&quot;)
      try! data.write(to: favoritePrimesUrl)
  }

  func loadFavoritePrimes() {
    let documentsPath = NSSearchPathForDirectoriesInDomains(
      .documentDirectory, .userDomainMask, true
      )[0]
    let documentsUrl = URL(fileURLWithPath: documentsPath)
    let favoritePrimesUrl = documentsUrl
      .appendingPathComponent(&quot;favorite-primes.json&quot;)
    guard
      let data = try? Data(contentsOf: favoritePrimesUrl),
      let favoritePrimes = try? JSONDecoder().decode([Int].self, from: data)
      else { return }
    self.favoritePrimes = favoritePrimes
  }
}
</code></pre>
<p>æ³¨æ„ï¼Œè¿™ä¸ªç»“æ„éœ€è¦ä¸¤ä¸ªç»‘å®šæ‰èƒ½åˆå§‹åŒ–ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯@<strong>Binding</strong>å±æ€§åŒ…è£…å™¨ã€‚è¿™å…è®¸æˆ‘ä»¬å°†è¿™äº›å­—æ®µè§†ä¸ºæ­£å¸¸å€¼ï¼Œè€Œå®é™…ä¸Šï¼Œå®ƒå®é™…ä¸Šæ˜¯ä½¿ç”¨ç»‘å®šæœºåˆ¶ï¼Œä»¥ä¾¿åœ¨å€¼æ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“UIã€‚</p>
<p><strong>body</strong>æ˜¯ä¸€ä¸ª<strong>List</strong>ï¼Œå…¶ä¸­åµŒå¥—äº†ä¸€ä¸ª<strong>ForEach</strong>ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä¸ºé›†åˆä¸­çš„æ¯ä¸ªé¡¹å‘ˆç°ä¸€è¡Œã€‚æˆ‘ä»¬è¿˜æœ‰è¿™ä¸ª<strong>onDelete</strong>æ“ä½œï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ä¸€è¡Œå‘ç”Ÿåˆ é™¤æ“ä½œæ—¶æ‰§è¡Œä¸€äº›ä»£ç ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€äº›å¯¼èˆªæ é¡¹ç›®æ¥ä¿å­˜â€œ<strong>Saveâ€å’Œâ€œLoad</strong>â€æŒ‰é’®ï¼Œå®ƒä»¬å„è‡ªçš„æ“ä½œè°ƒç”¨äº†æˆ‘ä»¬åœ¨è¿™ä¸ªè§†å›¾ä¸Šæ‹¥æœ‰çš„ä¸€äº›å‰¯ä½œç”¨æ–¹æ³•ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å‘ä¸Šæ»šåŠ¨ä¸€ç‚¹æ¥æŸ¥çœ‹<strong>CounterView:</strong></p>
<pre><code class="language-swift">struct CounterView: View {
  @ObservedObject var state: AppState
  @State var isPrimeModalShown: Bool = false
  @State var alertNthPrime: PrimeAlert?
  @State var isNthPrimeButtonDisabled = false

  var body: some View {
    VStack {
      HStack {
        Button(action: { self.state.count -= 1 }) {
          Text(&quot;-&quot;)
        }
        Text(&quot;\(self.state.count)&quot;)
        Button(action: { self.state.count += 1 }) {
          Text(&quot;+&quot;)
        }
      }
      Button(action: { self.isPrimeModalShown = true }) {
        Text(&quot;Is this prime?&quot;)
      }
      Button(action: self.nthPrimeButtonAction) {
        Text(&quot;What is the \(ordinal(self.state.count)) prime?&quot;)
      }
      .disabled(self.isNthPrimeButtonDisabled)
    }
    .font(.title)
    .navigationBarTitle(&quot;Counter demo&quot;)
    .sheet(isPresented: self.$isPrimeModalShown) {
      IsPrimeModalView(
        activityFeed: self.$state.activityFeed,
        count: self.state.count,
        favoritePrimes: self.$state.favoritePrimes
      )
    }
    .alert(item: self.$alertNthPrime) { alert in
      Alert(
        title: Text(&quot;The \(ordinal(self.state.count)) prime is \(alert.prime)&quot;),
        dismissButton: .default(Text(&quot;Ok&quot;))
      )
    }
  }

  func nthPrimeButtonAction() {
    self.isNthPrimeButtonDisabled = true
    nthPrime(self.state.count) { prime in
      self.alertNthPrime = prime.map(PrimeAlert.init(prime:))
      self.isNthPrimeButtonDisabled = false
    }
  }
}
</code></pre>
<p>ç»å¯¹æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­æœ€å¤§ä¹Ÿæ˜¯æœ€å¤æ‚çš„è§†å›¾ã€‚é¦–å…ˆï¼Œè¯·æ³¨æ„ï¼Œå®ƒå°†æ‰€æœ‰çš„åº”ç”¨ç¨‹åºçŠ¶æ€ä½œä¸ºä¸€ä¸ªè§‚å¯Ÿå¯¹è±¡:</p>
<pre><code class="language-swift">@ObservedObject var state: AppState
</code></pre>
<p>è¿™æ˜¯å› ä¸ºå®ƒéœ€è¦è®¿é—®å‡ ä¹æ‰€æœ‰çš„çŠ¶æ€æ¥å®Œæˆå®ƒçš„å·¥ä½œã€‚</p>
<p>å®ƒä¹Ÿæœ‰æ‰€æœ‰è¿™äº›é¢å¤–çš„å­—æ®µ:</p>
<pre><code class="language-swift">@State var isPrimeModalShown: Bool = false
@State var alertNthPrime: PrimeAlert?
@State var isNthPrimeButtonDisabled = false
</code></pre>
<p>è¿™æ˜¯åªæœ‰è¿™ä¸ªè§†å›¾å…³å¿ƒçš„å±€éƒ¨çŠ¶æ€ã€‚åœ¨åˆ›å»ºè¿™ä¸ªè§†å›¾æ—¶ï¼Œè¿™äº›å€¼ä¸éœ€è¦å‘ä¸‹ä¼ é€’ï¼Œå®ƒæœ‰ä¸€ä¸ªåˆç†çš„é»˜è®¤å€¼ï¼Œå¯ä»¥ä»å®ƒå¼€å§‹ã€‚</p>
<p>è§†å›¾æœ¬èº«çš„<strong>body</strong>æœ‰å¾ˆå¤šå†…å®¹ã€‚æˆ‘ä»¬ä½¿ç”¨<strong>HStack</strong>è®©è§†å›¾çš„ä¸»è¦éƒ¨åˆ†ç›¸äº’å †å ï¼Œè¿™åŒ…æ‹¬è®¡æ•°å™¨UIï¼Œâ€œ<strong>Is this prime?</strong>â€æŒ‰é’®ï¼Œä»¥åŠâ€œ<strong>What is the nth prime?</strong>â€â€æŒ‰é’®ã€‚æˆ‘ä»¬è¿˜æä¾›äº†æ˜¾ç¤º<strong>alerts</strong>å’Œ<strong>modals</strong>çš„é€»è¾‘ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨$è¯­æ³•æ¥è®¿é—®ä¸ºç›¸åº”çš„@<strong>State</strong>å­—æ®µæä¾›åŠ¨åŠ›çš„<strong>Binding</strong>ã€‚</p>
<p>æœ€åæˆ‘ä»¬æœ‰<strong>IsPrimeModalView</strong>:</p>
<pre><code class="language-swift">struct IsPrimeModalView: View {
  @Binding var activityFeed: [AppState.Activity]
  let count: Int
  @Binding var favoritePrimes: [Int]

  var body: some View {
    VStack {
      if isPrime(self.count) {
        Text(&quot;\(self.count) is prime ğŸ‰&quot;)
        if self.favoritePrimes.contains(self.count) {
          Button(action: {
            self.favoritePrimes.removeAll(where: { $0 == self.count })
            self.activityFeed.append(
              .init(timestamp: Date(), type: .removedFavoritePrime(self.count))
            )
          }) {
            Text(&quot;Remove from favorite primes&quot;)
          }
        } else {
          Button(action: {
            self.favoritePrimes.append(self.count)
            self.activityFeed.append(
              .init(timestamp: Date(), type: .addedFavoritePrime(self.count))
            )
          }) {
            Text(&quot;Save to favorite primes&quot;)
          }
        }
      } else {
        Text(&quot;\(self.count) is not prime :(&quot;)
      }
    }
  }
}
</code></pre>
<p>è¿™ä¸ªè§†å›¾æ¥å—ä¸¤ä¸ª@<strong>Bindings</strong>ï¼Œå› ä¸ºè¿™è¡¨ç¤ºè¿™ä¸ªè§†å›¾å¸Œæœ›èƒ½å¤Ÿçªå˜ï¼Œå¹¶è®©æ›´æ”¹ä¼ æ’­åˆ°çˆ¶è§†å›¾ï¼Œå®ƒæ¥å—ä¸€ä¸ªä¸å¯å˜å€¼ï¼Œå› ä¸ºè¿™æ˜¯åœ¨è¿™ä¸ªè§†å›¾ä¸­ä¸ä¼šæ›´æ”¹çš„æ•°æ®ã€‚</p>
<p>è¿™ä¸ªè§†å›¾ä¸­çš„å…¶ä»–ä¸€åˆ‡éƒ½æ˜¯ç›¸å½“æ ‡å‡†çš„ï¼Œå°½ç®¡å®ƒç¡®å®åŒ…å«äº†ç›¸å½“å¤šçš„é€»è¾‘å’Œç»†å¾®å·®åˆ«ã€‚</p>
<hr>
<h2 id="3-a-nametestingvanillaswiftuiatesting-vanilla-swiftui">3. <a name='TestingvanillaSwiftUI'></a>Testing vanilla SwiftUI</h2>
<p>è¿™å°±æ˜¯æˆ‘ä»¬ä¸Šæ¬¡æ„å»ºçš„åº”ç”¨ç¨‹åºçš„åŸºç¡€çŸ¥è¯†ã€‚å®ƒçš„è®¾è®¡å’Œæ¶æ„å®Œå…¨åŸºäºè‹¹æœæä¾›ç»™æˆ‘ä»¬çš„æ–‡æ¡£(åŒ…æ‹¬åœ¨çº¿å’ŒWWDCè§†é¢‘)ï¼Œå®ƒéå¸¸ç®€å•ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œæˆ‘ä»¬åœ¨è¿‡å»çš„å‡ ä¸ªæ˜ŸæœŸé‡Œæ„å»ºçš„æ¶æ„æœ‰å¾ˆå¤šå…³äºå¦‚ä½•æ„å»ºäº‹ç‰©çš„è§‚ç‚¹ï¼Œè¿™æ˜¯<em>SwiftUI</em>å•ç‹¬åšä¸åˆ°çš„ã€‚å®ƒè¦æ±‚æˆ‘ä»¬ä¸å†åœ¨æˆ‘ä»¬çš„<strong>state</strong>ä¸­æ•£å¸ƒçªå˜ã€‚ç›¸åï¼Œæˆ‘ä»¬å°†ç”¨æˆ·å¯ä»¥æ¥å—çš„æ‰€æœ‰æ“ä½œæè¿°ä¸º<strong>enum</strong>ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª<strong>reducer</strong>æ¥æè¿°ç»™å®šç”¨æˆ·æ“ä½œçš„çŠ¶æ€åº”è¯¥å¦‚ä½•å˜åŒ–ã€‚ç„¶åï¼Œåœ¨è§†å›¾ä¸­ï¼Œæˆ‘ä»¬åªå…è®¸å°†æ“ä½œå‘é€åˆ°<strong>store</strong>ï¼Œè€Œä¸å…è®¸æ‰§è¡Œçªå˜ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œè¿™äº›æ“ä½œéå¸¸ç®€å•åœ°æè¿°äº†ç”¨æˆ·åšäº†ä»€ä¹ˆï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›åœ¨æ“ä½œå‘ç”Ÿåå‘ç”Ÿä»€ä¹ˆã€‚å®ƒä»¬è¢«æè¿°ä¸º<strong>saveButtonTappedæˆ–incrButtonTapped</strong>ï¼Œè€Œä¸æ˜¯<strong>fetchNthPrimeæˆ–incrementCount</strong>ã€‚</p>
<p>æ­£å¦‚æˆ‘ä»¬åœ¨å‰3é›†ä¸­çœ‹åˆ°çš„ï¼Œè¿™ç§è®¾ç½®ä½¿ç¼–å†™æµ‹è¯•å˜å¾—éå¸¸å®¹æ˜“ã€‚æˆ‘ä»¬èŠ±äº†ä¸€ç‚¹æ—¶é—´æ¥å‡†å¤‡æ¶æ„ï¼Œä½†ä¸€æ—¦æ¶æ„å°±ç»ªï¼Œç¼–å†™æµ‹è¯•å°±å˜å¾—å¾ˆç®€å•äº†ï¼Œå®ƒä»¬å…è®¸æˆ‘ä»¬æµ‹è¯•åº”ç”¨ç¨‹åºé€»è¾‘çš„éå¸¸æ·±å…¥çš„æ–¹é¢ã€‚</p>
<p>æ‰€ä»¥é—®é¢˜æ˜¯:æµ‹è¯•ä¸€ä¸ªæ™®é€šçš„SwiftUIä¼šæ˜¯ä»€ä¹ˆæ ·å­? é€šè¿‡ä½¿ç”¨æ™®é€šçš„SwiftUIï¼Œè€Œä¸æ˜¯åœ¨ä¸Šé¢æ·»åŠ é¢å¤–çš„æ¶æ„å±‚ï¼Œæˆ‘ä»¬æ˜¾ç„¶èŠ‚çœäº†å¾ˆå¤šå·¥ä½œï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰èƒ½åŠ›è¿›è¡Œæµ‹è¯•å—?</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¿æŒSwiftUIçš„ä½¿ç”¨å°½å¯èƒ½ç®€å•çš„è¯ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¤ªå¤šå¯ä»¥ç›´æ¥æµ‹è¯•çš„ä¸œè¥¿ã€‚è®©æˆ‘ä»¬è¯•ç€ç¼–å†™ä¸€äº›æµ‹è¯•æ¥äº†è§£åŸå› ã€‚</p>
<hr>
<h2 id="4-a-nametestingtheprimemodalatesting-the-prime-modal">4. <a name='Testingtheprimemodal'></a>Testing the prime modal</h2>
<p>è®©æˆ‘ä»¬ä»ä¸º<strong>IsPrimeModalView</strong>ç¼–å†™ä¸€äº›æµ‹è¯•å¼€å§‹ï¼Œå®ƒå…·æœ‰å…è®¸æˆ‘ä»¬ä»æ”¶è—åˆ—è¡¨ä¸­ä¿å­˜å’Œåˆ é™¤è´¨æ•°çš„åŸºæœ¬åŠŸèƒ½ã€‚è®©æˆ‘ä»¬è·³è½¬åˆ°æˆ‘ä»¬çš„æµ‹è¯•æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªæµ‹è¯•:</p>
<pre><code class="language-swift">import XCTest
@testable import VanillaPrimeTime

class VanillaPrimeTimeTests: XCTestCase {
  func testIsPrimeModalView() {
  }
}
</code></pre>
<p>é‚£ä¹ˆï¼Œæµ‹è¯•è§†å›¾éœ€è¦ä»€ä¹ˆå‘¢? å¥½å§ï¼Œæˆ‘ä»¬åªæœ‰å®é™…çš„è§†å›¾åœ¨æˆ‘ä»¬çš„æ”¯é…ä¸‹ï¼Œæ²¡æœ‰å…¶ä»–è¾…åŠ©çš„ç‰©ä½“ä¸æˆ‘ä»¬äº¤äº’ã€‚è®©æˆ‘ä»¬è¯•ç€åˆ›å»ºä¸€ä¸ª:</p>
<pre><code class="language-swift">let view = IsPrimeModalView(
  activityFeed: &lt;#Binding&lt;[AppState.Activity]&gt;#&gt;,
  count: &lt;#Int#&gt;,
  favoritePrimes: &lt;#Binding&lt;[Int]&gt;#&gt;
)
</code></pre>
<p>çœ‹èµ·æ¥æˆ‘ä»¬éœ€è¦æä¾›ä¸¤ä¸ªç»‘å®šï¼Œä¸€ä¸ªç”¨äºæ´»åŠ¨æè¦ï¼Œä¸€ä¸ªç”¨äºæœ€å–œæ¬¢çš„è´¨æ•°ï¼Œä»¥åŠä¸€ä¸ªæ•´æ•°ã€‚å½“æˆ‘ä»¬åœ¨SwiftUIè§†å›¾çš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºè¿™ä¸ªè§†å›¾æ—¶ï¼Œæ´¾ç”Ÿè¿™äº›ç»‘å®šçœŸçš„å¾ˆå®¹æ˜“ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åš:</p>
<pre><code class="language-swift">IsPrimeModalView(
  activityFeed: self.$state.activityFeed,
  count: self.state.count,
  favoritePrimes: self.$state.favoritePrimes
)
</code></pre>
<p>ç„¶è€Œï¼Œæˆ‘ä»¬åœ¨XCTestä¸­æ²¡æœ‰ä»»ä½•SwiftUIæœºåˆ¶å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è‡ªå·±é‡æ–°åˆ›å»ºå®ƒã€‚ç»‘å®šä¸Šå”¯ä¸€æœ‰ç”¨çš„åˆå§‹åŒ–å™¨æ˜¯è¿™ä¸ª:</p>
<pre><code class="language-swift">Binding(
  get: &lt;#() -&gt; _#&gt;,
  set: &lt;#(_) -&gt; Void#&gt;
)
</code></pre>
<p>è¿™å…è®¸æˆ‘ä»¬æä¾›è‡ªå·±çš„<strong>getterå’Œsetter</strong>ã€‚</p>
<p>æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨å®ƒæ¥åˆ›å»ºæ´»åŠ¨æè¦ç»‘å®šå‘¢?</p>
<pre><code class="language-swift">let activityFeed = Binding(
  get: {  },
  set: { newValue in }
)
</code></pre>
<p>åœ¨è¿™äº›é—­åŒ…ä¸­æˆ‘ä»¬è¦è·å–å’Œè®¾ç½®ä»€ä¹ˆ? æˆ‘ä»¬éœ€è¦åœ¨å¤–éƒ¨ä¿ç•™ä¸€äº›é¢å¤–çš„å¯å˜çŠ¶æ€ä»¥ä¾¿åœ¨å†…éƒ¨ä½¿ç”¨:</p>
<pre><code class="language-swift">var _activityFeed: [AppState.Activity] = []
let activityFeed = Binding(
  get: { _activityFeed },
  set: { newValue in _activityFeed = newValue }
)
</code></pre>
<p>è¿™ä¸ªdanceå¯èƒ½åªæ˜¯@<strong>Binding</strong>å±æ€§åŒ…è£…å™¨çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨è¿™ä¸ªèŒƒå›´å†…ä½¿ç”¨å±æ€§åŒ…è£…å™¨:</p>
<pre><code class="language-swift">@Binding var _activityFeed: [AppState.Activity] = []
</code></pre>
<blockquote>
<p>ğŸ›‘ Property wrappers are not yet supported on local properties</p>
</blockquote>
<p>è€Œä¸”ï¼Œæˆ‘ä»¬ç”šè‡³ä¸èƒ½å°†å®ƒç”¨ä½œæµ‹è¯•ç”¨ä¾‹çš„å®ä¾‹å˜é‡:</p>
<pre><code class="language-swift">class FavoritePrimesTests: XCTestCase {
  @Binding var _activityFeed: [AppState.Activity] = []
</code></pre>
<blockquote>
<p>ğŸ›‘ Argument labels â€˜(wrappedValue:)â€™ do not match any available overloads</p>
</blockquote>
<p>è¿™æ˜¯å› ä¸º@<strong>Binding</strong>å±æ€§åŒ…è£…å™¨ä¸åƒ@<strong>State</strong>é‚£æ ·å…è®¸ä½¿ç”¨åº•å±‚å€¼è¿›è¡Œåˆå§‹åŒ–ã€‚æˆ‘ä»¬ä¹Ÿä¸èƒ½å»æ‰åˆå§‹å€¼:</p>
<pre><code class="language-swift">class FavoritePrimesTests: XCTestCase {
  @Binding var _activityFeed: [AppState.Activity]
</code></pre>
<blockquote>
<p>ğŸ›‘ Class â€˜FavoritePrimesTestsâ€™ has no initializers</p>
</blockquote>
<p>å› ä¸ºæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªåˆå§‹åŒ–å™¨ï¼Œè€Œä¸”æˆ‘ä»¬ä¸æ§åˆ¶<strong>XCTestCase</strong>å¯¹è±¡çš„åˆå§‹åŒ–ã€‚è¿™æ˜¯<strong>XCTest</strong>æ¡†æ¶å’Œ<strong>Xcode</strong>ä¸ºæˆ‘ä»¬å¤„ç†çš„ã€‚</p>
<p>æ‰€ä»¥çœ‹èµ·æ¥æˆ‘ä»¬åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½ç›´æ¥åˆ›å»ºç»‘å®šï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä»»ä½•SwiftUIçš„åä¸½å±æ€§åŒ…è£…å™¨ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€ä»¶å°äº‹æ¥æ¸…ç†å½“å‰åˆ›å»ºç»‘å®šçš„ä¸¤æ­¥æµç¨‹ã€‚æˆ‘ä»¬å¯ä»¥æä¾›è‡ªå·±çš„åˆå§‹åŒ–å™¨æ¥éšè—è¿™ä¸ªå±€éƒ¨å¯å˜å€¼:</p>
<pre><code class="language-swift">extension Binding {
  init(initialValue: Value) {
    var value = initialValue
    self.init(get: { value }, set: { value = $0 })
  }
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ç®€å•åœ°åš:</p>
<pre><code class="language-swift">let activityFeed = Binding&lt;[AppState.Activity]&gt;(initialValue: [])
</code></pre>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥å†…è”å®ƒ:</p>
<pre><code class="language-swift">let view = IsPrimeModalView(
  activityFeed: Binding&lt;[AppState.Activity]&gt;(initialValue: []),
  count: 2,
  favoritePrimes: Binding&lt;[Int]&gt;(initialValue: [2, 3, 5])
)
</code></pre>
<p>è¿™å°±å¥½å¤šäº†ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä»è§†å›¾ä¸­è·å–å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¿™æ ·åš:</p>
<pre><code class="language-swift">view.activityFeed
view.favoritePrimes
</code></pre>
<p>å”·ï¼Œå¥½å§ï¼Œæˆ‘ä»¬ä»ç„¶æ²¡æœ‰ç¼–å†™ä»»ä½•æµ‹è¯•!æˆ‘ä»¬åªæ¢è®¨äº†åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­åˆ›å»ºä¸€ä¸ªæ¥å—ç»‘å®šçš„SwiftUIè§†å›¾çš„æ„ä¹‰ã€‚</p>
<p>é‚£ä¹ˆï¼Œéœ€è¦æµ‹è¯•ä»€ä¹ˆå‘¢?å¥½å§ï¼Œåœ¨è¿™ä¸ªè§†å›¾ä¸­ï¼Œå…³äºå½“å‰è®¡æ•°æ˜¯å¦ä¸ºè´¨æ•°ï¼Œä»¥åŠè¿™ä¸ªè´¨æ•°æ˜¯å¦åœ¨æˆ‘ä»¬å–œæ¬¢çš„èŒƒå›´å†…ï¼Œæœ‰å¤§é‡çš„é€»è¾‘:</p>
<pre><code class="language-swift">var body: some View {
  VStack {
    if isPrime(self.count) {
      Text(&quot;\(self.count) is prime ğŸ‰&quot;)
      if self.favoritePrimes.contains(self.count) {
        Button(action: { â€¦ }) {
          Text(&quot;Remove from favorite primes&quot;)
        }
      } else {
        Button(action: { â€¦ }) {
          Text(&quot;Save to favorite primes&quot;)
        }
      }
    } else {
      Text(&quot;\(self.count) is not prime :(&quot;)
    }
  }
}
</code></pre>
<p>ç„¶è€Œï¼Œæ‰€æœ‰è¿™äº›é€»è¾‘éƒ½è¢«å›°åœ¨æˆ‘ä»¬çš„<strong>body</strong>å±æ€§ä¸­ï¼Œæ²¡æœ‰ä»»ä½•ç‰¹å®šé¢†åŸŸ:</p>
<pre><code class="language-swift">view.body.
</code></pre>
<p>æˆ‘ä»¬åªçœ‹åˆ°SwiftUI apiåœ¨é‚£é‡Œä¿®æ”¹è¿™ä¸ªè§†å›¾ã€‚æ— æ³•è®¿é—®è¿™ä¸ªè§†å›¾ä¸­çš„å­è§†å›¾è¿™æ ·æˆ‘ä»¬å°±æ— æ³•æ–­è¨€å‘ç”Ÿäº†ä»€ä¹ˆã€‚æœ¬è´¨ä¸Šï¼Œæ‰€æœ‰å‘ç”Ÿåœ¨è¿™äº›<strong>body</strong>å±æ€§å†…éƒ¨çš„äº‹æƒ…éƒ½åº”è¯¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé»‘ç›’ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬è¦æµ‹è¯•è¿™é‡Œçš„é€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒä»å…¶ä»–åœ°æ–¹æå–å‡ºæ¥ã€‚æˆ‘ä»¬å¯ä»¥åšçš„ä¸€ä»¶äº‹æ˜¯ï¼Œå°†ä¿å­˜å’Œåˆ é™¤æœ€å–œæ¬¢çš„è´¨æ•°çš„é€»è¾‘ç§»åŠ¨åˆ°è§†å›¾çš„æ–¹æ³•:</p>
<pre><code class="language-swift">Button(action: self.removeFavoritePrime) {
}
// â€¦
Button(action: self.saveFavoritePrime) {
}
// â€¦
func removeFavoritePrime() {
  self.favoritePrimes.removeAll(where: { $0 == self.count })
  self.activityFeed.append(.init(timestamp: Date(), type: .removedFavoritePrime(self.count)))
}

func saveFavoritePrime() {
  self.favoritePrimes.append(self.count)
  self.activityFeed.append(.init(timestamp: Date(), type: .addedFavoritePrime(self.count)))
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬ç»ˆäºå‡†å¤‡å¥½å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ–­è¨€:</p>
<pre><code class="language-swift">view.removeFavoritePrime()

XCTAssertEqual(view.favoritePrimes, [3, 5])

view.saveFavoritePrime()

XCTAssertEqual(view.favoritePrimes, [3, 5, 2])
</code></pre>
<p>è¿™äº›æ–­è¨€éƒ½é€šè¿‡äº†!æˆ‘ä»¬å¯ä»¥ç®€å•åœ°è°ƒç”¨è§†å›¾ä¸Šçš„å‡ ä¸ªæ–¹æ³•æ¥æ”¹å˜çŠ¶æ€ï¼Œç„¶åæ–­è¨€çŠ¶æ€ä»¥æˆ‘ä»¬æœŸæœ›çš„æ–¹å¼æ”¹å˜äº†ã€‚</p>
<p>ä¸ºäº†ç¡®ä¿è¿™äº›æµ‹è¯•ç¡®å®åœ¨è¿è¡Œï¼Œè®©æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸ªå¤±è´¥:</p>
<pre><code class="language-swift">view.saveFavoritePrime()
XCTAssertEqual(favoritePrimes.wrappedValue, [3, 5])
</code></pre>
<blockquote>
<p>ğŸ›‘ XCTAssertEqual failed: (â€œ[3, 5, 2]â€) is not equal to (â€œ[3, 5]â€)</p>
</blockquote>
<p>æˆ‘ä»¬åœ¨è¿™ä¸ªè§†å›¾ä¸­æµ‹è¯•ä¸€äº›é€»è¾‘ã€‚ç„¶è€Œï¼Œä¸æˆ‘ä»¬æµ‹è¯•æ¶æ„çš„æ–¹å¼ç›¸æ¯”ï¼Œæˆ‘ä»¬å¤±å»äº†ä¸€äº›ä¸œè¥¿ã€‚å½“æˆ‘ä»¬åœ¨å‰å‡ é›†é¦–æ¬¡æµ‹è¯•è¿™ä¸€åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå…¨é¢æ£€æŸ¥çŠ¶æ€ä¸­çš„æ¯ä¸ªé¢†åŸŸ:</p>
<pre><code class="language-swift">func testRemoveFavoritesPrimesTapped() {
  var state = (count: 3, favoritePrimes: [3, 5])
  let effects = primeModalReducer(state: &amp;state, action: .removeFavoritePrimeTapped)

  let (count, favoritePrimes) = state
  XCTAssertEqual(count, 3)
  XCTAssertEqual(favoritePrimes, [5])
  XCTAssert(effects.isEmpty)
}
</code></pre>
<p>å°¤å…¶æ˜¯è¿™ä¸€è¡Œâ€¦</p>
<pre><code class="language-swift">let (count, favoritePrimes) = state
</code></pre>
<p>å¦‚æœæˆ‘ä»¬åœ¨è¿™ä¸ªçŠ¶æ€ä¸­æ·»åŠ æ›´å¤šçš„å­—æ®µï¼Œå°†ä¼šå¤±è´¥ã€‚è¿™å¯¹äºç¡®ä¿æˆ‘ä»¬ç»§ç»­æ–­è¨€æ•´ä¸ª<strong>state</strong>æ¥è¯´æ˜¯éå¸¸å¥½çš„ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šä¸å°å¿ƒé”™è¿‡æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘åœ¨<strong>savefaviteprime</strong>æ–¹æ³•ä¸­åšäº†ä¸€äº›æ„šè ¢çš„äº‹æƒ…ï¼Œåƒè¿™æ ·:</p>
<pre><code class="language-swift">func removeFavoritePrime() {
  self.favoritePrimes.removeAll(where: { $0 == self.count })
  self.activityFeed.append(.init(timestamp: Current.date(), type: .removedFavoritePrime(self.count)))
  self.activityFeed = []
}
</code></pre>
<p>æˆ‘ä»¬çš„æµ‹è¯•è¿˜æ˜¯ä¼šé€šè¿‡çš„ã€‚å¦‚æœæˆ‘ä»¬åªæµ‹è¯•æˆ‘ä»¬è®¤ä¸ºä¼šæ”¹å˜çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šé”™è¿‡æ„å¤–æ”¹å˜çš„ä¸ç›¸å…³çš„çŠ¶æ€ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åšä¸€ä»¶äº‹æ¥é‡æ–°è·å¾—è¯¦å°½çš„æ–­è¨€ï¼Œä½†å®ƒå¸¦æœ‰ä¸€äº›æ ·æ¿ã€‚æˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„ç»“æ„ä½“ï¼Œå®ƒåªä¿å­˜æˆ‘ä»¬æ‰€å…³å¿ƒçš„<strong>AppState</strong>çš„çŠ¶æ€ï¼Œå¹¶å°†å…¶ç”¨äºç»‘å®š:</p>
<pre><code class="language-swift">struct IsPrimeModalView: View {

  struct State {
    var activityFeed: [AppState.Activity]
    let count: Int
    var favoritePrimes: [Int]
  }
  @Binding var state: State

//  @Binding var activityFeed: [AppState.Activity]
//  let count: Int
//  @Binding var favoritePrimes: [Int]
</code></pre>
<p>ç„¶åæˆ‘ä»¬éœ€è¦åœ¨<strong>AppState</strong>ä¸Šåˆ›å»ºä¸€ä¸ª<strong>getter/setter</strong>å±æ€§æ¥æ´¾ç”Ÿè¿™ä¸ªå­çŠ¶æ€:</p>
<pre><code class="language-swift">extension AppState {
  var isPrimeModalViewState: IsPrimeModalView.State {
    get {
      IsPrimeModalView.State(
        activityFeed: self.activityFeed,
        count: self.count,
        favoritePrimes: self.favoritePrimes
      )
    }
    set {
      (
        self.activityFeed,
        self.count,
        self.favoritePrimes
      ) = (
        newValue.activityFeed,
        newValue.count,
        newValue.favoritePrimes
      )
    }
  }
}
</code></pre>
<p>è¿™å°†å…è®¸æˆ‘ä»¬åƒè¿™æ ·åˆ›å»ºä¸»æ¨¡æ€è§†å›¾:</p>
<pre><code class="language-swift">IsPrimeModalView(
  state: self.$state.isPrimeModalViewState
)
</code></pre>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»ç¼–å†™çš„è¿™ä¸€å°æ®µç²˜åˆä»£ç åŸºæœ¬ä¸Šä¸æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„æ¶æ„æ‰€éœ€è¦ç¼–å†™çš„ä»£ç ç›¸åŒ:</p>
<pre><code class="language-swift">extension AppState {
  var isPrimeModalViewState: IsPrimeModalView.State {
    get { â€¦ }
    set { â€¦ }
  }
}
</code></pre>
<p>æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„æ¶æ„ä¸­åšå‡ æ¬¡è¿™æ ·çš„äº‹æƒ…ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†å†™ç®€åŒ–ç¨‹åºåªå¤„ç†å±€éƒ¨çŠ¶æ€å’ŒåŠ¨ä½œç„¶åæŠŠå®ƒä»¬æ‹‰å›å¤„ç†å…¨å±€çŠ¶æ€å’ŒåŠ¨ä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„æ˜¯ï¼Œå³ä½¿æˆ‘ä»¬æƒ³ä»¥æœ€ç®€å•ã€æœ€ç›´æ¥çš„æ–¹å¼ä½¿ç”¨SwiftUIï¼Œæœ‰æ—¶æˆ‘ä»¬ä¹Ÿæ— æ³•é¿å¼€ç¼–å†™ä¸€äº›é¢å¤–çš„æ¨¡æ¿ã€‚åœ¨è¿™é‡Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨SwiftUIä¸­æŒ¤å‡ºä¸€ç‚¹é¢å¤–çš„å¯æµ‹è¯•æ€§ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸å†™è¿™äº›é¢å¤–çš„ä»£ç ã€‚</p>
<p>è®©æˆ‘ä»¬é€€å‡ºè¿™ä¸ªé‡æ„ã€‚æˆ‘ä»¬åªæ˜¯æƒ³å±•ç¤ºè·å¾—æ‰€æœ‰å¯èƒ½çš„è·¯å¾„ï¼Œè€Œä¸æƒ³æ›´æ–°æ‰€æœ‰æµ‹è¯•ã€‚</p>
<hr>
<h2 id="5-a-nametestingthefavoriteprimesviewatesting-the-favorite-primes-view">5. <a name='Testingthefavoriteprimesview'></a>Testing the favorite primes view</h2>
<p>è™½ç„¶åŸå§‹æ¨¡æ€è§†å›¾ä¸æ˜¯è¶…å¯æµ‹è¯•çš„å¼€ç®±å³ç”¨ï¼Œä½†æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ä¸€äº›è¾…åŠ©æ–¹æ³•è·å¾—å¯æµ‹è¯•æ€§ã€‚è™½ç„¶æ¥å—ç»‘å®šçš„è§†å›¾æ˜¯å¯æµ‹è¯•çš„ï¼Œä½†æˆ‘ä»¬çŸ¥é“å½»åº•æµ‹è¯•éœ€è¦å°†è§†å›¾çš„çŠ¶æ€æ†ç»‘åœ¨ä¸€ä¸ªå•ä¸€çš„ã€å¯æµ‹è¯•çš„ç»‘å®šä¸­ï¼Œè¿™éœ€è¦å¤§é‡é¢å¤–çš„å·¥ä½œã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹æµ‹è¯•å…¶ä»–è§†å›¾éœ€è¦ä»€ä¹ˆã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä»å¿«é€ŸæŸ¥çœ‹<strong>FavoritePrimesView</strong>å¼€å§‹ã€‚å®ƒç±»ä¼¼äº<strong>IsPrimeModal</strong>ï¼Œå®ƒåªéœ€è¦å‡ ä¸ªç»‘å®šå€¼å°±å¯ä»¥å®Œæˆå®ƒçš„å·¥ä½œ:</p>
<pre><code class="language-swift">struct FavoritePrimesView: View {
  @Binding var favoritePrimes: [Int]
  @Binding var activityFeed: [AppState.Activity]
</code></pre>
<p>å› æ­¤ï¼ŒåŸºäºæˆ‘ä»¬å¯¹<strong>prime modal</strong>çš„å·¥ä½œï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåœ¨æµ‹è¯•ä¸­éå¸¸å®¹æ˜“åœ°å®ä¾‹åŒ–å…¶ä¸­ä¸€ä¸ªè§†å›¾ã€‚å¦‚æœæˆ‘ä»¬ç¯é¡¾å››å‘¨ï¼Œçœ‹çœ‹å“ªäº›æ˜¯å¯æµ‹è¯•çš„ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨è¿™ä¸ª<strong>onDelete</strong>é—­åŒ…ä¸­å¡«å……äº†ä¸€äº›é€»è¾‘:</p>
<pre><code class="language-swift">.onDelete { indexSet in
  for index in indexSet {
    let prime = self.favoritePrimes[index]
    self.favoritePrimes.remove(at: index)
    self.activityFeed.append(
      .init(timestamp: Date(), type: .removedFavoritePrime(prime))
    )
  }
}
</code></pre>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªé€»è¾‘æ˜¯å¯æµ‹è¯•çš„ï¼Œæˆ‘ä»¬å¿…é¡»å°†å®ƒæå–åˆ°ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œä»¥ä¾¿å¯ä»¥ç›´æ¥è°ƒç”¨å®ƒã€‚</p>
<p>æˆ‘ä»¬åœ¨è§†å›¾ä¸Šä¹Ÿæœ‰è¿™äº›ä¿å­˜å’ŒåŠ è½½æ–¹æ³•:</p>
<pre><code class="language-swift">func saveFavoritePrimes() {
  // â€¦
}

func loadFavoritePrimes() {
  // â€¦
}
</code></pre>
<p>å®ƒä»¬ä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼Œå‡è®¾æˆ‘ä»¬èƒ½æ§åˆ¶åœ¨è¿™é‡Œå‘ç”Ÿçš„å‰¯ä½œç”¨ã€‚</p>
<p>æˆ‘ä»¬ä¸æ‰“ç®—ä¸ºè¿™ä¸ªè§†å›¾ç¼–å†™ä»»ä½•æµ‹è¯•å› ä¸ºæµ‹è¯•å®ƒåº”è¯¥å’Œæµ‹è¯•<strong>FavoritePrimesView</strong>å·®ä¸å¤šã€‚</p>
<p>ç„¶è€Œï¼Œæˆ‘ä»¬æœ‰å¿…è¦é‡å¤æˆ‘ä»¬æ‰€å­¦åˆ°çš„ç»éªŒæ•™è®­ã€‚é¦–å…ˆï¼Œåœ¨è§†å›¾ä½“ä¸­æ‰€åšçš„ä¸€åˆ‡éƒ½æ˜¯ä¸å¯æµ‹è¯•çš„ã€‚æˆ‘ä»¬åº”è¯¥æŠŠå®ƒå½“æˆä¸€ä¸ªæˆ‘ä»¬æ ¹æœ¬æ— æ³•è¿›å…¥çš„é»‘ç›’ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»åšé¢å¤–çš„å·¥ä½œï¼Œè¯•å›¾æŠŠå·¥ä½œä»<strong>body</strong>è½¬ç§»åˆ°å¯ä»¥è¢«æµ‹è¯•çš„æ–¹æ³•ä¸­ã€‚</p>
<p>å…¶æ¬¡ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åŠ å¼ºæˆ‘ä»¬çš„æµ‹è¯•ï¼Œä½¿å®ƒä»¬å®Œå…¨è¦†ç›–è§†å›¾çš„é¢†åŸŸæ¨¡å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼¼ä¹åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½å¼•å…¥ä¸­é—´ç»“æ„ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ–­è¨€æ‰€æœ‰çš„ç»“æ„ã€‚</p>
<hr>
<h2 id="6-a-nametestingthecounterviewobservedobjectatesting-the-counter-view-observedobject">6. <a name='Testingthecounterview:ObservedObject'></a>Testing the counter view: @ObservedObject</h2>
<p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ä¸ºæˆ‘ä»¬çš„<strong>CounterView</strong>ç¼–å†™æµ‹è¯•éœ€è¦ä»€ä¹ˆã€‚è¿™é‡Œæˆ‘ä»¬é‡åˆ°äº†ä¸€äº›æˆ‘ä»¬åœ¨å‰ä¸¤ä¸ªè§†å›¾ä¸­æ²¡æœ‰çœ‹åˆ°çš„ä¸œè¥¿:</p>
<pre><code class="language-swift">struct CounterView: View {
  @ObservedObject var state: AppState
  @State var isPrimeModalShown: Bool = false
  @State var alertNthPrime: PrimeAlert?
  @State var isNthPrimeButtonDisabled = false
</code></pre>
<p>è¯¥è§†å›¾çš„ä¸€äº›çŠ¶æ€è¡¨ç¤ºä¸º@O<strong>bservedObject</strong>ï¼Œå…¶ä»–çŠ¶æ€è¡¨ç¤ºä¸º@<strong>State</strong>ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰ä¸ºè¿™ä¸¤ç§çŠ¶æ€ç¼–å†™æµ‹è¯•ã€‚@<strong>ObservedObject</strong>æ˜¯æœ€å®¹æ˜“æµ‹è¯•çš„éƒ¨åˆ†ï¼Œå®ƒç”šè‡³æ¯”æµ‹è¯•@<strong>Bindings</strong>æ›´å®¹æ˜“ã€‚ç„¶è€Œï¼Œä¸ºäº†è®©ä»»ä½•ä¸œè¥¿éƒ½æ˜¯å¯æµ‹è¯•çš„ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿å°†çŠ¶æ€çªå˜ç§»å‡ºè§†å›¾<strong>body</strong>ï¼Œå¹¶è½¬ç§»åˆ°ä¸“ç”¨çš„æ–¹æ³•ä¸­ã€‚è®©æˆ‘ä»¬ç”¨é€’å¢å’Œé€’å‡æŒ‰é’®æ¥åš:</p>
<pre><code class="language-swift">struct CounterView: View {
  // â€¦

  func incrementCount() {
    self.state.count += 1
  }

  func decrementCount() {
    self.state.count -= 1
  }

  var body: some View {
    // â€¦
    Button(action: self.decrementCount) {
      Text(&quot;-&quot;)
    }
    // â€¦
    Button(action: self.incrementCount) {
      Text(&quot;+&quot;)
    }
    // â€¦
  }
}
</code></pre>
<p>ç„¶åä¸ºäº†æµ‹è¯•è¿™ä¸ªé€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªè§†å›¾ï¼Œè°ƒç”¨é‚£äº›ç«¯ç‚¹ï¼Œå¹¶æ–­è¨€çŠ¶æ€ä»¥æˆ‘ä»¬æœŸæœ›çš„æ–¹å¼æ”¹å˜äº†ã€‚é™¤äº†ä¸æ„é€ <strong>bindings</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ é€’åº”ç”¨ç¨‹åºçŠ¶æ€:</p>
<pre><code class="language-swift">func testCounterView() {
  let view = CounterView(state: AppState())

  view.incrementCount()

  XCTAssertEqual(view.state, AppState(count: 1))
}
</code></pre>
<blockquote>
<p>ğŸ›‘ Argument passed to call that takes no arguments</p>
</blockquote>
<p>ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½è¿™æ ·åšã€‚ä½œä¸º<strong>ObservableObject</strong>çš„<strong>AppState</strong>å¿…é¡»æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸”ç±»æ²¡æœ‰ä¸€ä¸ªé»˜è®¤çš„æˆå‘˜ç±»åˆå§‹åŒ–å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å®ƒã€‚ æˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„åˆå§‹åŒ–å™¨æ¥è®¿é—®è¿™äº›<strong>helpers</strong>ï¼Œä½†æˆ‘ä»¬ç”šè‡³ä¸èƒ½è®©Xcodeä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªæˆå‘˜é€ä¸€åˆå§‹åŒ–å™¨ï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½å¾ˆå¥½åœ°ä¸é»˜è®¤å±æ€§é…åˆã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åšçš„ä¸€ä»¶äº‹æ˜¯åˆ›é€ ä¸€ä¸ªæ–°çš„ä»·å€¼ï¼Œå¹¶ä½¿å…¶ç¬¦åˆæˆ‘ä»¬çš„æœŸæœ›ã€‚</p>
<pre><code class="language-swift">func testCounterView() {
  let view = CounterView(state: AppState())

  view.incrementCount()

  let expected = AppState()
  expected.count = 1
  XCTAssertEqual(view.state, expected)
}
</code></pre>
<blockquote>
<p>ğŸ›‘ Global function â€˜XCTAssertEqual(::_:file:line:)â€™ requires that â€˜AppStateâ€™ conform to â€˜Equatableâ€™</p>
</blockquote>
<p>ç”šè‡³è¿™ä¹Ÿä¸èƒ½å·¥ä½œï¼Œå› ä¸º<strong>AppState</strong>ä¸ç¬¦åˆ<strong>Equatable</strong>ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ç”šè‡³ä¸èƒ½åœ¨<strong>AppState</strong>ä¸Šè‡ªåŠ¨åˆæˆå‡è¡¡æ€§ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç±»ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ç»´æŠ¤æˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰ä¸€è‡´æ€§ï¼Œè¿™å°†æ‰“ç ´ï¼Œæˆ‘ä»¬éœ€è¦è®°å¾—åœ¨æˆ‘ä»¬çš„çŠ¶æ€æ·»åŠ æˆ–åˆ é™¤å­—æ®µæ—¶æ›´æ–°å®ƒã€‚</p>
<p>æ‰€ä»¥è¿™äº›éƒ½ä¸å¯¹ï¼ŒçœŸçš„ã€‚å”¯ä¸€ç®€å•çš„æ­¥éª¤æ˜¯å–å‡ºçŠ¶æ€è®¡æ•°å¹¶ç›´æ¥æµ‹è¯•å®ƒã€‚</p>
<pre><code class="language-swift">func testCounterView() {
  let view = CounterView(state: AppState())

  view.incrementCount()

  XCTAssertEqual(view.state.count, 1)
}
</code></pre>
<p>å®ƒé€šè¿‡äº†ï¼Œä½†è¯·è®°ä½ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•ä¸­å·²ç»å¤±å»äº†å¼ºå¤§çš„ç©·ä¸¾æ€§ã€‚ å¦‚æœ<strong>incrementCount</strong>å¼€å§‹å¯¹<strong>AppState</strong>åšå…¶ä»–äº‹æƒ…ï¼Œæˆ‘ä»¬å°±æ²¡æœ‰è¦†ç›–æ¥æ§åˆ¶å®ƒã€‚</p>
<p>æ— è®ºå¦‚ä½•ï¼Œè®©æˆ‘ä»¬é€šè¿‡æ›´å¤šåœ°ç»ƒä¹ å®ƒçš„æ–¹æ³•æ¥å……å®è¿™ä¸ªæµ‹è¯•ã€‚</p>
<pre><code class="language-swift">func testCounterView() {
  let view = CounterView(state: AppState())

  view.incrementCount()

  XCTAssertEqual(view.state.count, 1)

  view.incrementCount()

  XCTAssertEqual(view.state.count, 2)

  view.decrementCount()

  XCTAssertEqual(view.state.count, 1)
}
</code></pre>
<p>æ‰€ä»¥è¿™ä¸ªæµ‹è¯•å†™èµ·æ¥æ›´å®¹æ˜“ä¸€äº›å› ä¸ºå¯è§‚å¯Ÿå¯¹è±¡æ¯”ç»‘å®šæ›´å®¹æ˜“åˆ›å»ºï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬é‡åˆ°äº†å…¶ä»–éº»çƒ¦ï¼Œæ¯”å¦‚æ²¡æœ‰ç®€å•çš„æ–¹æ³•æ¥åˆ›å»ºåŸºäºæˆå‘˜çš„åˆå§‹åŒ–å™¨ï¼Œä¹Ÿæ²¡æœ‰ç®€å•çš„æ–¹æ³•ä½¿å¯è§‚å¯Ÿå¯¹è±¡ç›¸ç­‰ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬è¢«è¿«æµ‹è¯•åº”ç”¨çŠ¶æ€çš„éƒ¨åˆ†è€Œä¸æ˜¯å…¨éƒ¨ã€‚</p>
<hr>
<h2 id="7-a-nametestingthecounterviewstateatesting-the-counter-view-state">7. <a name='Testingthecounterview:State'></a>Testing the counter view: @State</h2>
<p>æˆ‘ä»¬è¿˜å¸Œæœ›èƒ½å¤Ÿæµ‹è¯•è¿™äº›@<strong>State</strong>å­—æ®µï¼Œå› ä¸ºæœ‰ä¸€äº›ç»†å¾®çš„é€»è¾‘æŒ‡å¯¼å®ƒä»¬çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå½“ä½ ç‚¹å‡»â€œç¬¬nä¸ªè´¨æ•°æ˜¯å¤šå°‘?â€æŒ‰é’®ï¼Œæˆ‘ä»¬ç¦ç”¨ç¬¬nä¸ªä¸»è¦æŒ‰é’®ï¼Œç„¶ååªæœ‰å½“æˆ‘ä»¬ä»APIå¾—åˆ°å“åº”æ—¶ï¼Œæˆ‘ä»¬æ‰é‡æ–°å¯ç”¨å®ƒã€‚å½“æˆ‘ä»¬ä»APIè·å¾—æˆåŠŸå“åº”æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿåªæ˜¾ç¤ºè­¦æŠ¥:</p>
<pre><code class="language-swift">func nthPrimeButtonAction() {
  self.isNthPrimeButtonDisabled = true
  nthPrime(self.state.count) { prime in
    self.alertNthPrime = prime.map(PrimeAlert.init(prime:))
    self.isNthPrimeButtonDisabled = false
  }
}
</code></pre>
<p>wä»¬åº”è¯¥èƒ½å¤Ÿç¼–å†™ä¸€äº›æ–­è¨€ï¼Œå³ç¬¬nä¸ªæŒ‰é’®å¼€å§‹æ˜¯å¯ç”¨çš„ï¼Œç„¶åå½“ç¬¬nä¸ªæŒ‰é’®è¢«æŒ‰ä¸‹æ—¶åˆ‡æ¢åˆ°ç¦ç”¨ã€‚</p>
<pre><code class="language-swift">XCTAssertEqual(view.isNthPrimeButtonDisabled, false)

view.nthPrimeButtonAction()

XCTAssertEqual(view.isNthPrimeButtonDisabled, true)
</code></pre>
<p>And then we can run our test:</p>
<blockquote>
<p>ğŸ›‘ XCTAssertEqual failed: (â€œfalseâ€) is not equal to (â€œtrueâ€)</p>
</blockquote>
<p>é‚£ä¼¼ä¹ä¸å¤ªå¯¹ã€‚å®é™…ä¸Šï¼Œ<strong>nthPrimeButtonAction</strong>æ–¹æ³•åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å°†è¿™ä¸ªå¸ƒå°”å€¼ç¿»è½¬ä¸ºtrueã€‚è®©æˆ‘ä»¬é€šè¿‡åœ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–ä¹‹å‰å’Œä¹‹åæ·»åŠ ä¸€äº›printè¯­å¥æ¥å°è¯•äº†è§£è¿™ä¸ªæ–¹æ³•å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆ:</p>
<pre><code class="language-swift">func nthPrimeButtonAction() {
  print(self.isNthPrimeButtonDisabled)
  self.isNthPrimeButtonDisabled = true
  print(self.isNthPrimeButtonDisabled)
</code></pre>
<p>å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°:</p>
<pre><code class="language-swift">false
false
</code></pre>
<p>è¿™ä¼¼ä¹å¾ˆå¥‡æ€ªã€‚æˆ‘ä»¬ç›´æ¥åœ¨ä¸€è¡Œä¸Šæ”¹å˜è¿™ä¸ªå€¼ï¼Œç„¶åä¸‹ä¸€è¡Œå°±å¥½åƒä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿä¸€æ ·ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œä½†å‡ ä¹å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œè¿™ä¸ªå€¼å­˜å‚¨åœ¨@<strong>State</strong>å­—æ®µä¸­ï¼Œè¿™å°±æ˜¯SwiftUIåœ¨ä»»ä½•å€¼å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°å‘ˆç°è¯¥è§†å›¾çš„èƒ½åŠ›ã€‚ ç„¶è€Œï¼Œä¼¼ä¹æ— è®ºæœºåˆ¶çš„åŠ›é‡æ˜¯ä»€ä¹ˆï¼Œé™¤éå®ƒåœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œæ¯”å¦‚ä¸€ä¸ª<strong>UIHostingController</strong>ï¼Œå¦åˆ™å®ƒæ ¹æœ¬æ— æ³•å·¥ä½œã€‚</p>
<p>æ®æˆ‘ä»¬æ‰€çŸ¥ï¼Œè¿™æ˜¯æ— æ³•å›é¿çš„ã€‚åŸºæœ¬ä¸Šï¼Œä½¿ç”¨@<strong>State</strong>å±æ€§åŒ…è£…å™¨å»ºæ¨¡çš„ä»»ä½•çŠ¶æ€éƒ½æ˜¯ä¸å¯æµ‹è¯•çš„ã€‚ä¹Ÿè®¸æ‚¨å¹¶ä¸å…³å¿ƒæµ‹è¯•è¿™ä¸ªé€»è¾‘ï¼Œä½†æ˜¯å¦‚æœæ‚¨å…³å¿ƒï¼Œé‚£ä¹ˆæ‚¨åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½å°†å®ƒç§»åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚</p>
<p>è®©æˆ‘ä»¬å¿«é€Ÿåšä¸€ä¸‹ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™äº›å­—æ®µæ·»åŠ åˆ°<strong>AppState:</strong></p>
<pre><code class="language-swift">class AppState: ObservableObject {
  // â€¦
  @Published var alertNthPrime: PrimeAlert? = nil
  @Published var isNthPrimeButtonDisabled = false
</code></pre>
<p>ç„¶åä»æˆ‘ä»¬çš„è§†å›¾ä¸­åˆ é™¤è¿™äº›å­—æ®µï¼ŒåŒæ—¶ä¿®å¤å¯¹è¿™äº›å­—æ®µçš„å¼•ç”¨:</p>
<pre><code class="language-swift">struct CounterView: View {
  // â€¦
//  @State var alertNthPrime: PrimeAlert?
//  @State var isNthPrimeButtonDisabled = false
</code></pre>
<p>æˆ‘ä»¬åªéœ€è¦åœ¨è®¿é—®çŠ¶æ€æ—¶é€šè¿‡<strong>state</strong>å±æ€§ä¿®å¤ä¸€äº›ç¼–è¯‘å™¨é”™è¯¯ã€‚</p>
<p>ä¸€æ—¦æˆ‘ä»¬è¿™ä¹ˆåšäº†ï¼Œæˆ‘ä»¬çš„æµ‹è¯•å°±ä¼šé€šè¿‡:</p>
<pre><code class="language-swift">XCTAssertEqual(view.state.isNthPrimeButtonDisabled, false)

view.nthPrimeButtonAction()

XCTAssertEqual(view.state.isNthPrimeButtonDisabled, true)
</code></pre>
<p>å› æ­¤ï¼Œå°½ç®¡@<strong>State</strong>å­—æ®µä¸èƒ½ç›´æ¥æµ‹è¯•ï¼Œä½†æˆ‘ä»¬è‡³å°‘å¯ä»¥å°†å®ƒä»¬æå–åˆ°åº”ç”¨ç¨‹åºçŠ¶æ€ä¸­ï¼Œä½¿å…¶å¯æµ‹è¯•ã€‚</p>
<p>ç„¶è€Œï¼Œå³ä½¿è¿™æ ·åšäº†ï¼Œæˆ‘ä»¬ä»ç„¶æ²¡æœ‰æ¢å¤ä¸æˆ‘ä»¬çš„æ¶æ„ç›¸åŒçš„æµ‹è¯•èƒ½åŠ›ã€‚å½“æˆ‘ä»¬ç”¨å¯ç»„åˆæ¶æ„ä¸ºè¿™ä¸ªå±å¹•ç¼–å†™æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ ä¸€ä¸ªé›†æˆæµ‹è¯•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæµ‹è¯•å¯ä»¥åŒæ—¶è¿è¡Œåº”ç”¨ç¨‹åºçš„å¤šä¸ªç‹¬ç«‹éƒ¨åˆ†ã€‚æˆ‘ä»¬èƒ½å¤Ÿä¸ºåµŒå…¥åœ¨è®¡æ•°å™¨é€»è¾‘ä¸­çš„ç´ æ¨¡æ€é€»è¾‘ç¼–å†™ä¸€ä¸ªæµ‹è¯•ï¼Œåªæ˜¯ä¸ºäº†ç¡®ä¿è¿™ä¸¤ä¸ªç‰¹æ€§èƒ½å¤Ÿå¾ˆå¥½åœ°ç»“åˆåœ¨ä¸€èµ·ã€‚</p>
<p>è¿™æ˜¯ç›®å‰ä¸å¯èƒ½åšåˆ°çš„ã€‚ç”±äºä¸»æ¨¡æ€æ˜¯åœ¨<strong>counter</strong>è§†å›¾ä¸»ä½“ä¸­å‘ˆç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æµ‹è¯•ä¸­æ— æ³•è®¿é—®å®ƒã€‚å½“å®ƒä»¬ä»è®¡æ•°å™¨å±å¹•ä¸Šæ˜¾ç¤ºæ—¶å¦‚æœç”¨æˆ·ä¸ä¸»æ¨¡å¼äº¤äº’ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸èƒ½è°ƒç”¨å‰é¢åˆ›å»ºçš„æ–¹æ³•æ¥æ¨¡æ‹Ÿã€‚</p>
<p>æˆ‘ä»¬å¯èƒ½ä¼šæ¢å¤ä¸€äº›é›†æˆæµ‹è¯•çš„å¤–è¡¨ï¼Œä½†è¿™å°†æ„å‘³ç€å†æ¬¡å°†é€»è¾‘ç§»åˆ°æ›´æ˜“äºæµ‹è¯•çš„åœ°æ–¹ã€‚ä¹‹å‰æˆ‘ä»¬æŠŠé€»è¾‘ä»è§†å›¾ä¸»ä½“ç§»åˆ°è§†å›¾æ–¹æ³•ä¸­ï¼Œä½†ç°åœ¨è¿™è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æŠŠé€»è¾‘ç›´æ¥ç§»åˆ°åº”ç”¨ç¨‹åºçŠ¶æ€ä¸­ã€‚ä½†è¿™ä¼¼ä¹ä¹Ÿå¾ˆå›°éš¾ï¼Œå› ä¸ºæˆ‘ä»¬ç”šè‡³æ²¡æœ‰åœ¨ä¸»æ¨¡æ€è§†å›¾ä¸­ä½¿ç”¨appçŠ¶æ€ï¼Œæˆ‘ä»¬åªå‘ä¸‹ä¼ é€’ç»‘å®šï¼Œè€Œä¸æ˜¯å®Œæ•´çš„å¯è§‚å¯Ÿå¯¹è±¡ã€‚</p>
<hr>
<h2 id="8-a-nameconclusionaconclusion">8. <a name='Conclusion'></a>Conclusion</h2>
<p>æˆ‘è®¤ä¸ºæˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„æ˜¯ï¼ŒçœŸçš„æ²¡æœ‰æµ‹è¯•ä¸€ä¸ªæ™®é€šçš„SwiftUIåº”ç”¨ç¨‹åºè¿™æ ·çš„äº‹æƒ…ã€‚ä¼¼ä¹æ‚¨æ€»æ˜¯éœ€è¦åšä¸€äº›å‰æœŸå·¥ä½œæ¥è§£é”å¯æµ‹è¯•æ€§ã€‚</p>
<ul>
<li>
<p>è‡³å°‘ï¼Œä½ éœ€è¦å°½å¯èƒ½å¤šåœ°å°†ä½ çš„é€»è¾‘ç§»å‡ºè§†å›¾çš„<strong>body</strong>å±æ€§ï¼Œè¦ä¹ˆæŠŠå®ƒæ”¾åœ¨è§†å›¾çš„æ–¹æ³•ä¸­ï¼Œè¦ä¹ˆæŠŠå®ƒæ”¾åœ¨çŠ¶æ€çš„æ–¹æ³•ä¸­ã€‚è¿™è‡³å°‘å…è®¸æ‚¨è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œå¹¶æ–­è¨€çŠ¶æ€å·²æŒ‰æ‚¨æœŸæœ›çš„æ–¹å¼æ›´æ”¹ã€‚ä½†æ˜¯ï¼Œè¿™ä¸æˆ‘ä»¬åœ¨å¯ç»„åˆæ¶æ„ä¸­æ‰€åšçš„éå¸¸ç›¸ä¼¼ã€‚æˆ‘ä»¬å†³å®šä¸ç›´æ¥åœ¨è§†å›¾ä¸­æ‰§è¡Œçªå˜ï¼Œè€Œæ˜¯é€šè¿‡æšä¸¾æè¿°çªå˜ï¼Œå¹¶ç¼–å†™reducersæ¥å®é™…æ‰§è¡Œçªå˜ã€‚</p>
</li>
<li>
<p>å¦‚æœä½ æƒ³æ›´è¿›ä¸€æ­¥ï¼Œä½ è¿˜åº”è¯¥è€ƒè™‘ä½ ä½¿ç”¨å“ªäº›SwiftUIç‰¹æ€§æ¥å»ºæ¨¡ä½ çš„çŠ¶æ€ã€‚å°†å¤§çš„çŠ¶æ€é›†åˆä¸­çš„å‡ ä¸ªå­—æ®µæŠ•å°„åˆ°ç»‘å®šä¸­æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†æ˜¯å¦‚æœè¿™æ ·åšï¼Œå°±å¤±å»äº†å…¨é¢æ–­è¨€æµ‹è¯•ä¸­çŠ¶æ€å¦‚ä½•å˜åŒ–çš„èƒ½åŠ›ã€‚å¦‚æœä½ æƒ³æ¢å¤ç©·å°½æ€§ä½ å¿…é¡»æŠŠè¿™äº›å­—æ®µæ†ç»‘åˆ°è‡ªå·±çš„ç»“æ„ä¸­å¹¶åœ¨ä½ çš„åº”ç”¨çŠ¶æ€ä¸Šåˆ›å»ºä¸€ä¸ªè®¡ç®—å±æ€§æ¥æ´¾ç”Ÿé‚£ä¸ªå­çŠ¶æ€ã€‚ä½†æ˜¯ï¼Œè¿™ä¸æˆ‘ä»¬åœ¨å¯ç»„åˆæ¶æ„ä¸­æ‰€åšçš„éå¸¸ç›¸ä¼¼ã€‚æˆ‘ä»¬åˆ›å»ºäº†å°çš„çŠ¶æ€ç»“æ„æ¥ä¿å­˜ç‰¹å®šäºè§†å›¾çš„çŠ¶æ€ï¼Œå¹¶åˆ›å»ºäº†å°†å…¶æ’å…¥åˆ°å…¨å±€çŠ¶æ€æ‰€éœ€çš„å¯ç»„åˆæ€§å·¥å…·ï¼Œå› ä¸ºæˆ‘ä»¬è¿™æ ·åšäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å…è´¹è·å¾—äº†è¯¦å°½çš„æµ‹è¯•ã€‚</p>
</li>
<li>
<p>åœ¨è§†å›¾ä¸­ä½¿ç”¨@<strong>State</strong>æ¥å»ºæ¨¡æœ¬åœ°çŠ¶æ€ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ä½†è¿™æ˜¯ä»¥æ— æ³•éªŒè¯ä¸ºä»£ä»·çš„ã€‚åœ¨è°ƒç”¨è§†å›¾ä¸Šçš„å„ç§æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¼¼ä¹æ— æ³•æ”¹å˜è¿™äº›å€¼ã€‚è·å¾—å¯æµ‹è¯•æ€§çš„å”¯ä¸€æ–¹æ³•æ˜¯å°†è¯¥çŠ¶æ€ä»æœ¬åœ°@<strong>State</strong>ç»‘å®šè½¬ç§»åˆ°åº”ç”¨ç¨‹åºçŠ¶æ€ï¼Œè¿™æ„å‘³ç€è½¬æ¢ä¸º@<strong>Binding</strong>æˆ–@<strong>ObservedObject</strong>ã€‚å†è¯´ä¸€æ¬¡ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬åœ¨å¯ç»„åˆæ¶æ„ä¸­æ‰€åšçš„ã€‚æˆ‘ä»¬éœ€è¦å°†ä¸€äº›@Stateå­—æ®µç§»å‡ºè§†å›¾ï¼Œè¿›å…¥å…¨å±€åº”ç”¨çŠ¶æ€ï¼Œæ¯”å¦‚è­¦æŠ¥çŠ¶æ€å’ŒæŒ‰é’®ç¦ç”¨çŠ¶æ€ã€‚å½“æ—¶æˆ‘ä»¬è¿™ä¹ˆåšæ˜¯å› ä¸ºæ§åˆ¶è¿™ç§çŠ¶æ€çš„é€»è¾‘å¾ˆå¾®å¦™ï¼Œæˆ‘ä»¬æƒ³æŠŠå®ƒç§»åŠ¨åˆ°æˆ‘ä»¬çš„<strong>reducers</strong>ã€‚ä½†åæ¥æˆ‘ä»¬æ˜¾ç¤ºå®ƒç»™æˆ‘ä»¬å†™ä¸€äº›å¾ˆç¥å¥‡çš„æµ‹è¯•çš„èƒ½åŠ›,åŒ…æ‹¬èƒ½å¤Ÿå‘æŒ¥å‡ºä¸€ä¸ªå®Œæ•´çš„è„šæœ¬çš„ç”¨æˆ·æ“ä½œ(ä¾‹å¦‚å¼€å‘ä¸€ä¸ªæŒ‰é’®,è¿è¡Œæ•ˆæœ,è§¦å‘ä¸€ä¸ªè­¦å‘Š,å¹¶è§£é›‡è­¦æŠ¥),å¹¶ç¡®ä¿çŠ¶æ€æ”¹å˜æˆ‘ä»¬å¦‚ä½•æœŸå¾…ã€‚</p>
</li>
</ul>
<p>è¿˜æœ‰å¾ˆå¤šé—®é¢˜ç­‰ç€æˆ‘ä»¬å»å›ç­”ï¼Œè¿˜æœ‰å¾ˆå¤šäº‹æƒ…ç­‰ç€æˆ‘ä»¬å»æ¢ç´¢ã€‚æ¯”å¦‚:</p>
<ul>
<li>åœ¨å¯ç»„åˆæ¶æ„å¦‚ä½•æ­£ç¡®å¤„ç†alertï¼Œæ¨¡æ€å’Œå¼¹çª—?</li>
<li>æˆ‘ä»¬æ˜¯å¦å¯ä»¥å°†è¿™ä¸ªä½“ç³»ç»“æ„ç”¨äºé‚£äº›ä»ç„¶åœ¨çº¯UIKitä¸­æ„å»ºçš„è§†å›¾?</li>
<li>è¿™ä¸ªä½“ç³»ç»“æ„çš„æ€§èƒ½å¦‚ä½•?æœ‰ä»€ä¹ˆéœ€è¦æˆ‘ä»¬æ³¨æ„çš„å—?</li>
<li>æˆ‘ä»¬èƒ½æ”¹å–„å»ºç­‘çš„äººä½“å·¥ç¨‹å­¦å—?æˆ‘ä»¬å·²ç»åšè¿‡å‡ æ¬¡äº†ï¼Œä½†è¿˜æœ‰æ›´å¤šçš„äº‹æƒ…è¦åšã€‚</li>
<li>åœ¨è¿™ä¸ªä½“ç³»ç»“æ„ä¸­å¤„ç†ä¾èµ–å…³ç³»çš„æœ€å¥½æ–¹æ³•æ˜¯ä»€ä¹ˆ?æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ç¯å¢ƒä¸­åšäº†ä¸€ç‚¹è¿™æ–¹é¢çš„å·¥ä½œï¼Œä½†å®ƒèƒ½å¾—åˆ°æ”¹å–„å—?</li>
</ul>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://kayouyou.github.io/tag/i-r9uoo_2N/" class="tag">
                    PointFree
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kayouyou.github.io/post/pointfree-episode-84testable-state-management-ergonomics/">
                  <h3 class="post-title">
                    PointFree Episode 84:Testable State Management: Ergonomics
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
